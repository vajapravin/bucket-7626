/*! Copyright Elasticsearch B.V. and/or license to Elasticsearch B.V. under one or more contributor license agreements
 * Licensed under the Elastic License; you may not use this file except in compliance with the Elastic License. */(function(modules){function webpackJsonpCallback(data){var chunkIds=data[0];var moreModules=data[1];var executeModules=data[2];var moduleId,chunkId,i=0,resolves=[];for(;i<chunkIds.length;i++){chunkId=chunkIds[i];if(installedChunks[chunkId]){resolves.push(installedChunks[chunkId][0])}installedChunks[chunkId]=0}for(moduleId in moreModules){if(Object.prototype.hasOwnProperty.call(moreModules,moduleId)){modules[moduleId]=moreModules[moduleId]}}if(parentJsonpFunction)parentJsonpFunction(data);while(resolves.length){resolves.shift()()}deferredModules.push.apply(deferredModules,executeModules||[]);return checkDeferredModules()}function checkDeferredModules(){var result;for(var i=0;i<deferredModules.length;i++){var deferredModule=deferredModules[i];var fulfilled=true;for(var j=1;j<deferredModule.length;j++){var depId=deferredModule[j];if(installedChunks[depId]!==0)fulfilled=false}if(fulfilled){deferredModules.splice(i--,1);result=__webpack_require__(__webpack_require__.s=deferredModule[0])}}return result}var installedModules={};var installedChunks={10:0};var deferredModules=[];function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="__REPLACE_WITH_PUBLIC_PATH__";var jsonpArray=window["webpackJsonp"]=window["webpackJsonp"]||[];var oldJsonpFunction=jsonpArray.push.bind(jsonpArray);jsonpArray.push=webpackJsonpCallback;jsonpArray=jsonpArray.slice();for(var i=0;i<jsonpArray.length;i++)webpackJsonpCallback(jsonpArray[i]);var parentJsonpFunction=oldJsonpFunction;deferredModules.push([2189,0]);return checkDeferredModules()})({1000:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2328);__webpack_require__(274)},1001:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2330)},1002:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2332)},1003:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2334)},1004:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2337)},1005:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.PopulationJobServiceProvider=PopulationJobServiceProvider;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _general=__webpack_require__(259);var _job_utils=__webpack_require__(34);var _ml_time_buckets=__webpack_require__(258);var _field_format_service=__webpack_require__(209);var _job_service=__webpack_require__(23);var _new_job_utils=__webpack_require__(220);var _ml_api_service=__webpack_require__(22);var _timefilter=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function PopulationJobServiceProvider(Private){var TimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider);var OVER_FIELD_EXAMPLES_COUNT=40;var PopulationJobService=function(){function PopulationJobService(){_classCallCheck(this,PopulationJobService);this.chartData={job:{swimlane:[],line:[],bars:[],earliestTime:Number.MAX_SAFE_INTEGER},detectors:{},percentComplete:0,loadingDifference:0,lastLoadTimestamp:null,eventRateHighestValue:0,chartTicksMargin:{width:30},totalResults:0};this.job={}}_createClass(PopulationJobService,[{key:"clearChartData",value:function clearChartData(){this.chartData.job.swimlane=[];this.chartData.job.line=[];this.chartData.job.bars=[];this.chartData.detectors={};this.chartData.percentComplete=0;this.chartData.loadingDifference=0;this.chartData.eventRateHighestValue=0;this.chartData.totalResults=0;this.job={}}},{key:"getLineChartResults",value:function getLineChartResults(formConfig,thisLoadTimestamp){var _this=this;return new Promise(function(resolve,reject){var fieldIds=formConfig.fields.map(function(f){return f.id});_this.chartData.job.earliestTime=formConfig.start;var idx=_lodash2.default.findIndex(fieldIds,function(id){return id===_general.EVENT_RATE_COUNT_FIELD});if(idx!==-1){fieldIds.splice(idx,1);fieldIds.splice(0,0,_general.EVENT_RATE_COUNT_FIELD)}fieldIds.forEach(function(fieldId,i){_this.chartData.detectors[i]={line:[],swimlane:[],highestValue:0}});var searchJson=getSearchJsonFromConfig(formConfig,_timefilter.timefilter,TimeBuckets);_ml_api_service.ml.esSearch(searchJson).then(function(resp){if(thisLoadTimestamp===_this.chartData.lastLoadTimestamp){fieldIds.forEach(function(fieldId,i){_this.chartData.detectors[i]={line:[],swimlane:[],highestValue:0};if(fieldId!==_general.EVENT_RATE_COUNT_FIELD){var field=formConfig.fields[i];var aggType=field.agg.type.dslName;_this.chartData.detectors[i].fieldFormat=_field_format_service.mlFieldFormatService.getFieldFormatFromIndexPattern(formConfig.indexPattern,fieldId,aggType)}})}else{resolve(_this.chartData)}var aggregationsByTime=_lodash2.default.get(resp,["aggregations","times","buckets"],[]);_lodash2.default.each(aggregationsByTime,function(dataForTime){var time=+dataForTime.key;var date=new Date(time);_this.chartData.job.swimlane.push({date:date,time:time,value:0,color:"",percentComplete:0});_this.chartData.job.earliestTime=time<_this.chartData.job.earliestTime?time:_this.chartData.job.earliestTime;_this.chartData.job.line.push({date:date,time:time,value:null});fieldIds.forEach(function(fieldId,i){var populationBuckets=_lodash2.default.get(dataForTime,["population","buckets"],[]);var values=[];if(fieldId===_general.EVENT_RATE_COUNT_FIELD){populationBuckets.forEach(function(b){if(b[i]===undefined){values.push({label:b.key,value:b.doc_count})}else{values.push({label:b.key,value:b[i].doc_count})}})}else if(typeof dataForTime.population!=="undefined"){populationBuckets.forEach(function(b){var tempBucket=b[i];var value=null;var tempValue=tempBucket.value===undefined&&tempBucket.splitValue!==undefined?tempBucket.splitValue:tempBucket;if(tempValue.value===undefined&&tempValue.values!==undefined){value=tempValue.values[_job_utils.ML_MEDIAN_PERCENTS]}else{value=tempValue.value}values.push({label:b.key,value:isFinite(value)?value:null})})}var highestValueField=_lodash2.default.reduce(values,function(p,c){return c.value>p.value?c:p},{value:0});if(_this.chartData.detectors[i]){_this.chartData.detectors[i].line.push({date:date,time:time,values:values});_this.chartData.detectors[i].swimlane.push({date:date,time:time,value:0,color:"",percentComplete:0});_this.chartData.detectors[i].highestValue=Math.ceil(Math.max(_this.chartData.detectors[i].highestValue,Math.abs(highestValueField.value)))}})});resolve(_this.chartData)}).catch(function(resp){reject(resp)})})}},{key:"getJobFromConfig",value:function getJobFromConfig(formConfig){var job=_job_service.mlJobService.getBlankJob();job.data_description.time_field=formConfig.timeField;if(formConfig.enableModelPlot===true){job.model_plot_config={enabled:true}}else if(formConfig.enableModelPlot===false){delete job.model_plot_config}formConfig.fields.forEach(function(field){var func=field.agg.type.mlName;if(formConfig.isSparseData){if(field.agg.type.dslName==="count"){func=func.replace(/count/,"non_zero_count")}else if(field.agg.type.dslName==="sum"){func=func.replace(/sum/,"non_null_sum")}}var dtr={function:func};dtr.detector_description=func;if(field.id!==_general.EVENT_RATE_COUNT_FIELD){dtr.field_name=field.name;dtr.detector_description+="("+field.name+")"}if(field.splitField!==undefined){dtr.by_field_name=field.splitField.name;dtr.detector_description+=" by "+dtr.by_field_name}if(formConfig.overField!==undefined){dtr.over_field_name=formConfig.overField.name;dtr.detector_description+=" over "+dtr.over_field_name}job.analysis_config.detectors.push(dtr)});var influencerFields=formConfig.influencerFields.map(function(f){return f.name});if(influencerFields&&influencerFields.length){job.analysis_config.influencers=influencerFields}var query=formConfig.combinedQuery;job.analysis_config.bucket_span=formConfig.bucketSpan;job.analysis_limits={model_memory_limit:formConfig.modelMemoryLimit};delete job.data_description.field_delimiter;delete job.data_description.quote_character;delete job.data_description.time_format;delete job.data_description.format;var indices=formConfig.indexPattern.title.split(",").map(function(i){return i.trim()});job.datafeed_config={query:query,indices:indices};job.job_id=formConfig.jobId;job.description=formConfig.description;job.groups=formConfig.jobGroups;if(formConfig.useDedicatedIndex){job.results_index_name=job.job_id}if(formConfig.usesSavedSearch===false){job.custom_settings={created_by:_general.WIZARD_TYPE.POPULATION}}return job}},{key:"createJob",value:function createJob(formConfig){var _this2=this;return new Promise(function(resolve,reject){_this2.job=_this2.getJobFromConfig(formConfig);var job=(0,_new_job_utils.createJobForSaving)(_this2.job);_job_service.mlJobService.saveNewJob(job).then(function(resp){if(resp.success){resolve(_this2.job)}else{reject(resp)}})})}},{key:"startDatafeed",value:function startDatafeed(formConfig){var datafeedId=_job_service.mlJobService.getDatafeedId(formConfig.jobId);return _job_service.mlJobService.startDatafeed(datafeedId,formConfig.jobId,formConfig.start,formConfig.end)}},{key:"stopDatafeed",value:function stopDatafeed(formConfig){var datafeedId=_job_service.mlJobService.getDatafeedId(formConfig.jobId);return _job_service.mlJobService.stopDatafeed(datafeedId,formConfig.jobId)}}]);return PopulationJobService}();function getSearchJsonFromConfig(formConfig){var bounds=_timefilter.timefilter.getActiveBounds();var buckets=new TimeBuckets;buckets.setInterval("auto");buckets.setBounds(bounds);var interval=buckets.getInterval().asMilliseconds();var query=_lodash2.default.cloneDeep(formConfig.combinedQuery);var json={index:formConfig.indexPattern.title,size:0,body:{query:{},aggs:{times:{date_histogram:{field:formConfig.timeField,interval:interval,min_doc_count:0,extended_bounds:{min:formConfig.start,max:formConfig.end}}}}}};query.bool.must.push({range:_defineProperty({},formConfig.timeField,{gte:formConfig.start,lte:formConfig.end,format:formConfig.format})});json.body.query=query;if(formConfig.fields.length){var aggs={};formConfig.fields.forEach(function(field,i){if(field.id===_general.EVENT_RATE_COUNT_FIELD){if(field.splitField!==undefined&&field.firstSplitFieldName!==undefined){aggs[i]={filter:{term:_defineProperty({},field.splitField.name,field.firstSplitFieldName)}}}}else{if(field.splitField!==undefined&&field.firstSplitFieldName!==undefined){aggs[i]={filter:{term:_defineProperty({},field.splitField.name,field.firstSplitFieldName)},aggs:{splitValue:_defineProperty({},field.agg.type.dslName,{field:field.name})}};if(field.agg.type.dslName==="percentiles"){aggs[i].aggs.splitValue[field.agg.type.dslName].percents=[_job_utils.ML_MEDIAN_PERCENTS]}}else{aggs[i]=_defineProperty({},field.agg.type.dslName,{field:field.name});if(field.agg.type.dslName==="percentiles"){aggs[i][field.agg.type.dslName].percents=[_job_utils.ML_MEDIAN_PERCENTS]}}}});if(formConfig.overField!==undefined){json.body.aggs.times.aggs={population:{terms:{field:formConfig.overField.name,size:OVER_FIELD_EXAMPLES_COUNT},aggs:aggs}}}else{json.body.aggs.times.aggs=aggs}}return json}return new PopulationJobService}},1006:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.CreateRecognizerJobsServiceProvider=CreateRecognizerJobsServiceProvider;var _saved_objects=__webpack_require__(50);var _job_service=__webpack_require__(23);var _ml_api_service=__webpack_require__(22);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function CreateRecognizerJobsServiceProvider(Private){var savedObjectsClient=Private(_saved_objects.SavedObjectsClientProvider);var CreateRecognizerJobsService=function(){function CreateRecognizerJobsService(){_classCallCheck(this,CreateRecognizerJobsService)}_createClass(CreateRecognizerJobsService,[{key:"createDatafeed",value:function createDatafeed(job,formConfig){return new Promise(function(resolve,reject){var jobId=formConfig.jobLabel+job.id;_job_service.mlJobService.saveNewDatafeed(job.datafeedConfig,jobId).then(function(resp){resolve(resp)}).catch(function(resp){reject(resp)})})}},{key:"startDatafeed",value:function startDatafeed(datafeedId,jobId,start,end){return _job_service.mlJobService.startDatafeed(datafeedId,jobId,start,end)}},{key:"loadExistingSavedObjects",value:function loadExistingSavedObjects(type){return savedObjectsClient.find({type:type,perPage:1e3})}},{key:"indexTimeRange",value:function indexTimeRange(indexPattern,formConfig){var query=formConfig.combinedQuery;return _ml_api_service.ml.getTimeFieldRange({index:indexPattern.title,timeFieldName:indexPattern.timeFieldName,query:query})}}]);return CreateRecognizerJobsService}();return new CreateRecognizerJobsService}},1007:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2360);__webpack_require__(1008)},1008:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DataRecognizer=undefined;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _recognized_result=__webpack_require__(2361);var _ml_api_service=__webpack_require__(22);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DataRecognizer=exports.DataRecognizer=function(_Component){_inherits(DataRecognizer,_Component);function DataRecognizer(props){_classCallCheck(this,DataRecognizer);var _this=_possibleConstructorReturn(this,(DataRecognizer.__proto__||Object.getPrototypeOf(DataRecognizer)).call(this,props));_this.state={results:[]};_this.indexPattern=props.indexPattern;_this.savedSearch=props.savedSearch;_this.className=props.className;_this.results=props.results;return _this}_createClass(DataRecognizer,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;_ml_api_service.ml.recognizeIndex({indexPatternTitle:this.indexPattern.title}).then(function(resp){var results=resp.map(function(r){return _react2.default.createElement(_recognized_result.RecognizedResult,{key:r.id,config:r,indexPattern:_this2.indexPattern,savedSearch:_this2.savedSearch})});if(_typeof(_this2.results)==="object"){_this2.results.count=results.length;if(typeof _this2.results.onChange==="function"){_this2.results.onChange()}}_this2.setState({results:results})})}},{key:"render",value:function render(){return _react2.default.createElement("div",{className:this.className},this.state.results)}}]);return DataRecognizer}(_react.Component);DataRecognizer.propTypes={indexPattern:_propTypes2.default.object,savedSearch:_propTypes2.default.object,className:_propTypes2.default.string,results:_propTypes2.default.object}},1009:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2390)},1010:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EntityCell=EntityCell;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function EntityCell(_ref){var entityName=_ref.entityName,entityValue=_ref.entityValue,filter=_ref.filter;var valueText=entityName!=="mlcategory"?entityValue:"mlcategory "+entityValue;return _react2.default.createElement(_react2.default.Fragment,null,valueText,filter!==undefined&&entityName!==undefined&&entityValue!==undefined&&_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiToolTip,{content:"Add filter"},_react2.default.createElement(_eui.EuiButtonIcon,{size:"xs",className:"filter-button",onClick:function onClick(){return filter(entityName,entityValue,"+")},iconType:"plusInCircle","aria-label":"Add filter"})),_react2.default.createElement(_eui.EuiToolTip,{content:"Remove filter"},_react2.default.createElement(_eui.EuiButtonIcon,{size:"xs",className:"filter-button",onClick:function onClick(){return filter(entityName,entityValue,"-")},iconType:"minusInCircle","aria-label":"Remove filter"}))))}EntityCell.propTypes={entityName:_propTypes2.default.string,entityValue:_propTypes2.default.any,filter:_propTypes2.default.func}},1011:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _detector_description_list=__webpack_require__(2400);Object.defineProperty(exports,"DetectorDescriptionList",{enumerable:true,get:function get(){return _detector_description_list.DetectorDescriptionList}})},1012:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2412);__webpack_require__(1013);__webpack_require__(2418);__webpack_require__(2421)},1013:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2416)},1014:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.refreshIntervalWatcher=refreshIntervalWatcher;var _timefilter=__webpack_require__(16);function refreshIntervalWatcher($timeout){var refresher=void 0;var listener=void 0;var onRefreshIntervalChange=function onRefreshIntervalChange(){if(refresher){$timeout.cancel(refresher)}var interval=_timefilter.timefilter.getRefreshInterval();if(interval.value>0&&!interval.pause){var startRefresh=function startRefresh(){refresher=$timeout(function(){startRefresh();listener()},interval.value)};startRefresh()}};function init(listenerCallback){listener=listenerCallback;_timefilter.timefilter.on("refreshIntervalUpdate",onRefreshIntervalChange)}function cancel(){$timeout.cancel(refresher);_timefilter.timefilter.off("refreshIntervalUpdate",onRefreshIntervalChange)}return{init:init,cancel:cancel}}},1015:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.LoadingIndicator=LoadingIndicator;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function LoadingIndicator(_ref){var height=_ref.height;height=height?+height:100;return _react2.default.createElement("div",{className:"ml-loading-indicator",style:{height:height+"px"}},_react2.default.createElement("div",{className:"loading-spinner"},_react2.default.createElement("i",{className:"fa fa-spinner fa-spin"})))}LoadingIndicator.propTypes={height:_propTypes2.default.number}},1016:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.buildConfigFromDetector=buildConfigFromDetector;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _job_utils=__webpack_require__(34);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function buildConfigFromDetector(job,detectorIndex){var analysisConfig=job.analysis_config;var detector=analysisConfig.detectors[detectorIndex];var config={jobId:job.job_id,detectorIndex:detectorIndex,metricFunction:(0,_job_utils.mlFunctionToESAggregation)(detector.function),timeField:job.data_description.time_field,interval:job.analysis_config.bucket_span,datafeedConfig:job.datafeed_config};if(detector.field_name!==undefined){config.metricFieldName=detector.field_name}var summaryCountFieldName=analysisConfig.summary_count_field_name;if(config.metricFunction==="count"&&summaryCountFieldName!==undefined&&summaryCountFieldName!=="doc_count"){var cardinalityField=undefined;var topAgg=_lodash2.default.get(job.datafeed_config,"aggregations")||_lodash2.default.get(job.datafeed_config,"aggs");if(topAgg!==undefined&&_lodash2.default.values(topAgg).length>0){cardinalityField=_lodash2.default.get(_lodash2.default.values(topAgg)[0],["aggregations",summaryCountFieldName,"cardinality","field"])||_lodash2.default.get(_lodash2.default.values(topAgg)[0],["aggs",summaryCountFieldName,"cardinality","field"])}if(detector.function==="non_zero_count"&&cardinalityField!==undefined){config.metricFunction="cardinality";config.metricFieldName=cardinalityField}else{config.metricFunction="sum";config.metricFieldName=summaryCountFieldName}}return config}},1017:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var MESSAGE_LEVEL=exports.MESSAGE_LEVEL={ERROR:"error",INFO:"info",SUCCESS:"success",WARNING:"warning"}},1018:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createTimeSeriesJobData=createTimeSeriesJobData;exports.processMetricPlotResults=processMetricPlotResults;exports.processForecastResults=processForecastResults;exports.processRecordScoreResults=processRecordScoreResults;exports.processDataForFocusAnomalies=processDataForFocusAnomalies;exports.processScheduledEventsForChart=processScheduledEventsForChart;exports.findNearestChartPointToTime=findNearestChartPointToTime;exports.findChartPointForAnomalyTime=findChartPointForAnomalyTime;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _parse_interval=__webpack_require__(196);var _job_utils=__webpack_require__(34);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function createTimeSeriesJobData(jobs){var singleTimeSeriesJobs=jobs.filter(_job_utils.isTimeSeriesViewJob);return singleTimeSeriesJobs.map(function(job){var bucketSpan=(0,_parse_interval.parseInterval)(job.analysis_config.bucket_span);return{id:job.job_id,selected:false,bucketSpanSeconds:bucketSpan.asSeconds()}})}function processMetricPlotResults(metricPlotData,modelPlotEnabled){var metricPlotChartData=[];if(modelPlotEnabled===true){_lodash2.default.each(metricPlotData,function(dataForTime,time){metricPlotChartData.push({date:new Date(+time),lower:dataForTime.modelLower,value:dataForTime.actual,upper:dataForTime.modelUpper})})}else{_lodash2.default.each(metricPlotData,function(dataForTime,time){metricPlotChartData.push({date:new Date(+time),value:dataForTime.actual})})}return metricPlotChartData}function processForecastResults(forecastData){var forecastPlotChartData=[];_lodash2.default.each(forecastData,function(dataForTime,time){forecastPlotChartData.push({date:new Date(+time),isForecast:true,lower:dataForTime.forecastLower,value:dataForTime.prediction,upper:dataForTime.forecastUpper})});return forecastPlotChartData}function processRecordScoreResults(scoreData){var bucketScoreData=[];_lodash2.default.each(scoreData,function(dataForTime,time){bucketScoreData.push({date:new Date(+time),score:dataForTime.score})});return bucketScoreData}function processDataForFocusAnomalies(chartData,anomalyRecords,timeFieldName){anomalyRecords.forEach(function(record){var recordTime=record[timeFieldName];var chartPoint=findChartPointForAnomalyTime(chartData,recordTime);if(chartPoint===undefined&&chartData!==undefined&&chartData.length){var lastChartPoint=chartData[chartData.length-1];var lastChartPointScore=lastChartPoint.anomalyScore||0;if(record.record_score>lastChartPointScore){chartPoint=lastChartPoint}}if(chartPoint!==undefined){var recordScore=record.record_score;var pointScore=chartPoint.anomalyScore;if(pointScore===undefined||pointScore<recordScore){chartPoint.anomalyScore=recordScore;chartPoint.function=record.function;if(_lodash2.default.has(record,"actual")){chartPoint.actual=record.actual;chartPoint.typical=record.typical}else{var causes=_lodash2.default.get(record,"causes",[]);if(causes.length>0){chartPoint.byFieldName=record.by_field_name;chartPoint.numberOfCauses=causes.length;if(causes.length===1){var cause=_lodash2.default.first(record.causes);chartPoint.actual=cause.actual;chartPoint.typical=cause.typical}}}if(_lodash2.default.has(record,"multi_bucket_impact")){chartPoint.multiBucketImpact=record.multi_bucket_impact}}}});return chartData}function processScheduledEventsForChart(chartData,scheduledEvents){if(scheduledEvents!==undefined){_lodash2.default.each(scheduledEvents,function(events,time){var chartPoint=findNearestChartPointToTime(chartData,time);if(chartPoint!==undefined){chartPoint.scheduledEvents=events}})}return chartData}function findNearestChartPointToTime(chartData,time){var chartPoint=void 0;if(chartData===undefined){return chartPoint}for(var i=0;i<chartData.length;i++){if(chartData[i].date.getTime()===time){chartPoint=chartData[i];break}}if(chartPoint===undefined){var foundItem=void 0;for(var _i=0;_i<chartData.length;_i++){var itemTime=chartData[_i].date.getTime();if(itemTime>time){var item=chartData[_i];var previousItem=chartData[_i-1];var diff1=Math.abs(time-previousItem.date.getTime());var diff2=Math.abs(time-itemTime);if(previousItem===undefined||diff1>diff2){foundItem=item}else{foundItem=previousItem}break}}chartPoint=foundItem}return chartPoint}function findChartPointForAnomalyTime(chartData,anomalyTime){var chartPoint=void 0;if(chartData===undefined){return chartPoint}for(var i=0;i<chartData.length;i++){if(chartData[i].date.getTime()===anomalyTime){chartPoint=chartData[i];break}}if(chartPoint===undefined){var foundItem=void 0;for(var _i2=0;_i2<chartData.length;_i2++){var itemTime=chartData[_i2].date.getTime();if(itemTime>anomalyTime){foundItem=_i2>0?chartData[_i2-1]:chartData[0];break}}chartPoint=foundItem}return chartPoint}},1020:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mlTimeSeriesSearchService=undefined;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _ml_api_service=__webpack_require__(22);var _job_utils=__webpack_require__(34);var _chart_config_builder=__webpack_require__(1016);var _results_service=__webpack_require__(338);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getMetricData(job,detectorIndex,entityFields,earliestMs,latestMs,interval){if((0,_job_utils.isModelPlotEnabled)(job,detectorIndex,entityFields)){var criteriaFields=[];var detector=job.analysis_config.detectors[detectorIndex];if(_lodash2.default.has(detector,"partition_field_name")){var partitionEntity=_lodash2.default.find(entityFields,{fieldName:detector.partition_field_name});if(partitionEntity!==undefined){criteriaFields.push({fieldName:"partition_field_name",fieldValue:partitionEntity.fieldName},{fieldName:"partition_field_value",fieldValue:partitionEntity.fieldValue})}}if(_lodash2.default.has(detector,"over_field_name")){var overEntity=_lodash2.default.find(entityFields,{fieldName:detector.over_field_name});if(overEntity!==undefined){criteriaFields.push({fieldName:"over_field_name",fieldValue:overEntity.fieldName},{fieldName:"over_field_value",fieldValue:overEntity.fieldValue})}}if(_lodash2.default.has(detector,"by_field_name")){var byEntity=_lodash2.default.find(entityFields,{fieldName:detector.by_field_name});if(byEntity!==undefined){criteriaFields.push({fieldName:"by_field_name",fieldValue:byEntity.fieldName},{fieldName:"by_field_value",fieldValue:byEntity.fieldValue})}}return _results_service.mlResultsService.getModelPlotOutput(job.job_id,detectorIndex,criteriaFields,earliestMs,latestMs,interval)}else{return new Promise(function(resolve,reject){var obj={success:true,results:{}};var chartConfig=(0,_chart_config_builder.buildConfigFromDetector)(job,detectorIndex);_results_service.mlResultsService.getMetricData(chartConfig.datafeedConfig.indices,chartConfig.datafeedConfig.types,entityFields,chartConfig.datafeedConfig.query,chartConfig.metricFunction,chartConfig.metricFieldName,chartConfig.timeField,earliestMs,latestMs,interval).then(function(resp){_lodash2.default.each(resp.results,function(value,time){obj.results[time]={actual:value}});resolve(obj)}).catch(function(resp){reject(resp)})})}}function getChartDetails(job,detectorIndex,entityFields,earliestMs,latestMs){return new Promise(function(resolve,reject){var obj={success:true,results:{functionLabel:"",entityData:{entities:[]}}};var chartConfig=(0,_chart_config_builder.buildConfigFromDetector)(job,detectorIndex);var functionLabel=chartConfig.metricFunction;if(chartConfig.metricFieldName!==undefined){functionLabel+=" ";functionLabel+=chartConfig.metricFieldName}obj.results.functionLabel=functionLabel;var blankEntityFields=_lodash2.default.filter(entityFields,function(entity){return entity.fieldValue.length===0});if(blankEntityFields.length===0){obj.results.entityData.count=1;obj.results.entityData.entities=entityFields;resolve(obj)}else{var entityFieldNames=_lodash2.default.map(blankEntityFields,"fieldName");_ml_api_service.ml.getCardinalityOfFields({index:chartConfig.datafeedConfig.indices,types:chartConfig.datafeedConfig.types,fieldNames:entityFieldNames,query:chartConfig.datafeedConfig.query,timeFieldName:chartConfig.timeField,earliestMs:earliestMs,latestMs:latestMs}).then(function(results){_lodash2.default.each(blankEntityFields,function(field){obj.results.entityData.entities.push({fieldName:field.fieldName,cardinality:_lodash2.default.get(results,field.fieldName,0)})});resolve(obj)}).catch(function(resp){reject(resp)})}})}var mlTimeSeriesSearchService=exports.mlTimeSeriesSearchService={getMetricData:getMetricData,getChartDetails:getChartDetails}},1021:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _file_datavisualizer_view=__webpack_require__(2540);Object.defineProperty(exports,"FileDataVisualizerView",{enumerable:true,get:function get(){return _file_datavisualizer_view.FileDataVisualizerView}});Object.defineProperty(exports,"MODE",{enumerable:true,get:function get(){return _file_datavisualizer_view.MODE}})},1022:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _experimental_badge=__webpack_require__(2544);Object.defineProperty(exports,"ExperimentalBadge",{enumerable:true,get:function get(){return _experimental_badge.ExperimentalBadge}})},1023:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _import_progress=__webpack_require__(2574);Object.defineProperty(exports,"ImportProgress",{enumerable:true,get:function get(){return _import_progress.ImportProgress}});Object.defineProperty(exports,"IMPORT_STATUS",{enumerable:true,get:function get(){return _import_progress.IMPORT_STATUS}})},178:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mlMessageBarService=undefined;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _notify=__webpack_require__(10);var _ml_error=__webpack_require__(2207);var messages=[];var MSG_STYLE={INFO:"ml-message-info",WARNING:"ml-message-warning",ERROR:"ml-message-error"};function getMessages(){return messages}function addMessage(msg){if(messages.find(function(m){return m.text===msg.text&&m.style===msg.style})===undefined){messages.push(msg)}}function removeMessage(index){messages.splice(index,1)}function clear(){messages.length=0}function info(text){addMessage({text:text,style:MSG_STYLE.INFO})}function warning(text){addMessage({text:text,style:MSG_STYLE.WARNING})}function error(text,resp){text=text+" "+expandErrorMessageObj(resp);addMessage({text:text,style:MSG_STYLE.ERROR})}function expandErrorMessageObj(resp){var txt="";if(resp!==undefined&&(typeof resp==="undefined"?"undefined":_typeof(resp))==="object"){try{var respObj=JSON.parse(resp.response);if((typeof respObj==="undefined"?"undefined":_typeof(respObj))==="object"&&respObj.error!==undefined){txt=respObj.error.reason}}catch(e){txt=resp.message}}return txt}function errorNotify(text,resp){var err=null;if((typeof text==="undefined"?"undefined":_typeof(text))==="object"&&text.response!==undefined){resp=text.response}else if((typeof text==="undefined"?"undefined":_typeof(text))==="object"&&text.message!==undefined){err=new Error(text.message)}else{err=new Error(text)}_notify.notify.error(new _ml_error.MLRequestFailure(err,resp))}var mlMessageBarService=exports.mlMessageBarService={getMessages:getMessages,addMessage:addMessage,removeMessage:removeMessage,clear:clear,info:info,warning:warning,error:error,notify:{error:errorNotify}}},197:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SCHEDULED_EVENT_SYMBOL_HEIGHT=exports.MULTI_BUCKET_SYMBOL_SIZE=exports.LINE_CHART_ANOMALY_RADIUS=undefined;exports.chartLimits=chartLimits;exports.drawLineChartDots=drawLineChartDots;exports.filterAxisLabels=filterAxisLabels;exports.getChartType=getChartType;exports.getExploreSeriesLink=getExploreSeriesLink;exports.showMultiBucketAnomalyMarker=showMultiBucketAnomalyMarker;exports.showMultiBucketAnomalyTooltip=showMultiBucketAnomalyTooltip;exports.numTicks=numTicks;exports.numTicksForDateFormat=numTicksForDateFormat;exports.getTickValues=getTickValues;exports.isLabelLengthAboveThreshold=isLabelLengthAboveThreshold;exports.getXTransform=getXTransform;exports.removeLabelOverlap=removeLabelOverlap;var _d=__webpack_require__(20);var _d2=_interopRequireDefault(_d);var _string_utils=__webpack_require__(38);var _multi_bucket_impact=__webpack_require__(634);var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _risonNode=__webpack_require__(206);var _risonNode2=_interopRequireDefault(_risonNode);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _timefilter=__webpack_require__(16);var _explorer_constants=__webpack_require__(273);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var LINE_CHART_ANOMALY_RADIUS=exports.LINE_CHART_ANOMALY_RADIUS=7;var MULTI_BUCKET_SYMBOL_SIZE=exports.MULTI_BUCKET_SYMBOL_SIZE=100;var SCHEDULED_EVENT_SYMBOL_HEIGHT=exports.SCHEDULED_EVENT_SYMBOL_HEIGHT=5;var MAX_LABEL_WIDTH=100;function chartLimits(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var limits={max:0,min:0};limits.max=_d2.default.max(data,function(d){return d.value});limits.min=_d2.default.min(data,function(d){return d.value});if(limits.max===limits.min){limits.max=_d2.default.max(data,function(d){if(d.typical){return Math.max(d.value,d.typical)}else{return d.value}});limits.min=_d2.default.min(data,function(d){if(d.typical){return Math.min(d.value,d.typical)}else{return d.value}})}if(limits.max===limits.min){var padding=limits.max*.05;limits.max+=padding;limits.min-=padding}return limits}function drawLineChartDots(data,lineChartGroup,lineChartValuesLine){var radius=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1.5;var dotsData=data.reduce(function(p,c,i){var previous=data[i-1];var next=data[i+1];if((typeof previous==="undefined"||previous&&previous.value===null)&&c.value!==null&&(typeof next==="undefined"||next&&next.value===null)){p.push(c)}return p},[]);var dotGroup=lineChartGroup.select(".values-dots").empty()?lineChartGroup.append("g").classed("values-dots",true):lineChartGroup.select(".values-dots");var dots=dotGroup.selectAll("circle").data(dotsData);dots.enter().append("circle").attr("r",radius);dots.attr("cx",lineChartValuesLine.x()).attr("cy",lineChartValuesLine.y());dots.exit().remove()}function filterAxisLabels(selection,chartWidth){if(selection===undefined||selection.selectAll===undefined){throw new Error("Missing selection parameter")}selection.selectAll(".tick text").text(function(){var parent=_d2.default.select(this.parentNode);var labelWidth=parent.node().getBBox().width;var labelXPos=_d2.default.transform(parent.attr("transform")).translate[0];var minThreshold=labelXPos-labelWidth/2;var maxThreshold=labelXPos+labelWidth/2;if(minThreshold>=0&&maxThreshold<=chartWidth){return this.textContent}else{parent.remove()}})}var EVENT_DISTRIBUTION_ENABLED=true;var POPULATION_DISTRIBUTION_ENABLED=true;function getChartType(config){if(EVENT_DISTRIBUTION_ENABLED&&config.functionDescription==="rare"&&config.entityFields.some(function(f){return f.fieldType==="over"})===false){return _explorer_constants.CHART_TYPE.EVENT_DISTRIBUTION}else if(POPULATION_DISTRIBUTION_ENABLED&&config.functionDescription!=="rare"&&config.entityFields.some(function(f){return f.fieldType==="over"})){return _explorer_constants.CHART_TYPE.POPULATION_DISTRIBUTION}return _explorer_constants.CHART_TYPE.SINGLE_METRIC}function getExploreSeriesLink(series){var bounds=_timefilter.timefilter.getActiveBounds();var from=bounds.min.toISOString();var to=bounds.max.toISOString();var zoomFrom=(0,_moment2.default)(series.plotEarliest).toISOString();var zoomTo=(0,_moment2.default)(series.plotLatest).toISOString();var entityCondition={};series.entityFields.forEach(function(entity){entityCondition[entity.fieldName]=entity.fieldValue});var _g=_risonNode2.default.encode({ml:{jobIds:[series.jobId]},refreshInterval:{display:"Off",pause:false,value:0},time:{from:from,to:to,mode:"absolute"}});var _a=_risonNode2.default.encode({mlTimeSeriesExplorer:{zoom:{from:zoomFrom,to:zoomTo},detectorIndex:series.detectorIndex,entities:entityCondition},filters:[],query:{query_string:{analyze_wildcard:true,query:"*"}}});return _chrome2.default.getBasePath()+"/app/ml#/timeseriesexplorer?_g="+_g+"&_a="+encodeURIComponent(_a)}function showMultiBucketAnomalyMarker(point){return point.multiBucketImpact!==undefined&&point.multiBucketImpact>=_multi_bucket_impact.MULTI_BUCKET_IMPACT.MEDIUM}function showMultiBucketAnomalyTooltip(point){return point.multiBucketImpact!==undefined&&point.multiBucketImpact>=_multi_bucket_impact.MULTI_BUCKET_IMPACT.LOW}function numTicks(axisWidth){return axisWidth/MAX_LABEL_WIDTH}function numTicksForDateFormat(axisWidth,dateFormat){var tickWidth=(0,_string_utils.calculateTextWidth)((0,_moment2.default)().format(dateFormat),false);return axisWidth/(1.75*tickWidth)}var TICK_DIRECTION={NEXT:"next",PREVIOUS:"previous"};function getTickValues(startTimeMs,tickInterval,earliest,latest){if(tickInterval<=0){throw Error("tickInterval must be larger than 0.")}var tickValues=[startTimeMs];function addTicks(ts,operator){var newTick=void 0;var addAnotherTick=void 0;switch(operator){case TICK_DIRECTION.PREVIOUS:newTick=ts-tickInterval;addAnotherTick=newTick>=earliest;break;case TICK_DIRECTION.NEXT:newTick=ts+tickInterval;addAnotherTick=newTick<=latest;break}if(addAnotherTick){tickValues.push(newTick);addTicks(newTick,operator)}}addTicks(startTimeMs,TICK_DIRECTION.PREVIOUS);addTicks(startTimeMs,TICK_DIRECTION.NEXT);tickValues.sort();return tickValues}var LABEL_WRAP_THRESHOLD=60;function isLabelLengthAboveThreshold(_ref){var detectorLabel=_ref.detectorLabel,entityFields=_ref.entityFields;var labelLength=detectorLabel.length+entityFields.map(function(d){return d.fieldName+" "+d.fieldValue}).join(" ").length;return labelLength>LABEL_WRAP_THRESHOLD}function getXTransform(t){var regexResult=/translate\(\s*([^\s,)]+)([ ,]([^\s,)]+))?\)/.exec(t);if(Array.isArray(regexResult)&&regexResult.length>=2){return Number(regexResult[1])}return NaN}function removeLabelOverlap(axis,startTimeMs,tickInterval,width){axis.selectAll("g.tick").select("line").classed("ml-tick-emphasis",true);function getNeighborTickFactory(operator){return function(ts){switch(operator){case TICK_DIRECTION.PREVIOUS:return ts-tickInterval;case TICK_DIRECTION.NEXT:return ts+tickInterval}}}function getTickDataFactory(operator){var getNeighborTick=getNeighborTickFactory(operator);var fn=function fn(ts){var filteredTicks=axis.selectAll(".tick").filter(function(d){return d===ts});if(filteredTicks.length===0||filteredTicks[0].length===0){return false}var tick=_d2.default.selectAll(filteredTicks[0]);var textNode=tick.select("text").node();if(textNode===null){return fn(getNeighborTick(ts))}var tickWidth=textNode.getBBox().width;var padding=15;var xTransform=getXTransform(tick.attr("transform"));var xMinOffset=xTransform-(tickWidth/2+padding);var xMaxOffset=xTransform+(tickWidth/2+padding);return{tick:tick,ts:ts,xMinOffset:xMinOffset,xMaxOffset:xMaxOffset}};return fn}function checkTicks(ts,operator){var getTickData=getTickDataFactory(operator);var currentTickData=getTickData(ts);if(currentTickData===false){return}var getNeighborTick=getNeighborTickFactory(operator);var newTickData=getTickData(getNeighborTick(ts));if(newTickData!==false){if(newTickData.xMinOffset<0||newTickData.xMaxOffset>width||newTickData.xMaxOffset>currentTickData.xMinOffset&&operator===TICK_DIRECTION.PREVIOUS||newTickData.xMinOffset<currentTickData.xMaxOffset&&operator===TICK_DIRECTION.NEXT){newTickData.tick.select("text").remove();newTickData.tick.select("line").classed("ml-tick-emphasis",false);checkTicks(currentTickData.ts,operator)}else{checkTicks(newTickData.ts,operator)}}}checkTicks(startTimeMs,TICK_DIRECTION.PREVIOUS);checkTicks(startTimeMs,TICK_DIRECTION.NEXT)}},209:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mlFieldFormatService=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _job_utils=__webpack_require__(34);var _index_utils=__webpack_require__(62);var _job_service=__webpack_require__(23);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var FieldFormatService=function(){function FieldFormatService(){_classCallCheck(this,FieldFormatService);this.indexPatternIdsByJob={};this.formatsByJob={}}_createClass(FieldFormatService,[{key:"populateFormats",value:function populateFormats(jobIds,indexPatterns){var _this=this;return new Promise(function(resolve,reject){_lodash2.default.each(jobIds,function(jobId){var jobObj=_job_service.mlJobService.getJob(jobId);var datafeedIndices=jobObj.datafeed_config.indices;var indexPattern=_lodash2.default.find(indexPatterns,function(index){return _lodash2.default.find(datafeedIndices,function(datafeedIndex){return index.get("title")===datafeedIndex})});if(indexPattern!==undefined){_this.indexPatternIdsByJob[jobId]=indexPattern.id}});var promises=jobIds.map(function(jobId){return Promise.all([_this.getFormatsForJob(jobId)])});Promise.all(promises).then(function(fmtsByJobByDetector){_lodash2.default.each(fmtsByJobByDetector,function(formatsByDetector,index){_this.formatsByJob[jobIds[index]]=formatsByDetector[0]});resolve(_this.formatsByJob)}).catch(function(err){console.log("fieldFormatService error populating formats:",err);reject({formats:{},err:err})})})}},{key:"getFieldFormat",value:function getFieldFormat(jobId,detectorIndex){return _lodash2.default.get(this.formatsByJob,[jobId,detectorIndex])}},{key:"getFieldFormatFromIndexPattern",value:function getFieldFormatFromIndexPattern(fullIndexPattern,fieldName,esAggName){var fieldFormat=undefined;if(esAggName!=="cardinality"){var indexPatternFields=_lodash2.default.get(fullIndexPattern,"fields.byName",[]);fieldFormat=_lodash2.default.get(indexPatternFields,[fieldName,"format"])}return fieldFormat}},{key:"getFormatsForJob",value:function getFormatsForJob(jobId){var _this2=this;return new Promise(function(resolve,reject){var jobObj=_job_service.mlJobService.getJob(jobId);var detectors=jobObj.analysis_config.detectors||[];var formatsByDetector={};var indexPatternId=_this2.indexPatternIdsByJob[jobId];if(indexPatternId!==undefined){(0,_index_utils.getIndexPatternById)(indexPatternId).then(function(indexPatternData){var fieldsByName=_lodash2.default.get(indexPatternData,"fields.byName",[]);_lodash2.default.each(detectors,function(dtr){var esAgg=(0,_job_utils.mlFunctionToESAggregation)(dtr.function);if(dtr.field_name!==undefined&&esAgg!=="cardinality"){formatsByDetector[dtr.detector_index]=_lodash2.default.get(fieldsByName,[dtr.field_name,"format"])}});resolve(formatsByDetector)}).catch(function(err){reject(err)})}else{resolve(formatsByDetector)}})}}]);return FieldFormatService}();var mlFieldFormatService=exports.mlFieldFormatService=new FieldFormatService},2189:function(module,exports,__webpack_require__){"use strict";__webpack_require__(75);__webpack_require__(76);__webpack_require__(77);__webpack_require__(78);__webpack_require__(79);__webpack_require__(80);__webpack_require__(81);__webpack_require__(82);__webpack_require__(83);__webpack_require__(84);__webpack_require__(85);__webpack_require__(86);__webpack_require__(87);__webpack_require__(88);__webpack_require__(89);__webpack_require__(90);__webpack_require__(91);__webpack_require__(92);__webpack_require__(93);__webpack_require__(94);__webpack_require__(95);__webpack_require__(96);__webpack_require__(97);__webpack_require__(98);__webpack_require__(99);__webpack_require__(100);__webpack_require__(101);__webpack_require__(102);__webpack_require__(103);__webpack_require__(104);__webpack_require__(105);__webpack_require__(106);__webpack_require__(107);__webpack_require__(108);__webpack_require__(109);__webpack_require__(110);__webpack_require__(111);__webpack_require__(112);__webpack_require__(113);__webpack_require__(114);__webpack_require__(115);__webpack_require__(116);__webpack_require__(117);__webpack_require__(118);__webpack_require__(119);__webpack_require__(120);__webpack_require__(121);__webpack_require__(122);__webpack_require__(123);__webpack_require__(124);__webpack_require__(125);__webpack_require__(126);__webpack_require__(127);__webpack_require__(128);__webpack_require__(129);__webpack_require__(130);__webpack_require__(131);__webpack_require__(132);__webpack_require__(133);__webpack_require__(134);__webpack_require__(135);__webpack_require__(136);__webpack_require__(137);__webpack_require__(138);__webpack_require__(139);__webpack_require__(140);__webpack_require__(141);__webpack_require__(142);__webpack_require__(143);__webpack_require__(144);__webpack_require__(145);__webpack_require__(146);__webpack_require__(147);__webpack_require__(148);__webpack_require__(149);__webpack_require__(150);__webpack_require__(151);__webpack_require__(152);__webpack_require__(153);__webpack_require__(154);__webpack_require__(155);__webpack_require__(156);__webpack_require__(157);__webpack_require__(158);__webpack_require__(159);__webpack_require__(160);__webpack_require__(161);__webpack_require__(162);__webpack_require__(163);__webpack_require__(164);__webpack_require__(165);__webpack_require__(166);__webpack_require__(167);__webpack_require__(168);__webpack_require__(169);__webpack_require__(170);__webpack_require__(171);__webpack_require__(172);__webpack_require__(173);__webpack_require__(185);var _i18n=__webpack_require__(9);var _kibanaCore__=__webpack_require__(174);var injectedMetadata=JSON.parse(document.querySelector("kbn-injected-metadata").getAttribute("data"));_i18n.i18n.init(injectedMetadata.legacyMetadata.translations);new _kibanaCore__.CoreSystem({injectedMetadata:injectedMetadata,rootDomElement:document.body,requireLegacyFiles:function requireLegacyFiles(){__webpack_require__(2190)}}).start()},219:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.parseInterval=parseInterval;var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _datemath=__webpack_require__(57);var _datemath2=_interopRequireDefault(_datemath);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var INTERVAL_STRING_RE=new RegExp("^([0-9]*)\\s*("+_datemath2.default.units.join("|")+")$");var SUPPORT_ZERO_DURATION_UNITS=["ms","s","m","h"];function parseInterval(interval){var matches=String(interval).trim().match(INTERVAL_STRING_RE);if(!Array.isArray(matches))return null;if(matches.length<3)return null;try{var value=parseInt(matches[1]);var unit=matches[2];if(isNaN(value)||value<1&&SUPPORT_ZERO_DURATION_UNITS.indexOf(unit)===-1){return null}return _moment2.default.duration(value,unit)}catch(e){return null}}},2190:function(module,exports,__webpack_require__){"use strict";__webpack_require__(327);__webpack_require__(328);__webpack_require__(195);__webpack_require__(620);__webpack_require__(193);__webpack_require__(207);__webpack_require__(2191);__webpack_require__(467);__webpack_require__(399);__webpack_require__(2193);__webpack_require__(2194);__webpack_require__(991);__webpack_require__(2365);__webpack_require__(2368);__webpack_require__(2387);__webpack_require__(2448);__webpack_require__(2471);__webpack_require__(2474);__webpack_require__(2476);__webpack_require__(2479);__webpack_require__(2483);__webpack_require__(2486);__webpack_require__(2489);__webpack_require__(2537);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}if(typeof _routes2.default.enable==="function"){_routes2.default.enable()}_routes2.default.otherwise({redirectTo:"/jobs"})},2191:function(module,exports,__webpack_require__){"use strict";var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _index=__webpack_require__(2192);var _index2=_interopRequireDefault(_index);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_routes2.default.when("/access-denied",{template:_index2.default,controllerAs:"accessDenied",controller:function controller($window,kbnUrl,kbnBaseUrl){this.goToKibana=function(){$window.location.href=_chrome2.default.getBasePath()+kbnBaseUrl};this.retry=function(){return kbnUrl.redirect("/jobs")}}})},2192:function(module,exports){module.exports='<ml-nav-menu name="access-denied"></ml-nav-menu>\n<div class="col-md-12">\n  <div class="euiSpacer euiSpacer--m"></div>\n  <div class="euiCallOut euiCallOut--danger">\n    <div class="euiCallOutHeader">\n      <svg class="euiIcon euiIcon--medium euiCallOutHeader__icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n        width="16" height="16" viewBox="0 0 16 16">\n        <defs>\n          <path id="cross-a" d="M7.293 8l-4.147 4.146a.5.5 0 0 0 .708.708L8 8.707l4.146 4.147a.5.5 0 0 0 .708-.708L8.707 8l4.147-4.146a.5.5 0 0 0-.708-.708L8 7.293 3.854 3.146a.5.5 0 1 0-.708.708L7.293 8z"></path>\n        </defs>\n        <use fill-rule="nonzero" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#cross-a"></use>\n      </svg>\n      <span class="euiCallOutHeader__title">You need permission to access Machine Learning</span>\n    </div>\n    <div class="euiText euiText--small">\n      <p>You must have the privileges granted in the <span class="text-monospace">kibana_user</span> and <span class="text-monospace">machine_learning_user</span> roles.<br/>\n      Your system admin can set these roles on the Management User page.\n      </p>\n    </div>\n  </div>\n\n  <div style=\'margin-top:20px;\'>\n    <button ng-click="accessDenied.goToKibana();" class="kuiButton kuiButton--primary">Back to Kibana home</button>\n    <button ng-click="accessDenied.retry();" class="kuiButton kuiButton--basic">Retry</button>\n  </div>\n</div>\n'},2193:function(module,exports,__webpack_require__){"use strict";__webpack_require__(620);var _angular=__webpack_require__(21);var _angular2=_interopRequireDefault(_angular);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_angular2.default.module("ui.bootstrap.popover").directive("popoverHtmlUnsafePopup",function($compile){var template='<div class="popover {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">';template+='<div class="arrow"></div>';template+='<div class="popover-inner">';template+='<h3 class="popover-title" bind-html-unsafe="title" ng-show="title"></h3>';template+='<div class="popover-content" bind-html-unsafe="content" ></div>';template+="</div></div>";return{restrict:"EA",replace:true,scope:{title:"@",content:"@",placement:"@",animation:"&",isOpen:"&"},template:template,link:function link(scope,element){scope.$apply();var cont=$compile(scope.content)(scope);element.find(".popover-content").html(cont);scope.closePopover=function(){scope.$parent.$parent.isOpen=false;scope.$parent.$parent.$applyAsync();element.remove()}}}}).directive("popoverHtmlUnsafe",["$tooltip",function($tooltip){return $tooltip("popoverHtmlUnsafe","popover","click")}]);_angular2.default.module("ui.bootstrap.dropdown",["ui.bootstrap.position"]).constant("dropdownConfig",{openClass:"open"}).service("dropdownService",["$document","$rootScope",function($document,$rootScope){var openScope=null;var closeDropdown=function closeDropdown(evt){if(!openScope){return}if(evt&&openScope.getAutoClose()==="disabled"){return}var toggleElement=openScope.getToggleElement();if(evt&&toggleElement&&toggleElement[0].contains(evt.target)){return}var $element=openScope.getElement();if(evt&&openScope.getAutoClose()==="outsideClick"&&$element&&$element[0].contains(evt.target)){return}openScope.isOpen=false;if(!$rootScope.$$phase){openScope.$apply()}};var escapeKeyBind=function escapeKeyBind(evt){if(evt.which===27){openScope.focusToggleElement();closeDropdown()}};this.open=function(dropdownScope){if(!openScope){$document.bind("click",closeDropdown);$document.bind("keydown",escapeKeyBind)}if(openScope&&openScope!==dropdownScope){openScope.isOpen=false}openScope=dropdownScope};this.close=function(dropdownScope){if(openScope===dropdownScope){openScope=null;$document.unbind("click",closeDropdown);$document.unbind("keydown",escapeKeyBind)}}}]).controller("DropdownController",["$scope","$attrs","$parse","dropdownConfig","dropdownService","$animate","$position","$document",function($scope,$attrs,$parse,dropdownConfig,dropdownService,$animate,$position,$document){var self=this;var scope=$scope.$new();var openClass=dropdownConfig.openClass;var getIsOpen=void 0;var setIsOpen=_angular2.default.noop;var toggleInvoker=$attrs.onToggle?$parse($attrs.onToggle):_angular2.default.noop;var appendToBody=false;this.init=function(element){self.$element=element;if($attrs.isOpen){getIsOpen=$parse($attrs.isOpen);setIsOpen=getIsOpen.assign;$scope.$watch(getIsOpen,function(value){scope.isOpen=!!value})}appendToBody=_angular2.default.isDefined($attrs.dropdownAppendToBody);if(appendToBody&&self.dropdownMenu){$document.find("body").append(self.dropdownMenu);element.on("$destroy",function handleDestroyEvent(){self.dropdownMenu.remove()})}};this.toggle=function(open){return scope.isOpen=arguments.length?!!open:!scope.isOpen};this.isOpen=function(){return scope.isOpen};scope.getToggleElement=function(){return self.toggleElement};scope.getAutoClose=function(){return $attrs.autoClose||"always"};scope.getElement=function(){return self.$element};scope.focusToggleElement=function(){if(self.toggleElement){self.toggleElement[0].focus()}};scope.$watch("isOpen",function(isOpen,wasOpen){if(appendToBody&&self.dropdownMenu){var pos=$position.positionElements(self.$element,self.dropdownMenu,"bottom-left",true);var css={top:pos.top+"px",display:isOpen?"block":"none"};var rightalign=self.dropdownMenu.hasClass("dropdown-menu-right");if(!rightalign){css.left=pos.left+"px";css.right="auto"}else{css.left="auto";css.right=window.innerWidth-(pos.left+self.$element.prop("offsetWidth"))+"px"}self.dropdownMenu.css(css)}$animate[isOpen?"addClass":"removeClass"](self.$element,openClass);if(isOpen){scope.focusToggleElement();dropdownService.open(scope)}else{dropdownService.close(scope)}setIsOpen($scope,isOpen);if(_angular2.default.isDefined(isOpen)&&isOpen!==wasOpen){toggleInvoker($scope,{open:!!isOpen})}});$scope.$on("$locationChangeSuccess",function(){scope.isOpen=false});$scope.$on("$destroy",function(){scope.$destroy()})}]).directive("dropdown",function(){return{controller:"DropdownController",link:function link(scope,element,attrs,dropdownCtrl){dropdownCtrl.init(element)}}}).directive("dropdownMenu",function(){return{restrict:"AC",require:"?^dropdown",link:function link(scope,element,attrs,dropdownCtrl){if(!dropdownCtrl){return}dropdownCtrl.dropdownMenu=element}}}).directive("dropdownToggle",function(){return{require:"?^dropdown",link:function link(scope,element,attrs,dropdownCtrl){if(!dropdownCtrl){return}dropdownCtrl.toggleElement=element;var toggleDropdown=function toggleDropdown(event){event.preventDefault();if(!element.hasClass("disabled")&&!attrs.disabled){scope.$apply(function(){dropdownCtrl.toggle()})}};element.bind("click",toggleDropdown);element.attr({"aria-haspopup":true,"aria-expanded":false});scope.$watch(dropdownCtrl.isOpen,function(isOpen){element.attr("aria-expanded",!!isOpen)});scope.$on("$destroy",function(){element.unbind("click",toggleDropdown)})}}})},2194:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2195);__webpack_require__(2268);__webpack_require__(2302);__webpack_require__(2319);__webpack_require__(2338);__webpack_require__(2348);__webpack_require__(2352);__webpack_require__(2362)},2195:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2196)},2196:function(module,exports,__webpack_require__){"use strict";var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _modules=__webpack_require__(4);var _index_utils=__webpack_require__(62);var _check_license=__webpack_require__(43);var _check_privilege=__webpack_require__(32);var _check_ml_nodes=__webpack_require__(47);var _new_job_defaults=__webpack_require__(241);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _jobs=__webpack_require__(2204);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml",["react"]);var template='<ml-nav-menu name="jobs" /><jobs-page />';_routes2.default.when("/jobs/?",{template:template,resolve:{CheckLicense:_check_license.checkFullLicense,indexPatterns:_index_utils.loadIndexPatterns,privileges:_check_privilege.checkGetJobsPrivilege,mlNodeCount:_check_ml_nodes.getMlNodeCount,loadNewJobDefaults:_new_job_defaults.loadNewJobDefaults}});_module.directive("jobsPage",function(){return{scope:{},restrict:"E",link:function link(scope,element){_reactDom2.default.render(_react2.default.createElement(_react3.I18nProvider,null,_react2.default.createElement(_jobs.JobsPage,{angularWrapperScope:scope})),element[0])}}})},2197:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var LICENSE_TYPE=exports.LICENSE_TYPE={BASIC:0,FULL:1}},2198:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getPrivileges=getPrivileges;var _ml_api_service=__webpack_require__(22);function getPrivileges(){var privileges={canGetJobs:false,canCreateJob:false,canDeleteJob:false,canOpenJob:false,canCloseJob:false,canForecastJob:false,canGetDatafeeds:false,canStartStopDatafeed:false,canUpdateJob:false,canUpdateDatafeed:false,canPreviewDatafeed:false,canGetCalendars:false,canCreateCalendar:false,canDeleteCalendar:false,canGetFilters:false,canCreateFilter:false,canDeleteFilter:false,canFindFileStructure:false};return new Promise(function(resolve,reject){var priv={cluster:["cluster:monitor/xpack/ml/job/get","cluster:monitor/xpack/ml/job/stats/get","cluster:monitor/xpack/ml/datafeeds/get","cluster:monitor/xpack/ml/datafeeds/stats/get","cluster:monitor/xpack/ml/calendars/get","cluster:admin/xpack/ml/job/put","cluster:admin/xpack/ml/job/delete","cluster:admin/xpack/ml/job/update","cluster:admin/xpack/ml/job/open","cluster:admin/xpack/ml/job/close","cluster:admin/xpack/ml/job/forecast","cluster:admin/xpack/ml/datafeeds/put","cluster:admin/xpack/ml/datafeeds/delete","cluster:admin/xpack/ml/datafeeds/start","cluster:admin/xpack/ml/datafeeds/stop","cluster:admin/xpack/ml/datafeeds/update","cluster:admin/xpack/ml/datafeeds/preview","cluster:admin/xpack/ml/calendars/put","cluster:admin/xpack/ml/calendars/delete","cluster:admin/xpack/ml/calendars/jobs/update","cluster:admin/xpack/ml/calendars/events/post","cluster:admin/xpack/ml/calendars/events/delete","cluster:admin/xpack/ml/filters/put","cluster:admin/xpack/ml/filters/get","cluster:admin/xpack/ml/filters/update","cluster:admin/xpack/ml/filters/delete","cluster:monitor/xpack/ml/findfilestructure"]};_ml_api_service.ml.checkPrivilege(priv).then(function(resp){if(resp.securityDisabled){Object.keys(privileges).forEach(function(k){return privileges[k]=true})}else{if(resp.cluster["cluster:monitor/xpack/ml/job/get"]&&resp.cluster["cluster:monitor/xpack/ml/job/stats/get"]){privileges.canGetJobs=true}if(resp.cluster["cluster:monitor/xpack/ml/datafeeds/get"]&&resp.cluster["cluster:monitor/xpack/ml/datafeeds/stats/get"]){privileges.canGetDatafeeds=true}if(resp.cluster["cluster:admin/xpack/ml/job/put"]&&resp.cluster["cluster:admin/xpack/ml/job/open"]&&resp.cluster["cluster:admin/xpack/ml/datafeeds/put"]){privileges.canCreateJob=true}if(resp.cluster["cluster:admin/xpack/ml/job/update"]){privileges.canUpdateJob=true}if(resp.cluster["cluster:admin/xpack/ml/job/open"]){privileges.canOpenJob=true}if(resp.cluster["cluster:admin/xpack/ml/job/close"]){privileges.canCloseJob=true}if(resp.cluster["cluster:admin/xpack/ml/job/forecast"]){privileges.canForecastJob=true}if(resp.cluster["cluster:admin/xpack/ml/job/delete"]&&resp.cluster["cluster:admin/xpack/ml/datafeeds/delete"]){privileges.canDeleteJob=true}if(resp.cluster["cluster:admin/xpack/ml/job/open"]&&resp.cluster["cluster:admin/xpack/ml/datafeeds/start"]&&resp.cluster["cluster:admin/xpack/ml/datafeeds/stop"]){privileges.canStartStopDatafeed=true}if(resp.cluster["cluster:admin/xpack/ml/datafeeds/update"]){privileges.canUpdateDatafeed=true}if(resp.cluster["cluster:admin/xpack/ml/datafeeds/preview"]){privileges.canPreviewDatafeed=true}if(resp.cluster["cluster:monitor/xpack/ml/calendars/get"]){privileges.canGetCalendars=true}if(resp.cluster["cluster:admin/xpack/ml/calendars/put"]&&resp.cluster["cluster:admin/xpack/ml/calendars/jobs/update"]&&resp.cluster["cluster:admin/xpack/ml/calendars/events/post"]){privileges.canCreateCalendar=true}if(resp.cluster["cluster:admin/xpack/ml/calendars/delete"]&&resp.cluster["cluster:admin/xpack/ml/calendars/events/delete"]){privileges.canDeleteCalendar=true}if(resp.cluster["cluster:admin/xpack/ml/filters/get"]){privileges.canGetFilters=true}if(resp.cluster["cluster:admin/xpack/ml/filters/put"]&&resp.cluster["cluster:admin/xpack/ml/filters/update"]){privileges.canCreateFilter=true}if(resp.cluster["cluster:admin/xpack/ml/filters/delete"]){privileges.canDeleteFilter=true}if(resp.cluster["cluster:monitor/xpack/ml/findfilestructure"]){privileges.canFindFileStructure=true}}resolve(privileges)}).catch(function(){reject(privileges)})})}},2199:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.annotations=undefined;var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _http_service=__webpack_require__(296);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var basePath=_chrome2.default.addBasePath("/api/ml");var annotations=exports.annotations={getAnnotations:function getAnnotations(obj){return(0,_http_service.http)({url:basePath+"/annotations",method:"POST",data:obj})},indexAnnotation:function indexAnnotation(obj){return(0,_http_service.http)({url:basePath+"/annotations/index",method:"PUT",data:obj})},deleteAnnotation:function deleteAnnotation(id){return(0,_http_service.http)({url:basePath+"/annotations/delete/"+id,method:"DELETE"})}}},22:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ml=undefined;var _lodash=__webpack_require__(1);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _http_service=__webpack_require__(296);var _annotations=__webpack_require__(2199);var _filters=__webpack_require__(2200);var _results=__webpack_require__(2201);var _jobs=__webpack_require__(2202);var _datavisualizer=__webpack_require__(2203);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var basePath=_chrome2.default.addBasePath("/api/ml");var ml=exports.ml={getJobs:function getJobs(obj){var jobId=obj&&obj.jobId?"/"+obj.jobId:"";return(0,_http_service.http)({url:basePath+"/anomaly_detectors"+jobId})},getJobStats:function getJobStats(obj){var jobId=obj&&obj.jobId?"/"+obj.jobId:"";return(0,_http_service.http)({url:basePath+"/anomaly_detectors"+jobId+"/_stats"})},addJob:function addJob(obj){return(0,_http_service.http)({url:basePath+"/anomaly_detectors/"+obj.jobId,method:"PUT",data:obj.job})},openJob:function openJob(obj){return(0,_http_service.http)({url:basePath+"/anomaly_detectors/"+obj.jobId+"/_open",method:"POST"})},closeJob:function closeJob(obj){return(0,_http_service.http)({url:basePath+"/anomaly_detectors/"+obj.jobId+"/_close",method:"POST"})},deleteJob:function deleteJob(obj){return(0,_http_service.http)({url:basePath+"/anomaly_detectors/"+obj.jobId,method:"DELETE"})},forceDeleteJob:function forceDeleteJob(obj){return(0,_http_service.http)({url:basePath+"/anomaly_detectors/"+obj.jobId+"?force=true",method:"DELETE"})},updateJob:function updateJob(obj){return(0,_http_service.http)({url:basePath+"/anomaly_detectors/"+obj.jobId+"/_update",method:"POST",data:obj.job})},estimateBucketSpan:function estimateBucketSpan(obj){return(0,_http_service.http)({url:basePath+"/validate/estimate_bucket_span",method:"POST",data:obj})},validateJob:function validateJob(obj){return(0,_http_service.http)({url:basePath+"/validate/job",method:"POST",data:obj})},validateCardinality:function validateCardinality(obj){return(0,_http_service.http)({url:basePath+"/validate/cardinality",method:"POST",data:obj})},getDatafeeds:function getDatafeeds(obj){var datafeedId=obj&&obj.datafeedId?"/"+obj.datafeedId:"";return(0,_http_service.http)({url:basePath+"/datafeeds"+datafeedId})},getDatafeedStats:function getDatafeedStats(obj){var datafeedId=obj&&obj.datafeedId?"/"+obj.datafeedId:"";return(0,_http_service.http)({url:basePath+"/datafeeds"+datafeedId+"/_stats"})},addDatafeed:function addDatafeed(obj){return(0,_http_service.http)({url:basePath+"/datafeeds/"+obj.datafeedId,method:"PUT",data:obj.datafeedConfig})},updateDatafeed:function updateDatafeed(obj){return(0,_http_service.http)({url:basePath+"/datafeeds/"+obj.datafeedId+"/_update",method:"POST",data:obj.datafeedConfig})},deleteDatafeed:function deleteDatafeed(obj){return(0,_http_service.http)({url:basePath+"/datafeeds/"+obj.datafeedId,method:"DELETE"})},forceDeleteDatafeed:function forceDeleteDatafeed(obj){return(0,_http_service.http)({url:basePath+"/datafeeds/"+obj.datafeedId+"?force=true",method:"DELETE"})},startDatafeed:function startDatafeed(obj){var data={};if(obj.start!==undefined){data.start=obj.start}if(obj.end!==undefined){data.end=obj.end}return(0,_http_service.http)({url:basePath+"/datafeeds/"+obj.datafeedId+"/_start",method:"POST",data:data})},stopDatafeed:function stopDatafeed(obj){return(0,_http_service.http)({url:basePath+"/datafeeds/"+obj.datafeedId+"/_stop",method:"POST"})},datafeedPreview:function datafeedPreview(obj){return(0,_http_service.http)({url:basePath+"/datafeeds/"+obj.datafeedId+"/_preview",method:"GET"})},validateDetector:function validateDetector(obj){return(0,_http_service.http)({url:basePath+"/anomaly_detectors/_validate/detector",method:"POST",data:obj.detector})},forecast:function forecast(obj){var data={};if(obj.duration!==undefined){data.duration=obj.duration}return(0,_http_service.http)({url:basePath+"/anomaly_detectors/"+obj.jobId+"/_forecast",method:"POST",data:data})},overallBuckets:function overallBuckets(obj){var data=(0,_lodash.pick)(obj,["topN","bucketSpan","start","end"]);return(0,_http_service.http)({url:basePath+"/anomaly_detectors/"+obj.jobId+"/results/overall_buckets",method:"POST",data:data})},checkPrivilege:function checkPrivilege(obj){return(0,_http_service.http)({url:basePath+"/_has_privileges",method:"POST",data:obj})},getNotificationSettings:function getNotificationSettings(){return(0,_http_service.http)({url:basePath+"/notification_settings",method:"GET"})},getFieldCaps:function getFieldCaps(obj){var data={};if(obj.index!==undefined){data.index=obj.index}if(obj.fields!==undefined){data.fields=obj.fields}return(0,_http_service.http)({url:basePath+"/indices/field_caps",method:"POST",data:data})},recognizeIndex:function recognizeIndex(obj){return(0,_http_service.http)({url:basePath+"/modules/recognize/"+obj.indexPatternTitle,method:"GET"})},getDataRecognizerModule:function getDataRecognizerModule(obj){return(0,_http_service.http)({url:basePath+"/modules/get_module/"+obj.moduleId,method:"GET"})},setupDataRecognizerConfig:function setupDataRecognizerConfig(obj){var data=(0,_lodash.pick)(obj,["prefix","groups","indexPatternName","query","useDedicatedIndex"]);return(0,_http_service.http)({url:basePath+"/modules/setup/"+obj.moduleId,method:"POST",data:data})},getVisualizerFieldStats:function getVisualizerFieldStats(obj){var data=(0,_lodash.pick)(obj,["query","timeFieldName","earliest","latest","samplerShardSize","interval","fields","maxExamples"]);return(0,_http_service.http)({url:basePath+"/data_visualizer/get_field_stats/"+obj.indexPatternTitle,method:"POST",data:data})},getVisualizerOverallStats:function getVisualizerOverallStats(obj){var data=(0,_lodash.pick)(obj,["query","timeFieldName","earliest","latest","samplerShardSize","aggregatableFields","nonAggregatableFields"]);return(0,_http_service.http)({url:basePath+"/data_visualizer/get_overall_stats/"+obj.indexPatternTitle,method:"POST",data:data})},calendars:function calendars(obj){var calendarId=obj&&obj.calendarId?"/"+obj.calendarId:"";return(0,_http_service.http)({url:basePath+"/calendars"+calendarId,method:"GET"})},addCalendar:function addCalendar(obj){return(0,_http_service.http)({url:basePath+"/calendars",method:"PUT",data:obj})},updateCalendar:function updateCalendar(obj){var calendarId=obj&&obj.calendarId?"/"+obj.calendarId:"";return(0,_http_service.http)({url:basePath+"/calendars"+calendarId,method:"PUT",data:obj})},deleteCalendar:function deleteCalendar(obj){return(0,_http_service.http)({url:basePath+"/calendars/"+obj.calendarId,method:"DELETE"})},mlNodeCount:function mlNodeCount(){return(0,_http_service.http)({url:basePath+"/ml_node_count",method:"GET"})},mlInfo:function mlInfo(){return(0,_http_service.http)({url:basePath+"/info",method:"GET"})},calculateModelMemoryLimit:function calculateModelMemoryLimit(obj){var data=(0,_lodash.pick)(obj,["indexPattern","splitFieldName","query","fieldNames","influencerNames","timeFieldName","earliestMs","latestMs"]);return(0,_http_service.http)({url:basePath+"/validate/calculate_model_memory_limit",method:"POST",data:data})},getCardinalityOfFields:function getCardinalityOfFields(obj){var data=(0,_lodash.pick)(obj,["index","types","fieldNames","query","timeFieldName","earliestMs","latestMs"]);return(0,_http_service.http)({url:basePath+"/fields_service/field_cardinality",method:"POST",data:data})},getTimeFieldRange:function getTimeFieldRange(obj){var data=(0,_lodash.pick)(obj,["index","timeFieldName","query"]);return(0,_http_service.http)({url:basePath+"/fields_service/time_field_range",method:"POST",data:data})},esSearch:function esSearch(obj){return(0,_http_service.http)({url:basePath+"/es_search",method:"POST",data:obj})},getIndices:function getIndices(){var tempBasePath=_chrome2.default.addBasePath("/api");return(0,_http_service.http)({url:tempBasePath+"/index_management/indices",method:"GET"})},annotations:_annotations.annotations,filters:_filters.filters,results:_results.results,jobs:_jobs.jobs,fileDatavisualizer:_datavisualizer.fileDatavisualizer}},220:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SearchItemsProvider=SearchItemsProvider;exports.createJobForSaving=createJobForSaving;exports.addNewJobToRecentlyAccessed=addNewJobToRecentlyAccessed;exports.moveToAdvancedJobCreationProvider=moveToAdvancedJobCreationProvider;exports.focusOnResultsLink=focusOnResultsLink;exports.checkCardinalitySuccess=checkCardinalitySuccess;exports.getMinimalValidJob=getMinimalValidJob;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _jquery=__webpack_require__(17);var _jquery2=_interopRequireDefault(_jquery);var _esQuery=__webpack_require__(40);var _recently_accessed=__webpack_require__(468);var _job_service=__webpack_require__(23);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function SearchItemsProvider(Private,$route){var buildESQuery=Private(_esQuery.BuildESQueryProvider);function createSearchItems(){var indexPattern=$route.current.locals.indexPattern;var query={query:"*",language:"lucene"};var combinedQuery={bool:{must:[{query_string:{analyze_wildcard:true,query:"*"}}]}};var filters=[];var savedSearch=$route.current.locals.savedSearch;if(indexPattern.id===undefined&&savedSearch.id!==undefined){var searchSource=savedSearch.searchSource;indexPattern=searchSource.getField("index");query=searchSource.getField("query");var fs=searchSource.getField("filter");if(fs.length){filters=fs}combinedQuery=buildESQuery(indexPattern,[query],filters)}return{indexPattern:indexPattern,savedSearch:savedSearch,filters:filters,query:query,combinedQuery:combinedQuery}}return createSearchItems}function createJobForSaving(job){var newJob=_lodash2.default.cloneDeep(job);delete newJob.datafeed_config;return newJob}function addNewJobToRecentlyAccessed(jobId,resultsUrl){var urlParts=resultsUrl.match(/ml#\/(.+?)(\?.+)/);(0,_recently_accessed.addItemToRecentlyAccessed)(urlParts[1],jobId,urlParts[2])}function moveToAdvancedJobCreationProvider($location){return function moveToAdvancedJobCreation(job){_job_service.mlJobService.currentJob=job;$location.path("jobs/new_job/advanced")}}function focusOnResultsLink(linkId,$timeout){$timeout(function(){(0,_jquery2.default)("#"+linkId).focus()},0)}function checkCardinalitySuccess(data){var response={success:true};if(Array.isArray(data)&&data.length===0){return response}for(var i=0;i<data.length;i++){if(data[i].id==="success_cardinality"){break}if(data[i].id==="cardinality_model_plot_high"){response.success=false;response.highCardinality=data[i].modelPlotCardinality;break}}return response}function getMinimalValidJob(){return{analysis_config:{bucket_span:"15m",detectors:[],influencers:[]},data_description:{time_field:"@timestamp"},datafeed_config:{indices:[]}}}},2200:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.filters=undefined;var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _http_service=__webpack_require__(296);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var basePath=_chrome2.default.addBasePath("/api/ml");var filters=exports.filters={filters:function filters(obj){var filterId=obj&&obj.filterId?"/"+obj.filterId:"";return(0,_http_service.http)({url:basePath+"/filters"+filterId,method:"GET"})},filtersStats:function filtersStats(){return(0,_http_service.http)({url:basePath+"/filters/_stats",method:"GET"})},addFilter:function addFilter(filterId,description,items){return(0,_http_service.http)({url:basePath+"/filters",method:"PUT",data:{filterId:filterId,description:description,items:items}})},updateFilter:function updateFilter(filterId,description,addItems,removeItems){var data={};if(description!==undefined){data.description=description}if(addItems!==undefined){data.addItems=addItems}if(removeItems!==undefined){data.removeItems=removeItems}return(0,_http_service.http)({url:basePath+"/filters/"+filterId,method:"PUT",data:data})},deleteFilter:function deleteFilter(filterId){return(0,_http_service.http)({url:basePath+"/filters/"+filterId,method:"DELETE"})}}},2201:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.results=undefined;var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _http_service=__webpack_require__(296);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var basePath=_chrome2.default.addBasePath("/api/ml");var results=exports.results={getAnomaliesTableData:function getAnomaliesTableData(jobIds,criteriaFields,influencers,aggregationInterval,threshold,earliestMs,latestMs,dateFormatTz,maxRecords,maxExamples){return(0,_http_service.http)({url:basePath+"/results/anomalies_table_data",method:"POST",data:{jobIds:jobIds,criteriaFields:criteriaFields,influencers:influencers,aggregationInterval:aggregationInterval,threshold:threshold,earliestMs:earliestMs,latestMs:latestMs,dateFormatTz:dateFormatTz,maxRecords:maxRecords,maxExamples:maxExamples}})},getCategoryDefinition:function getCategoryDefinition(jobId,categoryId){return(0,_http_service.http)({url:basePath+"/results/category_definition",method:"POST",data:{jobId:jobId,categoryId:categoryId}})},getCategoryExamples:function getCategoryExamples(jobId,categoryIds,maxExamples){return(0,_http_service.http)({url:basePath+"/results/category_examples",method:"POST",data:{jobId:jobId,categoryIds:categoryIds,maxExamples:maxExamples}})}}},2202:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.jobs=undefined;var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _http_service=__webpack_require__(296);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var basePath=_chrome2.default.addBasePath("/api/ml");var jobs=exports.jobs={jobsSummary:function jobsSummary(jobIds){return(0,_http_service.http)({url:basePath+"/jobs/jobs_summary",method:"POST",data:{jobIds:jobIds}})},jobs:function jobs(jobIds){return(0,_http_service.http)({url:basePath+"/jobs/jobs",method:"POST",data:{jobIds:jobIds}})},groups:function groups(){return(0,_http_service.http)({url:basePath+"/jobs/groups",method:"GET"})},updateGroups:function updateGroups(updatedJobs){return(0,_http_service.http)({url:basePath+"/jobs/update_groups",method:"POST",data:{jobs:updatedJobs}})},forceStartDatafeeds:function forceStartDatafeeds(datafeedIds,start,end){return(0,_http_service.http)({url:basePath+"/jobs/force_start_datafeeds",method:"POST",data:{datafeedIds:datafeedIds,start:start,end:end}})},stopDatafeeds:function stopDatafeeds(datafeedIds){return(0,_http_service.http)({url:basePath+"/jobs/stop_datafeeds",method:"POST",data:{datafeedIds:datafeedIds}})},deleteJobs:function deleteJobs(jobIds){return(0,_http_service.http)({url:basePath+"/jobs/delete_jobs",method:"POST",data:{jobIds:jobIds}})},closeJobs:function closeJobs(jobIds){return(0,_http_service.http)({url:basePath+"/jobs/close_jobs",method:"POST",data:{jobIds:jobIds}})},jobAuditMessages:function jobAuditMessages(jobId,from){var jobIdString=jobId!==undefined?"/"+jobId:"";var fromString=from!==undefined?"?from="+from:"";return(0,_http_service.http)({url:basePath+"/job_audit_messages/messages"+jobIdString+fromString,method:"GET"})}}},2203:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fileDatavisualizer=undefined;var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _http_service=__webpack_require__(296);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var basePath=_chrome2.default.addBasePath("/api/ml");var fileDatavisualizer=exports.fileDatavisualizer={analyzeFile:function analyzeFile(obj){var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var paramString="";if(Object.keys(params).length){paramString="?";for(var p in params){if(params.hasOwnProperty(p)){paramString+="&"+p+"="+params[p]}}}return(0,_http_service.http)({url:basePath+"/file_data_visualizer/analyze_file"+paramString,method:"POST",data:obj})},import:function _import(obj){var paramString=obj.id!==undefined?"?id="+obj.id:"";var index=obj.index,data=obj.data,settings=obj.settings,mappings=obj.mappings,ingestPipeline=obj.ingestPipeline;return(0,_http_service.http)({url:basePath+"/file_data_visualizer/import"+paramString,method:"POST",data:{index:index,data:data,settings:settings,mappings:mappings,ingestPipeline:ingestPipeline}})}}},2204:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobsPage=undefined;var _jobs_list_view=__webpack_require__(2205);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var JobsPage=exports.JobsPage=function JobsPage(props){return _react2.default.createElement(_jobs_list_view.JobsListView,props)}},2205:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _jobs_list_view=__webpack_require__(2206);Object.defineProperty(exports,"JobsListView",{enumerable:true,get:function get(){return _jobs_list_view.JobsListView}})},2206:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobsListView=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _timefilter=__webpack_require__(16);var _ml_api_service=__webpack_require__(22);var _utils=__webpack_require__(297);var _jobs_list=__webpack_require__(2208);var _job_details=__webpack_require__(2215);var _job_filter_bar=__webpack_require__(2227);var _edit_job_flyout=__webpack_require__(2229);var _delete_job_modal=__webpack_require__(2239);var _start_datafeed_modal=__webpack_require__(2241);var _create_watch_flyout=__webpack_require__(2245);var _multi_job_actions=__webpack_require__(2251);var _new_job_button=__webpack_require__(2260);var _jobs_stats_bar=__webpack_require__(2262);var _node_available_warning=__webpack_require__(2264);var _refresh_jobs_list_button=__webpack_require__(2266);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_REFRESH_INTERVAL_MS=3e4;var MINIMUM_REFRESH_INTERVAL_MS=5e3;var jobsRefreshInterval=null;var JobsListView=exports.JobsListView=function(_Component){_inherits(JobsListView,_Component);function JobsListView(props){_classCallCheck(this,JobsListView);var _this=_possibleConstructorReturn(this,(JobsListView.__proto__||Object.getPrototypeOf(JobsListView)).call(this,props));_this.toggleRow=function(jobId){if(_this.state.itemIdToExpandedRowMap[jobId]){var itemIdToExpandedRowMap=_extends({},_this.state.itemIdToExpandedRowMap);delete itemIdToExpandedRowMap[jobId];_this.setState({itemIdToExpandedRowMap:itemIdToExpandedRowMap})}else{var _itemIdToExpandedRowMap=_extends({},_this.state.itemIdToExpandedRowMap);if(_this.state.fullJobsList[jobId]!==undefined){_itemIdToExpandedRowMap[jobId]=_react2.default.createElement(_job_details.JobDetails,{jobId:jobId,job:_this.state.fullJobsList[jobId],addYourself:_this.addUpdateFunction,removeYourself:_this.removeUpdateFunction})}else{_itemIdToExpandedRowMap[jobId]=_react2.default.createElement(_job_details.JobDetails,{jobId:jobId,addYourself:_this.addUpdateFunction,removeYourself:_this.removeUpdateFunction})}_this.setState({itemIdToExpandedRowMap:_itemIdToExpandedRowMap},function(){(0,_utils.loadFullJob)(jobId).then(function(job){var fullJobsList=_extends({},_this.state.fullJobsList);fullJobsList[jobId]=job;_this.setState({fullJobsList:fullJobsList},function(){_itemIdToExpandedRowMap=_extends({},_this.state.itemIdToExpandedRowMap);if(_itemIdToExpandedRowMap[jobId]!==undefined){_itemIdToExpandedRowMap[jobId]=_react2.default.createElement(_job_details.JobDetails,{jobId:jobId,job:job,addYourself:_this.addUpdateFunction,removeYourself:_this.removeUpdateFunction})}_this.setState({itemIdToExpandedRowMap:_itemIdToExpandedRowMap})})}).catch(function(error){console.error(error)})})}};_this.addUpdateFunction=function(id,f){_this.updateFunctions[id]=f};_this.removeUpdateFunction=function(id){delete _this.updateFunctions[id]};_this.setShowEditJobFlyoutFunction=function(func){_this.showEditJobFlyout=func};_this.unsetShowEditJobFlyoutFunction=function(){_this.showEditJobFlyout=function(){}};_this.setShowDeleteJobModalFunction=function(func){_this.showDeleteJobModal=func};_this.unsetShowDeleteJobModalFunction=function(){_this.showDeleteJobModal=function(){}};_this.setShowStartDatafeedModalFunction=function(func){_this.showStartDatafeedModal=func};_this.unsetShowStartDatafeedModalFunction=function(){_this.showStartDatafeedModal=function(){}};_this.setShowCreateWatchFlyoutFunction=function(func){_this.showCreateWatchFlyout=func};_this.unsetShowCreateWatchFlyoutFunction=function(){_this.showCreateWatchFlyout=function(){}};_this.getShowCreateWatchFlyoutFunction=function(){return _this.showCreateWatchFlyout};_this.selectJobChange=function(selectedJobs){_this.setState({selectedJobs:selectedJobs})};_this.setFilters=function(filterClauses){var filteredJobsSummaryList=(0,_utils.filterJobs)(_this.state.jobsSummaryList,filterClauses);_this.setState({filteredJobsSummaryList:filteredJobsSummaryList,filterClauses:filterClauses},function(){_this.refreshSelectedJobs()})};_this.onRefreshClick=function(){_this.setState({isRefreshing:true});_this.refreshJobSummaryList(true)};_this.isDoneRefreshing=function(){_this.setState({isRefreshing:false})};_this.state={isRefreshing:false,loading:null,jobsSummaryList:[],filteredJobsSummaryList:[],fullJobsList:{},selectedJobs:[],itemIdToExpandedRowMap:{},filterClauses:[]};_this.updateFunctions={};_this.showEditJobFlyout=function(){};_this.showDeleteJobModal=function(){};_this.showStartDatafeedModal=function(){};_this.showCreateWatchFlyout=function(){};_this.blockRefresh=false;return _this}_createClass(JobsListView,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;this.props.angularWrapperScope.$on("jobsUpdated",function(){_this2.refreshJobSummaryList(true)});this.props.angularWrapperScope.$on("openCreateWatchWindow",function(e,job){_this2.showCreateWatchFlyout(job.job_id)});_timefilter.timefilter.disableTimeRangeSelector();_timefilter.timefilter.enableAutoRefreshSelector();this.initAutoRefresh();this.initAutoRefreshUpdate()}},{key:"componentWillUnmount",value:function componentWillUnmount(){_timefilter.timefilter.off("refreshIntervalUpdate");this.clearRefreshInterval()}},{key:"initAutoRefresh",value:function initAutoRefresh(){var _timefilter$getRefres=_timefilter.timefilter.getRefreshInterval(),value=_timefilter$getRefres.value;if(value===0){_timefilter.timefilter.setRefreshInterval({pause:false,value:DEFAULT_REFRESH_INTERVAL_MS})}this.setAutoRefresh()}},{key:"initAutoRefreshUpdate",value:function initAutoRefreshUpdate(){var _this3=this;_timefilter.timefilter.on("refreshIntervalUpdate",function(){_this3.setAutoRefresh()})}},{key:"setAutoRefresh",value:function setAutoRefresh(){var _timefilter$getRefres2=_timefilter.timefilter.getRefreshInterval(),value=_timefilter$getRefres2.value,pause=_timefilter$getRefres2.pause;if(pause){this.clearRefreshInterval()}else{this.setRefreshInterval(value)}this.refreshJobSummaryList(true)}},{key:"setRefreshInterval",value:function setRefreshInterval(interval){var _this4=this;this.clearRefreshInterval();if(interval>=MINIMUM_REFRESH_INTERVAL_MS){this.blockRefresh=false;jobsRefreshInterval=setInterval(function(){return _this4.refreshJobSummaryList()},interval)}}},{key:"clearRefreshInterval",value:function clearRefreshInterval(){this.blockRefresh=true;clearInterval(jobsRefreshInterval)}},{key:"refreshSelectedJobs",value:function refreshSelectedJobs(){var selectedJobsIds=this.state.selectedJobs.map(function(j){return j.id});var filteredJobIds=this.state.filteredJobsSummaryList.map(function(j){return j.id});var selectedJobs=this.state.jobsSummaryList.filter(function(j){return selectedJobsIds.find(function(id){return id===j.id})}).filter(function(j){return filteredJobIds.find(function(id){return id===j.id})});this.setState({selectedJobs:selectedJobs})}},{key:"refreshJobSummaryList",value:function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var _this5=this;var forceRefresh=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var expandedJobsIds,jobs,fullJobsList,jobsSummaryList,filteredJobsSummaryList;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(forceRefresh===true||this.blockRefresh===false)){_context.next=19;break}if(this.state.loading===null){this.setState({loading:true})}expandedJobsIds=Object.keys(this.state.itemIdToExpandedRowMap);_context.prev=3;_context.next=6;return _ml_api_service.ml.jobs.jobsSummary(expandedJobsIds);case 6:jobs=_context.sent;fullJobsList={};jobsSummaryList=jobs.map(function(job){if(job.fullJob!==undefined){fullJobsList[job.id]=job.fullJob;delete job.fullJob}job.latestTimestampSortValue=job.latestTimestampMs||0;return job});filteredJobsSummaryList=(0,_utils.filterJobs)(jobsSummaryList,this.state.filterClauses);this.setState({jobsSummaryList:jobsSummaryList,filteredJobsSummaryList:filteredJobsSummaryList,fullJobsList:fullJobsList,loading:false},function(){_this5.refreshSelectedJobs()});Object.keys(this.updateFunctions).forEach(function(j){_this5.updateFunctions[j].setState({job:fullJobsList[j]})});this.isDoneRefreshing();_context.next=19;break;case 15:_context.prev=15;_context.t0=_context["catch"](3);console.error(_context.t0);this.setState({loading:false});case 19:case"end":return _context.stop()}}},_callee,this,[[3,15]])}));function refreshJobSummaryList(){return _ref.apply(this,arguments)}return refreshJobSummaryList}()},{key:"renderJobsListComponents",value:function renderJobsListComponents(){var _this6=this;var _state=this.state,loading=_state.loading,jobsSummaryList=_state.jobsSummaryList;var jobIds=jobsSummaryList.map(function(j){return j.id});return _react2.default.createElement("div",null,_react2.default.createElement("div",{className:"actions-bar"},_react2.default.createElement(_multi_job_actions.MultiJobActions,{selectedJobs:this.state.selectedJobs,allJobIds:jobIds,showStartDatafeedModal:this.showStartDatafeedModal,showDeleteJobModal:this.showDeleteJobModal,refreshJobs:function refreshJobs(){return _this6.refreshJobSummaryList(true)}}),_react2.default.createElement(_job_filter_bar.JobFilterBar,{setFilters:this.setFilters})),_react2.default.createElement(_jobs_list.JobsList,{jobsSummaryList:this.state.filteredJobsSummaryList,fullJobsList:this.state.fullJobsList,itemIdToExpandedRowMap:this.state.itemIdToExpandedRowMap,toggleRow:this.toggleRow,selectJobChange:this.selectJobChange,showEditJobFlyout:this.showEditJobFlyout,showDeleteJobModal:this.showDeleteJobModal,showStartDatafeedModal:this.showStartDatafeedModal,refreshJobs:function refreshJobs(){return _this6.refreshJobSummaryList(true)},selectedJobsCount:this.state.selectedJobs.length,loading:loading}),_react2.default.createElement(_edit_job_flyout.EditJobFlyout,{setShowFunction:this.setShowEditJobFlyoutFunction,unsetShowFunction:this.unsetShowEditJobFlyoutFunction,refreshJobs:function refreshJobs(){return _this6.refreshJobSummaryList(true)},allJobIds:jobIds}),_react2.default.createElement(_delete_job_modal.DeleteJobModal,{setShowFunction:this.setShowDeleteJobModalFunction,unsetShowFunction:this.unsetShowDeleteJobModalFunction,refreshJobs:function refreshJobs(){return _this6.refreshJobSummaryList(true)}}),_react2.default.createElement(_start_datafeed_modal.StartDatafeedModal,{setShowFunction:this.setShowStartDatafeedModalFunction,unsetShowFunction:this.unsetShowDeleteJobModalFunction,getShowCreateWatchFlyoutFunction:this.getShowCreateWatchFlyoutFunction,refreshJobs:function refreshJobs(){return _this6.refreshJobSummaryList(true)}}),_react2.default.createElement(_create_watch_flyout.CreateWatchFlyout,{setShowFunction:this.setShowCreateWatchFlyoutFunction,unsetShowFunction:this.unsetShowCreateWatchFlyoutFunction,compile:this.props.compile}))}},{key:"render",value:function render(){var _state2=this.state,isRefreshing=_state2.isRefreshing,jobsSummaryList=_state2.jobsSummaryList;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_jobs_stats_bar.JobStatsBar,{jobsSummaryList:jobsSummaryList}),_react2.default.createElement("div",{className:"job-management"},_react2.default.createElement(_node_available_warning.NodeAvailableWarning,null),_react2.default.createElement("header",null,_react2.default.createElement("div",{className:"job-buttons-container"},_react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"center"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_refresh_jobs_list_button.RefreshJobsListButton,{onRefreshClick:this.onRefreshClick,isRefreshing:isRefreshing})),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_new_job_button.NewJobButton,null))))),_react2.default.createElement("div",{className:"clear"}),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),this.renderJobsListComponents()))}}]);return JobsListView}(_react.Component)},2207:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MLRequestFailure=undefined;var _errors=__webpack_require__(45);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MLRequestFailure=exports.MLRequestFailure=function(_KbnError){_inherits(MLRequestFailure,_KbnError);function MLRequestFailure(error,resp){_classCallCheck(this,MLRequestFailure);error=error||{};var _this=_possibleConstructorReturn(this,(MLRequestFailure.__proto__||Object.getPrototypeOf(MLRequestFailure)).call(this,error.message||JSON.stringify(resp),MLRequestFailure));_this.origError=error;_this.resp=typeof resp==="string"?JSON.parse(resp):resp;return _this}return MLRequestFailure}(_errors.KbnError)},2208:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _jobs_list=__webpack_require__(2209);Object.defineProperty(exports,"JobsList",{enumerable:true,get:function get(){return _jobs_list.JobsList}})},2209:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobsList=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _lodash=__webpack_require__(1);var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _string_utils=__webpack_require__(38);var _job_actions=__webpack_require__(986);var _job_description=__webpack_require__(2212);var _job_message_icon=__webpack_require__(987);var _eui=__webpack_require__(2);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var PAGE_SIZE=10;var PAGE_SIZE_OPTIONS=[10,25,50];var TIME_FORMAT="YYYY-MM-DD HH:mm:ss";var JobsListUI=function(_Component){_inherits(JobsListUI,_Component);function JobsListUI(props){_classCallCheck(this,JobsListUI);var _this=_possibleConstructorReturn(this,(JobsListUI.__proto__||Object.getPrototypeOf(JobsListUI)).call(this,props));_this.onTableChange=function(_ref){var _ref$page=_ref.page,page=_ref$page===undefined?{}:_ref$page,_ref$sort=_ref.sort,sort=_ref$sort===undefined?{}:_ref$sort;var pageIndex=page.index,pageSize=page.size;var sortField=sort.field,sortDirection=sort.direction;_this.setState({pageIndex:pageIndex,pageSize:pageSize,sortField:sortField,sortDirection:sortDirection})};_this.toggleRow=function(item){_this.props.toggleRow(item.id)};_this.state={jobsSummaryList:props.jobsSummaryList,pageIndex:0,pageSize:PAGE_SIZE,itemIdToExpandedRowMap:{},sortField:"id",sortDirection:"asc"};return _this}_createClass(JobsListUI,[{key:"getPageOfJobs",value:function getPageOfJobs(index,size,sortField,sortDirection){var _this2=this;var list=this.state.jobsSummaryList;list=(0,_lodash.sortBy)(this.state.jobsSummaryList,function(item){return item[sortField]});list=sortDirection==="asc"?list:list.reverse();var listLength=list.length;var pageStart=index*size;if(pageStart>=listLength&&listLength!==0){pageStart=Math.floor((listLength-1)/size)*size;setTimeout(function(){_this2.setState({pageIndex:pageStart/size})},0)}return{pageOfItems:list.slice(pageStart,pageStart+size),totalItemCount:listLength}}},{key:"render",value:function render(){var _this3=this;var _props=this.props,intl=_props.intl,loading=_props.loading;var selectionControls={selectable:function selectable(){return true},selectableMessage:function selectableMessage(selectable){return!selectable?intl.formatMessage({id:"xpack.ml.jobsList.cannotSelectJobTooltip",defaultMessage:"Cannot select job"}):undefined},onSelectionChange:this.props.selectJobChange};var columns=[{name:"",render:function render(item){return _react2.default.createElement(_eui.EuiButtonIcon,{onClick:function onClick(){return _this3.toggleRow(item)},iconType:_this3.state.itemIdToExpandedRowMap[item.id]?"arrowDown":"arrowRight","aria-label":_this3.state.itemIdToExpandedRowMap[item.id]?intl.formatMessage({id:"xpack.ml.jobsList.collapseJobDetailsAriaLabel",defaultMessage:"Hide details for {itemId}"},{itemId:item.id}):intl.formatMessage({id:"xpack.ml.jobsList.expandJobDetailsAriaLabel",defaultMessage:"Show details for {itemId}"},{itemId:item.id}),"data-row-id":item.id})}},{field:"id",name:intl.formatMessage({id:"xpack.ml.jobsList.idLabel",defaultMessage:"ID"}),sortable:true,truncateText:false},{field:"auditMessage",name:"",render:function render(item){return _react2.default.createElement(_job_message_icon.JobIcon,{message:item,showTooltip:true})}},{name:intl.formatMessage({id:"xpack.ml.jobsList.descriptionLabel",defaultMessage:"Description"}),sortable:true,field:"description",render:function render(description,item){return _react2.default.createElement(_job_description.JobDescription,{job:item})},textOnly:true},{field:"processed_record_count",name:intl.formatMessage({id:"xpack.ml.jobsList.processedRecordsLabel",defaultMessage:"Processed records"}),sortable:true,truncateText:false,dataType:"number",render:function render(count){return(0,_string_utils.toLocaleString)(count)}},{field:"memory_status",name:intl.formatMessage({id:"xpack.ml.jobsList.memoryStatusLabel",defaultMessage:"Memory status"}),sortable:true,truncateText:false},{field:"jobState",name:intl.formatMessage({id:"xpack.ml.jobsList.jobStateLabel",defaultMessage:"Job state"}),sortable:true,truncateText:false},{field:"datafeedState",name:intl.formatMessage({id:"xpack.ml.jobsList.datafeedStateLabel",defaultMessage:"Datafeed state"}),sortable:true,truncateText:false},{name:intl.formatMessage({id:"xpack.ml.jobsList.latestTimestampLabel",defaultMessage:"Latest timestamp"}),truncateText:false,field:"latestTimestampSortValue",sortable:true,render:function render(time,item){return _react2.default.createElement("span",{className:"euiTableCellContent__text"},item.latestTimestampMs===undefined?"":(0,_moment2.default)(item.latestTimestampMs).format(TIME_FORMAT))}},{name:intl.formatMessage({id:"xpack.ml.jobsList.actionsLabel",defaultMessage:"Actions"}),render:function render(item){return _react2.default.createElement(_job_actions.ResultLinks,{jobs:[item]})}},{name:"",actions:(0,_job_actions.actionsMenuContent)(this.props.showEditJobFlyout,this.props.showDeleteJobModal,this.props.showStartDatafeedModal,this.props.refreshJobs)}];var _state=this.state,pageIndex=_state.pageIndex,pageSize=_state.pageSize,sortField=_state.sortField,sortDirection=_state.sortDirection;var _getPageOfJobs=this.getPageOfJobs(pageIndex,pageSize,sortField,sortDirection),pageOfItems=_getPageOfJobs.pageOfItems,totalItemCount=_getPageOfJobs.totalItemCount;var pagination={pageIndex:pageIndex,pageSize:pageSize,totalItemCount:totalItemCount,pageSizeOptions:PAGE_SIZE_OPTIONS};var sorting={sort:{field:sortField,direction:sortDirection}};var selectedJobsClass=this.props.selectedJobsCount?"jobs-selected":"";return _react2.default.createElement(_eui.EuiBasicTable,{loading:loading===true,noItemsMessage:loading?"Loading jobs...":"No jobs found",itemId:"id",className:"jobs-list-table "+selectedJobsClass,items:pageOfItems,columns:columns,pagination:pagination,onChange:this.onTableChange,selection:selectionControls,itemIdToExpandedRowMap:this.state.itemIdToExpandedRowMap,isExpandable:true,sorting:sorting,hasActions:true})}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props){var itemIdToExpandedRowMap=props.itemIdToExpandedRowMap;var jobsSummaryList=props.jobsSummaryList;return{itemIdToExpandedRowMap:itemIdToExpandedRowMap,jobsSummaryList:jobsSummaryList}}}]);return JobsListUI}(_react.Component);JobsListUI.propTypes={jobsSummaryList:_propTypes2.default.array.isRequired,fullJobsList:_propTypes2.default.object.isRequired,itemIdToExpandedRowMap:_propTypes2.default.object.isRequired,toggleRow:_propTypes2.default.func.isRequired,selectJobChange:_propTypes2.default.func.isRequired,showEditJobFlyout:_propTypes2.default.func.isRequired,showDeleteJobModal:_propTypes2.default.func.isRequired,showStartDatafeedModal:_propTypes2.default.func.isRequired,refreshJobs:_propTypes2.default.func.isRequired,selectedJobsCount:_propTypes2.default.number.isRequired,loading:_propTypes2.default.bool};JobsListUI.defaultProps={loading:false};var JobsList=exports.JobsList=(0,_react3.injectI18n)(JobsListUI)},221:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var format_1=__webpack_require__(418);function formatHumanReadableDate(ts){return format_1.formatDate(ts,"MMMM Do YYYY")}exports.formatHumanReadableDate=formatHumanReadableDate;function formatHumanReadableDateTime(ts){return format_1.formatDate(ts,"MMMM Do YYYY, HH:mm")}exports.formatHumanReadableDateTime=formatHumanReadableDateTime;function formatHumanReadableDateTimeSeconds(ts){return format_1.formatDate(ts,"MMMM Do YYYY, HH:mm:ss")}exports.formatHumanReadableDateTimeSeconds=formatHumanReadableDateTimeSeconds},2210:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.actionsMenuContent=actionsMenuContent;var _check_privilege=__webpack_require__(32);var _check_ml_nodes=__webpack_require__(47);var _index_utils=__webpack_require__(62);var _utils=__webpack_require__(297);var _i18n=__webpack_require__(9);function actionsMenuContent(showEditJobFlyout,showDeleteJobModal,showStartDatafeedModal,refreshJobs){var canCreateJob=(0,_check_privilege.checkPermission)("canCreateJob")&&(0,_check_ml_nodes.mlNodesAvailable)();var canUpdateJob=(0,_check_privilege.checkPermission)("canUpdateJob");var canDeleteJob=(0,_check_privilege.checkPermission)("canDeleteJob");var canUpdateDatafeed=(0,_check_privilege.checkPermission)("canUpdateDatafeed");var canStartStopDatafeed=(0,_check_privilege.checkPermission)("canStartStopDatafeed")&&(0,_check_ml_nodes.mlNodesAvailable)();var canCloseJob=(0,_check_privilege.checkPermission)("canCloseJob")&&(0,_check_ml_nodes.mlNodesAvailable)();return[{name:_i18n.i18n.translate("xpack.ml.jobsList.managementActions.startDatafeedLabel",{defaultMessage:"Start datafeed"}),description:_i18n.i18n.translate("xpack.ml.jobsList.managementActions.startDatafeedDescription",{defaultMessage:"Start datafeed"}),icon:"play",enabled:function enabled(){return canStartStopDatafeed},available:function available(item){return(0,_utils.isStartable)([item])},onClick:function onClick(item){showStartDatafeedModal([item]);closeMenu()}},{name:_i18n.i18n.translate("xpack.ml.jobsList.managementActions.stopDatafeedLabel",{defaultMessage:"Stop datafeed"}),description:_i18n.i18n.translate("xpack.ml.jobsList.managementActions.stopDatafeedDescription",{defaultMessage:"Stop datafeed"}),icon:"stop",enabled:function enabled(){return canStartStopDatafeed},available:function available(item){return(0,_utils.isStoppable)([item])},onClick:function onClick(item){(0,_utils.stopDatafeeds)([item],refreshJobs);closeMenu(true)}},{name:_i18n.i18n.translate("xpack.ml.jobsList.managementActions.closeJobLabel",{defaultMessage:"Close job"}),description:_i18n.i18n.translate("xpack.ml.jobsList.managementActions.closeJobDescription",{defaultMessage:"Close job"}),icon:"cross",enabled:function enabled(){return canCloseJob},available:function available(item){return(0,_utils.isClosable)([item])},onClick:function onClick(item){(0,_utils.closeJobs)([item],refreshJobs);closeMenu(true)}},{name:_i18n.i18n.translate("xpack.ml.jobsList.managementActions.cloneJobLabel",{defaultMessage:"Clone job"}),description:_i18n.i18n.translate("xpack.ml.jobsList.managementActions.cloneJobDescription",{defaultMessage:"Clone job"}),icon:"copy",enabled:function enabled(item){var indexPatternNames=(0,_index_utils.getIndexPatternNames)();var jobIndicesAvailable=item.datafeedIndices.every(function(dfiName){return indexPatternNames.some(function(ipName){return ipName===dfiName})});return canCreateJob&&jobIndicesAvailable},onClick:function onClick(item){(0,_utils.cloneJob)(item.id);closeMenu(true)}},{name:_i18n.i18n.translate("xpack.ml.jobsList.managementActions.editJobLabel",{defaultMessage:"Edit job"}),description:_i18n.i18n.translate("xpack.ml.jobsList.managementActions.editJobDescription",{defaultMessage:"Edit job"}),icon:"pencil",enabled:function enabled(){return canUpdateJob&&canUpdateDatafeed},onClick:function onClick(item){showEditJobFlyout(item);closeMenu()}},{name:_i18n.i18n.translate("xpack.ml.jobsList.managementActions.deleteJobLabel",{defaultMessage:"Delete job"}),description:_i18n.i18n.translate("xpack.ml.jobsList.managementActions.deleteJobDescription",{defaultMessage:"Delete job"}),icon:"trash",color:"danger",enabled:function enabled(){return canDeleteJob},onClick:function onClick(item){showDeleteJobModal([item]);closeMenu()}}]}function closeMenu(){var now=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(now){document.querySelector(".euiTable").click()}else{window.setTimeout(function(){var modalBody=document.querySelector(".euiModalBody");if(modalBody){modalBody.click()}else{document.querySelector(".euiTable").click()}},500)}}},2211:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ResultLinks=undefined;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _job_service=__webpack_require__(23);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}var TIME_FORMAT="YYYY-MM-DD HH:mm:ss";function getLink(location,jobs){var from=0;var to=0;if(jobs.length===1){from=jobs[0].earliestTimestampMs;to=jobs[0].latestTimestampMs}else{from=Math.min.apply(Math,_toConsumableArray(jobs.map(function(j){return j.earliestTimestampMs})));to=Math.max.apply(Math,_toConsumableArray(jobs.map(function(j){return j.latestTimestampMs})))}var fromString=(0,_moment2.default)(from).format(TIME_FORMAT);var toString=(0,_moment2.default)(to).format(TIME_FORMAT);var jobIds=jobs.map(function(j){return j.id});var url=_job_service.mlJobService.createResultsUrl(jobIds,fromString,toString,location);return _chrome2.default.getBasePath()+"/app/"+url}function ResultLinksUI(_ref){var jobs=_ref.jobs,intl=_ref.intl;var openJobsInSingleMetricViewerText=intl.formatMessage({id:"xpack.ml.jobsList.resultActions.openJobsInSingleMetricViewerText",defaultMessage:"Open {jobsCount, plural, one {{jobId}} other {# jobs}} in Single Metric Viewer"},{jobsCount:jobs.length,jobId:jobs[0].id});var openJobsInAnomalyExplorerText=intl.formatMessage({id:"xpack.ml.jobsList.resultActions.openJobsInAnomalyExplorerText",defaultMessage:"Open {jobsCount, plural, one {{jobId}} other {# jobs}} in Anomaly Explorer"},{jobsCount:jobs.length,jobId:jobs[0].id});var singleMetricVisible=jobs.length<2;var singleMetricEnabled=jobs.length===1&&jobs[0].isSingleMetricViewerJob;return _react2.default.createElement(_react2.default.Fragment,null,singleMetricVisible&&_react2.default.createElement(_eui.EuiToolTip,{position:"bottom",content:openJobsInSingleMetricViewerText},_react2.default.createElement(_eui.EuiButtonIcon,{href:getLink("timeseriesexplorer",jobs),iconType:"stats","aria-label":openJobsInSingleMetricViewerText,className:"results-button",isDisabled:singleMetricEnabled===false})),_react2.default.createElement(_eui.EuiToolTip,{position:"bottom",content:openJobsInAnomalyExplorerText},_react2.default.createElement(_eui.EuiButtonIcon,{href:getLink("explorer",jobs),iconType:"tableOfContents","aria-label":openJobsInAnomalyExplorerText,className:"results-button"})),_react2.default.createElement("div",{className:"actions-border"}))}ResultLinksUI.propTypes={jobs:_propTypes2.default.array.isRequired};var ResultLinks=exports.ResultLinks=(0,_react3.injectI18n)(ResultLinksUI)},2212:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobDescription=JobDescription;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _job_group=__webpack_require__(625);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function JobDescription(_ref){var job=_ref.job;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement("div",{className:"job-description"},job.description,"  ",job.groups.map(function(group){return _react2.default.createElement(_job_group.JobGroup,{key:group,name:group})})))}JobDescription.propTypes={job:_propTypes2.default.object.isRequired}},2213:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobGroup=JobGroup;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var COLORS=["#00B3A4","#3185FC","#DB1374","#490092","#E6C220","#BFA180","#F98510","#461A0A","#920000","#666666","#0079A5"];var colorMap={};function JobGroup(_ref){var name=_ref.name;return _react2.default.createElement("div",{className:"inline-group",style:{backgroundColor:tabColor(name)}},name)}JobGroup.propTypes={name:_propTypes2.default.string.isRequired};function tabColor(name){if(colorMap[name]===undefined){var n=stringHash(name);var color=COLORS[n%COLORS.length];colorMap[name]=color;return color}else{return colorMap[name]}}function stringHash(str){var hash=0;var chr="";if(str.length===0){return hash}for(var i=0;i<str.length;i++){chr=str.charCodeAt(i);hash=(hash<<5)-hash+chr;hash|=0}return hash<0?hash*-2:hash}},2214:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobIcon=JobIcon;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var INFO="info",WARNING="warning",ERROR="error";function JobIcon(_ref){var message=_ref.message,_ref$showTooltip=_ref.showTooltip,showTooltip=_ref$showTooltip===undefined?false:_ref$showTooltip;if(message!==undefined){var color="primary";var icon="alert";if(message.level===INFO){color="primary"}else if(message.level===WARNING){color="warning"}else if(message.level===ERROR){color="danger"}if(showTooltip){return _react2.default.createElement(_eui.EuiToolTip,{position:"bottom",content:message.text},_react2.default.createElement(_eui.EuiIcon,{type:icon,color:color}))}else{return _react2.default.createElement(_eui.EuiIcon,{type:icon,color:color})}}else{return _react2.default.createElement("span",null)}}JobIcon.propTypes={message:_propTypes2.default.object,showTooltip:_propTypes2.default.bool}},2215:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _job_details=__webpack_require__(2216);Object.defineProperty(exports,"JobDetails",{enumerable:true,get:function get(){return _job_details.JobDetails}})},2216:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobDetails=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _extract_job_details=__webpack_require__(2217);var _json_tab=__webpack_require__(2219);var _datafeed_preview_tab=__webpack_require__(2221);var _annotations_table=__webpack_require__(626);var _forecasts_table=__webpack_require__(2223);var _job_details_pane=__webpack_require__(2225);var _job_messages_pane=__webpack_require__(2226);var _react3=__webpack_require__(3);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var mlAnnotationsEnabled=_chrome2.default.getInjected("mlAnnotationsEnabled",false);var JobDetailsUI=function(_Component){_inherits(JobDetailsUI,_Component);function JobDetailsUI(props){_classCallCheck(this,JobDetailsUI);var _this=_possibleConstructorReturn(this,(JobDetailsUI.__proto__||Object.getPrototypeOf(JobDetailsUI)).call(this,props));_this.state={};if(_this.props.addYourself){_this.props.addYourself(props.jobId,_this)}return _this}_createClass(JobDetailsUI,[{key:"componentWillUnmount",value:function componentWillUnmount(){this.props.removeYourself(this.props.jobId)}},{key:"render",value:function render(){var job=this.state.job;if(job===undefined){return _react2.default.createElement("div",{className:"job-loading-spinner"},_react2.default.createElement(_eui.EuiLoadingSpinner,{size:"l"}))}else{var _extractJobDetails=(0,_extract_job_details.extractJobDetails)(job),general=_extractJobDetails.general,customUrl=_extractJobDetails.customUrl,node=_extractJobDetails.node,detectors=_extractJobDetails.detectors,influencers=_extractJobDetails.influencers,analysisConfig=_extractJobDetails.analysisConfig,analysisLimits=_extractJobDetails.analysisLimits,dataDescription=_extractJobDetails.dataDescription,datafeed=_extractJobDetails.datafeed,counts=_extractJobDetails.counts,modelSizeStats=_extractJobDetails.modelSizeStats;var intl=this.props.intl;var tabs=[{id:"job-settings",name:intl.formatMessage({id:"xpack.ml.jobsList.jobDetails.tabs.jobSettingsLabel",defaultMessage:"Job settings"}),content:_react2.default.createElement(_job_details_pane.JobDetailsPane,{sections:[general,customUrl,node]}),time:job.open_time},{id:"job-config",name:intl.formatMessage({id:"xpack.ml.jobsList.jobDetails.tabs.jobConfigLabel",defaultMessage:"Job config"}),content:_react2.default.createElement(_job_details_pane.JobDetailsPane,{sections:[detectors,influencers,analysisConfig,analysisLimits,dataDescription]})},{id:"datafeed",name:intl.formatMessage({id:"xpack.ml.jobsList.jobDetails.tabs.datafeedLabel",defaultMessage:"Datafeed"}),content:_react2.default.createElement(_job_details_pane.JobDetailsPane,{sections:[datafeed]})},{id:"counts",name:intl.formatMessage({id:"xpack.ml.jobsList.jobDetails.tabs.countsLabel",defaultMessage:"Counts"}),content:_react2.default.createElement(_job_details_pane.JobDetailsPane,{sections:[counts,modelSizeStats]})},{id:"json",name:intl.formatMessage({id:"xpack.ml.jobsList.jobDetails.tabs.jsonLabel",defaultMessage:"JSON"}),content:_react2.default.createElement(_json_tab.JsonPane,{job:job})},{id:"job-messages",name:intl.formatMessage({id:"xpack.ml.jobsList.jobDetails.tabs.jobMessagesLabel",defaultMessage:"Job messages"}),content:_react2.default.createElement(_job_messages_pane.JobMessagesPane,{job:job})},{id:"datafeed-preview",name:intl.formatMessage({id:"xpack.ml.jobsList.jobDetails.tabs.datafeedPreviewLabel",defaultMessage:"Datafeed preview"}),content:_react2.default.createElement(_datafeed_preview_tab.DatafeedPreviewPane,{job:job})},{id:"forecasts",name:intl.formatMessage({id:"xpack.ml.jobsList.jobDetails.tabs.forecastsLabel",defaultMessage:"Forecasts"}),content:_react2.default.createElement(_forecasts_table.ForecastsTable,{job:job})}];if(mlAnnotationsEnabled){tabs.push({id:"annotations",name:"Annotations",content:_react2.default.createElement(_annotations_table.AnnotationsTable,{jobs:[job],drillDown:true})})}return _react2.default.createElement("div",{className:"tab-contents"},_react2.default.createElement(_eui.EuiTabbedContent,{tabs:tabs,initialSelectedTab:tabs[0],onTabClick:function onTabClick(){}}))}}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props){var job=props.job,loading=props.loading;return{job:job,loading:loading}}}]);return JobDetailsUI}(_react.Component);JobDetailsUI.propTypes={jobId:_propTypes2.default.string.isRequired,job:_propTypes2.default.object,addYourself:_propTypes2.default.func.isRequired,removeYourself:_propTypes2.default.func.isRequired};var JobDetails=exports.JobDetails=(0,_react3.injectI18n)(JobDetailsUI)},2217:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.extractJobDetails=extractJobDetails;var _string_utils=__webpack_require__(38);var _format_values=__webpack_require__(2218);var _i18n=__webpack_require__(9);function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function extractJobDetails(job){if(Object.keys(job).length===0){return{}}var general={title:_i18n.i18n.translate("xpack.ml.jobsList.jobDetails.generalTitle",{defaultMessage:"General"}),position:"left",items:(0,_format_values.filterObjects)(job,true).map(_format_values.formatValues)};var customUrl={title:_i18n.i18n.translate("xpack.ml.jobsList.jobDetails.customUrlsTitle",{defaultMessage:"Custom URLs"}),position:"right",items:[]};if(job.custom_settings&&job.custom_settings.custom_urls){var _customUrl$items;(_customUrl$items=customUrl.items).push.apply(_customUrl$items,_toConsumableArray(job.custom_settings.custom_urls.map(function(cu){return[cu.url_name,cu.url_value,cu.time_range]})))}var node={title:_i18n.i18n.translate("xpack.ml.jobsList.jobDetails.nodeTitle",{defaultMessage:"Node"}),position:"right",items:[]};if(job.node){node.items.push(["name",job.node.name])}var detectors={title:_i18n.i18n.translate("xpack.ml.jobsList.jobDetails.detectorsTitle",{defaultMessage:"Detectors"}),position:"left",items:[]};if(job.analysis_config&&job.analysis_config.detectors){var _detectors$items;(_detectors$items=detectors.items).push.apply(_detectors$items,_toConsumableArray(job.analysis_config.detectors.map(function(d){var stringifiedDtr=(0,_string_utils.detectorToString)(d);return[stringifiedDtr,stringifiedDtr!==d.detector_description?d.detector_description:""]})))}var influencers={title:_i18n.i18n.translate("xpack.ml.jobsList.jobDetails.influencersTitle",{defaultMessage:"Influencers"}),position:"left",items:job.analysis_config.influencers.map(function(i){return["",i]})};var analysisConfig={title:_i18n.i18n.translate("xpack.ml.jobsList.jobDetails.analysisConfigTitle",{defaultMessage:"Analysis config"}),position:"left",items:(0,_format_values.filterObjects)(job.analysis_config)};var analysisLimits={title:_i18n.i18n.translate("xpack.ml.jobsList.jobDetails.analysisLimitsTitle",{defaultMessage:"Analysis limits"}),position:"left",items:(0,_format_values.filterObjects)(job.analysis_limits)};var dataDescription={title:_i18n.i18n.translate("xpack.ml.jobsList.jobDetails.dataDescriptionTitle",{defaultMessage:"Data description"}),position:"right",items:(0,_format_values.filterObjects)(job.data_description)};var datafeed={title:_i18n.i18n.translate("xpack.ml.jobsList.jobDetails.datafeedTitle",{defaultMessage:"Datafeed"}),position:"left",items:(0,_format_values.filterObjects)(job.datafeed_config,true,true)};if(job.node){datafeed.items.push(["node",JSON.stringify(job.node)])}var counts={title:_i18n.i18n.translate("xpack.ml.jobsList.jobDetails.countsTitle",{defaultMessage:"Counts"}),position:"left",items:(0,_format_values.filterObjects)(job.data_counts).map(_format_values.formatValues)};var modelSizeStats={title:_i18n.i18n.translate("xpack.ml.jobsList.jobDetails.modelSizeStatsTitle",{defaultMessage:"Model size stats"}),position:"right",items:(0,_format_values.filterObjects)(job.model_size_stats).map(_format_values.formatValues)};return{general:general,customUrl:customUrl,node:node,detectors:detectors,influencers:influencers,analysisConfig:analysisConfig,analysisLimits:analysisLimits,dataDescription:dataDescription,datafeed:datafeed,counts:counts,modelSizeStats:modelSizeStats}}},2218:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();exports.formatValues=formatValues;exports.filterObjects=filterObjects;var _numeral=__webpack_require__(212);var _numeral2=_interopRequireDefault(_numeral);var _format=__webpack_require__(418);var _string_utils=__webpack_require__(38);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var TIME_FORMAT="YYYY-MM-DD HH:mm:ss";var DATA_FORMAT="0.0 b";function formatData(txt){return(0,_numeral2.default)(txt).format(DATA_FORMAT)}function formatValues(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];switch(key){case"finished_time":case"create_time":case"log_time":case"timestamp":case"earliest_record_timestamp":case"latest_record_timestamp":case"last_data_time":case"latest_empty_bucket_timestamp":case"latest_sparse_bucket_timestamp":value=(0,_format.formatDate)(value,TIME_FORMAT);break;case"established_model_memory":case"input_bytes":case"model_bytes":value=formatData(value);break;case"processed_record_count":case"processed_field_count":case"input_field_count":case"invalid_date_count":case"missing_field_count":case"out_of_order_timestamp_count":case"empty_bucket_count":case"sparse_bucket_count":case"bucket_count":case"input_record_count":case"total_by_field_count":case"total_over_field_count":case"total_partition_field_count":case"bucket_allocation_failures_count":value=(0,_string_utils.toLocaleString)(value);break;default:break}return[key,value]}function filterObjects(obj,allowArrays,allowObjects){return Object.keys(obj).filter(function(k){return allowObjects||_typeof(obj[k])!=="object"||allowArrays&&Array.isArray(obj[k])}).map(function(k){var item=obj[k];if(Array.isArray(item)){item=item.join(", ")}else if(_typeof(obj[k])==="object"){item=JSON.stringify(item)}return[k,item]})}},2219:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JsonPane=JsonPane;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _ml_job_editor=__webpack_require__(403);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function JsonPane(_ref){var job=_ref.job;var json=JSON.stringify(job,null,2);return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_ml_job_editor.MLJobEditor,{value:json,readOnly:true}))}JsonPane.propTypes={job:_propTypes2.default.object.isRequired}},2220:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EDITOR_MODE=undefined;exports.MLJobEditor=MLJobEditor;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EDITOR_MODE=exports.EDITOR_MODE={TEXT:"text",JSON:"json"};function MLJobEditor(_ref){var value=_ref.value,_ref$height=_ref.height,height=_ref$height===undefined?"500px":_ref$height,_ref$width=_ref.width,width=_ref$width===undefined?"100%":_ref$width,_ref$mode=_ref.mode,mode=_ref$mode===undefined?EDITOR_MODE.JSON:_ref$mode,_ref$readOnly=_ref.readOnly,readOnly=_ref$readOnly===undefined?false:_ref$readOnly,_ref$syntaxChecking=_ref.syntaxChecking,syntaxChecking=_ref$syntaxChecking===undefined?true:_ref$syntaxChecking,_ref$onChange=_ref.onChange,onChange=_ref$onChange===undefined?function(){}:_ref$onChange;return _react2.default.createElement(_eui.EuiCodeEditor,{value:value,width:width,height:height,mode:mode,readOnly:readOnly,wrapEnabled:true,showPrintMargin:false,editorProps:{$blockScrolling:true},setOptions:{useWorker:syntaxChecking},onChange:onChange})}MLJobEditor.propTypes={value:_propTypes2.default.string.isRequired,height:_propTypes2.default.string,width:_propTypes2.default.string,mode:_propTypes2.default.string,readOnly:_propTypes2.default.bool,onChange:_propTypes2.default.func}},2221:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DatafeedPreviewPane=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _job_service=__webpack_require__(23);var _check_privilege=__webpack_require__(32);var _job_utils=__webpack_require__(34);var _ml_job_editor=__webpack_require__(403);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DatafeedPreviewPane=exports.DatafeedPreviewPane=function(_Component){_inherits(DatafeedPreviewPane,_Component);function DatafeedPreviewPane(props){_classCallCheck(this,DatafeedPreviewPane);var _this=_possibleConstructorReturn(this,(DatafeedPreviewPane.__proto__||Object.getPrototypeOf(DatafeedPreviewPane)).call(this,props));_this.state={previewJson:"",loading:true,canPreviewDatafeed:true};return _this}_createClass(DatafeedPreviewPane,[{key:"renderContent",value:function renderContent(){var _state=this.state,previewJson=_state.previewJson,loading=_state.loading,canPreviewDatafeed=_state.canPreviewDatafeed;if(canPreviewDatafeed===false){return _react2.default.createElement(_eui.EuiCallOut,{title:"You do not have permission to view the datafeed preview",color:"warning",iconType:"alert"},_react2.default.createElement("p",null,"Please contact your administrator"))}else if(loading===true){return _react2.default.createElement(_eui.EuiLoadingSpinner,{size:"xl"})}else{return _react2.default.createElement(_ml_job_editor.MLJobEditor,{value:previewJson,readOnly:true})}}},{key:"componentDidMount",value:function componentDidMount(){var _this2=this;var canPreviewDatafeed=(0,_check_privilege.checkPermission)("canPreviewDatafeed");this.setState({canPreviewDatafeed:canPreviewDatafeed});updateDatafeedPreview(this.props.job,canPreviewDatafeed).then(function(previewJson){_this2.setState({previewJson:previewJson,loading:false})}).catch(function(error){console.log("Datafeed preview could not be loaded",error);_this2.setState({loading:false})})}},{key:"render",value:function render(){return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),this.renderContent())}}]);return DatafeedPreviewPane}(_react.Component);DatafeedPreviewPane.propTypes={job:_propTypes2.default.object.isRequired};function updateDatafeedPreview(job,canPreviewDatafeed){return new Promise(function(resolve,reject){if(canPreviewDatafeed){_job_service.mlJobService.getDatafeedPreview(job.job_id).then(function(resp){if(Array.isArray(resp)){resolve(JSON.stringify(resp.slice(0,_job_utils.ML_DATA_PREVIEW_COUNT),null,2))}else{resolve("");console.log("Datafeed preview could not be loaded",resp)}}).catch(function(error){reject(error)})}})}},2222:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _annotations_table=__webpack_require__(988);__webpack_require__(21);var _modules=__webpack_require__(4);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");var mlAnnotationsEnabled=_chrome2.default.getInjected("mlAnnotationsEnabled",false);_module.directive("mlAnnotationTable",function(){function link(scope,element){function renderReactComponent(){if(typeof scope.jobs==="undefined"&&typeof scope.annotations==="undefined"){return}var props={annotations:scope.annotations,jobs:scope.jobs,isSingleMetricViewerLinkVisible:scope.drillDown,isNumberBadgeVisible:scope.numberBadge};_reactDom2.default.render(_react2.default.createElement(_annotations_table.AnnotationsTable,props),element[0])}renderReactComponent();scope.$on("render",function(){renderReactComponent()});function renderFocusChart(){renderReactComponent()}if(mlAnnotationsEnabled){scope.$watchCollection("annotations",renderFocusChart)}element.on("$destroy",function(){_reactDom2.default.unmountComponentAtNode(element[0]);scope.$destroy()})}return{scope:{annotations:"=",drillDown:"=",jobs:"=",numberBadge:"="},link:link}})},2223:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _forecasts_table=__webpack_require__(2224);Object.defineProperty(exports,"ForecastsTable",{enumerable:true,get:function get(){return _forecasts_table.ForecastsTable}})},2224:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ForecastsTable=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _risonNode=__webpack_require__(206);var _risonNode2=_interopRequireDefault(_risonNode);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _format=__webpack_require__(418);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _states=__webpack_require__(401);var _recently_accessed=__webpack_require__(468);var _forecast_service=__webpack_require__(630);var _react3=__webpack_require__(3);var _job_utils=__webpack_require__(34);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MAX_FORECASTS=500;var TIME_FORMAT="YYYY-MM-DD HH:mm:ss";var ForecastsTableUI=function(_Component){_inherits(ForecastsTableUI,_Component);function ForecastsTableUI(props){_classCallCheck(this,ForecastsTableUI);var _this=_possibleConstructorReturn(this,(ForecastsTableUI.__proto__||Object.getPrototypeOf(ForecastsTableUI)).call(this,props));_this.state={isLoading:props.job.data_counts.processed_record_count!==0,forecasts:[]};return _this}_createClass(ForecastsTableUI,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;var dataCounts=this.props.job.data_counts;if(dataCounts.processed_record_count>0){_forecast_service.mlForecastService.getForecastsSummary(this.props.job,null,dataCounts.earliest_record_timestamp,MAX_FORECASTS).then(function(resp){_this2.setState({isLoading:false,forecasts:resp.forecasts})}).catch(function(resp){console.log("Error loading list of forecasts for jobs list:",resp);_this2.setState({isLoading:false,errorMessage:_this2.props.intl.formatMessage({id:"xpack.ml.jobsList.jobDetails.forecastsTable.loadingErrorMessage",defaultMessage:"Error loading the list of forecasts run on this job"}),forecasts:[]})})}}},{key:"openSingleMetricView",value:function openSingleMetricView(forecast){var dataCounts=this.props.job.data_counts;var jobEarliest=dataCounts.earliest_record_timestamp;var from=new Date(dataCounts.earliest_record_timestamp).toISOString();var to=forecast!==undefined?new Date(forecast.forecast_end_timestamp).toISOString():new Date(dataCounts.latest_record_timestamp).toISOString();var _g=_risonNode2.default.encode({ml:{jobIds:[this.props.job.job_id]},refreshInterval:{display:"Off",pause:false,value:0},time:{from:from,to:to,mode:"absolute"}});var appState={filters:[],query:{query_string:{analyze_wildcard:true,query:"*"}}};if(forecast!==undefined){var forecastDurationMs=forecast.forecast_end_timestamp-forecast.forecast_start_timestamp;var zoomFrom=Math.max(forecast.forecast_start_timestamp-forecastDurationMs,jobEarliest);appState.mlTimeSeriesExplorer={forecastId:forecast.forecast_id,zoom:{from:new Date(zoomFrom).toISOString(),to:new Date(forecast.forecast_end_timestamp).toISOString()}}}var _a=_risonNode2.default.encode(appState);var url="?_g="+_g+"&_a="+_a;(0,_recently_accessed.addItemToRecentlyAccessed)("timeseriesexplorer",this.props.job.job_id,url);window.open(_chrome2.default.getBasePath()+"/app/ml#/timeseriesexplorer"+url,"_self")}},{key:"render",value:function render(){var _this3=this;if(this.state.isLoading===true){return _react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceAround"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiLoadingSpinner,{size:"l"})))}if(this.state.errorMessage!==undefined){return _react2.default.createElement(_eui.EuiCallOut,{title:this.state.errorMessage,color:"danger",iconType:"cross"})}var forecasts=this.state.forecasts;if(forecasts.length===0){return _react2.default.createElement(_eui.EuiCallOut,{title:_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.jobDetails.forecastsTable.noForecastsTitle",defaultMessage:"No forecasts have been run for this job"}),iconType:"iInCircle"},(0,_job_utils.isTimeSeriesViewJob)(this.props.job)&&_react2.default.createElement("p",null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.jobDetails.forecastsTable.noForecastsDescription",defaultMessage:"To run a forecast, open the {singleMetricViewerLink}",values:{singleMetricViewerLink:_react2.default.createElement(_eui.EuiLink,{onClick:function onClick(){return _this3.openSingleMetricView()}},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.jobDetails.forecastsTable.noForecastsDescription.linkText",defaultMessage:"Single Metric Viewer"}))}})))}var intl=this.props.intl;var columns=[{field:"forecast_create_timestamp",name:intl.formatMessage({id:"xpack.ml.jobsList.jobDetails.forecastsTable.createdLabel",defaultMessage:"Created"}),dataType:"date",render:function render(date){return(0,_format.formatDate)(date,TIME_FORMAT)},textOnly:true,sortable:true},{field:"forecast_start_timestamp",name:intl.formatMessage({id:"xpack.ml.jobsList.jobDetails.forecastsTable.fromLabel",defaultMessage:"From"}),dataType:"date",render:function render(date){return(0,_format.formatDate)(date,TIME_FORMAT)},textOnly:true,sortable:true},{field:"forecast_end_timestamp",name:intl.formatMessage({id:"xpack.ml.jobsList.jobDetails.forecastsTable.toLabel",defaultMessage:"To"}),dataType:"date",render:function render(date){return(0,_format.formatDate)(date,TIME_FORMAT)},textOnly:true,sortable:true},{field:"forecast_status",name:intl.formatMessage({id:"xpack.ml.jobsList.jobDetails.forecastsTable.statusLabel",defaultMessage:"Status"}),sortable:true},{field:"forecast_memory_bytes",name:intl.formatMessage({id:"xpack.ml.jobsList.jobDetails.forecastsTable.memorySizeLabel",defaultMessage:"Memory size"}),render:function render(bytes){return(0,_format.formatNumber)(bytes,"0b")},sortable:true},{field:"processing_time_ms",name:intl.formatMessage({id:"xpack.ml.jobsList.jobDetails.forecastsTable.processingTimeLabel",defaultMessage:"Processing time"}),render:function render(ms){return intl.formatMessage({id:"xpack.ml.jobsList.jobDetails.forecastsTable.msTimeUnitLabel",defaultMessage:"{ms} ms"},{ms:ms})},sortable:true},{field:"forecast_expiry_timestamp",name:intl.formatMessage({id:"xpack.ml.jobsList.jobDetails.forecastsTable.expiresLabel",defaultMessage:"Expires"}),render:function render(date){return(0,_format.formatDate)(date,TIME_FORMAT)},textOnly:true,sortable:true},{field:"forecast_messages",name:intl.formatMessage({id:"xpack.ml.jobsList.jobDetails.forecastsTable.messagesLabel",defaultMessage:"Messages"}),sortable:false,render:function render(messages){return _react2.default.createElement("div",null,messages.map(function(message,index){return _react2.default.createElement("p",{key:index},message)}))},textOnly:true},{name:intl.formatMessage({id:"xpack.ml.jobsList.jobDetails.forecastsTable.viewLabel",defaultMessage:"View"}),render:function render(forecast){return _react2.default.createElement(_eui.EuiButton,{onClick:function onClick(){return _this3.openSingleMetricView(forecast)},className:"view-forecast-btn",isDisabled:forecast.forecast_status!==_states.FORECAST_REQUEST_STATE.FINISHED},_react2.default.createElement("i",{"aria-hidden":"true",className:"fa fa-line-chart"}))}}];return _react2.default.createElement(_eui.EuiInMemoryTable,{className:"forecasts-table",items:forecasts,columns:columns,pagination:{pageSizeOptions:[5,10,25]},sorting:true})}}]);return ForecastsTableUI}(_react.Component);ForecastsTableUI.propTypes={job:_propTypes2.default.object.isRequired};var ForecastsTable=(0,_react3.injectI18n)(ForecastsTableUI);exports.ForecastsTable=ForecastsTable},2225:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobDetailsPane=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function SectionItem(_ref){var item=_ref.item;return _react2.default.createElement(_eui.EuiTableRow,null,item[0]!==""&&_react2.default.createElement(_eui.EuiTableRowCell,null,_react2.default.createElement("span",{className:"job-item header"},item[0])),_react2.default.createElement(_eui.EuiTableRowCell,null,_react2.default.createElement("span",{className:"job-item"},item[1])))}SectionItem.propTypes={item:_propTypes2.default.array.isRequired};function Section(_ref2){var section=_ref2.section;if(section.items.length===0){return _react2.default.createElement("div",null)}return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiTitle,{size:"xs"},_react2.default.createElement("h4",null,section.title)),_react2.default.createElement("div",{className:"job-section"},_react2.default.createElement(_eui.EuiTable,{compressed:true},_react2.default.createElement(_eui.EuiTableBody,null,section.items.map(function(item,i){return _react2.default.createElement(SectionItem,{item:item,key:i})})))))}Section.propTypes={section:_propTypes2.default.object.isRequired};var JobDetailsPane=exports.JobDetailsPane=function(_Component){_inherits(JobDetailsPane,_Component);function JobDetailsPane(props){_classCallCheck(this,JobDetailsPane);var _this=_possibleConstructorReturn(this,(JobDetailsPane.__proto__||Object.getPrototypeOf(JobDetailsPane)).call(this,props));_this.state={};return _this}_createClass(JobDetailsPane,[{key:"render",value:function render(){var _state=this.state,sections=_state.sections,time=_state.time;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement("div",{className:"row",time:time},_react2.default.createElement("div",{className:"col-md-6"},sections.filter(function(s){return s.position==="left"}).map(function(s,i){return _react2.default.createElement(Section,{section:s,key:i})})),_react2.default.createElement("div",{className:"col-md-6"},sections.filter(function(s){return s.position==="right"}).map(function(s,i){return _react2.default.createElement(Section,{section:s,key:i})}))))}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props){var sections=props.sections,time=props.time;return{sections:sections,time:time}}}]);return JobDetailsPane}(_react.Component);JobDetailsPane.propTypes={sections:_propTypes2.default.array.isRequired}},2226:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobMessagesPane=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _format=__webpack_require__(418);var _ml_api_service=__webpack_require__(22);var _job_message_icon=__webpack_require__(987);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TIME_FORMAT="YYYY-MM-DD HH:mm:ss";var JobMessagesPaneUI=function(_Component){_inherits(JobMessagesPaneUI,_Component);function JobMessagesPaneUI(props){_classCallCheck(this,JobMessagesPaneUI);var _this=_possibleConstructorReturn(this,(JobMessagesPaneUI.__proto__||Object.getPrototypeOf(JobMessagesPaneUI)).call(this,props));_this.state={messages:[]};_this.jobId=props.job.job_id;return _this}_createClass(JobMessagesPaneUI,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;_ml_api_service.ml.jobs.jobAuditMessages(this.jobId).then(function(messages){_this2.setState({messages:messages})}).catch(function(error){console.log("Job messages could not be loaded",error)})}},{key:"render",value:function render(){var messages=this.state.messages;var intl=this.props.intl;var columns=[{name:"",render:function render(item){return _react2.default.createElement(_job_message_icon.JobIcon,{message:item})}},{name:intl.formatMessage({id:"xpack.ml.jobsList.jobDetails.messagesPane.timeLabel",defaultMessage:"Time"}),render:function render(item){return(0,_format.formatDate)(item.timestamp,TIME_FORMAT)}},{field:"node_name",name:intl.formatMessage({id:"xpack.ml.jobsList.jobDetails.messagesPane.nodeLabel",defaultMessage:"Node"})},{field:"message",name:intl.formatMessage({id:"xpack.ml.jobsList.jobDetails.messagesPane.messageLabel",defaultMessage:"Message"})}];return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement("div",{className:"job-messages-table"},_react2.default.createElement(_eui.EuiBasicTable,{items:messages,columns:columns})))}}]);return JobMessagesPaneUI}(_react.Component);JobMessagesPaneUI.propTypes={job:_propTypes2.default.object.isRequired};var JobMessagesPane=exports.JobMessagesPane=(0,_react3.injectI18n)(JobMessagesPaneUI)},2227:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _job_filter_bar=__webpack_require__(2228);Object.defineProperty(exports,"JobFilterBar",{enumerable:true,get:function get(){return _job_filter_bar.JobFilterBar}})},2228:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobFilterBar=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _ml_api_service=__webpack_require__(22);var _job_group=__webpack_require__(625);var _eui=__webpack_require__(2);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function loadGroups(){return _ml_api_service.ml.jobs.groups().then(function(groups){return groups.map(function(g){return{value:g.id,view:_react2.default.createElement("div",{className:"group-item"},_react2.default.createElement(_job_group.JobGroup,{name:g.id})," ",_react2.default.createElement("span",null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.jobFilterBar.jobGroupTitle",defaultMessage:"({jobsCount, plural, one {# job} other {# jobs}})",values:{jobsCount:g.jobIds.length}})))}})}).catch(function(error){console.log(error);return[]})}var JobFilterBarUI=function(_Component){_inherits(JobFilterBarUI,_Component);function JobFilterBarUI(props){_classCallCheck(this,JobFilterBarUI);var _this=_possibleConstructorReturn(this,(JobFilterBarUI.__proto__||Object.getPrototypeOf(JobFilterBarUI)).call(this,props));_this.onChange=function(_ref){var query=_ref.query,error=_ref.error;if(error){_this.setState({error:error})}else{var clauses=[];if(query&&query.ast!==undefined&&query.ast.clauses!==undefined){clauses=query.ast.clauses}_this.setFilters(clauses);_this.setState({error:null})}};_this.state={error:null};_this.setFilters=props.setFilters;return _this}_createClass(JobFilterBarUI,[{key:"renderError",value:function renderError(){var error=this.state.error;if(!error){return}return _react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiCallOut,{color:"danger",title:_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.jobFilterBar.invalidSearchErrorMessage",defaultMessage:"Invalid search: {errorMessage}",values:{errorMessage:error.message}})}),_react2.default.createElement(_eui.EuiSpacer,{size:"l"}))}},{key:"render",value:function render(){var intl=this.props.intl;var filters=[{type:"field_value_toggle_group",field:"job_state",items:[{value:"opened",name:intl.formatMessage({id:"xpack.ml.jobsList.jobFilterBar.openedLabel",defaultMessage:"Opened"})},{value:"closed",name:intl.formatMessage({id:"xpack.ml.jobsList.jobFilterBar.closedLabel",defaultMessage:"Closed"})},{value:"failed",name:intl.formatMessage({id:"xpack.ml.jobsList.jobFilterBar.failedLabel",defaultMessage:"Failed"})}]},{type:"field_value_toggle_group",field:"datafeed_state",items:[{value:"started",name:intl.formatMessage({id:"xpack.ml.jobsList.jobFilterBar.startedLabel",defaultMessage:"Started"})},{value:"stopped",name:intl.formatMessage({id:"xpack.ml.jobsList.jobFilterBar.stoppedLabel",defaultMessage:"Stopped"})}]},{type:"field_value_selection",field:"groups",name:intl.formatMessage({id:"xpack.ml.jobsList.jobFilterBar.groupLabel",defaultMessage:"Group"}),multiSelect:"or",cache:1e4,options:function options(){return loadGroups()}}];return _react2.default.createElement(_eui.EuiFlexGroup,{direction:"column"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiSearchBar,{box:{incremental:true},filters:filters,onChange:this.onChange,className:"mlJobFilterBar"})),this.renderError()||"")}}]);return JobFilterBarUI}(_react.Component);JobFilterBarUI.propTypes={setFilters:_propTypes2.default.func.isRequired};var JobFilterBar=exports.JobFilterBar=(0,_react3.injectI18n)(JobFilterBarUI)},2229:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _edit_job_flyout=__webpack_require__(2230);Object.defineProperty(exports,"EditJobFlyout",{enumerable:true,get:function get(){return _edit_job_flyout.EditJobFlyout}})},2230:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EditJobFlyout=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _tabs=__webpack_require__(2231);var _edit_utils=__webpack_require__(989);var _utils=__webpack_require__(297);var _validate_job=__webpack_require__(990);var _messagebar_service=__webpack_require__(178);var _notify=__webpack_require__(10);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var EditJobFlyoutUI=function(_Component){_inherits(EditJobFlyoutUI,_Component);function EditJobFlyoutUI(props){_classCallCheck(this,EditJobFlyoutUI);var _this=_possibleConstructorReturn(this,(EditJobFlyoutUI.__proto__||Object.getPrototypeOf(EditJobFlyoutUI)).call(this,props));_this.closeFlyout=function(){_this.setState({isFlyoutVisible:false})};_this.showFlyout=function(jobLite){var hasDatafeed=jobLite.hasDatafeed;(0,_utils.loadFullJob)(jobLite.id).then(function(job){_this.extractJob(job,hasDatafeed);_this.setState({job:job,isFlyoutVisible:true})}).catch(function(error){console.error(error)})};_this.setJobDetails=function(jobDetails){var _this$state=_this.state,jobModelMemoryLimitValidationError=_this$state.jobModelMemoryLimitValidationError,jobGroupsValidationError=_this$state.jobGroupsValidationError;if(jobDetails.jobModelMemoryLimit!==undefined){jobModelMemoryLimitValidationError=(0,_validate_job.validateModelMemoryLimit)(jobDetails.jobModelMemoryLimit).message}if(jobDetails.jobGroups!==undefined){if(jobDetails.jobGroups.some(function(j){return _this.props.allJobIds.includes(j)})){jobGroupsValidationError=_this.props.intl.formatMessage({id:"xpack.ml.jobsList.editJobFlyout.groupsAndJobsHasSameIdErrorMessage",defaultMessage:"A job with this ID already exists. Groups and jobs cannot use the same ID."})}else{jobGroupsValidationError=(0,_validate_job.validateGroupNames)(jobDetails.jobGroups).message}}var isValidJobDetails=jobModelMemoryLimitValidationError===""&&jobGroupsValidationError==="";_this.setState(_extends({},jobDetails,{jobModelMemoryLimitValidationError:jobModelMemoryLimitValidationError,jobGroupsValidationError:jobGroupsValidationError,isValidJobDetails:isValidJobDetails}))};_this.setDetectorDescriptions=function(jobDetectorDescriptions){_this.setState(_extends({},jobDetectorDescriptions))};_this.setDatafeed=function(datafeed){_this.setState(_extends({},datafeed))};_this.setCustomUrls=function(jobCustomUrls){var isValidJobCustomUrls=(0,_validate_job.isValidCustomUrls)(jobCustomUrls);_this.setState({jobCustomUrls:jobCustomUrls,isValidJobCustomUrls:isValidJobCustomUrls})};_this.save=function(){var newJobData={description:_this.state.jobDescription,groups:_this.state.jobGroups,mml:_this.state.jobModelMemoryLimit,detectorDescriptions:_this.state.jobDetectorDescriptions,datafeedQuery:_this.state.datafeedQuery,datafeedQueryDelay:_this.state.datafeedQueryDelay,datafeedFrequency:_this.state.datafeedFrequency,datafeedScrollSize:_this.state.datafeedScrollSize,customUrls:_this.state.jobCustomUrls};(0,_edit_utils.saveJob)(_this.state.job,newJobData).then(function(){_notify.toastNotifications.addSuccess(_this.props.intl.formatMessage({id:"xpack.ml.jobsList.editJobFlyout.changesSavedNotificationMessage",defaultMessage:"Changes to {jobId} saved"},{jobId:_this.state.job.job_id}));_this.refreshJobs();_this.closeFlyout()}).catch(function(error){console.error(error);_notify.toastNotifications.addDanger(_this.props.intl.formatMessage({id:"xpack.ml.jobsList.editJobFlyout.changesNotSavedNotificationMessage",defaultMessage:"Could not save changes to {jobId}"},{jobId:_this.state.job.job_id}));_messagebar_service.mlMessageBarService.notify.error(error)})};_this.state={job:{},hasDatafeed:false,isFlyoutVisible:false,jobDescription:"",jobGroups:[],jobModelMemoryLimit:"",jobDetectors:[],jobDetectorDescriptions:[],jobCustomUrls:[],datafeedQuery:"",datafeedQueryDelay:"",datafeedFrequency:"",datafeedScrollSize:"",jobModelMemoryLimitValidationError:"",jobGroupsValidationError:"",isValidJobDetails:true,isValidJobCustomUrls:true};_this.refreshJobs=_this.props.refreshJobs;return _this}_createClass(EditJobFlyoutUI,[{key:"componentDidMount",value:function componentDidMount(){if(typeof this.props.setShowFunction==="function"){this.props.setShowFunction(this.showFlyout)}}},{key:"componentWillUnmount",value:function componentWillUnmount(){if(typeof this.props.unsetShowFunction==="function"){this.props.unsetShowFunction()}}},{key:"extractJob",value:function extractJob(job,hasDatafeed){var mml=job.analysis_limits&&job.analysis_limits.model_memory_limit?job.analysis_limits.model_memory_limit:"";var detectors=job.analysis_config&&job.analysis_config.detectors?job.analysis_config.detectors:"";var bucketSpan=job.analysis_config?job.analysis_config.bucket_span:"";var datafeedConfig=job.datafeed_config;var frequency=datafeedConfig.frequency!==undefined?datafeedConfig.frequency:"";var customUrls=job.custom_settings&&job.custom_settings.custom_urls?job.custom_settings.custom_urls:[];this.setState({job:job,hasDatafeed:hasDatafeed,jobDescription:job.description,jobGroups:job.groups!==undefined?job.groups:[],jobModelMemoryLimit:mml,jobDetectors:detectors,jobDetectorDescriptions:detectors.map(function(d){return d.detector_description}),jobBucketSpan:bucketSpan,jobCustomUrls:customUrls,datafeedQuery:hasDatafeed?JSON.stringify(datafeedConfig.query,null,2):"",datafeedQueryDelay:hasDatafeed?datafeedConfig.query_delay:"",datafeedFrequency:hasDatafeed?frequency:"",datafeedScrollSize:hasDatafeed?+datafeedConfig.scroll_size:"",jobModelMemoryLimitValidationError:"",jobGroupsValidationError:""})}},{key:"render",value:function render(){var flyout=void 0;if(this.state.isFlyoutVisible){var _state=this.state,job=_state.job,jobDescription=_state.jobDescription,jobGroups=_state.jobGroups,jobModelMemoryLimit=_state.jobModelMemoryLimit,jobDetectors=_state.jobDetectors,jobDetectorDescriptions=_state.jobDetectorDescriptions,jobBucketSpan=_state.jobBucketSpan,jobCustomUrls=_state.jobCustomUrls,datafeedQuery=_state.datafeedQuery,datafeedQueryDelay=_state.datafeedQueryDelay,datafeedFrequency=_state.datafeedFrequency,datafeedScrollSize=_state.datafeedScrollSize,jobGroupsValidationError=_state.jobGroupsValidationError,jobModelMemoryLimitValidationError=_state.jobModelMemoryLimitValidationError,isValidJobDetails=_state.isValidJobDetails,isValidJobCustomUrls=_state.isValidJobCustomUrls;var intl=this.props.intl;var tabs=[{id:"job-details",name:intl.formatMessage({id:"xpack.ml.jobsList.editJobFlyout.jobDetailsTitle",defaultMessage:"Job details"}),content:_react2.default.createElement(_tabs.JobDetails,{jobDescription:jobDescription,jobGroups:jobGroups,jobModelMemoryLimit:jobModelMemoryLimit,setJobDetails:this.setJobDetails,jobGroupsValidationError:jobGroupsValidationError,jobModelMemoryLimitValidationError:jobModelMemoryLimitValidationError})},{id:"detectors",name:intl.formatMessage({id:"xpack.ml.jobsList.editJobFlyout.detectorsTitle",defaultMessage:"Detectors"}),content:_react2.default.createElement(_tabs.Detectors,{jobDetectors:jobDetectors,jobDetectorDescriptions:jobDetectorDescriptions,setDetectorDescriptions:this.setDetectorDescriptions})},{id:"datafeed",name:intl.formatMessage({id:"xpack.ml.jobsList.editJobFlyout.datafeedTitle",defaultMessage:"Datafeed"}),content:_react2.default.createElement(_tabs.Datafeed,{datafeedQuery:datafeedQuery,datafeedQueryDelay:datafeedQueryDelay,datafeedFrequency:datafeedFrequency,datafeedScrollSize:datafeedScrollSize,jobBucketSpan:jobBucketSpan,setDatafeed:this.setDatafeed})},{id:"custom-urls",name:intl.formatMessage({id:"xpack.ml.jobsList.editJobFlyout.customUrlsTitle",defaultMessage:"Custom URLs"}),content:_react2.default.createElement(_tabs.CustomUrls,{job:job,jobCustomUrls:jobCustomUrls,setCustomUrls:this.setCustomUrls})}];flyout=_react2.default.createElement(_eui.EuiFlyout,{onClose:this.closeFlyout,size:"m"},_react2.default.createElement(_eui.EuiFlyoutHeader,null,_react2.default.createElement(_eui.EuiTitle,null,_react2.default.createElement("h2",null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.pageTitle",defaultMessage:"Edit {jobId}",values:{jobId:job.id}})))),_react2.default.createElement(_eui.EuiFlyoutBody,null,_react2.default.createElement(_eui.EuiTabbedContent,{tabs:tabs,initialSelectedTab:tabs[0],onTabClick:function onTabClick(){}})),_react2.default.createElement(_eui.EuiFlyoutFooter,null,_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceBetween"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonEmpty,{iconType:"cross",onClick:this.closeFlyout,flush:"left"},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.closeButtonLabel",defaultMessage:"Close"}))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButton,{onClick:this.save,fill:true,isDisabled:isValidJobDetails===false||isValidJobCustomUrls===false},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.saveButtonLabel",defaultMessage:"Save"}))))))}return _react2.default.createElement("div",null,flyout)}}]);return EditJobFlyoutUI}(_react.Component);EditJobFlyoutUI.propTypes={setShowFunction:_propTypes2.default.func.isRequired,unsetShowFunction:_propTypes2.default.func.isRequired,refreshJobs:_propTypes2.default.func.isRequired,allJobIds:_propTypes2.default.array.isRequired};var EditJobFlyout=exports.EditJobFlyout=(0,_react3.injectI18n)(EditJobFlyoutUI)},2231:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _job_details=__webpack_require__(2232);Object.defineProperty(exports,"JobDetails",{enumerable:true,get:function get(){return _job_details.JobDetails}});var _detectors=__webpack_require__(2233);Object.defineProperty(exports,"Detectors",{enumerable:true,get:function get(){return _detectors.Detectors}});var _datafeed=__webpack_require__(2234);Object.defineProperty(exports,"Datafeed",{enumerable:true,get:function get(){return _datafeed.Datafeed}});var _custom_urls=__webpack_require__(2235);Object.defineProperty(exports,"CustomUrls",{enumerable:true,get:function get(){return _custom_urls.CustomUrls}})},2232:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobDetails=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _ml_api_service=__webpack_require__(22);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var JobDetailsUI=function(_Component){_inherits(JobDetailsUI,_Component);function JobDetailsUI(props){_classCallCheck(this,JobDetailsUI);var _this=_possibleConstructorReturn(this,(JobDetailsUI.__proto__||Object.getPrototypeOf(JobDetailsUI)).call(this,props));_this.onDescriptionChange=function(e){_this.setJobDetails({jobDescription:e.target.value})};_this.onMmlChange=function(e){_this.setJobDetails({jobModelMemoryLimit:e.target.value})};_this.onGroupsChange=function(selectedGroups){_this.setJobDetails({jobGroups:selectedGroups.map(function(g){return g.label})})};_this.onCreateGroup=function(input,flattenedOptions){var normalizedSearchValue=input.trim().toLowerCase();if(!normalizedSearchValue){return}var newGroup={label:input};var groups=_this.state.groups;if(flattenedOptions.findIndex(function(option){return option.label.trim().toLowerCase()===normalizedSearchValue})===-1){groups.push(newGroup)}var selectedGroups=_this.state.selectedGroups.concat(newGroup);_this.setState({groups:groups},function(){return _this.onGroupsChange(selectedGroups)})};_this.state={description:"",groups:[],selectedGroups:[],mml:"",mmlValidationError:"",groupsValidationError:""};_this.setJobDetails=props.setJobDetails;return _this}_createClass(JobDetailsUI,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;_ml_api_service.ml.jobs.groups().then(function(resp){var groups=resp.map(function(g){return{label:g.id}});_this2.setState({groups:groups})}).catch(function(error){console.error("Could not load groups",error)})}},{key:"render",value:function render(){var _state=this.state,description=_state.description,selectedGroups=_state.selectedGroups,mml=_state.mml,groups=_state.groups,mmlValidationError=_state.mmlValidationError,groupsValidationError=_state.groupsValidationError;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_eui.EuiForm,null,_react2.default.createElement(_eui.EuiFormRow,{label:_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.jobDetails.jobDescriptionLabel",defaultMessage:"Job description"})},_react2.default.createElement(_eui.EuiFieldText,{value:description,onChange:this.onDescriptionChange})),_react2.default.createElement(_eui.EuiFormRow,{label:_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.jobDetails.jobGroupsLabel",defaultMessage:"Job groups"}),isInvalid:groupsValidationError!=="",error:groupsValidationError},_react2.default.createElement(_eui.EuiComboBox,{placeholder:this.props.intl.formatMessage({id:"xpack.ml.jobsList.editJobFlyout.jobDetails.jobGroupsPlaceholder",defaultMessage:"Select or create groups"}),options:groups,selectedOptions:selectedGroups,onChange:this.onGroupsChange,onCreateOption:this.onCreateGroup,isClearable:true,isInvalid:groupsValidationError!=="",error:groupsValidationError})),_react2.default.createElement(_eui.EuiFormRow,{label:_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.jobDetails.modelMemoryLimitLabel",defaultMessage:"Model memory limit"}),isInvalid:mmlValidationError!=="",error:mmlValidationError},_react2.default.createElement(_eui.EuiFieldText,{value:mml,onChange:this.onMmlChange,isInvalid:mmlValidationError!=="",error:mmlValidationError}))))}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props){var selectedGroups=props.jobGroups!==undefined?props.jobGroups.map(function(g){return{label:g}}):[];return{description:props.jobDescription,selectedGroups:selectedGroups,mml:props.jobModelMemoryLimit,mmlValidationError:props.jobModelMemoryLimitValidationError,groupsValidationError:props.jobGroupsValidationError}}}]);return JobDetailsUI}(_react.Component);JobDetailsUI.propTypes={jobDescription:_propTypes2.default.string.isRequired,jobGroups:_propTypes2.default.array.isRequired,jobModelMemoryLimit:_propTypes2.default.string.isRequired,setJobDetails:_propTypes2.default.func.isRequired};var JobDetails=exports.JobDetails=(0,_react3.injectI18n)(JobDetailsUI)},2233:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Detectors=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _job_service=__webpack_require__(23);var _string_utils=__webpack_require__(38);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Detectors=exports.Detectors=function(_Component){_inherits(Detectors,_Component);function Detectors(props){_classCallCheck(this,Detectors);var _this=_possibleConstructorReturn(this,(Detectors.__proto__||Object.getPrototypeOf(Detectors)).call(this,props));_this.onDescriptionChange=function(e,i){var jobDetectorDescriptions=_this.state.detectorDescriptions;jobDetectorDescriptions[i]=e.target.value;_this.setDetectorDescriptions({jobDetectorDescriptions:jobDetectorDescriptions})};_this.detectors=_job_service.mlJobService.getJobGroups().map(function(g){return{label:g.id}});_this.state={detectors:[],detectorDescriptions:[]};_this.setDetectorDescriptions=props.setDetectorDescriptions;return _this}_createClass(Detectors,[{key:"render",value:function render(){var _this2=this;var _state=this.state,detectors=_state.detectors,detectorDescriptions=_state.detectorDescriptions;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_eui.EuiForm,null,detectorDescriptions.map(function(d,i){return _react2.default.createElement(_eui.EuiFormRow,{label:(0,_string_utils.detectorToString)(detectors[i]),key:i},_react2.default.createElement(_eui.EuiFieldText,{value:d,onChange:function onChange(e){return _this2.onDescriptionChange(e,i)}}))})))}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props){return{detectors:props.jobDetectors,detectorDescriptions:props.jobDetectorDescriptions}}}]);return Detectors}(_react.Component);Detectors.propTypes={jobDetectors:_propTypes2.default.array.isRequired,jobDetectorDescriptions:_propTypes2.default.array.isRequired,setDetectorDescriptions:_propTypes2.default.func.isRequired}},2234:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Datafeed=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _job_utils=__webpack_require__(34);var _new_job_defaults=__webpack_require__(241);var _parse_interval=__webpack_require__(219);var _ml_job_editor=__webpack_require__(403);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function getDefaults(bucketSpan,jobDefaults){var bucketSpanSeconds=bucketSpan!==undefined?(0,_parse_interval.parseInterval)(bucketSpan).asSeconds():"";return{queryDelay:"60s",frequency:(0,_job_utils.calculateDatafeedFrequencyDefaultSeconds)(bucketSpanSeconds)+"s",scrollSize:jobDefaults.datafeeds.scroll_size}}var Datafeed=exports.Datafeed=function(_Component){_inherits(Datafeed,_Component);function Datafeed(props){_classCallCheck(this,Datafeed);var _this=_possibleConstructorReturn(this,(Datafeed.__proto__||Object.getPrototypeOf(Datafeed)).call(this,props));_this.onQueryChange=function(query){_this.setDatafeed({datafeedQuery:query})};_this.onQueryDelayChange=function(e){_this.setDatafeed({datafeedQueryDelay:e.target.value})};_this.onFrequencyChange=function(e){_this.setDatafeed({datafeedFrequency:e.target.value})};_this.onScrollSizeChange=function(e){_this.setDatafeed({datafeedScrollSize:+e.target.value})};_this.state={query:"",queryDelay:"",frequency:"",scrollSize:"",defaults:{queryDelay:"",frequency:"",scrollSize:0},jobDefaults:(0,_new_job_defaults.newJobDefaults)()};_this.setDatafeed=props.setDatafeed;return _this}_createClass(Datafeed,[{key:"render",value:function render(){var _state=this.state,query=_state.query,queryDelay=_state.queryDelay,frequency=_state.frequency,scrollSize=_state.scrollSize,defaults=_state.defaults;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_eui.EuiForm,null,_react2.default.createElement(_eui.EuiFormRow,{label:_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.datafeed.queryLabel",defaultMessage:"Query"}),style:{maxWidth:"inherit"}},_react2.default.createElement(_ml_job_editor.MLJobEditor,{value:query,onChange:this.onQueryChange,height:"200px"})),_react2.default.createElement(_eui.EuiFormRow,{label:_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.datafeed.queryDelayLabel",defaultMessage:"Query delay"})},_react2.default.createElement(_eui.EuiFieldText,{value:queryDelay,placeholder:defaults.queryDelay,onChange:this.onQueryDelayChange})),_react2.default.createElement(_eui.EuiFormRow,{label:_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.datafeed.frequencyLabel",defaultMessage:"Frequency"})},_react2.default.createElement(_eui.EuiFieldText,{value:frequency,placeholder:defaults.frequency,onChange:this.onFrequencyChange})),_react2.default.createElement(_eui.EuiFormRow,{label:_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.datafeed.scrollSizeLabel",defaultMessage:"Scroll size"})},_react2.default.createElement(_eui.EuiFieldNumber,{value:scrollSize,placeholder:defaults.scrollSize,onChange:this.onScrollSizeChange}))))}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props,state){return{query:props.datafeedQuery,queryDelay:props.datafeedQueryDelay,frequency:props.datafeedFrequency,scrollSize:props.datafeedScrollSize,defaults:getDefaults(props.jobBucketSpan,state.jobDefaults)}}}]);return Datafeed}(_react.Component);Datafeed.propTypes={datafeedQuery:_propTypes2.default.string.isRequired,datafeedQueryDelay:_propTypes2.default.string.isRequired,datafeedFrequency:_propTypes2.default.string.isRequired,datafeedScrollSize:_propTypes2.default.number.isRequired,jobBucketSpan:_propTypes2.default.string.isRequired,setDatafeed:_propTypes2.default.func.isRequired}},2235:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CustomUrls=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _notify=__webpack_require__(10);var _custom_url_editor=__webpack_require__(2236);var _utils=__webpack_require__(631);var _edit_utils=__webpack_require__(989);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MAX_NUMBER_DASHBOARDS=1e3;var MAX_NUMBER_INDEX_PATTERNS=1e3;var CustomUrlsUI=function(_Component){_inherits(CustomUrlsUI,_Component);function CustomUrlsUI(props){_classCallCheck(this,CustomUrlsUI);var _this=_possibleConstructorReturn(this,(CustomUrlsUI.__proto__||Object.getPrototypeOf(CustomUrlsUI)).call(this,props));_this.editNewCustomUrl=function(){_this.setState(function(prevState){var dashboards=prevState.dashboards,indexPatterns=prevState.indexPatterns;return{editorOpen:true,editorSettings:(0,_utils.getNewCustomUrlDefaults)(_this.props.job,dashboards,indexPatterns)}})};_this.setEditCustomUrl=function(customUrl){_this.setState({editorSettings:customUrl})};_this.addNewCustomUrl=function(){(0,_utils.buildCustomUrlFromSettings)(_this.state.editorSettings).then(function(customUrl){var customUrls=[].concat(_toConsumableArray(_this.state.customUrls),[customUrl]);_this.setCustomUrls(customUrls);_this.setState({editorOpen:false})}).catch(function(resp){console.log("Error building custom URL from settings:",resp);_notify.toastNotifications.addDanger(_this.props.intl.formatMessage({id:"xpack.ml.jobsList.editJobFlyout.customUrls.addNewUrlErrorNotificationMessage",defaultMessage:"An error occurred building the new custom URL from the supplied settings"}))})};_this.onTestButtonClick=function(){var job=_this.props.job;var intl=_this.props.intl;(0,_utils.buildCustomUrlFromSettings)(_this.state.editorSettings).then(function(customUrl){(0,_utils.getTestUrl)(job,customUrl).then(function(testUrl){window.open(testUrl,"_blank")}).catch(function(resp){console.log("Error obtaining URL for test:",resp);_notify.toastNotifications.addWarning(intl.formatMessage({id:"xpack.ml.jobsList.editJobFlyout.customUrls.getTestUrlErrorNotificationMessage",defaultMessage:"An error occurred obtaining the URL to test the configuration"}))})}).catch(function(resp){console.log("Error building custom URL from settings:",resp);_notify.toastNotifications.addWarning(intl.formatMessage({id:"xpack.ml.jobsList.editJobFlyout.customUrls.buildUrlErrorNotificationMessage",defaultMessage:"An error occurred building the custom URL for testing from the supplied settings"}))})};_this.closeEditor=function(){_this.setState({editorOpen:false})};_this.state={customUrls:[],dashboards:[],indexPatterns:[],queryEntityFieldNames:[],editorOpen:false};_this.setCustomUrls=props.setCustomUrls;_this.angularApply=props.angularApply;return _this}_createClass(CustomUrlsUI,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;var intl=this.props.intl;(0,_edit_utils.loadSavedDashboards)(MAX_NUMBER_DASHBOARDS).then(function(dashboards){_this2.setState({dashboards:dashboards})}).catch(function(resp){console.log("Error loading list of dashboards:",resp);_notify.toastNotifications.addDanger(intl.formatMessage({id:"xpack.ml.jobsList.editJobFlyout.customUrls.loadSavedDashboardsErrorNotificationMessage",defaultMessage:"An error occurred loading the list of saved Kibana dashboards"}))});(0,_edit_utils.loadIndexPatterns)(MAX_NUMBER_INDEX_PATTERNS).then(function(indexPatterns){_this2.setState({indexPatterns:indexPatterns})}).catch(function(resp){console.log("Error loading list of dashboards:",resp);_notify.toastNotifications.addDanger(intl.formatMessage({id:"xpack.ml.jobsList.editJobFlyout.customUrls.loadIndexPatternsErrorNotificationMessage",defaultMessage:"An error occurred loading the list of saved index patterns"}))})}},{key:"render",value:function render(){var _this3=this;var _state=this.state,customUrls=_state.customUrls,editorOpen=_state.editorOpen,editorSettings=_state.editorSettings,dashboards=_state.dashboards,indexPatterns=_state.indexPatterns,queryEntityFieldNames=_state.queryEntityFieldNames;var isValidEditorSettings=editorOpen===true?(0,_utils.isValidCustomUrlSettings)(editorSettings,customUrls):true;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),editorOpen===false?_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiButton,{size:"s",onClick:function onClick(){return _this3.editNewCustomUrl()}},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.customUrls.addCustomUrlButtonLabel",defaultMessage:"Add custom URL"}))):_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiPanel,{className:"edit-custom-url-panel"},_react2.default.createElement(_eui.EuiButtonIcon,{color:"text",onClick:function onClick(){return _this3.closeEditor()},iconType:"cross","aria-label":this.props.intl.formatMessage({id:"xpack.ml.jobsList.editJobFlyout.customUrls.closeEditorAriaLabel",defaultMessage:"Close custom URL editor"}),className:"close-editor-button"}),_react2.default.createElement(_custom_url_editor.CustomUrlEditor,{customUrl:editorSettings,setEditCustomUrl:this.setEditCustomUrl,savedCustomUrls:customUrls,dashboards:dashboards,indexPatterns:indexPatterns,queryEntityFieldNames:queryEntityFieldNames}),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_eui.EuiFlexGroup,null,_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButton,{onClick:function onClick(){return _this3.addNewCustomUrl()},isDisabled:!isValidEditorSettings},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.customUrls.addButtonLabel",defaultMessage:"Add"}))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonEmpty,{iconType:"popout",iconSide:"right",onClick:function onClick(){return _this3.onTestButtonClick()},isDisabled:!isValidEditorSettings},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.customUrls.testButtonLabel",defaultMessage:"Test"})))))),_react2.default.createElement(_eui.EuiSpacer,{size:"l"}),_react2.default.createElement(_custom_url_editor.CustomUrlList,{job:this.props.job,customUrls:customUrls,setCustomUrls:this.setCustomUrls}))}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props){return{job:props.job,customUrls:props.jobCustomUrls,queryEntityFieldNames:(0,_utils.getQueryEntityFieldNames)(props.job)}}}]);return CustomUrlsUI}(_react.Component);CustomUrlsUI.propTypes={job:_propTypes2.default.object.isRequired,jobCustomUrls:_propTypes2.default.array.isRequired,setCustomUrls:_propTypes2.default.func.isRequired};var CustomUrls=exports.CustomUrls=(0,_react3.injectI18n)(CustomUrlsUI)},2236:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _list=__webpack_require__(2237);Object.defineProperty(exports,"CustomUrlList",{enumerable:true,get:function get(){return _list.CustomUrlList}});var _editor=__webpack_require__(2238);Object.defineProperty(exports,"CustomUrlEditor",{enumerable:true,get:function get(){return _editor.CustomUrlEditor}})},2237:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CustomUrlList=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _notify=__webpack_require__(10);var _custom_url_utils=__webpack_require__(405);var _utils=__webpack_require__(631);var _parse_interval=__webpack_require__(219);var _constants=__webpack_require__(632);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function isValidTimeRange(timeRange){if(timeRange===undefined||timeRange.length===0||timeRange===_constants.TIME_RANGE_TYPE.AUTO){return true}var interval=(0,_parse_interval.parseInterval)(timeRange);return interval!==null}var CustomUrlList=exports.CustomUrlList=function(_Component){_inherits(CustomUrlList,_Component);function CustomUrlList(props){_classCallCheck(this,CustomUrlList);var _this=_possibleConstructorReturn(this,(CustomUrlList.__proto__||Object.getPrototypeOf(CustomUrlList)).call(this,props));_this.onLabelChange=function(e,index){var _this$props=_this.props,customUrls=_this$props.customUrls,setCustomUrls=_this$props.setCustomUrls;if(index<customUrls.length){customUrls[index]=_extends({},customUrls[index],{url_name:e.target.value});setCustomUrls(customUrls)}};_this.onUrlValueChange=function(e,index){var _this$props2=_this.props,customUrls=_this$props2.customUrls,setCustomUrls=_this$props2.setCustomUrls;if(index<customUrls.length){customUrls[index]=_extends({},customUrls[index],{url_value:e.target.value});setCustomUrls(customUrls)}};_this.onTimeRangeChange=function(e,index){var _this$props3=_this.props,customUrls=_this$props3.customUrls,setCustomUrls=_this$props3.setCustomUrls;if(index<customUrls.length){customUrls[index]=_extends({},customUrls[index]);var timeRange=e.target.value;if(timeRange!==undefined&&timeRange.length>0){customUrls[index].time_range=timeRange}else{delete customUrls[index].time_range}setCustomUrls(customUrls)}};_this.onDeleteButtonClick=function(index){var _this$props4=_this.props,customUrls=_this$props4.customUrls,setCustomUrls=_this$props4.setCustomUrls;if(index<customUrls.length){customUrls.splice(index,1);setCustomUrls(customUrls)}};_this.onTestButtonClick=function(index){var _this$props5=_this.props,customUrls=_this$props5.customUrls,job=_this$props5.job;if(index<customUrls.length){(0,_utils.getTestUrl)(job,customUrls[index]).then(function(testUrl){window.open(testUrl,"_blank")}).catch(function(resp){console.log("Error obtaining URL for test:",resp);_notify.toastNotifications.addDanger("An error occurred obtaining the URL to test the configuration")})}};return _this}_createClass(CustomUrlList,[{key:"render",value:function render(){var _this2=this;var customUrls=this.props.customUrls;var customUrlRows=customUrls.map(function(customUrl,index){var label=customUrl.url_name;var otherUrls=[].concat(_toConsumableArray(customUrls));otherUrls.splice(index,1);var isInvalidLabel=!(0,_custom_url_utils.isValidLabel)(label,otherUrls);var invalidLabelError=isInvalidLabel===true?["A unique label must be supplied"]:[];var timeRange=customUrl.time_range;var isInvalidTimeRange=!isValidTimeRange(timeRange);var invalidIntervalError=isInvalidTimeRange===true?["Invalid format"]:[];return _react2.default.createElement(_eui.EuiFlexGroup,{key:"url_"+index},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiFormRow,{label:"Label",isInvalid:isInvalidLabel,error:invalidLabelError},_react2.default.createElement(_eui.EuiFieldText,{value:label,isInvalid:isInvalidLabel,onChange:function onChange(e){return _this2.onLabelChange(e,index)}}))),_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiFormRow,{label:"URL"},_react2.default.createElement(_eui.EuiFieldText,{value:customUrl.url_value,onChange:function onChange(e){return _this2.onUrlValueChange(e,index)}}))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiFormRow,{label:"Time range",error:invalidIntervalError,isInvalid:isInvalidTimeRange},_react2.default.createElement(_eui.EuiFieldText,{value:customUrl.time_range||"",isInvalid:isInvalidTimeRange,placeholder:_constants.TIME_RANGE_TYPE.AUTO,onChange:function onChange(e){return _this2.onTimeRangeChange(e,index)}}))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiFormRow,{hasEmptyLabelSpace:true},_react2.default.createElement(_eui.EuiToolTip,{content:"Test custom URL"},_react2.default.createElement(_eui.EuiButtonIcon,{size:"s",color:"primary",onClick:function onClick(){return _this2.onTestButtonClick(index)},iconType:"popout","aria-label":"Test custom URL"})))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiFormRow,{hasEmptyLabelSpace:true},_react2.default.createElement(_eui.EuiToolTip,{content:"Delete custom URL"},_react2.default.createElement(_eui.EuiButtonIcon,{size:"s",color:"danger",onClick:function onClick(){return _this2.onDeleteButtonClick(index)},iconType:"trash","aria-label":"Delete custom URL"})))))});return _react2.default.createElement(_react2.default.Fragment,null,customUrlRows)}}]);return CustomUrlList}(_react.Component);CustomUrlList.propTypes={job:_propTypes2.default.object.isRequired,customUrls:_propTypes2.default.array.isRequired,setCustomUrls:_propTypes2.default.func.isRequired}},2238:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CustomUrlEditor=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _utils=__webpack_require__(631);var _custom_url_utils=__webpack_require__(405);var _constants=__webpack_require__(632);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function getLinkToOptions(){return[{id:_constants.URL_TYPE.KIBANA_DASHBOARD,label:"Kibana dashboard"},{id:_constants.URL_TYPE.KIBANA_DISCOVER,label:"Discover"},{id:_constants.URL_TYPE.OTHER,label:"Other"}]}var CustomUrlEditor=exports.CustomUrlEditor=function(_Component){_inherits(CustomUrlEditor,_Component);function CustomUrlEditor(props){_classCallCheck(this,CustomUrlEditor);var _this=_possibleConstructorReturn(this,(CustomUrlEditor.__proto__||Object.getPrototypeOf(CustomUrlEditor)).call(this,props));_this.onLabelChange=function(e){var _this$props=_this.props,customUrl=_this$props.customUrl,setEditCustomUrl=_this$props.setEditCustomUrl;setEditCustomUrl(_extends({},customUrl,{label:e.target.value}))};_this.onTypeChange=function(linkType){var _this$props2=_this.props,customUrl=_this$props2.customUrl,setEditCustomUrl=_this$props2.setEditCustomUrl;setEditCustomUrl(_extends({},customUrl,{type:linkType}))};_this.onDashboardChange=function(e){var _this$props3=_this.props,customUrl=_this$props3.customUrl,setEditCustomUrl=_this$props3.setEditCustomUrl;var kibanaSettings=customUrl.kibanaSettings;setEditCustomUrl(_extends({},customUrl,{kibanaSettings:_extends({},kibanaSettings,{dashboardId:e.target.value})}))};_this.onDiscoverIndexPatternChange=function(e){var _this$props4=_this.props,customUrl=_this$props4.customUrl,setEditCustomUrl=_this$props4.setEditCustomUrl;var kibanaSettings=customUrl.kibanaSettings;setEditCustomUrl(_extends({},customUrl,{kibanaSettings:_extends({},kibanaSettings,{discoverIndexPatternId:e.target.value})}))};_this.onQueryEntitiesChange=function(selectedOptions){var _this$props5=_this.props,customUrl=_this$props5.customUrl,setEditCustomUrl=_this$props5.setEditCustomUrl;var selectedFieldNames=selectedOptions.map(function(option){return option.label});var kibanaSettings=customUrl.kibanaSettings;setEditCustomUrl(_extends({},customUrl,{kibanaSettings:_extends({},kibanaSettings,{queryFieldNames:selectedFieldNames})}))};_this.onOtherUrlValueChange=function(e){var _this$props6=_this.props,customUrl=_this$props6.customUrl,setEditCustomUrl=_this$props6.setEditCustomUrl;setEditCustomUrl(_extends({},customUrl,{otherUrlSettings:{urlValue:e.target.value}}))};_this.onTimeRangeTypeChange=function(e){var _this$props7=_this.props,customUrl=_this$props7.customUrl,setEditCustomUrl=_this$props7.setEditCustomUrl;var timeRange=customUrl.timeRange;setEditCustomUrl(_extends({},customUrl,{timeRange:_extends({},timeRange,{type:e.target.value})}))};_this.onTimeRangeIntervalChange=function(e){var _this$props8=_this.props,customUrl=_this$props8.customUrl,setEditCustomUrl=_this$props8.setEditCustomUrl;var timeRange=customUrl.timeRange;setEditCustomUrl(_extends({},customUrl,{timeRange:_extends({},timeRange,{interval:e.target.value})}))};return _this}_createClass(CustomUrlEditor,[{key:"render",value:function render(){var _props=this.props,customUrl=_props.customUrl,savedCustomUrls=_props.savedCustomUrls,dashboards=_props.dashboards,indexPatterns=_props.indexPatterns,queryEntityFieldNames=_props.queryEntityFieldNames;if(customUrl===undefined){return}var label=customUrl.label,type=customUrl.type,timeRange=customUrl.timeRange,kibanaSettings=customUrl.kibanaSettings,otherUrlSettings=customUrl.otherUrlSettings;var dashboardOptions=dashboards.map(function(dashboard){return{value:dashboard.id,text:dashboard.title}});var indexPatternOptions=indexPatterns.map(function(indexPattern){return{value:indexPattern.id,text:indexPattern.title}});var entityOptions=queryEntityFieldNames.map(function(fieldName){return{label:fieldName}});var selectedEntityOptions=[];if(kibanaSettings!==undefined&&kibanaSettings.queryFieldNames!==undefined){var queryFieldNames=kibanaSettings.queryFieldNames;selectedEntityOptions=queryFieldNames.map(function(fieldName){return{label:fieldName}})}var timeRangeOptions=Object.keys(_constants.TIME_RANGE_TYPE).map(function(timeRangeType){return{value:_constants.TIME_RANGE_TYPE[timeRangeType],text:_constants.TIME_RANGE_TYPE[timeRangeType]}});var isInvalidLabel=!(0,_custom_url_utils.isValidLabel)(label,savedCustomUrls);var invalidLabelError=isInvalidLabel===true?["A unique label must be supplied"]:[];var isInvalidTimeRange=!(0,_utils.isValidCustomUrlSettingsTimeRange)(timeRange);var invalidIntervalError=isInvalidTimeRange===true?["Invalid interval format"]:[];return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiTitle,{size:"xs"},_react2.default.createElement("h4",null,"Create new custom URL")),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_eui.EuiForm,{className:"ml-edit-url-form"},_react2.default.createElement(_eui.EuiFormRow,{label:"Label",className:"url-label",error:invalidLabelError,isInvalid:isInvalidLabel,compressed:true},_react2.default.createElement(_eui.EuiFieldText,{value:label,onChange:this.onLabelChange,isInvalid:isInvalidLabel,compressed:true})),_react2.default.createElement(_eui.EuiFormRow,{label:"Link to",compressed:true},_react2.default.createElement(_eui.EuiRadioGroup,{options:getLinkToOptions(),idSelected:type,onChange:this.onTypeChange,className:"url-link-to-radio"})),type===_constants.URL_TYPE.KIBANA_DASHBOARD&&_react2.default.createElement(_eui.EuiFormRow,{label:"Dashboard name",compressed:true},_react2.default.createElement(_eui.EuiSelect,{options:dashboardOptions,value:kibanaSettings.dashboardId,onChange:this.onDashboardChange,compressed:true})),type===_constants.URL_TYPE.KIBANA_DISCOVER&&_react2.default.createElement(_eui.EuiFormRow,{label:"Index pattern",compressed:true},_react2.default.createElement(_eui.EuiSelect,{options:indexPatternOptions,value:kibanaSettings.discoverIndexPatternId,onChange:this.onDiscoverIndexPatternChange,compressed:true})),(type===_constants.URL_TYPE.KIBANA_DASHBOARD||type===_constants.URL_TYPE.KIBANA_DISCOVER)&&entityOptions.length>0&&_react2.default.createElement(_eui.EuiFormRow,{label:"Query entities"},_react2.default.createElement(_eui.EuiComboBox,{placeholder:"Select entities",options:entityOptions,selectedOptions:selectedEntityOptions,onChange:this.onQueryEntitiesChange,isClearable:true})),(type===_constants.URL_TYPE.KIBANA_DASHBOARD||type===_constants.URL_TYPE.KIBANA_DISCOVER)&&_react2.default.createElement(_eui.EuiFlexGroup,null,_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiFormRow,{label:"Time range",className:"url-time-range",compressed:true},_react2.default.createElement(_eui.EuiSelect,{options:timeRangeOptions,value:timeRange.type,onChange:this.onTimeRangeTypeChange,compressed:true}))),timeRange.type===_constants.TIME_RANGE_TYPE.INTERVAL&&_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiFormRow,{label:"Interval",className:"url-time-range",error:invalidIntervalError,isInvalid:isInvalidTimeRange,compressed:true},_react2.default.createElement(_eui.EuiFieldText,{value:timeRange.interval,onChange:this.onTimeRangeIntervalChange,isInvalid:isInvalidTimeRange,compressed:true})))),type===_constants.URL_TYPE.OTHER&&_react2.default.createElement(_eui.EuiFormRow,{label:"URL",compressed:true,fullWidth:true},_react2.default.createElement(_eui.EuiTextArea,{fullWidth:true,rows:2,value:otherUrlSettings.urlValue,onChange:this.onOtherUrlValueChange,compressed:true}))))}}]);return CustomUrlEditor}(_react.Component);CustomUrlEditor.propTypes={customUrl:_propTypes2.default.object,setEditCustomUrl:_propTypes2.default.func.isRequired,savedCustomUrls:_propTypes2.default.array.isRequired,dashboards:_propTypes2.default.array.isRequired,indexPatterns:_propTypes2.default.array.isRequired,queryEntityFieldNames:_propTypes2.default.array.isRequired}},2239:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _delete_job_modal=__webpack_require__(2240);Object.defineProperty(exports,"DeleteJobModal",{enumerable:true,get:function get(){return _delete_job_modal.DeleteJobModal}})},2240:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DeleteJobModal=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _class,_temp;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _utils=__webpack_require__(297);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DeleteJobModal=exports.DeleteJobModal=(0,_react3.injectI18n)((_temp=_class=function(_Component){_inherits(_class,_Component);function _class(props){_classCallCheck(this,_class);var _this=_possibleConstructorReturn(this,(_class.__proto__||Object.getPrototypeOf(_class)).call(this,props));_this.closeModal=function(){_this.setState({isModalVisible:false})};_this.showModal=function(jobs){_this.setState({jobs:jobs,isModalVisible:true,deleting:false})};_this.deleteJob=function(){_this.setState({deleting:true});(0,_utils.deleteJobs)(_this.state.jobs,function(){_this.refreshJobs();_this.closeModal()})};_this.setEL=function(el){if(el){_this.el=el}};_this.state={jobs:[],isModalVisible:false,deleting:false};_this.refreshJobs=_this.props.refreshJobs;return _this}_createClass(_class,[{key:"componentDidMount",value:function componentDidMount(){if(typeof this.props.setShowFunction==="function"){this.props.setShowFunction(this.showModal)}}},{key:"componentWillUnmount",value:function componentWillUnmount(){if(typeof this.props.unsetShowFunction==="function"){this.props.unsetShowFunction()}}},{key:"render",value:function render(){var intl=this.props.intl;var modal=void 0;if(this.state.isModalVisible){if(this.el&&this.state.deleting===true){this.el.confirmButton.style.display="none";this.el.cancelButton.textContent=intl.formatMessage({id:"xpack.ml.jobsList.deleteJobModal.closeButtonLabel",defaultMessage:"Close"})}var title=_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.deleteJobModal.deleteJobsTitle",defaultMessage:"Delete {jobsCount, plural, one {{jobId}} other {# jobs}}",values:{jobsCount:this.state.jobs.length,jobId:this.state.jobs[0].id}});modal=_react2.default.createElement(_eui.EuiOverlayMask,null,_react2.default.createElement(_eui.EuiConfirmModal,{ref:this.setEL,title:title,onCancel:this.closeModal,onConfirm:this.deleteJob,cancelButtonText:_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.deleteJobModal.cancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonText:_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.deleteJobModal.deleteButtonLabel",defaultMessage:"Delete"}),buttonColor:"danger",defaultFocusedButton:_eui.EUI_MODAL_CONFIRM_BUTTON,className:"eui-textBreakWord"},this.state.deleting===true&&_react2.default.createElement("div",null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.deleteJobModal.deletingJobsStatusLabel",defaultMessage:"Deleting jobs"}),_react2.default.createElement(_eui.EuiSpacer,null),_react2.default.createElement("div",{style:{textAlign:"center"}},_react2.default.createElement(_eui.EuiLoadingSpinner,{size:"l"}))),this.state.deleting===false&&_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement("p",null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.deleteJobModal.deleteJobsDescription",defaultMessage:"Are you sure you want to delete {jobsCount, plural, one {this job} other {these jobs}}?",values:{jobsCount:this.state.jobs.length}})),this.state.jobs.length>1&&_react2.default.createElement("p",null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.deleteJobModal.deleteMultipleJobsDescription",defaultMessage:"Deleting multiple jobs can be time consuming. They will be deleted in the background and may not disappear from the jobs list instantly"})))))}return _react2.default.createElement("div",null,modal)}}]);return _class}(_react.Component),_class.displayName="DeleteJobModal",_class.propTypes={setShowFunction:_propTypes2.default.func.isRequired,unsetShowFunction:_propTypes2.default.func.isRequired,refreshJobs:_propTypes2.default.func.isRequired},_temp))},2241:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _start_datafeed_modal=__webpack_require__(2242);Object.defineProperty(exports,"StartDatafeedModal",{enumerable:true,get:function get(){return _start_datafeed_modal.StartDatafeedModal}})},2242:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.StartDatafeedModal=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _utils=__webpack_require__(297);var _time_range_selector=__webpack_require__(2243);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var StartDatafeedModal=exports.StartDatafeedModal=function(_Component){_inherits(StartDatafeedModal,_Component);function StartDatafeedModal(props){_classCallCheck(this,StartDatafeedModal);var _this=_possibleConstructorReturn(this,(StartDatafeedModal.__proto__||Object.getPrototypeOf(StartDatafeedModal)).call(this,props));_initialiseProps.call(_this);var now=(0,_moment2.default)();_this.state={jobs:_this.props.jobs,isModalVisible:false,startTime:now,endTime:now,createWatch:false,allowCreateWatch:false,initialSpecifiedStartTime:now,now:now};_this.initialSpecifiedStartTime=now;_this.refreshJobs=_this.props.refreshJobs;_this.getShowCreateWatchFlyoutFunction=_this.props.getShowCreateWatchFlyoutFunction;return _this}_createClass(StartDatafeedModal,[{key:"componentDidMount",value:function componentDidMount(){if(typeof this.props.setShowFunction==="function"){this.props.setShowFunction(this.showModal)}}},{key:"componentWillUnmount",value:function componentWillUnmount(){if(typeof this.props.unsetShowFunction==="function"){this.props.unsetShowFunction()}}},{key:"render",value:function render(){var _state=this.state,jobs=_state.jobs,initialSpecifiedStartTime=_state.initialSpecifiedStartTime,startTime=_state.startTime,endTime=_state.endTime,createWatch=_state.createWatch,now=_state.now;var startableJobs=jobs!==undefined?jobs.filter(function(j){return j.hasDatafeed}):[];var startDisabled=startTime!==undefined&&startTime===endTime;var modal=void 0;if(this.state.isModalVisible){modal=_react2.default.createElement(_eui.EuiOverlayMask,null,_react2.default.createElement(_eui.EuiModal,{onClose:this.closeModal,style:{width:"850px"},maxWidth:false},_react2.default.createElement(_eui.EuiModalHeader,null,_react2.default.createElement(_eui.EuiModalHeaderTitle,null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.startJobsTitle",defaultMessage:"Start {jobsCount, plural, one {{jobId}} other {# jobs}}",values:{jobsCount:startableJobs.length,jobId:startableJobs[0].id}}))),_react2.default.createElement(_eui.EuiModalBody,null,_react2.default.createElement(_time_range_selector.TimeRangeSelector,{startTime:startTime===undefined?initialSpecifiedStartTime:startTime,endTime:endTime,setStartTime:this.setStartTime,setEndTime:this.setEndTime,now:now}),this.state.endTime===undefined&&_react2.default.createElement("div",{className:"create-watch"},_react2.default.createElement(_eui.EuiHorizontalRule,null),_react2.default.createElement(_eui.EuiCheckbox,{id:"createWatch",label:_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.createWatchDescription",defaultMessage:"Create watch after datafeed has started"}),checked:createWatch,onChange:this.setCreateWatch}))),_react2.default.createElement(_eui.EuiModalFooter,null,_react2.default.createElement(_eui.EuiButtonEmpty,{onClick:this.closeModal},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.cancelButtonLabel",defaultMessage:"Cancel"})),_react2.default.createElement(_eui.EuiButton,{onClick:this.save,isDisabled:startDisabled,fill:true},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.startButtonLabel",defaultMessage:"Start"})))))}return _react2.default.createElement("div",null,modal)}}]);return StartDatafeedModal}(_react.Component);var _initialiseProps=function _initialiseProps(){var _this2=this;this.setStartTime=function(time){_this2.setState({startTime:time})};this.setEndTime=function(time){_this2.setState({endTime:time})};this.setCreateWatch=function(e){_this2.setState({createWatch:e.target.checked})};this.closeModal=function(){_this2.setState({isModalVisible:false})};this.showModal=function(jobs,showCreateWatchFlyout){var startTime=undefined;var now=(0,_moment2.default)();var endTime=now;var initialSpecifiedStartTime=getLowestLatestTime(jobs);var allowCreateWatch=jobs.length===1;_this2.setState({jobs:jobs,isModalVisible:true,startTime:startTime,endTime:endTime,initialSpecifiedStartTime:initialSpecifiedStartTime,showCreateWatchFlyout:showCreateWatchFlyout,allowCreateWatch:allowCreateWatch,createWatch:false,now:now})};this.save=function(){var jobs=_this2.state.jobs;var start=_moment2.default.isMoment(_this2.state.startTime)?_this2.state.startTime.valueOf():_this2.state.startTime;var end=_moment2.default.isMoment(_this2.state.endTime)?_this2.state.endTime.valueOf():_this2.state.endTime;(0,_utils.forceStartDatafeeds)(jobs,start,end,function(){if(_this2.state.createWatch&&jobs.length===1){var jobId=jobs[0].id;_this2.getShowCreateWatchFlyoutFunction()(jobId)}_this2.refreshJobs()});_this2.closeModal()}};StartDatafeedModal.propTypes={setShowFunction:_propTypes2.default.func.isRequired,unsetShowFunction:_propTypes2.default.func.isRequired,refreshJobs:_propTypes2.default.func.isRequired};function getLowestLatestTime(jobs){var times=jobs.map(function(j){return j.latestTimestampSortValue});return(0,_moment2.default)(Math.min.apply(Math,_toConsumableArray(times)))}},2243:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _time_range_selector=__webpack_require__(2244);Object.defineProperty(exports,"TimeRangeSelector",{enumerable:true,get:function get(){return _time_range_selector.TimeRangeSelector}})},2244:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TimeRangeSelector=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TIME_FORMAT="YYYY-MM-DD HH:mm:ss";var TimeRangeSelector=exports.TimeRangeSelector=function(_Component){_inherits(TimeRangeSelector,_Component);function TimeRangeSelector(props){_classCallCheck(this,TimeRangeSelector);var _this=_possibleConstructorReturn(this,(TimeRangeSelector.__proto__||Object.getPrototypeOf(TimeRangeSelector)).call(this,props));_this.setStartTab=function(tab){_this.setState({startTab:tab});switch(tab){case 0:_this.setStartTime(undefined);break;case 1:_this.setStartTime(_this.now);break;default:break}};_this.setEndTab=function(tab){_this.setState({endTab:tab});switch(tab){case 0:_this.setEndTime(undefined);break;case 1:_this.setEndTime(_this.now);break;default:break}};_this.setStartTime=function(time){_this.props.setStartTime(time)};_this.setEndTime=function(time){_this.props.setEndTime(time)};_this.state={startTab:0,endTab:1};_this.latestTimestamp=_this.props.startTime;_this.now=_this.props.now;return _this}_createClass(TimeRangeSelector,[{key:"getTabItems",value:function getTabItems(){var datePickerTimes={start:_moment2.default.isMoment(this.props.startTime)?this.props.startTime:this.latestTimestamp,end:_moment2.default.isMoment(this.props.endTime)?this.props.endTime:this.now};var formattedStartTime=this.latestTimestamp.format(TIME_FORMAT);var showContinueLabels=this.latestTimestamp.valueOf()>0;var startLabels=showContinueLabels===true?[_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.continueFromStartTimeLabel",defaultMessage:"Continue from {formattedStartTime}",values:{formattedStartTime:formattedStartTime}}),_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.continueFromNowLabel",defaultMessage:"Continue from now"}),_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.continueFromSpecifiedTimeLabel",defaultMessage:"Continue from specified time"})]:[_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.startAtBeginningOfDataLabel",defaultMessage:"Start at beginning of data"}),_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.startFromNowLabel",defaultMessage:"Start from now"}),_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.specifyStartTimeLabel",defaultMessage:"Specify start time"})];var startItems=[{index:0,label:startLabels[0]},{index:1,label:startLabels[1]},{index:2,label:startLabels[2],body:_react2.default.createElement(_eui.EuiDatePicker,{selected:datePickerTimes.start,onChange:this.setStartTime,maxDate:datePickerTimes.end,inline:true,showTimeSelect:true})}];var endItems=[{index:0,label:_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.noEndTimeLabel",defaultMessage:"No end time (Real-time search)"})},{index:1,label:_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.specifyEndTimeLabel",defaultMessage:"Specify end time"}),body:_react2.default.createElement(_eui.EuiDatePicker,{selected:datePickerTimes.end,onChange:this.setEndTime,minDate:datePickerTimes.start,inline:true,showTimeSelect:true})}];return{startItems:startItems,endItems:endItems}}},{key:"render",value:function render(){var _getTabItems=this.getTabItems(),startItems=_getTabItems.startItems,endItems=_getTabItems.endItems;return _react2.default.createElement("div",{className:"time-range-selector"},_react2.default.createElement("div",{className:"time-range-section-container"},_react2.default.createElement(TabStack,{title:_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.searchStartTimeTitle",defaultMessage:"Search start time"}),items:startItems,switchState:this.state.startTab,switchFunc:this.setStartTab}),_react2.default.createElement(TabStack,{title:_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.searchEndTimeTitle",defaultMessage:"Search end time"}),items:endItems,switchState:this.state.endTab,switchFunc:this.setEndTab})))}}]);return TimeRangeSelector}(_react.Component);function TabStack(_ref){var title=_ref.title,items=_ref.items,switchState=_ref.switchState,switchFunc=_ref.switchFunc;return _react2.default.createElement("div",{className:"time-range-section"},_react2.default.createElement("div",{className:"time-range-section-title"},title),_react2.default.createElement("ul",{className:"tab-stack"},items.map(function(item,i){var className="";if(switchState===item.index){className+="active "}if(item.body!==undefined){className+="has-body "}return _react2.default.createElement("li",{key:i,className:className},_react2.default.createElement("a",{onClick:function onClick(){return switchFunc(item.index)}},item.label),item.body!==undefined&&_react2.default.createElement("div",{className:"body"},item.body))})))}TimeRangeSelector.propTypes={startTime:_propTypes2.default.object.isRequired,endTime:_propTypes2.default.object,setStartTime:_propTypes2.default.func.isRequired,setEndTime:_propTypes2.default.func.isRequired}},2245:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _create_watch_flyout=__webpack_require__(2246);Object.defineProperty(exports,"CreateWatchFlyout",{enumerable:true,get:function get(){return _create_watch_flyout.CreateWatchFlyout}})},2246:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CreateWatchFlyout=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _notify=__webpack_require__(10);var _utils=__webpack_require__(297);var _create_watch_service=__webpack_require__(337);var _create_watch_view=__webpack_require__(2250);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function getSuccessToast(id,url,intl){return{title:intl.formatMessage({id:"xpack.ml.jobsList.createWatchFlyout.watchCreatedSuccessfullyNotificationMessage",defaultMessage:"Watch {id} created successfully"},{id:id}),text:_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"flexEnd",gutterSize:"s"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButton,{size:"s",href:url,target:"_blank",iconType:"link"},intl.formatMessage({id:"xpack.ml.jobsList.createWatchFlyout.editWatchButtonLabel",defaultMessage:"Edit watch"})))))}}var CreateWatchFlyoutUI=function(_Component){_inherits(CreateWatchFlyoutUI,_Component);function CreateWatchFlyoutUI(props){_classCallCheck(this,CreateWatchFlyoutUI);var _this=_possibleConstructorReturn(this,(CreateWatchFlyoutUI.__proto__||Object.getPrototypeOf(CreateWatchFlyoutUI)).call(this,props));_this.closeFlyout=function(){_this.setState({isFlyoutVisible:false})};_this.showFlyout=function(jobId){(0,_utils.loadFullJob)(jobId).then(function(job){var bucketSpan=job.analysis_config.bucket_span;_create_watch_service.mlCreateWatchService.config.includeInfluencers=job.analysis_config.influencers.length>0;_this.setState({job:job,jobId:jobId,bucketSpan:bucketSpan,isFlyoutVisible:true})}).catch(function(error){console.error(error)})};_this.save=function(){var intl=_this.props.intl;_create_watch_service.mlCreateWatchService.createNewWatch(_this.state.jobId).then(function(resp){_notify.toastNotifications.addSuccess(getSuccessToast(resp.id,resp.url,intl));_this.closeFlyout()}).catch(function(error){_notify.toastNotifications.addDanger(intl.formatMessage({id:"xpack.ml.jobsList.createWatchFlyout.watchNotSavedErrorNotificationMessage",defaultMessage:"Could not save watch"}));console.error(error)})};_this.state={jobId:null,bucketSpan:null};return _this}_createClass(CreateWatchFlyoutUI,[{key:"componentDidMount",value:function componentDidMount(){if(typeof this.props.setShowFunction==="function"){this.props.setShowFunction(this.showFlyout)}}},{key:"componentWillUnmount",value:function componentWillUnmount(){if(typeof this.props.unsetShowFunction==="function"){this.props.unsetShowFunction()}}},{key:"render",value:function render(){var _state=this.state,jobId=_state.jobId,bucketSpan=_state.bucketSpan;var flyout=void 0;if(this.state.isFlyoutVisible){flyout=_react2.default.createElement(_eui.EuiFlyout,{onClose:this.closeFlyout,size:"s"},_react2.default.createElement(_eui.EuiFlyoutHeader,null,_react2.default.createElement(_eui.EuiTitle,null,_react2.default.createElement("h2",null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.createWatchFlyout.pageTitle",defaultMessage:"Create watch for {jobId}",values:{jobId:jobId}})))),_react2.default.createElement(_eui.EuiFlyoutBody,null,_react2.default.createElement(_create_watch_view.CreateWatch,{jobId:jobId,bucketSpan:bucketSpan})),_react2.default.createElement(_eui.EuiFlyoutFooter,null,_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceBetween"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonEmpty,{iconType:"cross",onClick:this.closeFlyout,flush:"left"},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.createWatchFlyout.closeButtonLabel",defaultMessage:"Close"}))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButton,{onClick:this.save,fill:true},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.createWatchFlyout.saveButtonLabel",defaultMessage:"Save"}))))))}return _react2.default.createElement("div",null,flyout)}}]);return CreateWatchFlyoutUI}(_react.Component);CreateWatchFlyoutUI.propTypes={setShowFunction:_propTypes2.default.func.isRequired,unsetShowFunction:_propTypes2.default.func.isRequired};var CreateWatchFlyout=exports.CreateWatchFlyout=(0,_react3.injectI18n)(CreateWatchFlyoutUI)},2247:function(module,exports){module.exports="<html>\n  <body>\n    <strong>Elastic Stack Machine Learning Alert</strong>\n    <br />\n    <br />\n\n    <strong>Job</strong>: {{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0._source.job_id}}\n    <br />\n\n    <strong>Time</strong>: {{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0.fields.timestamp_iso8601.0}}\n    <br />\n\n    <strong>Anomaly score</strong>: {{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0.fields.score.0}}\n    <br />\n    <br />\n\n    <a href=\"<%= serverAddress %>#/explorer/?_g=(ml:(jobIds:!('{{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0._source.job_id}}')),refreshInterval:(display:Off,pause:!f,value:0),time:(from:'{{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0.fields.start.0}}',mode:absolute,to:'{{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0.fields.end.0}}'))&_a=(filters:!(),mlAnomaliesTable:(intervalValue:auto,thresholdValue:0),mlExplorerSwimlane:(selectedLane:Overall,selectedTime:{{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0.fields.timestamp_epoch.0}},selectedType:overall),query:(query_string:(analyze_wildcard:!t,query:'*')))\">\n    Click here to open in Anomaly Explorer</a>.\n    <br />\n    <br />\n\n    <%= influencersSection %>\n\n    <strong>Top records:</strong>\n    <br />\n    {{#ctx.payload.aggregations.record_results.top_record_hits.hits.hits}}\n      {{_source.function}}({{_source.field_name}}) {{_source.by_field_value}} {{_source.over_field_value}} {{_source.partition_field_value}} [{{fields.score.0}}]\n      <br />\n    {{/ctx.payload.aggregations.record_results.top_record_hits.hits.hits}}\n\n  </body>\n</html>\n"},2248:function(module,exports){module.exports="<strong>Top influencers:</strong>\n<br />\n  {{#ctx.payload.aggregations.influencer_results.top_influencer_hits.hits.hits}}\n    {{_source.influencer_field_name}} = {{_source.influencer_field_value}} [{{fields.score.0}}]\n    <br />\n  {{/ctx.payload.aggregations.influencer_results.top_influencer_hits.hits.hits}}\n<br />\n"},2249:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.watch=undefined;var _index_patterns=__webpack_require__(404);var watch=exports.watch={trigger:{schedule:{interval:"60s"}},input:{search:{request:{search_type:"query_then_fetch",indices:[_index_patterns.ML_RESULTS_INDEX_PATTERN],types:[],body:{size:0,query:{bool:{filter:[{term:{job_id:null}},{range:{timestamp:{gte:null}}},{terms:{result_type:["bucket","record","influencer"]}}]}},aggs:{bucket_results:{filter:{range:{anomaly_score:{gte:null}}},aggs:{top_bucket_hits:{top_hits:{sort:[{anomaly_score:{order:"desc"}}],_source:{includes:["job_id","result_type","timestamp","anomaly_score","is_interim"]},size:1,script_fields:{start:{script:{lang:"painless",inline:'LocalDateTime.ofEpochSecond((doc["timestamp"].date.getMillis()-((doc["bucket_span"].value * 1000)\n * params.padding)) / 1000, 0, ZoneOffset.UTC).toString()+":00.000Z"',params:{padding:10}}},end:{script:{lang:"painless",inline:'LocalDateTime.ofEpochSecond((doc["timestamp"].date.getMillis()+((doc["bucket_span"].value * 1000)\n * params.padding)) / 1000, 0, ZoneOffset.UTC).toString()+":00.000Z"',params:{padding:10}}},timestamp_epoch:{script:{lang:"painless",inline:'doc["timestamp"].date.getMillis()/1000'}},timestamp_iso8601:{script:{lang:"painless",inline:'doc["timestamp"].date'}},score:{script:{lang:"painless",inline:'Math.round(doc["anomaly_score"].value)'}}}}}}},influencer_results:{filter:{range:{influencer_score:{gte:3}}},aggs:{top_influencer_hits:{top_hits:{sort:[{influencer_score:{order:"desc"}}],_source:{includes:["result_type","timestamp","influencer_field_name","influencer_field_value","influencer_score","isInterim"]},size:3,script_fields:{score:{script:{lang:"painless",inline:'Math.round(doc["influencer_score"].value)'}}}}}}},record_results:{filter:{range:{record_score:{gte:3}}},aggs:{top_record_hits:{top_hits:{sort:[{record_score:{order:"desc"}}],_source:{includes:["result_type","timestamp","record_score","is_interim","function","field_name","by_field_value","over_field_value","partition_field_value"]},size:3,script_fields:{score:{script:{lang:"painless",inline:'Math.round(doc["record_score"].value)'}}}}}}}}}}}},condition:{compare:{"ctx.payload.aggregations.bucket_results.doc_count":{gt:0}}},actions:{log:{logging:{level:"info",text:""}}}};var txt="Alert for job [{{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0._source.job_id}}] at ";txt+="[{{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0.fields.timestamp_iso8601.0}}] score ";txt+="[{{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0.fields.score.0}}]";watch.actions.log.logging.text=txt},2250:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CreateWatch=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _lodash=__webpack_require__(1);var _parse_interval=__webpack_require__(196);var _ml_api_service=__webpack_require__(22);var _select_severity=__webpack_require__(633);var _create_watch_service=__webpack_require__(337);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var STATUS=_create_watch_service.mlCreateWatchService.STATUS;var CreateWatch=exports.CreateWatch=function(_Component){_inherits(CreateWatch,_Component);function CreateWatch(props){_classCallCheck(this,CreateWatch);var _this=_possibleConstructorReturn(this,(CreateWatch.__proto__||Object.getPrototypeOf(CreateWatch)).call(this,props));_this.onThresholdChange=function(threshold){_this.setState({threshold:threshold},function(){_this.config.threshold=threshold})};_this.onIntervalChange=function(e){var interval=e.target.value;_this.setState({interval:interval},function(){_this.config.interval=interval})};_this.onIncludeEmailChanged=function(e){var includeEmail=e.target.checked;_this.setState({includeEmail:includeEmail},function(){_this.config.includeEmail=includeEmail})};_this.onEmailChange=function(e){var email=e.target.value;_this.setState({email:email},function(){_this.config.email=email})};_create_watch_service.mlCreateWatchService.reset();_this.config=_create_watch_service.mlCreateWatchService.config;_this.state={jobId:_this.props.jobId,bucketSpan:_this.props.bucketSpan,interval:_this.config.interval,threshold:_this.config.threshold,includeEmail:_this.config.emailIncluded,email:_this.config.email,emailEnabled:false,status:null,watchAlreadyExists:false};return _this}_createClass(CreateWatch,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;if(this.state.bucketSpan){var intervalObject=(0,_parse_interval.parseInterval)(this.state.bucketSpan);var bs=intervalObject.asMinutes()*2;if(bs<1){bs=1}var interval=bs+"m";this.setState({interval:interval},function(){_this2.config.interval=interval})}_ml_api_service.ml.getNotificationSettings().then(function(resp){if((0,_lodash.has)(resp,"defaults.xpack.notification.email")){_this2.setState({emailEnabled:true})}});_create_watch_service.mlCreateWatchService.loadWatch(this.state.jobId).then(function(){_this2.setState({watchAlreadyExists:true})}).catch(function(){_this2.setState({watchAlreadyExists:false})})}},{key:"render",value:function render(){var _this3=this;var mlSelectSeverityService={state:{set:function set(name,threshold){_this3.onThresholdChange(threshold);return{changed:function changed(){}}},get:function get(){return _this3.config.threshold}}};var status=this.state.status;if(status===null||status===STATUS.SAVING||status===STATUS.SAVE_FAILED){return _react2.default.createElement("div",{className:"create-watch"},_react2.default.createElement("div",{className:"form-group form-group-flex"},_react2.default.createElement("div",{className:"sub-form-group"},_react2.default.createElement("div",null,_react2.default.createElement("label",{htmlFor:"selectInterval",className:"euiFormLabel"},"Time range")),"Now - ",_react2.default.createElement(_eui.EuiFieldText,{id:"selectInterval",value:this.state.interval,onChange:this.onIntervalChange})),_react2.default.createElement("div",{className:"sub-form-group"},_react2.default.createElement("div",null,_react2.default.createElement("label",{htmlFor:"selectSeverity",className:"euiFormLabel"},"Severity threshold")),_react2.default.createElement("div",{className:"dropdown-group"},_react2.default.createElement(_select_severity.SelectSeverity,{id:"selectSeverity",mlSelectSeverityService:mlSelectSeverityService})))),this.state.emailEnabled&&_react2.default.createElement("div",{className:"form-group"},_react2.default.createElement(_eui.EuiCheckbox,{id:"includeEmail",label:"Send email",checked:this.state.includeEmail,onChange:this.onIncludeEmailChanged}),this.state.includeEmail&&_react2.default.createElement("div",{className:"email-section"},_react2.default.createElement(_eui.EuiFieldText,{value:this.state.email,onChange:this.onEmailChange,placeholder:"email address","aria-label":"Watch email address"}))),this.state.watchAlreadyExists&&_react2.default.createElement(_eui.EuiCallOut,{title:"Warning, watch ml-"+this.state.jobId+" already exists, clicking apply will overwrite the original."}))}else if(status===STATUS.SAVED){return _react2.default.createElement("div",null,"Success")}else{return _react2.default.createElement("div",null)}}}]);return CreateWatch}(_react.Component);CreateWatch.propTypes={jobId:_propTypes2.default.string.isRequired,bucketSpan:_propTypes2.default.string.isRequired}},2251:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _multi_job_actions=__webpack_require__(2252);Object.defineProperty(exports,"MultiJobActions",{enumerable:true,get:function get(){return _multi_job_actions.MultiJobActions}})},2252:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MultiJobActions=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _job_actions=__webpack_require__(986);var _actions_menu=__webpack_require__(2253);var _group_selector=__webpack_require__(2254);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MultiJobActions=exports.MultiJobActions=function(_Component){_inherits(MultiJobActions,_Component);function MultiJobActions(props){_classCallCheck(this,MultiJobActions);var _this=_possibleConstructorReturn(this,(MultiJobActions.__proto__||Object.getPrototypeOf(MultiJobActions)).call(this,props));_this.state={};return _this}_createClass(MultiJobActions,[{key:"render",value:function render(){var jobsSelected=this.props.selectedJobs.length>0;return _react2.default.createElement("div",{className:"multi-select-actions"+(jobsSelected?"":"-no-display")},jobsSelected&&_react2.default.createElement(_react.Fragment,null,_react2.default.createElement("span",{className:"jobs-selected-title"},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.multiJobsActions.jobsSelectedLabel",defaultMessage:"{selectedJobsCount, plural, one {# job} other {# jobs}} selected",values:{selectedJobsCount:this.props.selectedJobs.length}})),_react2.default.createElement("div",{className:"actions-border-large"}),_react2.default.createElement(_job_actions.ResultLinks,{jobs:this.props.selectedJobs}),_react2.default.createElement(_group_selector.GroupSelector,{jobs:this.props.selectedJobs,allJobIds:this.props.allJobIds,refreshJobs:this.props.refreshJobs}),_react2.default.createElement(_actions_menu.MultiJobActionsMenu,{jobs:this.props.selectedJobs,showStartDatafeedModal:this.props.showStartDatafeedModal,showDeleteJobModal:this.props.showDeleteJobModal,refreshJobs:this.props.refreshJobs})))}}]);return MultiJobActions}(_react.Component);MultiJobActions.propTypes={selectedJobs:_propTypes2.default.array.isRequired,allJobIds:_propTypes2.default.array.isRequired,showStartDatafeedModal:_propTypes2.default.func.isRequired,showDeleteJobModal:_propTypes2.default.func.isRequired,refreshJobs:_propTypes2.default.func.isRequired}},2253:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MultiJobActionsMenu=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _check_privilege=__webpack_require__(32);var _check_ml_nodes=__webpack_require__(47);var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _utils=__webpack_require__(297);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MultiJobActionsMenuUI=function(_Component){_inherits(MultiJobActionsMenuUI,_Component);function MultiJobActionsMenuUI(props){_classCallCheck(this,MultiJobActionsMenuUI);var _this=_possibleConstructorReturn(this,(MultiJobActionsMenuUI.__proto__||Object.getPrototypeOf(MultiJobActionsMenuUI)).call(this,props));_this.onButtonClick=function(){_this.setState(function(prevState){return{isOpen:!prevState.isOpen}})};_this.closePopover=function(){_this.setState({isOpen:false})};_this.state={isOpen:false};_this.canDeleteJob=(0,_check_privilege.checkPermission)("canDeleteJob");_this.canStartStopDatafeed=(0,_check_privilege.checkPermission)("canStartStopDatafeed")&&(0,_check_ml_nodes.mlNodesAvailable)();_this.canCloseJob=(0,_check_privilege.checkPermission)("canCloseJob")&&(0,_check_ml_nodes.mlNodesAvailable)();return _this}_createClass(MultiJobActionsMenuUI,[{key:"render",value:function render(){var _this2=this;var button=_react2.default.createElement(_eui.EuiButtonIcon,{size:"s",onClick:this.onButtonClick,iconType:"gear","aria-label":this.props.intl.formatMessage({id:"xpack.ml.jobsList.multiJobActionsMenu.managementActionsAriaLabel",defaultMessage:"Management actions"}),color:"text",disabled:this.canDeleteJob===false&&this.canStartStopDatafeed===false});var items=[_react2.default.createElement(_eui.EuiContextMenuItem,{key:"delete",icon:"trash",disabled:this.canDeleteJob===false,onClick:function onClick(){_this2.props.showDeleteJobModal(_this2.props.jobs);_this2.closePopover()}},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.multiJobsActions.deleteJobsLabel",defaultMessage:"Delete {jobsCount, plural, one {job} other {jobs}}",values:{jobsCount:this.props.jobs.length}}))];if((0,_utils.isClosable)(this.props.jobs)){items.push(_react2.default.createElement(_eui.EuiContextMenuItem,{key:"close job",icon:"cross",disabled:this.canCloseJob===false,onClick:function onClick(){(0,_utils.closeJobs)(_this2.props.jobs);_this2.closePopover()}},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.multiJobsActions.closeJobsLabel",defaultMessage:"Close {jobsCount, plural, one {job} other {jobs}}",values:{jobsCount:this.props.jobs.length}})))}if((0,_utils.isStoppable)(this.props.jobs)){items.push(_react2.default.createElement(_eui.EuiContextMenuItem,{key:"stop datafeed",icon:"stop",disabled:this.canStartStopDatafeed===false,onClick:function onClick(){(0,_utils.stopDatafeeds)(_this2.props.jobs,_this2.props.refreshJobs);_this2.closePopover()}},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.multiJobsActions.stopDatafeedsLabel",defaultMessage:"Stop {jobsCount, plural, one {datafeed} other {datafeeds}}",values:{jobsCount:this.props.jobs.length}})))}if((0,_utils.isStartable)(this.props.jobs)){items.push(_react2.default.createElement(_eui.EuiContextMenuItem,{key:"start datafeed",icon:"play",disabled:this.canStartStopDatafeed===false,onClick:function onClick(){_this2.props.showStartDatafeedModal(_this2.props.jobs);_this2.closePopover()}},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.multiJobsActions.startDatafeedsLabel",defaultMessage:"Start {jobsCount, plural, one {datafeed} other {datafeeds}}",values:{jobsCount:this.props.jobs.length}})))}return _react2.default.createElement(_eui.EuiPopover,{button:button,isOpen:this.state.isOpen,closePopover:this.closePopover,panelPaddingSize:"none",anchorPosition:"downCenter"},_react2.default.createElement(_eui.EuiContextMenuPanel,{items:items.reverse()}))}}]);return MultiJobActionsMenuUI}(_react.Component);MultiJobActionsMenuUI.propTypes={jobs:_propTypes2.default.array.isRequired,showStartDatafeedModal:_propTypes2.default.func.isRequired,showDeleteJobModal:_propTypes2.default.func.isRequired,refreshJobs:_propTypes2.default.func.isRequired};var MultiJobActionsMenu=exports.MultiJobActionsMenu=(0,_react3.injectI18n)(MultiJobActionsMenuUI)},2254:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _group_selector=__webpack_require__(2255);Object.defineProperty(exports,"GroupSelector",{enumerable:true,get:function get(){return _group_selector.GroupSelector}})},2255:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.GroupSelector=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _check_privilege=__webpack_require__(32);var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _lodash=__webpack_require__(1);var _ml_api_service=__webpack_require__(22);var _group_list=__webpack_require__(2256);var _new_group_input=__webpack_require__(2258);var _messagebar_service=__webpack_require__(178);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function createSelectedGroups(jobs,groups){var jobIds=jobs.map(function(j){return j.id});var groupCounts={};jobs.forEach(function(j){j.groups.forEach(function(g){if(groupCounts[g]===undefined){groupCounts[g]=0}groupCounts[g]++})});var selectedGroups=groups.reduce(function(p,c){if(c.jobIds.some(function(j){return jobIds.includes(j)})){p[c.id]={partial:groupCounts[c.id]!==jobIds.length}}return p},{});return selectedGroups}var GroupSelector=exports.GroupSelector=function(_Component){_inherits(GroupSelector,_Component);function GroupSelector(props){_classCallCheck(this,GroupSelector);var _this=_possibleConstructorReturn(this,(GroupSelector.__proto__||Object.getPrototypeOf(GroupSelector)).call(this,props));_this.togglePopover=function(){if(_this.state.isPopoverOpen){_this.closePopover()}else{_ml_api_service.ml.jobs.groups().then(function(groups){var selectedGroups=createSelectedGroups(_this.props.jobs,groups);_this.setState({isPopoverOpen:true,edited:false,selectedGroups:selectedGroups,groups:groups})}).catch(function(error){console.error(error)})}};_this.closePopover=function(){_this.setState({edited:false,isPopoverOpen:false})};_this.selectGroup=function(group){var newSelectedGroups=(0,_lodash.cloneDeep)(_this.state.selectedGroups);if(newSelectedGroups[group.id]===undefined){newSelectedGroups[group.id]={partial:false}}else if(newSelectedGroups[group.id].partial===true){newSelectedGroups[group.id].partial=false}else{delete newSelectedGroups[group.id]}_this.setState({selectedGroups:newSelectedGroups,edited:true})};_this.applyChanges=function(){var selectedGroups=_this.state.selectedGroups;var jobs=_this.props.jobs;var newJobs=jobs.map(function(j){return{id:j.id,oldGroups:j.groups,newGroups:[]}});var _loop=function _loop(gId){if(selectedGroups.hasOwnProperty(gId)){var group=selectedGroups[gId];newJobs.forEach(function(j){if(group.partial===false||group.partial===true&&j.oldGroups.includes(gId)){j.newGroups.push(gId)}})}};for(var gId in selectedGroups){_loop(gId)}var tempJobs=newJobs.map(function(j){return{job_id:j.id,groups:j.newGroups}});_ml_api_service.ml.jobs.updateGroups(tempJobs).then(function(resp){var success=true;for(var jobId in resp){if(resp.hasOwnProperty(jobId)){if(resp[jobId].success===false){_messagebar_service.mlMessageBarService.notify.error(resp[jobId].error);success=false}}}if(success){_this.refreshJobs();_this.closePopover()}else{console.error(resp)}}).catch(function(error){_messagebar_service.mlMessageBarService.notify.error(error);console.error(error)})};_this.addNewGroup=function(id){var newGroup={id:id,calendarIds:[],jobIds:[]};var groups=_this.state.groups;if(groups.some(function(g){return g.id===newGroup.id})===false){groups.push(newGroup)}_this.setState({groups:groups})};_this.state={isPopoverOpen:false,groups:[],selectedGroups:{},edited:false};_this.refreshJobs=_this.props.refreshJobs;_this.canUpdateJob=(0,_check_privilege.checkPermission)("canUpdateJob");return _this}_createClass(GroupSelector,[{key:"render",value:function render(){var _this2=this;var _state=this.state,groups=_state.groups,selectedGroups=_state.selectedGroups,edited=_state.edited;var button=_react2.default.createElement(_eui.EuiToolTip,{position:"bottom",content:"Edit job groups"},_react2.default.createElement(_eui.EuiButtonIcon,{iconType:"indexEdit","aria-label":"Edit job groups",onClick:function onClick(){return _this2.togglePopover()},disabled:this.canUpdateJob===false}));var s=this.props.jobs.length>1?"s":"";return _react2.default.createElement(_eui.EuiPopover,{id:"trapFocus",ownFocus:true,button:button,isOpen:this.state.isPopoverOpen,closePopover:function closePopover(){return _this2.closePopover()}},_react2.default.createElement("div",{className:"group-selector"},_react2.default.createElement(_eui.EuiPopoverTitle,null,"Apply groups to job",s),_react2.default.createElement(_group_list.GroupList,{groups:groups,selectedGroups:selectedGroups,selectGroup:this.selectGroup}),_react2.default.createElement(_eui.EuiHorizontalRule,{margin:"xs"}),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_new_group_input.NewGroupInput,{addNewGroup:this.addNewGroup,allJobIds:this.props.allJobIds}),_react2.default.createElement(_eui.EuiHorizontalRule,{margin:"m"}),_react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiFlexGroup,null,_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButton,{size:"s",onClick:this.applyChanges,isDisabled:edited===false},"Apply"))))))}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props,state){if(state.edited===false){var selectedGroups=createSelectedGroups(props.jobs,state.groups);return{selectedGroups:selectedGroups}}else{return{}}}}]);return GroupSelector}(_react.Component);GroupSelector.propTypes={jobs:_propTypes2.default.array.isRequired,allJobIds:_propTypes2.default.array.isRequired,refreshJobs:_propTypes2.default.func.isRequired}},2256:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _group_list=__webpack_require__(2257);Object.defineProperty(exports,"GroupList",{enumerable:true,get:function get(){return _group_list.GroupList}})},2257:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.GroupList=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _job_group=__webpack_require__(625);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function Check(_ref){var group=_ref.group,selectedGroups=_ref.selectedGroups;if(selectedGroups[group.id]!==undefined){if(selectedGroups[group.id].partial){return _react2.default.createElement("div",{className:"check selected"},_react2.default.createElement("span",null,"—"))}else{return _react2.default.createElement("div",{className:"check selected"},_react2.default.createElement(_eui.EuiIcon,{type:"check"}))}}else{return _react2.default.createElement("div",{className:"check"})}}var GroupList=exports.GroupList=function(_Component){_inherits(GroupList,_Component);function GroupList(props){_classCallCheck(this,GroupList);var _this=_possibleConstructorReturn(this,(GroupList.__proto__||Object.getPrototypeOf(GroupList)).call(this,props));_this.selectGroup=function(group){_this.props.selectGroup(group)};_this.moveUp=function(event,index){event.preventDefault();if(index<0){return}else if(index>0){_this.selectItems[index-1].focus()}};_this.moveDown=function(event,index){event.preventDefault();if(index<_this.selectItems.length-1){_this.selectItems[index+1].focus()}};_this.handleKeyDown=function(event,group,index){switch(event.keyCode){case _eui.keyCodes.ENTER:_this.selectGroup(group);break;case _eui.keyCodes.SPACE:_this.selectGroup(group);break;case _eui.keyCodes.DOWN:_this.moveDown(event,index);break;case _eui.keyCodes.UP:_this.moveUp(event,index);break}};_this.setRef=function(ref,index){_this.selectItems[index]=ref};_this.state={groups:[]};_this.selectItems=[];return _this}_createClass(GroupList,[{key:"render",value:function render(){var _this2=this;var _props=this.props,selectedGroups=_props.selectedGroups,groups=_props.groups;return _react2.default.createElement("div",{className:"group-list"},groups.map(function(g,index){return _react2.default.createElement("div",{tabIndex:"0",onKeyDown:function onKeyDown(event){return _this2.handleKeyDown(event,g,index)},key:g.id,className:"group-item",onClick:function onClick(){return _this2.selectGroup(g)},ref:function ref(_ref2){return _this2.setRef(_ref2,index)}},_react2.default.createElement(Check,{group:g,selectedGroups:selectedGroups}),_react2.default.createElement(_job_group.JobGroup,{name:g.id}))}))}}]);return GroupList}(_react.Component);GroupList.propTypes={selectedGroups:_propTypes2.default.object.isRequired,groups:_propTypes2.default.array.isRequired,selectGroup:_propTypes2.default.func.isRequired}},2258:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _new_group_input=__webpack_require__(2259);Object.defineProperty(exports,"NewGroupInput",{enumerable:true,get:function get(){return _new_group_input.NewGroupInput}})},2259:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.NewGroupInput=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _validate_job=__webpack_require__(990);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var NewGroupInput=exports.NewGroupInput=function(_Component){_inherits(NewGroupInput,_Component);function NewGroupInput(props){_classCallCheck(this,NewGroupInput);var _this=_possibleConstructorReturn(this,(NewGroupInput.__proto__||Object.getPrototypeOf(NewGroupInput)).call(this,props));_this.changeTempNewGroup=function(e){var tempNewGroupName=e.target.value;var groupsValidationError="";if(tempNewGroupName===""){groupsValidationError=""}else if(_this.props.allJobIds.includes(tempNewGroupName)){groupsValidationError="A job with this ID already exists. Groups and jobs cannot use the same ID."}else{groupsValidationError=(0,_validate_job.validateGroupNames)([tempNewGroupName]).message}_this.setState({tempNewGroupName:tempNewGroupName,groupsValidationError:groupsValidationError})};_this.newGroupKeyPress=function(e){if(e.keyCode===_eui.keyCodes.ENTER&&_this.state.groupsValidationError===""&&_this.state.tempNewGroupName!==""){_this.addNewGroup()}};_this.addNewGroup=function(){_this.props.addNewGroup(_this.state.tempNewGroupName);_this.setState({tempNewGroupName:""})};_this.state={tempNewGroupName:"",groupsValidationError:""};return _this}_createClass(NewGroupInput,[{key:"render",value:function render(){var _state=this.state,tempNewGroupName=_state.tempNewGroupName,groupsValidationError=_state.groupsValidationError;return _react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiFormRow,{compressed:true,isInvalid:groupsValidationError!=="",error:groupsValidationError,className:"new-group-input"},_react2.default.createElement(_eui.EuiFieldText,{compressed:true,placeholder:"Add new group",value:tempNewGroupName,onChange:this.changeTempNewGroup,onKeyDown:this.newGroupKeyPress,isInvalid:groupsValidationError!=="",error:groupsValidationError}))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiFormRow,{className:"new-group-input"},_react2.default.createElement(_eui.EuiButtonIcon,{onClick:this.addNewGroup,iconType:"plusInCircle","aria-label":"Add",disabled:tempNewGroupName===""||groupsValidationError!==""})))))}}]);return NewGroupInput}(_react.Component);NewGroupInput.propTypes={addNewGroup:_propTypes2.default.func.isRequired,allJobIds:_propTypes2.default.array.isRequired}},2260:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _new_job_button=__webpack_require__(2261);Object.defineProperty(exports,"NewJobButton",{enumerable:true,get:function get(){return _new_job_button.NewJobButton}})},2261:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.NewJobButton=NewJobButton;var _check_privilege=__webpack_require__(32);var _check_ml_nodes=__webpack_require__(47);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function newJob(){window.location.href="#/jobs/new_job"}function NewJobButton(){var buttonEnabled=(0,_check_privilege.checkPermission)("canCreateJob")&&(0,_check_ml_nodes.mlNodesAvailable)();return _react2.default.createElement(_eui.EuiButton,{onClick:newJob,size:"s",disabled:buttonEnabled===false,fill:true,iconType:"plusInCircle"},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.createNewJobButtonLabel",defaultMessage:"Create new job"}))}},2262:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _jobs_stats_bar=__webpack_require__(2263);Object.defineProperty(exports,"JobStatsBar",{enumerable:true,get:function get(){return _jobs_stats_bar.JobStatsBar}})},2263:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobStatsBar=undefined;var _states=__webpack_require__(401);var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _i18n=__webpack_require__(9);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function createJobStats(jobsSummaryList){var jobStats={activeNodes:{label:_i18n.i18n.translate("xpack.ml.jobsList.statsBar.activeMLNodesLabel",{defaultMessage:"Active ML Nodes"}),value:0,show:true},total:{label:_i18n.i18n.translate("xpack.ml.jobsList.statsBar.totalJobsLabel",{defaultMessage:"Total jobs"}),value:0,show:true},open:{label:_i18n.i18n.translate("xpack.ml.jobsList.statsBar.openJobsLabel",{defaultMessage:"Open jobs"}),value:0,show:true},closed:{label:_i18n.i18n.translate("xpack.ml.jobsList.statsBar.closedJobsLabel",{defaultMessage:"Closed jobs"}),value:0,show:true},failed:{label:_i18n.i18n.translate("xpack.ml.jobsList.statsBar.failedJobsLabel",{defaultMessage:"Failed jobs"}),value:0,show:false},activeDatafeeds:{label:_i18n.i18n.translate("xpack.ml.jobsList.statsBar.activeDatafeedsLabel",{defaultMessage:"Active datafeeds"}),value:0,show:true}};if(jobsSummaryList===undefined){return jobStats}var mlNodes={};var failedJobs=0;jobsSummaryList.forEach(function(job){if(job.jobState===_states.JOB_STATE.OPENED){jobStats.open.value++}else if(job.jobState===_states.JOB_STATE.CLOSED){jobStats.closed.value++}else if(job.jobState===_states.JOB_STATE.FAILED){failedJobs++}if(job.hasDatafeed&&job.datafeedState===_states.DATAFEED_STATE.STARTED){jobStats.activeDatafeeds.value++}if(job.nodeName!==undefined){mlNodes[job.nodeName]={}}});jobStats.total.value=jobsSummaryList.length;if(failedJobs){jobStats.failed.value=failedJobs;jobStats.failed.show=true}else{jobStats.failed.show=false}jobStats.activeNodes.value=Object.keys(mlNodes).length;return jobStats}function Stat(_ref){var stat=_ref.stat;return _react2.default.createElement("span",{className:"stat"},_react2.default.createElement("span",{className:"stat-label"},stat.label),": ",_react2.default.createElement("span",{className:"stat-value"},stat.value))}Stat.propTypes={stat:_propTypes2.default.object.isRequired};var JobStatsBar=exports.JobStatsBar=function JobStatsBar(_ref2){var jobsSummaryList=_ref2.jobsSummaryList;var jobStats=createJobStats(jobsSummaryList);var stats=Object.keys(jobStats).map(function(k){return jobStats[k]});return _react2.default.createElement("div",{className:"jobs-stats-bar"},stats.filter(function(s){return s.show}).map(function(s){return _react2.default.createElement(Stat,{key:s.label,stat:s})}))};JobStatsBar.propTypes={jobsSummaryList:_propTypes2.default.array.isRequired}},2264:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _node_available_warning=__webpack_require__(2265);Object.defineProperty(exports,"NodeAvailableWarning",{enumerable:true,get:function get(){return _node_available_warning.NodeAvailableWarning}})},2265:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.NodeAvailableWarning=NodeAvailableWarning;var _check_ml_nodes=__webpack_require__(47);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function NodeAvailableWarning(){var isCloud=false;if((0,_check_ml_nodes.mlNodesAvailable)()===true||(0,_check_ml_nodes.permissionToViewMlNodeCount)()===false){return _react2.default.createElement("span",null)}else{return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiCallOut,{title:_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.nodeAvailableWarning.noMLNodesAvailableTitle",defaultMessage:"No ML nodes available"}),color:"warning",iconType:"alert"},_react2.default.createElement("p",null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.nodeAvailableWarning.noMLNodesAvailableDescription",defaultMessage:"There are no ML nodes available."}),_react2.default.createElement("br",null),_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.nodeAvailableWarning.unavailableCreateOrRunJobsDescription",defaultMessage:"You will not be able to create or run jobs. {cloudConfigLink}",values:{cloudConfigLink:isCloud?_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.nodeAvailableWarning.linkToCloudDescription",defaultMessage:"This can be configured in Cloud {hereCloudLink}.",values:{hereCloudLink:_react2.default.createElement(_eui.EuiLink,{href:"#"},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.nodeAvailableWarning.linkToCloud.hereLinkText",defaultMessage:"here"}))}}):""}}))),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}))}}},2266:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _refresh_jobs_list_button=__webpack_require__(2267);Object.defineProperty(exports,"RefreshJobsListButton",{enumerable:true,get:function get(){return _refresh_jobs_list_button.RefreshJobsListButton}})},2267:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.RefreshJobsListButton=undefined;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _eui=__webpack_require__(2);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var RefreshJobsListButton=exports.RefreshJobsListButton=function RefreshJobsListButton(_ref){var onRefreshClick=_ref.onRefreshClick,isRefreshing=_ref.isRefreshing;return _react2.default.createElement(_eui.EuiButtonEmpty,{onClick:onRefreshClick,isLoading:isRefreshing},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.ml.jobsList.refreshButtonLabel",defaultMessage:"Refresh"}))};RefreshJobsListButton.propTypes={onRefreshClick:_propTypes2.default.func.isRequired,isRefreshing:_propTypes2.default.bool.isRequired}},2268:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2269);__webpack_require__(2272);__webpack_require__(2283);__webpack_require__(2285);__webpack_require__(406);__webpack_require__(2291);__webpack_require__(2299)},2269:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _angular=__webpack_require__(21);var _angular2=_interopRequireDefault(_angular);__webpack_require__(205);var _parse_interval=__webpack_require__(196);var _timefilter=__webpack_require__(16);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _check_license=__webpack_require__(43);var _check_privilege=__webpack_require__(32);var _new_job=__webpack_require__(2270);var _new_job2=_interopRequireDefault(_new_job);var _save_status_modal=__webpack_require__(2271);var _save_status_modal2=_interopRequireDefault(_save_status_modal);var _new_job_utils=__webpack_require__(220);var _index_utils=__webpack_require__(62);var _field_types=__webpack_require__(257);var _validation=__webpack_require__(400);var _check_ml_nodes=__webpack_require__(47);var _new_job_defaults=__webpack_require__(241);var _job_utils=__webpack_require__(34);var _job_service=__webpack_require__(23);var _messagebar_service=__webpack_require__(178);var _ml_api_service=__webpack_require__(22);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}_routes2.default.when("/jobs/new_job/advanced",{template:_new_job2.default,resolve:{CheckLicense:_check_license.checkFullLicense,privileges:_check_privilege.checkCreateJobsPrivilege,indexPattern:_index_utils.loadCurrentIndexPattern,indexPatterns:_index_utils.loadIndexPatterns,savedSearch:_index_utils.loadCurrentSavedSearch,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable,loadNewJobDefaults:_new_job_defaults.loadNewJobDefaults}}).when("/jobs/new_job/advanced/:jobId",{template:_new_job2.default,resolve:{CheckLicense:_check_license.checkFullLicense,privileges:_check_privilege.checkCreateJobsPrivilege,indexPattern:_index_utils.loadCurrentIndexPattern,indexPatterns:_index_utils.loadIndexPatterns,savedSearch:_index_utils.loadCurrentSavedSearch,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable,loadNewJobDefaults:_new_job_defaults.loadNewJobDefaults}});var _module=_modules.uiModules.get("apps/ml");_module.controller("MlNewJob",function($scope,$route,$location,$modal,Private,mlDatafeedService,mlConfirmModalService){_timefilter.timefilter.disableTimeRangeSelector();_timefilter.timefilter.disableAutoRefreshSelector();var MODE={NEW:0,EDIT:1,CLONE:2};var INDEX_INPUT_TYPE={TEXT:"TEXT",LIST:"LIST"};$scope.INDEX_INPUT_TYPE=INDEX_INPUT_TYPE;var fieldsToIgnore=["_id","_field_names","_index","_parent","_routing","_seq_no","_source","_type","_uid","_version","_feature","_ignored"];var allowedInfluencerTypes=[_field_types.ES_FIELD_TYPES.TEXT,_field_types.ES_FIELD_TYPES.KEYWORD,_field_types.ES_FIELD_TYPES.IP];var msgs=_messagebar_service.mlMessageBarService;var mlConfirm=mlConfirmModalService;msgs.clear();var jobDefaults=(0,_new_job_defaults.newJobDefaults)();var currentConfigs={detectors:[],model_plot_config:{enabled:false}};$scope.job={};$scope.mode=MODE.NEW;$scope.saveLock=false;$scope.indices={};$scope.types={};$scope.fields={};$scope.dateFields={};$scope.catFields={};$scope.maximumFileSize;$scope.mlElasticDataDescriptionExposedFunctions={};$scope.elasticServerInfo={};$scope.jobGroupsUpdateFunction={};$scope.ui={pageTitle:"Create a new job",dataLocation:"ES",dataPreview:"",currentTab:0,tabs:[{index:0,title:"Job Details"},{index:1,title:"Analysis Configuration"},{index:2,title:"Data Description",hidden:true},{index:3,title:"Datafeed"},{index:4,title:"Edit JSON"},{index:5,title:"Data Preview",hidden:true}],validation:{tabs:[{index:0,valid:true,checks:{jobId:{valid:true},groupIds:{valid:true},modelMemoryLimit:{valid:true}}},{index:1,valid:true,checks:{detectors:{valid:true},influencers:{valid:true},categorizationFilters:{valid:true},bucketSpan:{valid:true}}},{index:2,valid:true,checks:{timeField:{valid:true},timeFormat:{valid:true}}},{index:3,valid:true,checks:{isDatafeed:{valid:true},hasAccessToIndex:{valid:true}}},{index:4,valid:true,checks:{}},{index:5,valid:true,checks:{}}],setTabValid:function setTabValid(tab,valid){$scope.ui.validation.tabs[tab].valid=valid}},cardinalityValidator:{status:0,message:"",STATUS:{FAILED:-1,NOT_RUNNING:0,RUNNING:1,FINISHED:2,WARNING:3}},jsonText:"",changeTab:changeTab,influencers:[],allInfluencers:allInfluencers,customInfluencers:[],tempCustomInfluencer:"",inputDataFormat:[{value:"delimited",title:"Delimited"},{value:"json",title:"JSON"}],fieldDelimiterOptions:[{value:"\t",title:"tab"},{value:" ",title:"space"},{value:",",title:","},{value:";",title:";"},{value:"custom",title:"custom"}],selectedFieldDelimiter:",",customFieldDelimiter:"",indexTextOk:false,fieldsUpToDate:false,indices:{},types:{},isDatafeed:true,useDedicatedIndex:false,enableModelPlot:false,modelMemoryLimit:"",modelMemoryLimitDefault:jobDefaults.anomaly_detectors.model_memory_limit,datafeed:{queryText:'{"match_all":{}}',queryDelayText:"",queryDelayDefault:"60s",frequencyText:"",frequencyDefault:"",scrollSizeText:"",scrollSizeDefault:1e3,indicesText:"",typesText:"",scriptFields:[]},saveStatus:{job:0}};function init(){_job_service.mlJobService.loadJobs();if(_job_service.mlJobService.currentJob){var jobId=$route.current.params.jobId;$scope.job=_job_service.mlJobService.cloneJob(_job_service.mlJobService.currentJob);if(jobId){$scope.mode=MODE.EDIT;console.log("Editing job",_job_service.mlJobService.currentJob);$scope.ui.pageTitle="Editing Job "+$scope.job.job_id}else{if(_job_service.mlJobService.currentJob.job_version===undefined){$scope.mode=MODE.NEW;if($scope.job.results_index_name!==undefined){$scope.ui.useDedicatedIndex=true}}else{$scope.mode=MODE.CLONE;console.log("Cloning job",_job_service.mlJobService.currentJob);$scope.ui.pageTitle="Clone Job from "+$scope.job.job_id;$scope.job.job_id="";if($scope.job.results_index_name==="shared"){delete $scope.job.results_index_name}else{$scope.ui.useDedicatedIndex=true;$scope.job.results_index_name=""}}setDatafeedUIText();setFieldDelimiterControlsFromText();if(!$scope.job.datafeed_config){$scope.ui.dataLocation="NONE";$scope.ui.influencers=_angular2.default.copy($scope.job.analysis_config.influencers)}if($scope.job.analysis_limits&&$scope.job.analysis_limits.model_memory_limit){$scope.ui.modelMemoryLimitText=$scope.job.analysis_limits.model_memory_limit}}_job_service.mlJobService.currentJob=undefined}else{$scope.mode=MODE.NEW;console.log("Creating new job");$scope.job=_job_service.mlJobService.getBlankJob();$scope.job.data_description.format="json";delete $scope.job.data_description.time_format;delete $scope.job.data_description.format;populateFormFromUrl()}loadFields().then(function(){calculateDatafeedFrequencyDefaultSeconds();showDataPreviewTab()}).catch(function(){calculateDatafeedFrequencyDefaultSeconds()})}function checkForConfigUpdates(){var STATUS=$scope.ui.cardinalityValidator.STATUS;var jobModelPlotValue=$scope.job.model_plot_config?$scope.job.model_plot_config:{enabled:false};var modelPlotSettingsEqual=_lodash2.default.isEqual(currentConfigs.model_plot_config,jobModelPlotValue);if(!modelPlotSettingsEqual){currentConfigs.model_plot_config.enabled=jobModelPlotValue.enabled;$scope.ui.enableModelPlot=jobModelPlotValue.enabled}if($scope.ui.enableModelPlot===true){var unchanged=_lodash2.default.isEqual(currentConfigs.detectors,$scope.job.analysis_config.detectors);if(!unchanged||!modelPlotSettingsEqual){runValidateCardinality()}}else{$scope.ui.cardinalityValidator.status=STATUS.FINISHED;$scope.ui.cardinalityValidator.message=""}}function changeTab(tab){$scope.ui.currentTab=tab.index;if(tab.index===1){checkForConfigUpdates()}else if(tab.index===4){createJSONText()}else if(tab.index===5){if($scope.ui.dataLocation==="ES"){loadDataPreview()}}}$scope.indexChanged=function(){$scope.ui.fieldsUpToDate=false};$scope.loadFields=function(){loadFields().catch(function(){}).then(function(){$scope.$applyAsync()})};function loadFields(){return new Promise(function(resolve,reject){clear($scope.fields);clear($scope.dateFields);clear($scope.catFields);clear($scope.ui.influencers);var index=$scope.ui.datafeed.indicesText;if(index!==""){_ml_api_service.ml.getFieldCaps({index:index}).then(function(resp){$scope.ui.fieldsUpToDate=true;_lodash2.default.each(resp,function(fieldList){_lodash2.default.each(fieldList,function(field,fieldName){_lodash2.default.each(field,function(type){if(fieldsToIgnore.indexOf(fieldName)===-1){var addField=true;if(fieldName.match(/\.keyword$/)){var keywordLess=fieldName.replace(".keyword");if($scope.fields[keywordLess]!==undefined){delete $scope.fields[keywordLess]}}else if($scope.fields[fieldName+".keyword"]!==undefined){addField=false}if(addField){$scope.fields[fieldName]=type;if(type.type===_field_types.ML_JOB_FIELD_TYPES.DATE){$scope.dateFields[fieldName]=type}if(type.type===_field_types.ML_JOB_FIELD_TYPES.TEXT||type.type===_field_types.ML_JOB_FIELD_TYPES.KEYWORD){$scope.catFields[fieldName]=type}if(allowedInfluencerTypes.indexOf(type.type)!==-1){$scope.ui.influencers.push(fieldName)}}}})})});var scriptFields=Object.keys(_lodash2.default.get($scope.job,"datafeed_config.script_fields",{}));var scriptType={type:"script_fields",searchable:false,aggregatable:true};scriptFields.forEach(function(fieldName){$scope.fields[fieldName]=scriptType});if(Object.keys($scope.fields).length){$scope.ui.indexTextOk=true}validateIndex($scope.ui.validation.tabs);guessTimeField();resolve()}).catch(function(error){$scope.ui.indexTextOk=false;validateIndex($scope.ui.validation.tabs);reject(error)})}else{reject()}})}function guessTimeField(){var currentTimeField=$scope.job.data_description.time_field;if($scope.dateFields[currentTimeField]===undefined){currentTimeField="";$scope.job.data_description.time_field=""}if(currentTimeField===""&&Object.keys($scope.dateFields).length){$scope.job.data_description.time_field=Object.keys($scope.dateFields)[0];console.log("guessTimeField: guessed time fields: ",$scope.job.data_description.time_field)}}$scope.isCurrentJobConfig=false;$scope.$watch("job",function(){$scope.isCurrentJobConfig=false},true);$scope.getJobConfig=function(){getDelimiterSelection();getDatafeedSelection();getAnalysisLimitsSelection();$scope.isCurrentJobConfig=true;return $scope.job};$scope.save=function(){console.log("save() job: ",$scope.job);msgs.clear();getDelimiterSelection();getDatafeedSelection();getAnalysisLimitsSelection();var jobValid=validateJob();if(jobValid.valid){_job_service.mlJobService.loadJobs().then(function(){var tempJob=_job_service.mlJobService.getJob($scope.job.job_id);if(tempJob){var tab=$scope.ui.validation.tabs[0];tab.valid=false;tab.checks.jobId.valid=false;tab.checks.jobId.message="'"+$scope.job.job_id+"' already exists, please choose a different name";changeTab({index:0})}else{checkInfluencers()}function checkInfluencers(){if($scope.job.analysis_config.influencers&&$scope.job.analysis_config.influencers.length){saveFunc()}else{mlConfirm.open({message:"You have not chosen any influencers, do you want to continue?",title:"No Influencers"}).then(saveFunc).catch(function(){changeTab({index:1})})}}function saveFunc(){if($scope.ui.useDedicatedIndex){if($scope.job.results_index_name===""){$scope.job.results_index_name=$scope.job.job_id}}else{delete $scope.job.results_index_name}$scope.saveLock=true;$scope.ui.saveStatus.job=1;openSaveStatusWindow();var job=(0,_new_job_utils.createJobForSaving)($scope.job);_job_service.mlJobService.saveNewJob(job).then(function(result){if(result.success){var saveNewDatafeed=function saveNewDatafeed(datafeedConfig,jobId){if(datafeedConfig){_job_service.mlJobService.saveNewDatafeed(datafeedConfig,jobId).then(function(){$scope.saveLock=false}).catch(function(resp){msgs.error("Could not create datafeed: ",resp);$scope.saveLock=false}).then(function(){$scope.$applyAsync()})}else{$scope.saveLock=false;$scope.$applyAsync()}};msgs.info("New Job '"+result.resp.job_id+"' added");$scope.ui.saveStatus.job=2;$scope.$applyAsync();_job_service.mlJobService.openJob($scope.job.job_id).then(function(){saveNewDatafeed($scope.job.datafeed_config,$scope.job.job_id)}).catch(function(resp){msgs.error("Could not open job: ",resp);msgs.error("Job created, creating datafeed anyway");saveNewDatafeed($scope.job.datafeed_config,$scope.job.job_id)})}else{$scope.ui.saveStatus.job=-1;$scope.saveLock=false;msgs.error("Save failed: "+result.resp.message);$scope.$applyAsync()}}).catch(function(result){$scope.ui.saveStatus.job=-1;$scope.saveLock=false;msgs.error("Save failed: "+result.resp.message);$scope.$applyAsync()})}}).catch(function(){msgs.error("Save failed");console.log("save(): job validation failed. Jobs list could not be loaded.");$scope.$applyAsync()})}else{msgs.error(jobValid.message);console.log("save(): job validation failed");$scope.$applyAsync()}};$scope.cancel=function(){mlConfirm.open({message:"Are you sure you want to cancel job creation?",title:"Are you sure?"}).then(function(){msgs.clear();$scope.$applyAsync();$location.path("jobs")})};$scope.cloneJobDataDescriptionCallback=function(){extractCustomInfluencers()};function populateFormFromUrl(){var createSearchItems=Private(_new_job_utils.SearchItemsProvider);var _createSearchItems=createSearchItems(),indexPattern=_createSearchItems.indexPattern,savedSearch=_createSearchItems.savedSearch,combinedQuery=_createSearchItems.combinedQuery;if(indexPattern.id!==undefined){(0,_index_utils.timeBasedIndexCheck)(indexPattern,true);$scope.ui.datafeed.indicesText=indexPattern.title;$scope.job.data_description.time_field=indexPattern.timeFieldName;if(savedSearch.id!==undefined){$scope.ui.datafeed.queryText=JSON.stringify(combinedQuery)}}}$scope.timeFieldSelected=function(){return $scope.job.data_description.time_field===""?false:true};$scope.jsonTextChange=function(){try{$scope.job=JSON.parse($scope.ui.jsonText);$scope.changeJobIDCase();if($scope.jobGroupsUpdateFunction.update!==undefined){$scope.jobGroupsUpdateFunction.update($scope.job.groups)}extractCustomInfluencers();setFieldDelimiterControlsFromText();setDatafeedUIText();setAnalysisLimitsUIText();if($scope.job.results_index_name!==undefined){$scope.ui.useDedicatedIndex=true}else{$scope.ui.useDedicatedIndex=false}}catch(e){console.log("JSON could not be parsed")}};$scope.changeJobIDCase=function(){if($scope.job.job_id){$scope.job.job_id=$scope.job.job_id.toLowerCase()}};$scope.datafeedChange=function(){if($scope.ui.isDatafeed){$scope.job.datafeed_config={};$scope.ui.tabs[2].hidden=true;calculateDatafeedFrequencyDefaultSeconds()}else{delete $scope.job.datafeed_config;$scope.ui.tabs[2].hidden=false;$scope.job.data_description.format="json"}showDataPreviewTab()};$scope.setDedicatedIndex=function(){if($scope.ui.useDedicatedIndex){$scope.job.results_index_name=""}else{delete $scope.job.results_index_name}};function runValidateCardinality(){var STATUS=$scope.ui.cardinalityValidator.STATUS;$scope.ui.cardinalityValidator.status=$scope.ui.cardinalityValidator.STATUS.RUNNING;var tempJob=_job_service.mlJobService.cloneJob($scope.job);_lodash2.default.merge(tempJob,(0,_new_job_utils.getMinimalValidJob)());_ml_api_service.ml.validateCardinality(tempJob).then(function(response){var validationResult=(0,_new_job_utils.checkCardinalitySuccess)(response);if(validationResult.success===true){$scope.ui.cardinalityValidator.status=STATUS.FINISHED;$scope.ui.cardinalityValidator.message=""}else{$scope.ui.cardinalityValidator.message="Creating model plots is resource intensive and not recommended\n                  where the cardinality of the selected fields is greater than 100. Estimated cardinality\n                  for this job is "+validationResult.highCardinality+".\n                  If you enable model plot with this configuration\n                  we recommend you select a dedicated results index on the Job Details tab.";$scope.ui.cardinalityValidator.status=STATUS.WARNING}}).catch(function(error){console.log("Cardinality check error:",error);$scope.ui.cardinalityValidator.message="An error occurred validating the configuration\n            for running the job with model plot enabled.\n            Creating model plots can be resource intensive and not recommended where the cardinality of the selected fields is high.\n            You may want to select a dedicated results index on the Job Details tab.";$scope.ui.cardinalityValidator.status=STATUS.FAILED}).then(function(){$scope.$applyAsync()})}$scope.onDetectorsUpdate=function(){var STATUS=$scope.ui.cardinalityValidator.STATUS;if($scope.ui.enableModelPlot===true){currentConfigs.detectors=_lodash2.default.cloneDeep($scope.job.analysis_config.detectors);if($scope.job.analysis_config.detectors.length===0){$scope.ui.cardinalityValidator.status=STATUS.FINISHED;$scope.ui.cardinalityValidator.message=""}else{runValidateCardinality()}}};$scope.setModelPlotEnabled=function(){var STATUS=$scope.ui.cardinalityValidator.STATUS;if($scope.ui.enableModelPlot===true){currentConfigs.detectors=_lodash2.default.cloneDeep($scope.job.analysis_config.detectors);$scope.job.model_plot_config={enabled:true};currentConfigs.model_plot_config.enabled=true;if($scope.job.analysis_config.detectors.length===0){return}runValidateCardinality()}else{currentConfigs.model_plot_config.enabled=false;$scope.ui.cardinalityValidator.status=STATUS.FINISHED;$scope.ui.cardinalityValidator.message="";delete $scope.job.model_plot_config}};$scope.setAnalysisConfigProperty=function(value,field){if(value===""){delete $scope.job.analysis_config[field]}else{$scope.job.analysis_config[field]=value}};function clear(obj){Object.keys(obj).forEach(function(key){delete obj[key]});if(Array.isArray(obj)){obj.length=0}}function setDatafeedUIText(){if($scope.job.datafeed_config&&Object.keys($scope.job.datafeed_config).length){var datafeedConfig=$scope.job.datafeed_config;$scope.ui.isDatafeed=true;$scope.ui.tabs[2].hidden=true;$scope.ui.dataLocation="ES";showDataPreviewTab();var queryDelayDefault=$scope.ui.datafeed.queryDelayDefault;var queryDelay=datafeedConfig.query_delay;if(datafeedConfig.query_delay===undefined||$scope.ui.datafeed.queryDelayDefault===datafeedConfig.query_delay){queryDelay=""}var frequencyDefault=$scope.ui.datafeed.frequencyDefault;var freq=datafeedConfig.frequency;if(datafeedConfig.frequency===undefined||$scope.ui.datafeed.frequencyDefault===datafeedConfig.frequency){freq=""}var scrollSizeDefault=$scope.ui.datafeed.scrollSizeDefault;var scrollSize=datafeedConfig.scroll_size;if(datafeedConfig.scroll_size===undefined||$scope.ui.datafeed.scrollSizeDefault===datafeedConfig.scroll_size){scrollSize=""}clear($scope.types);_lodash2.default.each(datafeedConfig.types,function(type){$scope.types[type]=$scope.ui.types[type]});clear($scope.indices);_lodash2.default.each(datafeedConfig.indices,function(index){$scope.indices[index]=$scope.ui.indices[index]});var indicesText=datafeedConfig.indices.join(",");var scriptFields=datafeedConfig.script_fields!==undefined?Object.keys(datafeedConfig.script_fields):[];var fieldsUpToDate=true;if(indicesText!==$scope.ui.datafeed.indicesText||_lodash2.default.isEqual(scriptFields,$scope.ui.datafeed.scriptFields)===false){fieldsUpToDate=false}$scope.ui.fieldsUpToDate=fieldsUpToDate;var types=Array.isArray(datafeedConfig.types)?datafeedConfig.types:[];$scope.ui.datafeed={queryText:_angular2.default.toJson(datafeedConfig.query,true),queryDelayText:queryDelay,queryDelayDefault:queryDelayDefault,frequencyText:freq,frequencyDefault:frequencyDefault,scrollSizeText:scrollSize,scrollSizeDefault:scrollSizeDefault,indicesText:indicesText,typesText:types.join(","),scriptFields:scriptFields};if($scope.ui.fieldsUpToDate===false){$scope.loadFields()}}else{$scope.ui.isDatafeed=false;$scope.ui.tabs[2].hidden=false}}function setAnalysisLimitsUIText(){if($scope.job.analysis_limits!==undefined){if($scope.job.analysis_limits.model_memory_limit!==undefined){$scope.ui.modelMemoryLimitText=$scope.job.analysis_limits.model_memory_limit}}}function calculateDatafeedFrequencyDefaultSeconds(){var bucketSpan=(0,_parse_interval.parseInterval)($scope.job.analysis_config.bucket_span);if(bucketSpan!==null){$scope.ui.datafeed.frequencyDefault=(0,_job_utils.calculateDatafeedFrequencyDefaultSeconds)(bucketSpan.asSeconds())+"s"}}$scope.calculateDatafeedFrequencyDefaultSeconds=calculateDatafeedFrequencyDefaultSeconds;function setFieldDelimiterControlsFromText(){if($scope.job.data_description&&$scope.job.data_description.field_delimiter){if($scope.job.data_description.format===undefined){$scope.job.data_description.format="delimited"}var fieldDelimiter=$scope.job.data_description.field_delimiter;$scope.ui.selectedFieldDelimiter="custom";$scope.ui.customFieldDelimiter="";var isCustom=true;for(var i=0;i<$scope.ui.fieldDelimiterOptions.length-1;i++){if($scope.ui.fieldDelimiterOptions[i].value===fieldDelimiter){isCustom=false;$scope.ui.selectedFieldDelimiter=$scope.ui.fieldDelimiterOptions[i].value}}if(isCustom){$scope.ui.customFieldDelimiter=fieldDelimiter}}}function getDelimiterSelection(){if($scope.job.data_description.format==="delimited"){var selectedFieldDelimiter=$scope.ui.selectedFieldDelimiter;if(selectedFieldDelimiter==="custom"){$scope.job.data_description.field_delimiter=$scope.ui.customFieldDelimiter}else{$scope.job.data_description.field_delimiter=selectedFieldDelimiter}}else{delete $scope.job.data_description.field_delimiter;delete $scope.job.data_description.quote_character}}function getAnalysisLimitsSelection(){var ui=$scope.ui;var job=$scope.job;if(ui.modelMemoryLimitText===""||ui.modelMemoryLimitText===null||ui.modelMemoryLimitText===undefined){if(job.analysis_limits!==undefined){delete job.analysis_limits.model_memory_limit;if(Object.keys(job.analysis_limits).length===0){delete job.analysis_limits}}}else{if(job.analysis_limits===undefined){job.analysis_limits={}}job.analysis_limits.model_memory_limit=ui.modelMemoryLimitText}}function getDatafeedSelection(){if($scope.ui.isDatafeed){var df=$scope.ui.datafeed;if(df.queryText===""){df.queryText='{"match_all":{}}'}var query=df.queryText;try{query=JSON.parse(query)}catch(e){console.log("getDatafeedSelection(): could not parse query JSON")}var indices=[];if(df.indicesText){indices=df.indicesText.split(",").map(function(i){return i.trim()})}var types=[];if(df.typesText){types=df.typesText.split(",");for(var i=0;i<types.length;i++){types[i]=types[i].trim()}}var typeKeys=Object.keys($scope.ui.types);if(_lodash2.default.difference(typeKeys,types).length===0){types=[]}if(!$scope.job.datafeed_config){$scope.job.datafeed_config={}}var config=$scope.job.datafeed_config;config.query=query;if(df.queryDelayText===""||df.queryDelayText===null||df.queryDelayText===undefined){delete config.query_delay}else{config.query_delay=df.queryDelayText}if(df.frequencyText===""||df.frequencyText===null||df.frequencyText===undefined){delete config.frequency}else{config.frequency=df.frequencyText}if(df.scrollSizeText===""||df.scrollSizeText===null||df.scrollSizeText===undefined){delete config.scroll_size}else{config.scroll_size=df.scrollSizeText}config.indices=indices;config.types=types}}function getCustomUrlSelection(){if($scope.job.custom_settings&&$scope.job.custom_settings.custom_urls){if($scope.job.custom_settings.custom_urls.length===0){delete $scope.job.custom_settings}}}function getCategorizationFilterSelection(){if($scope.job.analysis_config&&$scope.job.analysis_config.categorization_filters){if($scope.job.analysis_config.categorization_filters.length===0){delete $scope.job.analysis_config.categorization_filters}}}function createJSONText(){getDelimiterSelection();getAnalysisLimitsSelection();getDatafeedSelection();getCustomUrlSelection();getCategorizationFilterSelection();$scope.ui.jsonText=_angular2.default.toJson($scope.job,true);setTimeout(function(){$scope.$applyAsync()},0)}$scope.addCustomUrl=function(){if(!$scope.job.custom_settings){$scope.job.custom_settings={}}if(!$scope.job.custom_settings.custom_urls){$scope.job.custom_settings.custom_urls=[]}$scope.job.custom_settings.custom_urls.push({url_name:"",url_value:""})};$scope.removeCustomUrl=function(index){$scope.job.custom_settings.custom_urls.splice(index,1)};$scope.addCategorizationFilter=function(){if($scope.job.analysis_config){if(!$scope.job.analysis_config.categorization_filters){$scope.job.analysis_config.categorization_filters=[]}$scope.job.analysis_config.categorization_filters.push("")}};$scope.removeCategorizationFilter=function(index){if($scope.job.analysis_config&&$scope.job.analysis_config.categorization_filters){$scope.job.analysis_config.categorization_filters.splice(index,1)}};$scope.influencerChecked=function(inf){return _lodash2.default.contains($scope.job.analysis_config.influencers,inf)};$scope.toggleInfluencer=function(inf){var influencers=$scope.job.analysis_config.influencers;if($scope.influencerChecked(inf)){for(var i=0;i<influencers.length;i++){if(influencers[i]===inf){$scope.job.analysis_config.influencers.splice(i,1)}}}else{$scope.job.analysis_config.influencers.push(inf)}};$scope.addCustomInfluencer=function(){if($scope.ui.tempCustomInfluencer!==""){$scope.ui.customInfluencers.push($scope.ui.tempCustomInfluencer);$scope.ui.tempCustomInfluencer=""}};function extractCustomInfluencers(){var allInfluencersList=$scope.ui.influencers;$scope.ui.customInfluencers=_lodash2.default.difference($scope.job.analysis_config.influencers,allInfluencersList);console.log("extractCustomInfluencers: ",$scope.ui.customInfluencers)}function validateJob(){var limits=(0,_new_job_defaults.newJobLimits)();var validationResults=(0,_job_utils.basicJobValidation)($scope.job,$scope.fields,limits);var valid=validationResults.valid;var message="Fill in all required fields";var tabs=$scope.ui.validation.tabs;_lodash2.default.each(tabs,function(tab){tab.valid=true;for(var check in tab.checks){if(tab.checks.hasOwnProperty(check)){tab.checks[check].valid=true;tab.checks[check].message=""}}});var job=$scope.job;if(job){if(validationResults.contains("job_id_empty")){tabs[0].checks.jobId.valid=false}else if(validationResults.contains("job_id_invalid")){tabs[0].checks.jobId.valid=false;var msg="Job name can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; ";msg+="must start and end with an alphanumeric character";tabs[0].checks.jobId.message=msg}if(validationResults.contains("job_group_id_invalid")){tabs[0].checks.groupIds.valid=false;var _msg="Job group names can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; ";_msg+="must start and end with an alphanumeric character";tabs[0].checks.groupIds.message=_msg}if(validationResults.contains("model_memory_limit_units_invalid")){tabs[0].checks.modelMemoryLimit.valid=false;var str=_validation.ALLOWED_DATA_UNITS.slice(0,_validation.ALLOWED_DATA_UNITS.length-1).join(", ")+" or "+[].concat(_toConsumableArray(_validation.ALLOWED_DATA_UNITS)).pop();var _msg2="Model memory limit data unit unrecognized. It must be "+str;tabs[0].checks.modelMemoryLimit.message=_msg2}if(validationResults.contains("model_memory_limit_invalid")){tabs[0].checks.modelMemoryLimit.valid=false;var _msg3="Model memory limit cannot be higher than the maximum value of "+limits.max_model_memory_limit.toUpperCase();tabs[0].checks.modelMemoryLimit.message=_msg3}if(validationResults.contains("categorization_filter_invalid")){tabs[1].checks.categorizationFilters.message="categorizationFieldName must be set to allow filters";tabs[1].checks.categorizationFilters.valid=false}if(validationResults.contains("detectors_empty")){tabs[1].checks.detectors.valid=false}if(validationResults.contains("detectors_duplicates")){var _msg4="Duplicate detectors were found. Detectors having the same combined configuration for";_msg4+=" 'function', 'field_name', 'by_field_name', 'over_field_name' and";_msg4+=" 'partition_field_name' are not allowed within the same job.";tabs[1].checks.detectors.message=_msg4;tabs[1].checks.detectors.valid=false}if(validationResults.contains("influencers_empty")){}if(validationResults.contains("bucket_span_empty")){tabs[1].checks.bucketSpan.message="bucket_span must be set";tabs[1].checks.bucketSpan.valid=false}else if(validationResults.contains("bucket_span_invalid")){var _msg5=job.analysis_config.bucket_span+" is not a valid time interval format e.g. 10m, 1h.";_msg5+=" It also needs to be higher than zero.";tabs[1].checks.bucketSpan.message=_msg5;tabs[1].checks.bucketSpan.valid=false}validateIndex(tabs,function(){return validationResults.contains("index_fields_invalid")})}_lodash2.default.each(tabs,function(tab){_lodash2.default.each(tab.checks,function(item){if(item.valid===false){tab.valid=false}})});return{valid:valid,message:message}}function validateIndex(tabs){var dataFeedTest=arguments.length>1&&arguments[1]!==undefined?arguments[1]:function(){return Object.keys($scope.fields).length===0};if(dataFeedTest()){var msg="Could not load fields from index";tabs[3].checks.hasAccessToIndex.valid=false;tabs[3].checks.hasAccessToIndex.message=msg;tabs[3].valid=false}else{tabs[3].checks.hasAccessToIndex.valid=true;tabs[3].valid=true}}function openSaveStatusWindow(){$modal.open({template:_save_status_modal2.default,controller:"MlSaveStatusModal",backdrop:"static",keyboard:false,size:"sm",resolve:{params:function params(){return{pscope:$scope,openDatafeed:function openDatafeed(){mlDatafeedService.openJobTimepickerWindow($scope.job)}}}}})}function loadDataPreview(){createJSONText();$scope.ui.dataPreview="";var job=$scope.job;if(job.datafeed_config&&job.datafeed_config.indices.length){_job_service.mlJobService.searchPreview(job).then(function(resp){var data=void 0;if(resp.aggregations){data=resp.aggregations.buckets.buckets.slice(0,_job_utils.ML_DATA_PREVIEW_COUNT)}else{data=resp.hits.hits}$scope.ui.dataPreview=_angular2.default.toJson(data,true)}).catch(function(resp){$scope.ui.dataPreview=_angular2.default.toJson(resp,true)}).then(function(){$scope.$applyAsync()})}else{$scope.ui.dataPreview="Datafeed does not exist";$scope.$applyAsync()}}function showDataPreviewTab(){var hidden=true;if($scope.ui.isDatafeed){hidden=false}if($scope.ui.dataLocation==="NONE"&&$scope.mode===MODE.CLONE){hidden=true}$scope.ui.tabs[5].hidden=hidden;$scope.$applyAsync()}function allInfluencers(){var influencers=$scope.ui.influencers.concat($scope.ui.customInfluencers);influencers=_lodash2.default.uniq(influencers);return _lodash2.default.sortBy(influencers,function(inf){return inf})}$scope.aceLoaded=function(editor){$scope.$applyAsync();if(editor.container.id==="datafeed-preview"){editor.setReadOnly(true)}};init()})},2270:function(module,exports){module.exports='<ml-nav-menu name="new_job_advanced"></ml-nav-menu>\n<ml-new-job class="ml-new-job euiPage euiPage--widthIsNotRestricted">\n  <ml-message-bar></ml-message-bar>\n  <div ng-controller="MlNewJob" class="euiPageBody">\n    <div class="euiPanel euiPanel--paddingLarge euiPageContent">\n      <div class="euiPageContentHeader">\n        <div class="euiPageContentHeaderSection">\n          <h3 class="euiTitle euiTitle--large">{{ui.pageTitle}}</h3>\n        </div>\n      </div>\n      <div class="euiPageContentBody">\n        <ul class="nav nav-tabs">\n          <li\n            class="kbn-settings-tab"\n            ng-class="{ active: ui.currentTab === tab.index }"\n            ng-repeat="tab in ui.tabs"\n            ng-hide="ui.tabs[{{tab.index}}].hidden">\n\n            <a ng-click="ui.changeTab(tab)">\n              {{ tab.title }}\n              <i ng-hide=\'ui.validation.tabs[tab.index].valid\' class=\'validation-error fa fa-exclamation-circle\' />\n            </a>\n          </li>\n        </ul>\n\n        \x3c!-- tab 0 Job Details --\x3e\n        <ml-job-tab-0 class="tab" ng-show="ui.currentTab === 0">\n          <div class="tab_contents">\n            \x3c!-- ID --\x3e\n            <div class="form-group">\n              <ml-form-label label-id="new_job_id" tooltip-append-to-body="true">Name</ml-form-label>\n              <input\n                aria-labelledby="ml_aria_label_new_job_id"\n                aria-describedby="ml_aria_description_new_job_id"\n                ng-model="job.job_id"\n                required\n                placeholder="Job ID"\n                ng-change="changeJobIDCase()"\n                input-focus\n                class="form-control lowercase" />\n              <div ng-hide="ui.validation.tabs[0].checks.jobId.valid" class="validation-error">{{ ( ui.validation.tabs[0].checks.jobId.message || "Enter a name for the job" ) }}</div>\n            </div>\n            \x3c!-- description --\x3e\n            <div class="form-group">\n              <ml-form-label label-id="new_job_description">Description</ml-form-label>\n              <input\n                aria-labelledby="ml_aria_label_new_job_description"\n                aria-describedby="ml_aria_description_new_job_description"\n                ng-model="job.description"\n                placeholder="Job description"\n                class="form-control" />\n            </div>\n\n            <div class="form-group">\n              <ml-form-label label-id="new_job_group">Job Groups</ml-form-label>\n              <ml-job-group-select\n                aria-labelledby="ml_aria_label_new_job_group"\n                aria-describedby="ml_aria_description_new_job_group"\n                job-groups=\'job.groups\'\n                external-update-function=\'jobGroupsUpdateFunction\' />\n              <div ng-hide="ui.validation.checks.groupIds.valid" class="validation-error">{{ ui.validation.tabs[0].checks.groupIds.message }}</div>\n            </div>\n\n            <div class="form-group">\n              <label class="kuiFormLabel">Custom URLs</label><i ml-info-icon="new_job_custom_urls" />\n              <div class="euiSpacer euiSpacer--s"></div>\n              <div ng-if="job.custom_settings && job.custom_settings.custom_urls">\n                <div ng-repeat="item in job.custom_settings.custom_urls track by $index" class="custom-url">\n                  <div class="field-cols">\n\n                    <div class="form-group">\n                      <label class="kuiFormLabel" id="ml_aria_label_custom_url_label_{{$index}}">Label</label>\n                      <input\n                        aria-labelledby="ml_aria_label_custom_url_label_{{$index}}"\n                        ng-model="item.url_name"\n                        type="text"\n                        class="form-control" />\n                    </div>\n                  </div>\n\n                  <div class="field-cols">\n                    <div class="form-group">\n                      <label class="kuiFormLabel" id="ml_aria_label_custom_url_{{$index}}">URL</label>\n                      <textarea\n                        aria-labelledby="ml_aria_label_custom_url_{{$index}}"\n                        ng-model="item.url_value"\n                        type="text"\n                        class="form-control" ></textarea>\n                    </div>\n                  </div>\n\n                  <button\n                    aria-label="Remove Custom URL"\n                    ng-click="removeCustomUrl($index)"\n                    tooltip-append-to-body="true"\n                    type="button"\n                    class="kuiButton kuiButton--danger kuiButton--small remove-button">\n                      <i aria-hidden="true" class="fa fa-times" />\n                  </button>\n                </div>\n              </div>\n              <div>\n                <button\n                  aria-labelledby="ml_aria_label_new_job_custom_urls"\n                  aria-describedby="ml_aria_description_new_job_custom_urls"\n                  ng-click="addCustomUrl()"\n                  type="button"\n                  class="kuiButton kuiButton--primary kuiButton--small">\n                  <i aria-hidden="true" class="fa fa-plus" />\n                  <span id="ml_aria_label_new_job_custom_urls">Add Custom URL</span>\n                </button>\n              </div>\n\n            </div>\n\n            <div class="form-group">\n              <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n                <input type="checkbox"\n                  aria-labelledby="ml_aria_label_new_job_dedicated_index"\n                  aria-describedby="ml_aria_description_new_job_dedicated_index"\n                  class=\'kuiCheckBox\'\n                  ng-change="setDedicatedIndex()"\n                  ng-model  ="ui.useDedicatedIndex" />\n                <span class=\'kuiCheckBoxLabel__text\'>\n                  <span id="ml_aria_label_new_job_dedicated_index">Use dedicated index</span>\n                  <i ml-info-icon="new_job_dedicated_index" />\n                </span>\n              </label>\n            </div>\n\n            <div class="form-group">\n              <ml-form-label label-id="new_job_model_memory_limit">Model memory limit</ml-form-label>\n              <input\n                aria-labelledby="ml_aria_label_new_job_model_memory_limit"\n                aria-describedby="ml_aria_description_new_job_model_memory_limit"\n                ng-model="ui.modelMemoryLimitText"\n                placeholder="{{ui.modelMemoryLimitDefault}}"\n                class="form-control" />\n              <div ng-hide="ui.validation.tabs[0].checks.modelMemoryLimit.valid" class="validation-error">{{ ui.validation.tabs[0].checks.modelMemoryLimit.message }}</div>\n            </div>\n\n          </div>\n        </ml-job-tab-0>\n\n        \x3c!-- tab2 1 Analysis Configuration --\x3e\n        <ml-job-tab-1 ng-show="ui.currentTab === 1">\n          <div class="tab_contents">\n            <div class="form-group">\n              <ml-form-label label-id="new_job_bucketspan">bucket_span</ml-form-label>\n              <input\n                aria-labelledby="ml_aria_label_new_job_bucketspan"\n                aria-describedby="ml_aria_description_new_job_bucketspan"\n                type="text"\n                ng-model="job.analysis_config.bucket_span"\n                placeholder=""\n                ng-change="calculateDatafeedFrequencyDefaultSeconds()"\n                class="form-control" />\n              <div ng-hide="ui.validation.tabs[1].checks.bucketSpan.valid" class="validation-error">\n                {{ ( ui.validation.tabs[1].checks.bucketSpan.message || "bucket_span is not a valid time interval format" ) }}\n              </div>\n            </div>\n            <div class="form-group">\n              <ml-form-label label-id="new_job_summarycountfieldname">summary_count_field_name</ml-form-label>\n              <field-select\n                label-id=\'"new_job_summarycountfieldname"\'\n                on-change=\'setAnalysisConfigProperty\'\n                value=\'job.analysis_config.summary_count_field_name\'\n                field=\'"summary_count_field_name"\'\n                options=\'fields\'>\n              </field-select>\n            </div>\n            <div class="form-group">\n              <ml-form-label label-id="new_job_categorizationfieldname">categorization_field_name</ml-form-label>\n              <field-select\n                label-id=\'"new_job_categorizationfieldname"\'\n                on-change=\'setAnalysisConfigProperty\'\n                value=\'job.analysis_config.categorization_field_name\'\n                field=\'"categorization_field_name"\'\n                options=\'catFields\'>\n              </field-select>\n            </div>\n\n            <div class="form-group"\n              ng-show="(job.analysis_config.categorization_field_name !== undefined && job.analysis_config.categorization_field_name !== \'\') ||\n                       (job.analysis_config.categorization_filters && job.analysis_config.categorization_filters.length)">\n\n              <label class="kuiFormLabel" aria-describedby="ml_aria_description_new_job_categorizationfilters">Categorization Filters</label>\n              <i ml-info-icon="new_job_categorizationfilters" />\n              <div class="euiSpacer euiSpacer--s"></div>\n              <div ng-if="job.analysis_config && job.analysis_config.categorization_filters">\n                <div ng-repeat="item in job.analysis_config.categorization_filters track by $index" class="categorization-filter">\n                  <div class="field-cols">\n\n                    <div class="form-group">\n                      <input\n                        aria-label="Categorization filter regular expression"\n                        ng-model="job.analysis_config.categorization_filters[$index]"\n                        type="text"\n                        class="form-control" />\n                    </div>\n                  </div>\n\n                  <button\n                    aria-label="Remove categorization filter"\n                    ng-click="removeCategorizationFilter($index)"\n                    tooltip-append-to-body="true"\n                    type="button"\n                    class="kuiButton kuiButton--danger kuiButton--small remove-button">\n                      <i aria-hidden="true" class="fa fa-times" />\n                  </button>\n                </div>\n              </div>\n              <div>\n                <button\n                  aria-labelledby="ml_aria_label_add_categorization_filter"\n                  ng-click="addCategorizationFilter()"\n                  type="button"\n                  ng-disabled="job.analysis_config.categorization_field_name === undefined || job.analysis_config.categorization_field_name === \'\'"\n                  class="kuiButton kuiButton--primary kuiButton--small">\n                  <i aria-hidden="true" class="fa fa-plus" />\n                  <span id="ml_aria_label_add_categorization_filter">Add Categorization Filter</span>\n                </button>\n              </div>\n            </div>\n            <div ng-hide="ui.validation.tabs[1].checks.categorizationFilters.valid" class="validation-error">\n              {{ ( ui.validation.tabs[1].checks.categorizationFilters.message || "Categorization filters must all be valid regular expressions" ) }}\n            </div>\n\n            <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n            <label class="kuiFormLabel" aria-describedby="ml_aria_description_new_job_detectors">Detectors</label>\n            <i ml-info-icon="new_job_detectors" />\n\n            <div class="euiSpacer euiSpacer--s"></div>\n\n            <div ml-job-detectors-list\n              ml-detectors="job.analysis_config.detectors"\n              ml-indices="indices"\n              ml-fields="fields"\n              ml-cat-field-name-selected="(job.analysis_config.categorization_field_name?true:false)"\n              ml-edit-mode="\'NEW\'"\n              ml-on-detectors-update="onDetectorsUpdate"\n              ></div>\n            <div ng-hide="ui.validation.tabs[1].checks.detectors.valid" class="validation-error">\n              {{ ( ui.validation.tabs[1].checks.detectors.message || "At least one detector should be configured" ) }}\n            </div>\n\n            <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n            <label class="kuiFormLabel" aria-describedby="ml_aria_description_new_job_influencers">Influencers</label>\n            <i ml-info-icon="new_job_influencers" />\n            <div class="influencer-list-container">\n\n              <div ng-repeat="inf in ui.allInfluencers()" >\n                <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n                  <input class=\'kuiCheckBox\' type="checkbox" ng-checked="influencerChecked(inf)" ng-click="toggleInfluencer(inf)" />\n                  <span class=\'kuiCheckBoxLabel__text\'>{{inf}}</span>\n                </label>\n              </div>\n\n              <div class="custom-influencer">\n                <input\n                  type="text"\n                  ng-model="ui.tempCustomInfluencer"\n                  placeholder="Custom influencer"\n                  class="form-control"  />\n                <button\n                  aria-label="Add Custom Influencer"\n                  ng-click="addCustomInfluencer()"\n                  ng-disabled="ui.tempCustomInfluencer===\'\'"\n                  type="button"\n                  class="kuiButton kuiButton--primary kuiButton--small">\n                  <i aria-hidden="true" class="fa fa-plus" /> Add\n                </button>\n              </div>\n            </div>\n            <div ng-hide="ui.validation.tabs[1].checks.influencers.valid" class="validation-error">\n              {{ ( ui.validation.tabs[1].checks.influencers.message || "At least one influencer should be selected" ) }}\n            </div>\n\n            <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n            <div class="form-group">\n              <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n                <input\n                  type="checkbox"\n                  aria-labelledby="ml_aria_label_new_job_enable_model_plot"\n                  aria-describedby="ml_aria_description_new_job_enable_model_plot"\n                  class=\'kuiCheckBox\'\n                  ng-change="setModelPlotEnabled()"\n                  ng-model="ui.enableModelPlot" />\n                <span class=\'kuiCheckBoxLabel__text\'>\n                  <span id="ml_aria_label_new_job_enable_model_plot">\n                    {{ ui.cardinalityValidator.status === ui.cardinalityValidator.STATUS.RUNNING ? \'Validating cardinality...\' : \'Enable model plot\' }}\n                  </span>\n                  <i ml-info-icon="new_job_enable_model_plot" />\n                </span>\n              </label>\n              <div class=\'ml-new-job-callout kuiVerticalRhythm\'>\n                <ml-enable-model-plot-callout\n                  message=\'ui.cardinalityValidator.message\'\n                  ng-show="ui.cardinalityValidator.status === ui.cardinalityValidator.STATUS.WARNING ||\n                    ui.cardinalityValidator.status === ui.cardinalityValidator.STATUS.FAILED">\n                </ml-enable-model-plot-callout>\n              </div>\n            </div>\n          </div>\n        </ml-job-tab-1>\n\n\n        \x3c!-- tab 2 Data Description --\x3e\n        <ml-job-tab-2 ng-show="ui.currentTab === 2">\n          <div class="tab_contents">\n            <div class="form-group">\n              <ml-form-label label-id="new_job_data_format">Data format</ml-form-label>\n              <select\n                aria-labelledby="ml_aria_label_new_job_data_format"\n                aria-describedby="ml_aria_description_new_job_data_format"\n                ng-model="job.data_description.format"\n                ng-disabled="ui.isDatafeed"\n                ng-options="item.value as item.title for item in ui.inputDataFormat"\n                class="form-control">\n              </select>\n            </div>\n            <ml-job-delimited-options ng-show="job.data_description.format===\'delimited\'">\n              <div class="form-group">\n                <ml-form-label label-id="new_job_delimiter">Delimiter</ml-form-label>\n                <select\n                  aria-labelledby="ml_aria_label_new_job_delimiter"\n                  aria-describedby="ml_aria_description_new_job_delimiter"\n                  ng-model="ui.selectedFieldDelimiter"\n                  ng-options="item.value as item.title for item in ui.fieldDelimiterOptions"\n                  class="form-control" />\n              </div>\n              <div class="form-group">\n                <input\n                  ng-model="ui.customFieldDelimiter"\n                  ng-show="ui.selectedFieldDelimiter===\'custom\'"\n                  ng-required="job.data_description.format===\'delimited\' && ui.selectedFieldDelimiter===\'custom\'"\n                  class="form-control" />\n              </div>\n              <div class="form-group">\n                <ml-form-label label-id="new_job_quote_character">Quote character</ml-form-label>\n                <input\n                  aria-labelledby="ml_aria_label_new_job_quote_character"\n                  aria-describedby="ml_aria_description_new_job_quote_character"\n                  ng-model="job.data_description.quote_character"\n                  ng-required="job.data_description.format===\'delimited\'"\n                  placeholder=""\n                  class="form-control" />\n              </div>\n            </ml-job-delimited-options>\n\n            <div class="form-group">\n              <ml-form-label label-id="new_job_time_field">Time field</ml-form-label>\n              <input\n                aria-labelledby="ml_aria_label_new_job_time_field"\n                aria-describedby="ml_aria_description_new_job_time_field"\n                ng-model="job.data_description.time_field"\n                required\n                placeholder=""\n                class="form-control" />\n              <div ng-hide="ui.validation.tabs[2].checks.timeField.valid" class="validation-error">\n                {{ ( ui.validation.tabs[2].checks.timeField.message || "Time field should be specified" ) }}\n              </div>\n            </div>\n\n            <div class="form-group">\n              <ml-form-label label-id="new_job_time_format">Time format</ml-form-label>\n              <input\n                aria-labelledby="ml_aria_label_new_job_time_format"\n                aria-describedby="ml_aria_description_new_job_time_format"\n                ng-model="job.data_description.time_format"\n                required\n                placeholder=""\n                class="form-control" />\n              <div ng-hide="ui.validation.tabs[2].checks.timeFormat.valid" class="validation-error">\n                {{ ( ui.validation.tabs[2].checks.timeFormat.message || "Time format should be specified" ) }}\n              </div>\n              <div class="time-example">{{ ((exampleTime)?"e.g. "+ exampleTime:"") }}</div>\n            </div>\n          </div>\n        </ml-job-tab-2>\n\n        \x3c!-- tab 3 Datafeed --\x3e\n        <ml-job-tab-3 ng-show="ui.currentTab === 3">\n          <div class="tab_contents">\n            <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n              <input\n                aria-labelledby="ml_aria_label_new_job_enable_datafeed_job"\n                aria-describedby="ml_aria_description_new_job_enable_datafeed_job"\n                class=\'kuiCheckBox\'\n                ng-model="ui.isDatafeed"\n                ng-change="datafeedChange()"\n                ng-disabled="job.data_description.format!==\'json\'"\n                type="checkbox" />\n              <span class=\'kuiCheckBoxLabel__text\'>\n                <span id="ml_aria_label_new_job_enable_datafeed_job">Datafeed job</span>\n                <i ml-info-icon="new_job_enable_datafeed_job" />\n              </span>\n            </label>\n            <div class="euiSpacer euiSpacer--s"></div>\n            <div class="form-group help-pane" ng-show="job.data_description.format!==\'json\' && job.data_description.format!==undefined">\n              <small class="info">Data format must be set to \'JSON\' to enable the datafeed.</small>\n            </div>\n\n            <div ng-if="ui.isDatafeed">\n              <div class="form-group">\n                <ml-form-label label-id="new_job_datafeed_query" tooltip-append-to-body="true">Query</ml-form-label>\n                <input\n                  aria-labelledby="ml_aria_label_new_job_datafeed_query"\n                  aria-describedby="ml_aria_description_new_job_datafeed_query"\n                  ng-model="ui.datafeed.queryText"\n                  placeholder=\'{ "match_all": {}}\'\n                  class="form-control" />\n\n              </div>\n              <div class="form-group" >\n                <ml-form-label label-id="new_job_datafeed_query_delay">Query delay</ml-form-label>\n                <input\n                  aria-labelledby="ml_aria_label_new_job_datafeed_query_delay"\n                  aria-describedby="ml_aria_description_new_job_datafeed_query_delay"\n                  ng-model="ui.datafeed.queryDelayText"\n                  placeholder="{{ui.datafeed.queryDelayDefault}}"\n                  min="0"\n                  class="form-control" />\n\n              </div>\n              <div class="form-group" >\n                <ml-form-label label-id="new_job_datafeed_frequency">Frequency</ml-form-label>\n                <input\n                  aria-labelledby="ml_aria_label_new_job_datafeed_frequency"\n                  aria-describedby="ml_aria_description_new_job_datafeed_frequency"\n                  ng-model="ui.datafeed.frequencyText"\n                  placeholder="{{ui.datafeed.frequencyDefault}}"\n                  min="0"\n                  class="form-control" />\n\n              </div>\n              <div class="form-group" >\n                <ml-form-label label-id="new_job_datafeed_scrollsize" tooltip-append-to-body="true">scroll_size</ml-form-label>\n                <input\n                  aria-labelledby="ml_aria_label_new_job_datafeed_scrollsize"\n                  aria-describedby="ml_aria_description_new_job_datafeed_scrollsize"\n                  ng-model="ui.datafeed.scrollSizeText"\n                  placeholder="{{ui.datafeed.scrollSizeDefault}}"\n                  type="number"\n                  min="0"\n                  class="form-control" />\n\n              </div>\n              <div class="form-group" >\n                <div class="form-group">\n                  <label class="kuiFormLabel">Index</label>\n                  <div class="input-group">\n                  <input\n                    ng-model="ui.datafeed.indicesText"\n                    placeholder=""\n                    class="form-control"\n                    aria-describedby="index-text-status"\n                    ng-change="indexChanged()"\n                    list=\'index_datalist\' />\n                    <span class="input-group-addon" id="index-text-status">\n                      <i ng-show="ui.indexTextOk === true && ui.fieldsUpToDate === true" aria-hidden="true" style=\'color:green;\' class="fa fa-check"></i>\n                      <i ng-show="ui.indexTextOk === false || ui.fieldsUpToDate === false" aria-hidden="true" style=\'color:red;\' class="fa fa-remove"></i>\n                    </span>\n                  </div>\n                  <div ng-hide="ui.validation.tabs[3].checks.hasAccessToIndex.valid"  class="validation-error">{{ ( ui.validation.tabs[3].checks.hasAccessToIndex.message) }}</div>\n                </div>\n                <div class="form-group" ng-show="ui.fieldsUpToData === false || ui.fieldsUpToDate === false">\n                  <button\n                    ng-click="loadFields()"\n                    type="button"\n                    class="kuiButton kuiButton--primary kuiButton--small">\n                    <i aria-hidden="true" class="fa fa-refresh"></i>\n                    <span>Reload index</span>\n                  </button>\n                </div>\n\n                <div ng-show="ui.indexTextOk && ui.fieldsUpToDate === true" class="form-group">\n                  <label class="kuiFormLabel">Time-field name</label>\n                  <select\n                    ng-model="job.data_description.time_field"\n                    class="form-control">\n                    <option ng-repeat="(key, value) in dateFields">{{key}}</option>\n                  </select>\n                </div>\n\n                <div class="clearfix"></div>\n\n              </div>\n            </div>\n          </div>\n        </ml-job-tab-3>\n\n        \x3c!-- tab 4 Edit JSON --\x3e\n        <ml-job-tab-4 ng-show="ui.currentTab === 4" class="ml_json_tab">\n          <div class="tab_contents">\n            <label class="kuiFormLabel" id="ml_aria_label_new_job_json">JSON</label>\n            <div\n              class="form-control json-textarea"\n              ui-ace="{\n                mode: \'json\',\n                onChange: jsonTextChange\n              }"\n              ng-model="ui.jsonText"\n              ></div>\n          </div>\n        </ml-job-tab-4>\n\n        \x3c!-- tab 5 Data preview --\x3e\n        <ml-job-tab-5 ng-show="ui.currentTab === 5" class="ml_data_preview_tab">\n          <div class="tab_contents">\n            <ml-form-label label-id="new_job_data_preview">Data preview</ml-form-label>\n            <ml-loading-indicator\n              label="Loading data preview"\n              is-loading="(ui.dataPreview === \'\')"\n            />\n            <div ng-hide="(ui.dataPreview === \'\')">\n              <div\n                id="datafeed-preview"\n                class="form-control json-textarea"\n                ui-ace="{\n                  mode: \'json\',\n                  onLoad: aceLoaded\n                }"\n                ng-model="ui.dataPreview"\n                ></div>\n                <div class="note">\n                  Preview returns the content of the _source field only.\n                </div>\n            </div>\n          </div>\n        </ml-job-tab-5>\n\n        <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n        <div class="euiFlexGroup euiFlexGroup--gutterSmall euiFlexGroup--alignItemsCenter euiFlexGroup--responsive">\n          <div class="euiFlexItem euiFlexItem--flexGrowZero">\n            <ml-validate-job\n              fields="fields"\n              fill="false"\n              get-job-config="getJobConfig"\n              is-current-job-config="isCurrentJobConfig"\n              is-disabled="(saveLock === true)"\n              ng-show="jobState === JOB_STATE.NOT_STARTED"\n            />\n          </div>\n          <div class="euiFlexItem euiFlexItem--flexGrowZero">\n            <button\n              ng-click="save()"\n              ng-disabled="(saveLock === true)"\n              class="euiButton euiButton--primary euiButton--small euiButton--fill"\n              aria-label="Save">\n              <span class="euiButton__content">\n                <span>Save</span>\n              </span>\n            </button>\n          </div>\n          <div class="euiFlexItem euiFlexItem--flexGrowZero">\n            <button\n              ng-click="cancel()"\n              ng-disabled="(saveLock === true)"\n              class="euiButton euiButton--primary euiButton--small euiButton--fill"\n              aria-label="Cancel">\n              <span class="euiButton__content">\n                <span>Cancel</span>\n              </span>\n            </button>\n          </div>\n        </div>\n\n      </div>\n    </div>\n  </div>\n</ml-new-job>\n'},2271:function(module,exports){module.exports='<div class="save-status-modal">\n  \x3c!-- <ml-message-bar ></ml-message-bar> --\x3e\n  <h3 class="euiTitle euiTitle--small">Saving new job</h3>\n  <div class="status-item">Saving job...\n  \t<i ng-show="pscope.ui.saveStatus.job === -1" aria-hidden="true" style="color:red;" class="fa fa-remove"></i>\n  \t<i ng-show="pscope.ui.saveStatus.job === 1" aria-hidden="true" class="fa fa-spinner fa-spin"></i>\n  \t<i ng-show="pscope.ui.saveStatus.job === 2" aria-hidden="true" style="color:green;" class="fa fa-check"></i>\n  </div>\n\n  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n  <button\n    ng-show="(pscope.ui.saveStatus.job === 2 && pscope.ui.isDatafeed)"\n    ng-disabled="pscope.saveLock"\n    ng-click="openDatafeed();"\n    class="kuiButton kuiButton--primary"\n    aria-label="Back">\n      Start datafeed\n  </button>\n\n  <button\n  \tng-disabled="pscope.saveLock"\n    ng-click="close();"\n    class="kuiButton kuiButton--primary"\n    aria-label="Back">\n    \tClose\n  </button>\n</div>\n'},2272:function(module,exports,__webpack_require__){"use strict";var _angular=__webpack_require__(21);var _angular2=_interopRequireDefault(_angular);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);__webpack_require__(2273);__webpack_require__(2278);var _string_utils=__webpack_require__(38);var _detectors_list=__webpack_require__(2280);var _detectors_list2=_interopRequireDefault(_detectors_list);var _detector_modal=__webpack_require__(2281);var _detector_modal2=_interopRequireDefault(_detector_modal);var _detector_filter_modal=__webpack_require__(2282);var _detector_filter_modal2=_interopRequireDefault(_detector_filter_modal);var _job_service=__webpack_require__(23);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlJobDetectorsList",function($modal){return{restrict:"AE",replace:true,scope:{detectors:"=mlDetectors",indices:"=mlIndices",fields:"=mlFields",catFieldNameSelected:"=mlCatFieldNameSelected",editMode:"=mlEditMode",onUpdate:"=mlOnDetectorsUpdate"},template:_detectors_list2.default,controller:function controller($scope){$scope.addDetector=function(dtr,index){if(dtr!==undefined){if(index>=0){$scope.detectors[index]=dtr}else{$scope.detectors.push(dtr)}$scope.onUpdate()}};$scope.removeDetector=function(index){$scope.detectors.splice(index,1);$scope.onUpdate()};$scope.editDetector=function(index){$scope.openNewWindow(index)};$scope.info=function(){};$scope.addFilter=function(dtr,filter,filterIndex){if(dtr.rules===undefined){dtr.rules=[]}if(filterIndex>=0){dtr.rules[filterIndex]=filter}else{dtr.rules.push(filter)}};$scope.removeFilter=function(detector,filterIndex){detector.rules.splice(filterIndex,1)};$scope.editFilter=function(detector,index){$scope.openFilterWindow(detector,index)};$scope.detectorToString=_string_utils.detectorToString;function validateDetector(dtr){if(dtr.exclude_frequent!==undefined&&dtr.exclude_frequent!==""){var exFrqs=["all","none","by","over"];if(_lodash2.default.indexOf(exFrqs,dtr.exclude_frequent.trim())===-1){return{then:function then(callback){callback({success:false,message:'exclude_frequent value must be: "all", "none", "by" or "over"'})}}}}return _job_service.mlJobService.validateDetector(dtr).then(function(resp){return{success:resp.acknowledged||false}}).catch(function(resp){return{success:false,message:resp.message||"Validation failed"}})}$scope.openNewWindow=function(index){index=index!==undefined?index:-1;var dtr=void 0;if(index>=0){dtr=_angular2.default.copy($scope.detectors[index])}$modal.open({template:_detector_modal2.default,controller:"MlDetectorModal",backdrop:"static",keyboard:false,size:"lg",resolve:{params:function params(){return{fields:$scope.fields,validate:validateDetector,detector:dtr,index:index,add:$scope.addDetector,catFieldNameSelected:$scope.catFieldNameSelected}}}})};$scope.openFilterWindow=function(dtr,filterIndex){filterIndex=filterIndex!==undefined?filterIndex:-1;var filter=void 0;if(filterIndex>=0){filter=_angular2.default.copy(dtr.rules[filterIndex])}$modal.open({template:_detector_filter_modal2.default,controller:"MlDetectorFilterModal",backdrop:"static",keyboard:false,size:"lg",resolve:{params:function params(){return{fields:$scope.fields,validate:validateDetector,detector:dtr,filter:filter,index:filterIndex,add:$scope.addFilter}}}})}}}})},2273:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2274);__webpack_require__(2275)},2274:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _angular=__webpack_require__(21);var _angular2=_interopRequireDefault(_angular);var _string_utils=__webpack_require__(38);var _messagebar_service=__webpack_require__(178);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.controller("MlDetectorModal",function($scope,$modalInstance,params){var msgs=_messagebar_service.mlMessageBarService;msgs.clear();$scope.title="Add new detector";$scope.detector={function:""};$scope.saveLock=false;$scope.editMode=false;var index=-1;$scope.functions=[{id:"count",uri:"ml-count-functions.html#ml-count"},{id:"low_count",uri:"ml-count-functions.html#ml-count"},{id:"high_count",uri:"ml-count-functions.html#ml-count"},{id:"non_zero_count",uri:"ml-count-functions.html#ml-nonzero-count"},{id:"low_non_zero_count",uri:"ml-count-functions.html#ml-nonzero-count"},{id:"high_non_zero_count",uri:"ml-count-functions.html#ml-nonzero-count"},{id:"distinct_count",uri:"ml-count-functions.html#ml-distinct-count"},{id:"low_distinct_count",uri:"ml-count-functions.html#ml-distinct-count"},{id:"high_distinct_count",uri:"ml-count-functions.html#ml-distinct-count"},{id:"rare",uri:"ml-rare-functions.html#ml-rare"},{id:"freq_rare",uri:"ml-rare-functions.html#ml-freq-rare"},{id:"info_content",uri:"ml-info-functions.html#ml-info-content"},{id:"low_info_content",uri:"ml-info-functions.html#ml-info-content"},{id:"high_info_content",uri:"ml-info-functions.html#ml-info-content"},{id:"metric",uri:"ml-metric-functions.html#ml-metric-metric"},{id:"median",uri:"ml-metric-functions.html#ml-metric-median"},{id:"low_median",uri:"ml-metric-functions.html#ml-metric-median"},{id:"high_median",uri:"ml-metric-functions.html#ml-metric-median"},{id:"mean",uri:"ml-metric-functions.html#ml-metric-mean"},{id:"low_mean",uri:"ml-metric-functions.html#ml-metric-mean"},{id:"high_mean",uri:"ml-metric-functions.html#ml-metric-mean"},{id:"min",uri:"ml-metric-functions.html#ml-metric-min"},{id:"max",uri:"ml-metric-functions.html#ml-metric-max"},{id:"varp",uri:"ml-metric-functions.html#ml-metric-varp"},{id:"low_varp",uri:"ml-metric-functions.html#ml-metric-varp"},{id:"high_varp",uri:"ml-metric-functions.html#ml-metric-varp"},{id:"sum",uri:"ml-sum-functions.html#ml-sum"},{id:"low_sum",uri:"ml-sum-functions.html#ml-sum"},{id:"high_sum",uri:"ml-sum-functions.html#ml-sum"},{id:"non_null_sum",uri:"ml-sum-functions.html#ml-nonnull-sum"},{id:"low_non_null_sum",uri:"ml-sum-functions.html#ml-nonnull-sum"},{id:"high_non_null_sum",uri:"ml-sum-functions.html#ml-nonnull-sum"},{id:"time_of_day",uri:"ml-time-functions.html#ml-time-of-day"},{id:"time_of_week",uri:"ml-time-functions.html#ml-time-of-week"},{id:"lat_long",uri:"ml-geo-functions.html#ml-lat-long"}];$scope.functionIds={};_lodash2.default.each($scope.functions,function(f){$scope.functionIds[f.id]=""});$scope.fields=params.fields;$scope.fields_byFieldName=_angular2.default.copy($scope.fields);if(params.catFieldNameSelected){$scope.fields_byFieldName.mlcategory="mlcategory"}var validate=params.validate;var add=params.add;if(params.detector){$scope.detector=params.detector;index=params.index;$scope.title="Edit detector";$scope.editMode=true}$scope.detectorToString=_string_utils.detectorToString;$scope.helpLink={};$scope.functionChange=function(){var func=_lodash2.default.findWhere($scope.functions,{id:$scope.detector.function});$scope.helpLink.label="Help for analytical functions";$scope.helpLink.uri="ml-functions.html";if(func){$scope.helpLink.uri=func.uri;$scope.helpLink.label="Help for "+func.id}};$scope.functionChange();$scope.setDetectorProperty=function(value,field){if(value===""||value===undefined){delete $scope.detector[field]}else{$scope.detector[field]=value}if(field==="function"){$scope.functionChange()}};$scope.save=function(){$scope.saveLock=true;validate($scope.detector).then(function(resp){$scope.saveLock=false;if(resp.success){if($scope.detector.detector_description===""){delete $scope.detector.detector_description}add($scope.detector,index);$modalInstance.close($scope.detector);msgs.clear()}else{msgs.error(resp.message)}})};$scope.cancel=function(){msgs.clear();$modalInstance.close()}})},2275:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2276)},2276:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _metadata=__webpack_require__(190);var _modules=__webpack_require__(4);var _documentation_help_link_view=__webpack_require__(2277);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlDocumentationHelpLink",function(){return{scope:{uri:"@mlUri",label:"@mlLabel"},restrict:"AE",replace:true,link:function link(scope,element){var baseUrl="https://www.elastic.co";var version=_metadata.metadata.branch;var props={fullUrl:baseUrl+"/guide/en/x-pack/"+version+"/"+scope.uri,label:scope.label};_reactDom2.default.render(_react2.default.createElement(_documentation_help_link_view.DocumentationHelpLink,props),element[0])}}})},2277:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DocumentationHelpLink=DocumentationHelpLink;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function DocumentationHelpLink(_ref){var fullUrl=_ref.fullUrl,label=_ref.label;return _react2.default.createElement("a",{href:fullUrl,rel:"noopener noreferrer",target:"_blank",className:"documentation-help-link"},label," ",_react2.default.createElement(_eui.EuiIcon,{type:"popout"}))}DocumentationHelpLink.propTypes={fullUrl:_propTypes2.default.string.isRequired,label:_propTypes2.default.string.isRequired}},2278:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2279)},2279:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _angular=__webpack_require__(21);var _angular2=_interopRequireDefault(_angular);var _messagebar_service=__webpack_require__(178);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.controller("MlDetectorFilterModal",function($scope,$modalInstance,params){var msgs=_messagebar_service.mlMessageBarService;msgs.clear();$scope.title="Add new filter";$scope.detector=params.detector;$scope.saveLock=false;$scope.editMode=false;var index=-1;var add=params.add;var validate=params.validate;$scope.fields=[];if($scope.detector.field_name){$scope.fields.push($scope.detector.field_name)}if($scope.detector.by_field_name){$scope.fields.push($scope.detector.by_field_name)}if($scope.detector.over_field_name){$scope.fields.push($scope.detector.over_field_name)}if($scope.detector.partition_field_name){$scope.fields.push($scope.detector.partition_field_name)}if(params.filter===undefined){$scope.filter={ruleAction:"filter_results",target_field_name:"",target_field_value:"",conditions_connective:"or",conditions:[],value_list:[]}}else{$scope.editMode=true;$scope.filter=params.filter;$scope.title="Edit filter";index=params.index}$scope.ui={ruleAction:["filter_results"],target_field_name:"",target_field_value:"",conditions_connective:["or","and"],ruleCondition:{condition_type:[{label:"actual",value:"numerical_actual"},{label:"typical",value:"numerical_typical"},{label:"|actual - typical|",value:"numerical_diff_abs"}],field_name:"",field_value:"",condition:{operator:[{label:"<",value:"lt"},{label:">",value:"gt"},{label:"<=",value:"lte"},{label:">=",value:"gte"}]},value_list:[]}};$scope.addNewCondition=function(){$scope.filter.conditions.push({condition_type:"numerical_actual",field_name:"",field_value:"",condition:{operator:"lt",value:""}})};$scope.removeCondition=function(idx){$scope.filter.conditions.splice(idx,1)};$scope.helpLink={};$scope.save=function(){var filter=_angular2.default.copy($scope.filter);if(!filter.conditions.length){return}$scope.saveLock=true;if(filter.target_field_name===""){delete filter.target_field_name}if(filter.target_field_value===""){delete filter.target_field_value}_lodash2.default.each(filter.conditions,function(cond){delete cond.$$hashKey;if(cond.field_name===""){delete cond.field_vname}if(cond.fieldValue===""){delete cond.fieldValue}});if(filter.value_list&&filter.value_list.length===0){delete filter.value_list}var dtr=_angular2.default.copy($scope.detector);if(dtr.rules===undefined){dtr.rules=[]}if(index>=0){dtr.rules[index]=filter}else{dtr.rules.push(filter)}validate(dtr).then(function(resp){msgs.clear();$scope.saveLock=false;if(resp.success){add($scope.detector,filter,index);$modalInstance.close()}else{msgs.error(resp.message)}})};$scope.cancel=function(){msgs.clear();$modalInstance.close()}})},2280:function(module,exports){module.exports='<div>\n  <div class="form-group">\n    <div ng-repeat="detector in detectors track by $index">\n      <div class="detector" ng-class="{\'detector-edit-mode\':(editMode===\'EDIT\')}">\n        <div class="detector-fields">\n          <label ng-show="editMode===\'EDIT\'">Detector:</label>\n          <div aria-label="Customised description" ng-hide="editMode===\'EDIT\' || detector.detector_description === \'\' || detector.detector_description === detectorToString(detector) ">{{ detector.detector_description }}</div>\n          <div aria-label="Default description" style="font-style:italic;" >{{ detectorToString(detector) }}</div>\n\n          <div ng-show="editMode===\'EDIT\'">\n            <label class="kuiFormLabel">Description:</label>\n            <input\n              ng-model="detector.detector_description"\n              class="form-control" />\n          </div>\n\n        </div>\n\n        <div class="button-container" ng-show="editMode===\'NEW\'">\n          <button\n            ng-click="editDetector($index)"\n            aria-label="Edit"\n            class="kuiButton kuiButton--basic kuiButton--small"\n            data-toggle="tooltip"\n            tooltip="Edit Detector">\n              <i aria-hidden="true" class="fa fa-pencil"></i>\n          </button>\n\n          <button\n            aria-label="Remove Detector"\n            ng-click="removeDetector($index)"\n            tooltip-append-to-body="true"\n            type="button"\n            class="kuiButton kuiButton--danger kuiButton--small remove-button">\n              <i aria-hidden="true" class="fa fa-trash"></i>\n          </button>\n        </div>\n\n      </div>\n\n    </div>\n\n    <div ng-show="editMode===\'NEW\'">\n      <button\n        aria-labelledby="ml_aria_description_new_job_detectors"\n        aria-describedby="ml_aria_label_new_job_add_detector"\n        ng-click="openNewWindow()"\n        type="button"\n        class="kuiButton kuiButton--primary kuiButton--small">\n          <i aria-hidden="true" class="fa fa-plus"></i>\n          <span id="ml_aria_label_new_job_add_detector">Add Detector</span>\n      </button>\n    </div>\n  </div>\n\n</div>\n'},2281:function(module,exports){module.exports='<div class="detector-modal">\n  <ml-message-bar ></ml-message-bar>\n  <h1 class="euiTitle">{{title}}</h1>\n  <div class="euiSpacer euiSpacer--m"></div>\n\n  <div class="form-group">\n    <ml-form-label label-id="new_job_detector_description">Description</ml-form-label>\n    <input\n      aria-labelledby="ml_aria_label_new_job_detector_description"\n      aria-describedby="ml_aria_description_new_job_detector_description"\n      ng-model="detector.detector_description"\n      placeholder="{{ detectorToString(detector) }}"\n      class="form-control" />\n  </div>\n\n  <div class="editor-color detector_field_form">\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_job_detector_function">function</ml-form-label>\n        <field-select\n          label-id=\'"new_job_detector_function"\'\n          on-change=\'setDetectorProperty\'\n          value=\'detector.function\'\n          field=\'"function"\'\n          options=\'functionIds\'>\n        </field-select>\n      </div>\n    </div>\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_job_detector_fieldname">field_name</ml-form-label>\n        <field-select\n          label-id=\'"new_job_detector_fieldname"\'\n          on-change=\'setDetectorProperty\'\n          value=\'detector.field_name\'\n          field=\'"field_name"\'\n          options=\'fields\'>\n        </field-select>\n      </div>\n    </div>\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_job_detector_byfieldname">by_field_name</ml-form-label>\n        <field-select\n          label-id=\'"new_job_detector_byfieldname"\'\n          on-change=\'setDetectorProperty\'\n          value=\'detector.by_field_name\'\n          field=\'"by_field_name"\'\n          options=\'fields_byFieldName\'>\n        </field-select>\n      </div>\n    </div>\n\n  </div>\n  <div class="editor-color detector_field_form">\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_job_detector_overfieldname">over_field_name</ml-form-label>\n        <field-select\n          label-id=\'"new_job_detector_overfieldname"\'\n          on-change=\'setDetectorProperty\'\n          value=\'detector.over_field_name\'\n          field=\'"over_field_name"\'\n          options=\'fields\'>\n        </field-select>\n      </div>\n    </div>\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_job_detector_partitionfieldname">partition_field_name</ml-form-label>\n        <field-select\n          label-id=\'"new_job_detector_partitionfieldname"\'\n          on-change=\'setDetectorProperty\'\n          value=\'detector.partition_field_name\'\n          field=\'"partition_field_name"\'\n          options=\'fields\'>\n        </field-select>\n      </div>\n    </div>\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_job_detector_excludefrequent">exclude_frequent</ml-form-label>\n        <field-select\n          label-id=\'"new_job_detector_excludefrequent"\'\n          on-change=\'setDetectorProperty\'\n          value=\'detector.exclude_frequent\'\n          field=\'"exclude_frequent"\'\n          options=\'{all: "", none: ""}\'>\n        </field-select>\n      </div>\n    </div>\n\n  </div>\n  <small><div class=\'help-pane\'><ml-documentation-help-link ml-uri="{{helpLink.uri}}" ml-label="{{helpLink.label}}"></ml-documentation-help-link></div></small>\n\n  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n  <button\n    ng-click="save()"\n    ng-disabled="(saveLock === true) || (detector.function === \'\')"\n    class="kuiButton kuiButton--primary"\n    aria-label="Save">\n    {{ (editMode? "Update" : "Add") }}\n  </button>\n  <button\n    ng-click="cancel()"\n    ng-disabled="(saveLock === true)"\n    class="kuiButton kuiButton--primary"\n    aria-label="Cancel">\n    Cancel\n  </button>\n</div>\n'},2282:function(module,exports){module.exports='<div class="detector-filter-modal">\n  <ml-message-bar ></ml-message-bar>\n  <h3 class="euiTitle euiTitle--small">{{title}}</h3>\n  <div class="editor-color filter-field-form target-container">\n\n    <datalist id="fields_datalist">\n      <option ng-repeat="field in fields" >{{field}}</option>\n    </datalist>\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_filter_targetfieldname">target_field_name</ml-form-label>\n\n        <input\n          aria-labelledby="ml_aria_label_new_filter_targetfieldname"\n          aria-describedby="ml_aria_description_new_filter_targetfieldname"\n          ng-model="filter.target_field_name"\n          tabindex="2"\n          ng-change="functionChange()"\n          list=\'fields_datalist\'\n          class="form-control" />\n\n        <ml-form-label label-id="new_action_targetfieldvalue">target_field_value</ml-form-label>\n\n        <input\n          aria-labelledby="ml_aria_label_new_action_targetfieldvalue"\n          aria-describedby="ml_aria_description_new_action_targetfieldvalue"\n          ng-model="filter.target_field_value"\n          tabindex="2"\n          ng-change="functionChange()"\n          class="form-control" />\n      </div>\n    </div>\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_action_conditionsconnective">conditions_connective</ml-form-label>\n        <select\n          aria-labelledby="ml_aria_label_new_action_conditionsconnective"\n          aria-describedby="ml_aria_description_new_action_conditionsconnective"\n          ng-model="filter.conditions_connective"\n          tabindex="2"\n          placeholder=""\n          class="form-control">\n            <option ng-repeat="index in ui.conditions_connective" value="{{index}}" >{{index}}</option>\n        </select>\n      </div>\n    </div>\n  </div>\n\n  <div class="conditions-list-container" >\n    <div class="title"><span aria-describedby="ml_aria_description_new_action_ruleconditions">Conditions</span><i ml-info-icon="new_action_ruleconditions" /></div>\n    <div class="table-title">\n      <div><span aria-describedby="ml_aria_description_new_action_conditiontype">Type</span><i ml-info-icon="new_action_conditiontype" /></div>\n      <div><span aria-describedby="ml_aria_description_new_action_fieldname">field_name</span><i ml-info-icon="new_action_fieldname" /></div>\n      <div><span aria-describedby="ml_aria_description_new_action_fieldvalue">field_value</span><i ml-info-icon="new_action_fieldvalue" /></div>\n      <div><span aria-describedby="ml_aria_description_new_action_condition">lt/gt</span><i ml-info-icon="new_action_condition" /></div>\n      <div><span aria-describedby="ml_aria_description_new_action_value">value</span><i ml-info-icon="new_action_value" /></div>\n      <div></div>\n    </div>\n    <div ng-repeat="cond in filter.ruleConditions track by $index" class="rule-condition">\n      <div>\n        <select\n          ng-model="cond.conditionType"\n          placeholder=""\n          class="form-control">\n            <option ng-repeat="type in ui.ruleCondition.conditionType" value="{{type.value}}" >{{type.label}}</option>\n        </select>\n        <div ng-hide="$index === filter.ruleConditions.length-1" class=\'conditions-connective\'>-- {{filter.conditions_connective}} --</div>\n      </div>\n      <div>\n        <select\n          ng-model="cond.field_name"\n          placeholder=""\n          class="form-control">\n            <option ng-repeat="field in fields" >{{field}}</option>\n        </select>\n        \x3c!-- <input\n          ng-model="cond.field_name"\n          tabindex="2"\n          list=\'fields_datalist\'\n          class="form-control" /> --\x3e\n      </div>\n      <div>\n        <input\n          ng-model="cond.field_value"\n          tabindex="2"\n          class="form-control" />\n      </div>\n      <div>\n        <select\n          ng-model="cond.condition.operator"\n          placeholder=""\n          class="form-control">\n            <option ng-repeat="op in ui.ruleCondition.condition.operator" value="{{op.value}}" >{{op.label}}</option>\n        </select>\n      </div>\n      <div>\n        <input\n          ng-model="cond.condition.value"\n          tabindex="2"\n          class="form-control" />\n      </div>\n      <div>\n        <button\n          aria-label="Remove Condition"\n          ng-click="removeCondition($index)"\n          tooltip-append-to-body="true"\n          type="button"\n          class="kuiButton kuiButton--danger kuiButton--small remove-button">\n            <i aria-hidden="true" class="fa fa-trash"></i>\n        </button>\n      </div>\n    </div>\n  </div>\n  <button\n    aria-label="Add new condition"\n    ng-click="addNewCondition()"\n    type="button"\n    class="kuiButton kuiButton--primary kuiButton--small add-new">\n      <i aria-hidden="true" class="fa fa-plus"></i> Add new condition\n  </button>\n\n  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n  <button\n    ng-click="save()"\n    ng-disabled="(saveLock === true || filter.ruleConditions.length === 0)"\n    class="kuiButton kuiButton--primary"\n    aria-label="Save">\n    {{ (editMode? "Update" : "Add") }}\n  </button>\n  <button\n    ng-click="cancel()"\n    ng-disabled="(saveLock === true)"\n    class="kuiButton kuiButton--primary"\n    aria-label="Cancel">\n    Cancel\n  </button>\n</div>\n'},2283:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2284)},2284:function(module,exports,__webpack_require__){"use strict";var _modules=__webpack_require__(4);var _module=_modules.uiModules.get("apps/ml");_module.controller("MlSaveStatusModal",function($scope,$location,$modalInstance,params){$scope.pscope=params.pscope;$scope.ui={showTimepicker:false};$scope.openDatafeed=function(){$location.path("jobs");$modalInstance.close();params.openDatafeed()};$scope.close=function(){if($scope.pscope.ui.saveStatus.job===2){$location.path("jobs")}$scope.pscope.ui.saveStatus.job=0;$modalInstance.close()}})},2285:function(module,exports,__webpack_require__){"use strict";__webpack_require__(53);var _field_select=__webpack_require__(2286);var _modules=__webpack_require__(4);var _module=_modules.uiModules.get("apps/ml",["react"]);_module.directive("fieldSelect",function(reactDirective){return reactDirective(_field_select.FieldSelect)})},2286:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FieldSelect=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _reactSelect=__webpack_require__(3092);var _reactSelect2=_interopRequireDefault(_reactSelect);__webpack_require__(2288);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var FieldSelect=exports.FieldSelect=function(_Component){_inherits(FieldSelect,_Component);function FieldSelect(){_classCallCheck(this,FieldSelect);return _possibleConstructorReturn(this,(FieldSelect.__proto__||Object.getPrototypeOf(FieldSelect)).apply(this,arguments))}_createClass(FieldSelect,[{key:"render",value:function render(){var _props=this.props,labelId=_props.labelId,onChange=_props.onChange,value=_props.value,options=_props.options,field=_props.field,placeholder=_props.placeholder;function change(selection){var val=selection?selection.value:"";onChange(val,field)}function getOptions(){var ops=[];_lodash2.default.each(options,function(op,key){ops.push({label:key,value:key})});return ops}return _react2.default.createElement(_reactSelect2.default,{"aria-describedby":"ml_aria_description_"+labelId,"aria-labelledby":"ml_aria_label_"+labelId,placeholder:placeholder,options:getOptions(),value:value,onChange:change})}}]);return FieldSelect}(_react.Component);FieldSelect.propTypes={labelId:_propTypes2.default.string,onChange:_propTypes2.default.func,value:_propTypes2.default.string,options:_propTypes2.default.object,field:_propTypes2.default.string,placeholder:_propTypes2.default.string}},2288:function(module,exports,__webpack_require__){},2289:function(module,exports,__webpack_require__){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _job_group_select=__webpack_require__(2290);var _job_group_select2=_interopRequireDefault(_job_group_select);var _job_service=__webpack_require__(23);var _calendar_service=__webpack_require__(991);var _compat=__webpack_require__(68);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlJobGroupSelect",function(){return{restrict:"E",template:_job_group_select2.default,scope:{jobGroups:"=",disabled:"=",externalUpdateFunction:"="},controllerAs:"mlGroupSelect",bindToController:true,controller:function(_InitAfterBindingsWor){_inherits(MlGroupSelectController,_InitAfterBindingsWor);function MlGroupSelectController(){_classCallCheck(this,MlGroupSelectController);return _possibleConstructorReturn(this,(MlGroupSelectController.__proto__||Object.getPrototypeOf(MlGroupSelectController)).apply(this,arguments))}_createClass(MlGroupSelectController,[{key:"initAfterBindings",value:function initAfterBindings($scope){var _this2=this;this.$scope=$scope;this.selectedGroups=[];this.groups=[];_job_service.mlJobService.loadJobs().then(function(){var tempGroupIds={};var jobGroups=_job_service.mlJobService.getJobGroups();_this2.groups=jobGroups.map(function(g){tempGroupIds[g.id]=null;return{id:g.id,count:g.jobs.length,isTag:false}});if(Array.isArray(_this2.jobGroups)===false){_this2.jobGroups=[]}_calendar_service.mlCalendarService.loadCalendars(_job_service.mlJobService.jobs).then(function(){var calendarGroups=_calendar_service.mlCalendarService.getCalendarGroups();calendarGroups.forEach(function(g){if(tempGroupIds[g.id]===undefined){_this2.groups.push({id:g.id,count:0,isTag:false})}});_this2.populateSelectedGroups(_this2.jobGroups)}).catch(function(error){console.log("Could not load groups from calendars",error);_this2.populateSelectedGroups(_this2.jobGroups)}).then(function(){$scope.$applyAsync()})});if(this.externalUpdateFunction!==undefined){this.externalUpdateFunction.update=function(groups){_this2.populateSelectedGroups(groups)}}}},{key:"populateSelectedGroups",value:function populateSelectedGroups(groups){var _this3=this;this.selectedGroups=[];groups.forEach(function(gId){var tempGroup=_lodash2.default.filter(_this3.groups,{id:gId});if(tempGroup.length){_this3.selectedGroups.push(tempGroup[0])}else{_this3.selectedGroups.push(_this3.createNewItem(gId))}})}},{key:"onGroupsChanged",value:function onGroupsChanged(){var _this4=this;this.jobGroups.length=0;this.selectedGroups.forEach(function(group){_this4.jobGroups.push(group.id)})}},{key:"createNewItem",value:function createNewItem(groupId){var gId=groupId.toLowerCase();return{id:gId,count:0,isTag:true}}},{key:"groupTypes",value:function groupTypes(group){if(group.isTag===false){return"Existing groups"}}}]);return MlGroupSelectController}(_compat.InitAfterBindingsWorkaround)}})},2290:function(module,exports){module.exports='<div class="ml-job-group-select">\n  <ui-select\n    ng-model="mlGroupSelect.selectedGroups"\n    on-select="mlGroupSelect.onGroupsChanged()"\n    on-remove="mlGroupSelect.onGroupsChanged()"\n    ng-disabled="mlGroupSelect.disabled"\n    multiple\n    tagging=\'mlGroupSelect.createNewItem\'\n    append-to-body=true\n  >\n    <ui-select-match placeholder="Job Group">\n      {{$item.id}}\n    </ui-select-match>\n    <ui-select-choices\n      repeat="group in mlGroupSelect.groups | filter: { id: $select.search }"\n      group-by="mlGroupSelect.groupTypes"\n    >\n      <div ng-if="group.isTag"  class="select-item" ng-bind-html="(group.id | highlight: $select.search) +\' <small>(new group)</small>\'"></div>\n      <div ng-if="!group.isTag" class="select-item" >\n        <div ng-bind-html="group.id | highlight: $select.search"></div>\n        <small>\n          Other jobs in this group: {{group.count}}\n        </small>\n      </div>\n    </ui-select-choices>\n  </ui-select>\n</div>\n'},2291:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2292);__webpack_require__(2294);__webpack_require__(992)},2292:function(module,exports,__webpack_require__){"use strict";var _job_timepicker_modal=__webpack_require__(2293);var _job_timepicker_modal2=_interopRequireDefault(_job_timepicker_modal);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.service("mlDatafeedService",function($modal){this.openJobTimepickerWindow=function(job){$modal.open({template:_job_timepicker_modal2.default,controller:"MlJobTimepickerModal",backdrop:"static",keyboard:false,resolve:{params:function params(){return{job:job}}}})}})},2293:function(module,exports){module.exports='<div class="job-timepicker-modal">\n  <ml-message-bar ></ml-message-bar>\n  <h1 tooltip="Start datafeed for {{jobId}}" class="euiTitle">Start datafeed for {{jobId}}</h1>\n\n  <div class="euiSpacer euiSpacer--s"></div>\n\n  <div class="ml-timepicker-contents" >\n    <div class="row">\n      <div\n        class="ml-timepicker-section"\n        ng-class="{\n          \'ml-timepicker-right-border\':\n            (+ui.startRadio <= 1 && ui.endRadio === \'0\') ||\n            (ui.startRadio === \'2\' && +ui.endRadio <= 1)\n        }">\n        <label class="kuiFormLabel">Search start time</label>\n\n        <div class="ml-timepicker-radios" >\n          <ul class="nav nav-pills nav-stacked">\n            <li ng-class="{ active: ui.startRadio === \'1\' }">\n              <a ng-click="ui.startRadio = \'1\'" >{{ ( isNew?"Start at beginning of data" : "Continue from " + ui.lastTime ) }}</a>\n            </li>\n            <li ng-class="{ active: ui.startRadio === \'0\' }">\n              <a ng-click="ui.startRadio = \'0\'">{{ ( isNew?"Start now" : "Continue from now" ) }}</a>\n            </li>\n            <li ng-class="{ active: ui.startRadio === \'2\' }">\n              <a ng-click="ui.startRadio = \'2\'" ng-class="{\'ml-timepicker-radio-bottom\': ui.startRadio === \'2\'}">{{ ( isNew?"Specify start time" : "Continue from specified time" ) }}</a>\n            </li>\n          </ul>\n        </div>\n        <div class=\'ml-timepicker\' ng-show="ui.startRadio == \'2\'">\n          <div>\n            <input type="text" class="form-control" input-datetime="YYYY-MM-DD HH:mm:ss" ng-model="ui.timepicker.from" >\n          </div>\n          <div>\n            <datepicker\n              offset-timezone\n              ng-model="ui.timepicker.from"\n              show-weeks="false">\n            </datepicker>\n          </div>\n        </div>\n      </div>\n\n      <div class="ml-timepicker-section"\n        ng-class="{\n          \'ml-timepicker-left-border\':\n            (+ui.startRadio <= 1 && ui.endRadio === \'1\')\n        }">\n        <label class="kuiFormLabel">Search end time</label>\n        <div class="ml-timepicker-radios" >\n          <ul class="nav nav-pills nav-stacked">\n            <li ng-class="{ active: ui.endRadio === \'0\' }">\n              <a ng-click="ui.endRadio = \'0\'">No end time (Real-time search)</a>\n            </li>\n            <li ng-class="{ active: ui.endRadio === \'1\' }">\n              <a ng-click="ui.endRadio = \'1\'" ng-class="{\'ml-timepicker-radio-bottom\': ui.endRadio === \'1\'}">Specify end time</a>\n            </li>\n          </ul>\n        </div>\n        <div class=\'ml-timepicker\' ng-show="ui.endRadio == \'1\'">\n          <div>\n            <input type="text" class="form-control" input-datetime="{{format}}" ng-model="ui.timepicker.to">\n          </div>\n          <div>\n            <datepicker\n              offset-timezone\n              ng-model="ui.timepicker.to"\n              show-weeks="false">\n            </datepicker>\n          </div>\n        </div>\n      </div>\n    </div>\n\n  </div>\n\n  <div ng-if="ui.endRadio === \'0\' && watcherEnabled">\n    <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n    <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n      <input ng-model=\'ui.createWatch\' type="checkbox" class=\'kuiCheckBox\'/>\n      <span class="kuiCheckBoxLabel__text">\n        Create watch after datafeed has started\n      </span>\n    </label>\n  </div>\n  <div class="clearfix"></div>\n\n  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n  <button\n    ng-click="save()"\n    ng-disabled="(\n      saveLock === true ||\n      ( ui.startRadio===\'2\' && ui.timepicker.from===\'\' ) ||\n      ( ui.endRadio===\'1\' && ui.timepicker.to===\'\' )\n    )"\n    class="kuiButton kuiButton--primary" >\n    Start\n  </button>\n  <button\n    ng-click="cancel()"\n    ng-disabled="(saveLock === true)"\n    class="kuiButton kuiButton--primary"\n    aria-label="Cancel">\n    Cancel\n  </button>\n\n</div>\n'},2294:function(module,exports,__webpack_require__){"use strict";var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _angular=__webpack_require__(21);var _angular2=_interopRequireDefault(_angular);var _job_service=__webpack_require__(23);var _messagebar_service=__webpack_require__(178);var _check_license=__webpack_require__(43);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.controller("MlJobTimepickerModal",function($scope,$rootScope,$modalInstance,params,Private){var msgs=_messagebar_service.mlMessageBarService;$scope.saveLock=false;var xpackFeature=Private(_check_license.xpackFeatureProvider);$scope.watcherEnabled=xpackFeature.isAvailable("watcher");var job=_angular2.default.copy(params.job);$scope.jobId=job.job_id;$scope.datafeedId=_job_service.mlJobService.getDatafeedId(job.job_id);$scope.start="";$scope.end="";var lastTime="";if(job.data_counts&&job.data_counts.latest_record_timestamp){var time=(0,_moment2.default)(job.data_counts.latest_record_timestamp);lastTime=time.format("YYYY-MM-DD HH:mm:ss")}$scope.isNew=job.data_counts&&job.data_counts.input_record_count>0?false:true;$scope.ui={lastTime:lastTime,startDateText:"",startRadio:"1",endDateText:"",endRadio:"1",timepicker:{from:"",to:(0,_moment2.default)()},setStartRadio:function setStartRadio(i){$scope.ui.startRadio=i},createWatch:false};function extractForm(){if($scope.ui.startRadio==="0"){$scope.start="now"}else if($scope.ui.startRadio==="1"){$scope.start="0"}else if($scope.ui.startRadio==="2"){$scope.start=(0,_moment2.default)($scope.ui.timepicker.from).unix()*1e3}if($scope.ui.endRadio==="0"){$scope.end=undefined}else if($scope.ui.endRadio==="1"){$scope.end=(0,_moment2.default)($scope.ui.timepicker.to).unix()*1e3}}$scope.save=function(){$scope.saveLock=true;extractForm();var doStartCalled=false;window.setTimeout(doStart,1e4);_job_service.mlJobService.openJob($scope.jobId).then(function(){doStart()}).catch(function(resp){if(resp.statusCode===409){doStart()}else{if(resp.statusCode===500){if(doStartCalled===false){msgs.error("Could not open "+$scope.jobId,resp)}}else{msgs.error("Could not open "+$scope.jobId,resp)}$scope.saveLock=false}});function doStart(){if(doStartCalled===false){doStartCalled=true;_job_service.mlJobService.startDatafeed($scope.datafeedId,$scope.jobId,$scope.start,$scope.end).then(function(){$rootScope.$broadcast("jobsUpdated");if($scope.ui.createWatch){$rootScope.$broadcast("openCreateWatchWindow",job)}}).catch(function(){$scope.saveLock=false})}}$modalInstance.close();window.setTimeout(function(){$rootScope.$broadcast("jobsUpdated")},500)};$scope.cancel=function(){$modalInstance.close()}})},2295:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _parse_interval=__webpack_require__(196);var _create_watch_service=__webpack_require__(337);var _create_watch=__webpack_require__(2296);var _create_watch2=_interopRequireDefault(_create_watch);var _ml_api_service=__webpack_require__(22);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlCreateWatch",function(){return{restrict:"AE",replace:false,scope:{jobId:"=",bucketSpan:"=",embedded:"="},template:_create_watch2.default,link:function link($scope){$scope.config=_create_watch_service.mlCreateWatchService.config;$scope.status=_create_watch_service.mlCreateWatchService.status;$scope.STATUS=_create_watch_service.mlCreateWatchService.STATUS;$scope.ui={emailEnabled:false,embedded:$scope.embedded,watchAlreadyExists:false};if($scope.bucketSpan){var interval=(0,_parse_interval.parseInterval)($scope.bucketSpan);var bs=interval.asMinutes()*2;if(bs<1){bs=1}$scope.config.interval=bs+"m"}_ml_api_service.ml.getNotificationSettings().then(function(resp){if(_lodash2.default.has(resp,"defaults.xpack.notification.email")){$scope.ui.emailEnabled=true;$scope.$applyAsync()}});_create_watch_service.mlCreateWatchService.loadWatch($scope.jobId).then(function(){$scope.ui.watchAlreadyExists=true}).catch(function(){$scope.ui.watchAlreadyExists=false}).then(function(){$scope.$applyAsync()})}}})},2296:function(module,exports){module.exports='<div class="create-watch" ng-class="{\'create-watch-embedded\': ui.embedded}">\n\t<div ng-show="status.watch===null || status.watch===STATUS.SAVING || status.watch===STATUS.SAVE_FAILED">\n\t\t<div class="form-group">\n\t\t\t<div class="sub-form-group">\n\t\t\t\t<label for="selectInterval" class="kuiFormLabel kuiVerticalRhythm">Time range</label><br />\n\t\t\t\tNow - <input id="selectInterval" ng-model="config.interval" type="text" class="kuiTextInput kuiTextInput--small interval" placeholder="m">\n\t\t\t</div>\n\n\t\t\t<div class="sub-form-group">\n\t\t\t\t<label for="selectSeverity" class="kuiFormLabel kuiVerticalRhythm">Severity threshold</label><br />\n\t\t\t\t\t<div class="dropdown-group">\n\t\t\t\t\t\t<ml-severity-control\n\t\t\t\t\t\t\tconfig=\'config\'\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t    </div>\n\t\t</div>\n\t\t<div ng-show="ui.emailEnabled" class="form-group">\n\t\t\t<label for="sendEmail" class="kuiCheckBoxLabel kuiVerticalRhythm">\n\t\t\t\t<input id="sendEmail" ng-model="config.includeEmail" type="checkbox" class="kuiCheckBox" />\n\t\t\t\t<span class="kuiCheckBoxLabel__text">Send email</span>\n\t\t\t</label>\n\t\t\t<div ng-show="config.includeEmail" class="email-section">\n\t\t\t\t<input type="text" ng-model="config.email" class="kuiTextInput kuiTextInput--large" placeholder="email address">\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div ng-if="ui.watchAlreadyExists" class="watch-exists-warning">\n\t\t\tWarning, watch ml-{{jobId}} already exists, clicking apply will overwrite the original.\n\t\t</div>\n\n\t</div>\n\n\t<div ng-show="status.watch===STATUS.SAVED">\n\t\t<div>Watch: <strong>{{config.id}}</strong> created</div>\n\t\t<br />\n\t\t<div>\n\t\t\t<a href="{{config.watcherEditURL}}" target="_blank" rel="noopener noreferrer">Edit {{config.id}} in Watcher <i class="fa fa-external-link"></i></a>\n\t\t</div>\n\t</div>\n\n</div>\n'},2297:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2298)},2298:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _select_severity=__webpack_require__(633);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlSeverityControl",function(){return{restrict:"AE",replace:false,scope:{config:"="},link:function link($scope,$element){$scope.handleThresholdChange=function(th){$scope.config.threshold=th};var props={onChangeHandler:$scope.handleThresholdChange,classNames:"form-control dropdown-toggle"};_reactDom2.default.render(_react2.default.createElement(_select_severity.SelectSeverity,props),$element[0])}}})},2299:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2300)},23:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mlJobService=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _angular=__webpack_require__(21);var _angular2=_interopRequireDefault(_angular);var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _parse_interval=__webpack_require__(196);var _ml_api_service=__webpack_require__(22);var _messagebar_service=__webpack_require__(178);var _string_utils=__webpack_require__(38);var _job_utils=__webpack_require__(34);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var msgs=_messagebar_service.mlMessageBarService;var jobs=[];var datafeedIds={};var JobService=function(){function JobService(){_classCallCheck(this,JobService);this.currentJob=undefined;this.jobs=[];this.basicJobs={};this.jobDescriptions={};this.detectorsByJob={};this.customUrlsByJob={};this.jobStats={activeNodes:{label:"Active ML Nodes",value:0,show:true},total:{label:"Total jobs",value:0,show:true},open:{label:"Open jobs",value:0,show:true},closed:{label:"Closed jobs",value:0,show:true},failed:{label:"Failed jobs",value:0,show:false},activeDatafeeds:{label:"Active datafeeds",value:0,show:true}};this.jobUrls={}}_createClass(JobService,[{key:"getBlankJob",value:function getBlankJob(){return{job_id:"",description:"",groups:[],analysis_config:{bucket_span:"15m",influencers:[],detectors:[]},data_description:{time_field:"",time_format:"",field_delimiter:"",quote_character:'"',format:"delimited"}}}},{key:"loadJobs",value:function loadJobs(){var _this=this;return new Promise(function(resolve,reject){jobs=[];datafeedIds={};_ml_api_service.ml.getJobs().then(function(resp){_angular2.default.copy(resp.jobs,jobs);_ml_api_service.ml.getJobStats().then(function(statsResp){for(var i=0;i<jobs.length;i++){var job=jobs[i];job.data_counts={};job.model_size_stats={};job.datafeed_config={};for(var j=0;j<statsResp.jobs.length;j++){if(job.job_id===statsResp.jobs[j].job_id){var jobStats=_angular2.default.copy(statsResp.jobs[j]);job.state=jobStats.state;job.data_counts=jobStats.data_counts;job.model_size_stats=jobStats.model_size_stats;if(jobStats.node){job.node=jobStats.node}if(jobStats.open_time){job.open_time=jobStats.open_time}}}}_this.loadDatafeeds().then(function(datafeedsResp){for(var _i=0;_i<jobs.length;_i++){for(var _j=0;_j<datafeedsResp.datafeeds.length;_j++){if(jobs[_i].job_id===datafeedsResp.datafeeds[_j].job_id){jobs[_i].datafeed_config=datafeedsResp.datafeeds[_j];datafeedIds[jobs[_i].job_id]=datafeedsResp.datafeeds[_j].datafeed_id}}}processBasicJobInfo(_this,jobs);_this.jobs=jobs;createJobStats(_this.jobs,_this.jobStats);createJobUrls(_this.jobs,_this.jobUrls);resolve({jobs:_this.jobs})})}).catch(function(err){error(err)})}).catch(function(err){error(err)});function error(err){console.log("jobService error getting list of jobs:",err);msgs.error("Jobs list could not be retrieved");msgs.error("",err);reject({jobs:jobs,err:err})}})}},{key:"refreshJob",value:function refreshJob(jobId){var _this2=this;return new Promise(function(resolve,reject){_ml_api_service.ml.getJobs({jobId:jobId}).then(function(resp){var newJob={};if(resp.jobs&&resp.jobs.length){_angular2.default.copy(resp.jobs[0],newJob);_ml_api_service.ml.getJobStats({jobId:jobId}).then(function(statsResp){for(var j=0;j<statsResp.jobs.length;j++){if(newJob.job_id===statsResp.jobs[j].job_id){var statsJob=statsResp.jobs[j];newJob.state=statsJob.state;newJob.data_counts={};newJob.model_size_stats={};_angular2.default.copy(statsJob.data_counts,newJob.data_counts);_angular2.default.copy(statsJob.model_size_stats,newJob.model_size_stats);if(newJob.node){_angular2.default.copy(statsJob.node,newJob.node)}if(statsJob.open_time){newJob.open_time=statsJob.open_time}}}for(var i=0;i<jobs.length;i++){if(jobs[i].job_id===newJob.job_id){jobs[i]=newJob}}var datafeedId=_this2.getDatafeedId(jobId);_this2.loadDatafeeds(datafeedId).then(function(datafeedsResp){for(var _i2=0;_i2<jobs.length;_i2++){for(var _j2=0;_j2<datafeedsResp.datafeeds.length;_j2++){if(jobs[_i2].job_id===datafeedsResp.datafeeds[_j2].job_id){jobs[_i2].datafeed_config=datafeedsResp.datafeeds[_j2];datafeedIds[jobs[_i2].job_id]=datafeedsResp.datafeeds[_j2].datafeed_id}}}_this2.jobs=jobs;createJobStats(_this2.jobs,_this2.jobStats);createJobUrls(_this2.jobs,_this2.jobUrls);resolve({jobs:_this2.jobs})})}).catch(function(err){error(err)})}}).catch(function(err){error(err)});function error(err){console.log("JobService error getting list of jobs:",err);msgs.error("Jobs list could not be retrieved");msgs.error("",err);reject({jobs:jobs,err:err})}})}},{key:"loadDatafeeds",value:function loadDatafeeds(datafeedId){return new Promise(function(resolve,reject){var datafeeds=[];var sId=datafeedId!==undefined?{datafeed_id:datafeedId}:undefined;_ml_api_service.ml.getDatafeeds(sId).then(function(resp){_angular2.default.copy(resp.datafeeds,datafeeds);_ml_api_service.ml.getDatafeedStats().then(function(statsResp){for(var i=0;i<datafeeds.length;i++){var datafeed=datafeeds[i];for(var j=0;j<statsResp.datafeeds.length;j++){if(datafeed.datafeed_id===statsResp.datafeeds[j].datafeed_id){datafeed.state=statsResp.datafeeds[j].state}}}resolve({datafeeds:datafeeds})}).catch(function(err){error(err)})}).catch(function(err){error(err)});function error(err){console.log("loadDatafeeds error getting list of datafeeds:",err);msgs.error("datafeeds list could not be retrieved");msgs.error("",err);reject({jobs:jobs,err:err})}})}},{key:"updateSingleJobDatafeedState",value:function updateSingleJobDatafeedState(jobId){var _this3=this;return new Promise(function(resolve,reject){var datafeedId=_this3.getDatafeedId(jobId);_ml_api_service.ml.getDatafeedStats({datafeedId:datafeedId}).then(function(resp){var datafeeds=resp.datafeeds;var state="UNKNOWN";if(datafeeds&&datafeeds.length){state=datafeeds[0].state}resolve(state)}).catch(function(resp){reject(resp)})})}},{key:"saveNewJob",value:function saveNewJob(job){function func(resp){console.log("Response for job query:",resp);var success=checkSaveResponse(resp,job);return{success:success,job:job,resp:resp}}return _ml_api_service.ml.addJob({jobId:job.job_id,job:job}).then(func).catch(func)}},{key:"cloneJob",value:function cloneJob(job){var tempJob=_angular2.default.copy(job);delete tempJob.state;delete tempJob.job_version;delete tempJob.data_counts;delete tempJob.create_time;delete tempJob.finished_time;delete tempJob.last_data_time;delete tempJob.model_size_stats;delete tempJob.node;delete tempJob.average_bucket_processing_time_ms;delete tempJob.model_snapshot_id;delete tempJob.open_time;delete tempJob.established_model_memory;delete tempJob.calendars;delete tempJob.analysis_config.use_per_partition_normalization;_lodash2.default.each(tempJob.analysis_config.detectors,function(d){delete d.detector_index});if(tempJob.datafeed_config){delete tempJob.datafeed_config.datafeed_id;delete tempJob.datafeed_config.job_id;delete tempJob.datafeed_config.state;delete tempJob.datafeed_config.node;if(tempJob.datafeed_config.query_delay){var interval=(0,_parse_interval.parseInterval)(tempJob.datafeed_config.query_delay);if(interval!==null){var queryDelay=interval.asSeconds();if(queryDelay>60&&queryDelay<120){delete tempJob.datafeed_config.query_delay}}}}if(tempJob.custom_settings&&tempJob.custom_settings.created_by){delete tempJob.custom_settings.created_by}return tempJob}},{key:"updateJob",value:function updateJob(jobId,job){return _ml_api_service.ml.updateJob({jobId:jobId,job:job}).then(function(resp){console.log("update job",resp);return{success:true}}).catch(function(err){msgs.error("Could not update job: "+jobId);console.log("update job",err);return{success:false,message:err.message}})}},{key:"validateJob",value:function validateJob(obj){return _ml_api_service.ml.validateJob(obj).then(function(messages){console.log("validate job",messages);return{success:true,messages:messages}}).catch(function(err){msgs.error("Job Validation Error: "+err.message);console.log("validate job",err);return{success:false,messages:[{status:"error",text:err.message}]}})}},{key:"getJob",value:function getJob(jobId){var job=_lodash2.default.find(jobs,function(j){return j.job_id===jobId});return job}},{key:"searchPreview",value:function searchPreview(job){return new Promise(function(resolve,reject){if(job.datafeed_config){var query={match_all:{}};if(job.datafeed_config.query){query=job.datafeed_config.query}_ml_api_service.ml.getTimeFieldRange({index:job.datafeed_config.indices,timeFieldName:job.data_description.time_field,query:query}).then(function(timeRange){var bucketSpan=(0,_parse_interval.parseInterval)(job.analysis_config.bucket_span);var earliestMs=timeRange.start.epoch;var latestMs=+timeRange.start.epoch+10*bucketSpan.asMilliseconds();var body={query:{bool:{must:[{range:_defineProperty({},job.data_description.time_field,{gte:earliestMs,lt:latestMs,format:"epoch_millis"})},query]}}};var aggregations=job.datafeed_config.aggs||job.datafeed_config.aggregations;if(aggregations&&Object.keys(aggregations).length){body.size=0;body.aggregations=aggregations;var scriptFields=job.datafeed_config.script_fields;if(scriptFields&&Object.keys(scriptFields).length){body.script_fields=scriptFields}}else{body.size=_job_utils.ML_DATA_PREVIEW_COUNT;var _scriptFields=job.datafeed_config.script_fields;if(_scriptFields&&Object.keys(_scriptFields).length){body.script_fields=_scriptFields}var fields={};if(job.analysis_config.detectors){_lodash2.default.each(job.analysis_config.detectors,function(dtr){if(dtr.by_field_name){fields[dtr.by_field_name]={}}if(dtr.field_name){fields[dtr.field_name]={}}if(dtr.over_field_name){fields[dtr.over_field_name]={}}if(dtr.partition_field_name){fields[dtr.partition_field_name]={}}})}if(job.analysis_config.influencers){_lodash2.default.each(job.analysis_config.influencers,function(inf){fields[inf]={}})}if(job.analysis_config.categorization_field_name){fields[job.analysis_config.categorization_field_name]={}}if(job.analysis_config.summary_count_field_name){fields[job.analysis_config.summary_count_field_name]={}}if(job.data_description.time_field){fields[job.data_description.time_field]={}}var fieldsList=Object.keys(fields);if(fieldsList.length){body._source=fieldsList}}var data={index:job.datafeed_config.indices,body:body};_ml_api_service.ml.esSearch(data).then(function(resp){resolve(resp)}).catch(function(resp){reject(resp)})}).catch(function(resp){reject(resp)})}})}},{key:"openJob",value:function openJob(jobId){return _ml_api_service.ml.openJob({jobId:jobId})}},{key:"closeJob",value:function closeJob(jobId){return _ml_api_service.ml.closeJob({jobId:jobId})}},{key:"saveNewDatafeed",value:function saveNewDatafeed(datafeedConfig,jobId){var datafeedId="datafeed-"+jobId;datafeedConfig.job_id=jobId;return _ml_api_service.ml.addDatafeed({datafeedId:datafeedId,datafeedConfig:datafeedConfig})}},{key:"updateDatafeed",value:function updateDatafeed(datafeedId,datafeedConfig){return _ml_api_service.ml.updateDatafeed({datafeedId:datafeedId,datafeedConfig:datafeedConfig}).then(function(resp){console.log("update datafeed",resp);return{success:true}}).catch(function(err){msgs.error("Could not update datafeed: "+datafeedId);console.log("update datafeed",err);return{success:false,message:err.message}})}},{key:"startDatafeed",value:function startDatafeed(datafeedId,jobId,start,end){return new Promise(function(resolve,reject){if(_lodash2.default.isNumber(end)){end++}_ml_api_service.ml.startDatafeed({datafeedId:datafeedId,start:start,end:end}).then(function(resp){resolve(resp)}).catch(function(err){console.log("jobService error starting datafeed:",err);msgs.error("Could not start datafeed for "+jobId,err);reject(err)})})}},{key:"stopDatafeed",value:function stopDatafeed(datafeedId,jobId){return new Promise(function(resolve,reject){_ml_api_service.ml.stopDatafeed({datafeedId:datafeedId}).then(function(resp){resolve(resp)}).catch(function(err){console.log("jobService error stopping datafeed:",err);if(err.statusCode===500){msgs.error("Could not stop datafeed for "+jobId);msgs.error("Request may have timed out and may still be running in the background.")}else{msgs.error("Could not stop datafeed for "+jobId,err)}reject(err)})})}},{key:"forceStartDatafeeds",value:function forceStartDatafeeds(dIds,start,end){return _ml_api_service.ml.jobs.forceStartDatafeeds(dIds,start,end)}},{key:"stopDatafeeds",value:function stopDatafeeds(dIds){return _ml_api_service.ml.jobs.stopDatafeeds(dIds)}},{key:"deleteJobs",value:function deleteJobs(jIds){return _ml_api_service.ml.jobs.deleteJobs(jIds)}},{key:"closeJobs",value:function closeJobs(jIds){return _ml_api_service.ml.jobs.closeJobs(jIds)}},{key:"validateDetector",value:function validateDetector(detector){return new Promise(function(resolve,reject){if(detector){_ml_api_service.ml.validateDetector({detector:detector}).then(function(resp){resolve(resp)}).catch(function(resp){reject(resp)})}else{reject({})}})}},{key:"getDatafeedId",value:function getDatafeedId(jobId){var datafeedId=datafeedIds[jobId];if(datafeedId===undefined){datafeedId="datafeed-"+jobId}return datafeedId}},{key:"getDatafeedPreview",value:function getDatafeedPreview(jobId){var datafeedId=this.getDatafeedId(jobId);return _ml_api_service.ml.datafeedPreview({datafeedId:datafeedId})}},{key:"getJobGroups",value:function getJobGroups(){var groups=[];var tempGroups={};this.jobs.forEach(function(job){if(Array.isArray(job.groups)){job.groups.forEach(function(group){if(tempGroups[group]===undefined){tempGroups[group]=[job]}else{tempGroups[group].push(job)}})}});_lodash2.default.each(tempGroups,function(js,id){groups.push({id:id,jobs:js})});return groups}},{key:"createResultsUrl",value:function createResultsUrl(jobIds,from,to,resultsPage){return _createResultsUrl(jobIds,from,to,resultsPage)}}]);return JobService}();function checkSaveResponse(resp,origJob){if(resp){if(resp.job_id){if(resp.job_id===origJob.job_id){console.log("checkSaveResponse(): save successful");return true}}else{if(resp.errorCode){console.log("checkSaveResponse(): save failed",resp);return false}}}else{console.log("checkSaveResponse(): response is empty");return false}}function processBasicJobInfo(localJobService,jobsList){var processedJobsList=[];var detectorsByJob={};var customUrlsByJob={};var jobsListCopy=_lodash2.default.cloneDeep(jobsList);_lodash2.default.each(jobsListCopy,function(jobObj){var analysisConfig=jobObj.analysis_config;var bucketSpan=(0,_parse_interval.parseInterval)(analysisConfig.bucket_span);var job={id:jobObj.job_id,bucketSpanSeconds:bucketSpan.asSeconds()};if(_lodash2.default.has(jobObj,"description")&&/^\s*$/.test(jobObj.description)===false){job.description=jobObj.description}else{job.description=jobObj.job_id}job.detectors=_lodash2.default.get(analysisConfig,"detectors",[]);detectorsByJob[job.id]=job.detectors;if(_lodash2.default.has(jobObj,"custom_settings.custom_urls")){job.customUrls=[];_lodash2.default.each(jobObj.custom_settings.custom_urls,function(url){if(_lodash2.default.has(url,"url_name")&&_lodash2.default.has(url,"url_value")&&(0,_string_utils.isWebUrl)(url.url_value)){job.customUrls.push(url)}});if(job.customUrls.length>0){customUrlsByJob[job.id]=job.customUrls}}localJobService.jobDescriptions[job.id]=job.description;localJobService.basicJobs[job.id]=job;processedJobsList.push(job)});localJobService.detectorsByJob=detectorsByJob;localJobService.customUrlsByJob=customUrlsByJob;return processedJobsList}function createJobStats(jobsList,jobStats){jobStats.activeNodes.value=0;jobStats.total.value=0;jobStats.open.value=0;jobStats.closed.value=0;jobStats.failed.value=0;jobStats.activeDatafeeds.value=0;var mlNodes={};var failedJobs=0;_lodash2.default.each(jobsList,function(job){if(job.state==="opened"){jobStats.open.value++}else if(job.state==="closed"){jobStats.closed.value++}else if(job.state==="failed"){failedJobs++}if(job.datafeed_config&&job.datafeed_config.state==="started"){jobStats.activeDatafeeds.value++}if(job.node&&job.node.name){mlNodes[job.node.name]={}}});jobStats.total.value=jobsList.length;if(failedJobs){jobStats.failed.value=failedJobs;jobStats.failed.show=true}else{jobStats.failed.show=false}jobStats.activeNodes.value=Object.keys(mlNodes).length}function createJobUrls(jobsList,jobUrls){_lodash2.default.each(jobsList,function(job){if(job.data_counts){var from=(0,_moment2.default)(job.data_counts.earliest_record_timestamp).toISOString();var to=(0,_moment2.default)(job.data_counts.latest_record_timestamp).toISOString();var path=_createResultsUrl([job.job_id],to,from);if(jobUrls[job.job_id]){jobUrls[job.job_id].url=path}else{jobUrls[job.job_id]={url:path}}}})}function _createResultsUrl(jobIds,start,end,resultsPage){var idString=jobIds.map(function(j){return"'"+j+"'"}).join(",");var from=(0,_moment2.default)(start).toISOString();var to=(0,_moment2.default)(end).toISOString();var path="";if(resultsPage!==undefined){path+="ml#/";path+=resultsPage}path+="?_g=(ml:(jobIds:!("+idString+"))";path+=",refreshInterval:(display:Off,pause:!f,value:0),time:(from:'"+from+"'";path+=",mode:absolute,to:'"+to+"'";path+="))&_a=(filters:!(),query:(query_string:(analyze_wildcard:!t,query:'*')))";return path}var mlJobService=exports.mlJobService=new JobService},2300:function(module,exports,__webpack_require__){"use strict";__webpack_require__(53);var _modules=__webpack_require__(4);var _enable_model_plot_callout_view=__webpack_require__(2301);var _module=_modules.uiModules.get("apps/ml",["react"]);_module.directive("mlEnableModelPlotCallout",function(reactDirective){return reactDirective(_enable_model_plot_callout_view.EnableModelPlotCallout,undefined,{restrict:"E"})})},2301:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EnableModelPlotCallout=undefined;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EnableModelPlotCallout=exports.EnableModelPlotCallout=function EnableModelPlotCallout(_ref){var message=_ref.message;return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_eui.EuiFlexGroup,{direction:"column"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiCallOut,{title:"Proceed with caution!",color:"warning",iconType:"help"},_react2.default.createElement("p",null,message)))))};EnableModelPlotCallout.propTypes={message:_propTypes2.default.string.isRequired}},2302:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2303)},2303:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2304);__webpack_require__(995);__webpack_require__(2309);__webpack_require__(209);__webpack_require__(339);__webpack_require__(472);__webpack_require__(639);__webpack_require__(2313);__webpack_require__(406);__webpack_require__(473);__webpack_require__(274)},2304:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _index=__webpack_require__(293);var _validation_utils=__webpack_require__(470);var _parse_interval=__webpack_require__(219);var _datemath=__webpack_require__(57);var _datemath2=_interopRequireDefault(_datemath);var _angular=__webpack_require__(21);var _angular2=_interopRequireDefault(_angular);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _job_utils=__webpack_require__(34);var _check_license=__webpack_require__(43);var _check_privilege=__webpack_require__(32);var _ml_time_buckets=__webpack_require__(258);var _filter_agg_types=__webpack_require__(635);var _validate_job=__webpack_require__(469);var _adjust_interval=__webpack_require__(636);var _create_fields=__webpack_require__(637);var _change_job_id_case=__webpack_require__(994);var _states=__webpack_require__(407);var _index_utils=__webpack_require__(62);var _check_ml_nodes=__webpack_require__(47);var _new_job_defaults=__webpack_require__(241);var _new_job_utils=__webpack_require__(220);var _job_service=__webpack_require__(23);var _prepopulate_job_settings=__webpack_require__(638);var _create_job_service=__webpack_require__(995);var _full_time_range_selector_service=__webpack_require__(471);var _messagebar_service=__webpack_require__(178);var _create_job=__webpack_require__(2308);var _create_job2=_interopRequireDefault(_create_job);var _timefilter=__webpack_require__(16);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_routes2.default.when("/jobs/new_job/simple/single_metric",{template:_create_job2.default,resolve:{CheckLicense:_check_license.checkLicenseExpired,privileges:_check_privilege.checkCreateJobsPrivilege,indexPattern:_index_utils.loadCurrentIndexPattern,savedSearch:_index_utils.loadCurrentSavedSearch,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable,loadNewJobDefaults:_new_job_defaults.loadNewJobDefaults}});var _module=_modules.uiModules.get("apps/ml");_module.controller("MlCreateSingleMetricJob",function($scope,$route,$filter,$timeout,Private,AppState){_timefilter.timefilter.enableTimeRangeSelector();_timefilter.timefilter.disableAutoRefreshSelector();var msgs=_messagebar_service.mlMessageBarService;var MlTimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider);var moveToAdvancedJobCreation=Private(_new_job_utils.moveToAdvancedJobCreationProvider);var mlSingleMetricJobService=Private(_create_job_service.SingleMetricJobServiceProvider);var mlFullTimeRangeSelectorService=Private(_full_time_range_selector_service.FullTimeRangeSelectorServiceProvider);var stateDefaults={mlJobSettings:{}};var appState=new AppState(stateDefaults);$scope.index=$route.current.params.index;$scope.chartData=mlSingleMetricJobService.chartData;$scope.changeJobIDCase=_change_job_id_case.changeJobIDCase;$scope.addNewJobToRecentlyAccessed=_new_job_utils.addNewJobToRecentlyAccessed;var PAGE_WIDTH=_angular2.default.element(".single-metric-job-container").width();var BAR_TARGET=PAGE_WIDTH>2e3?1e3:PAGE_WIDTH/2;var MAX_BARS=BAR_TARGET+BAR_TARGET/100*100;var REFRESH_INTERVAL_MS=100;var MAX_BUCKET_DIFF=3;var METRIC_AGG_TYPE="metrics";var DEFAULT_MODEL_MEMORY_LIMIT="10MB";var jobProgressChecks={25:false,50:false,75:false};var refreshCounter=0;$scope.JOB_STATE=_states.JOB_STATE;$scope.jobState=$scope.JOB_STATE.NOT_STARTED;$scope.CHART_STATE=_states.CHART_STATE;$scope.chartState=_states.CHART_STATE.NOT_STARTED;var globalForceStop=false;var createSearchItems=Private(_new_job_utils.SearchItemsProvider);var _createSearchItems=createSearchItems(),indexPattern=_createSearchItems.indexPattern,savedSearch=_createSearchItems.savedSearch,query=_createSearchItems.query,filters=_createSearchItems.filters,combinedQuery=_createSearchItems.combinedQuery;(0,_index_utils.timeBasedIndexCheck)(indexPattern,true);var pageTitle=savedSearch.id!==undefined?"saved search "+savedSearch.title:"index pattern "+indexPattern.title;$scope.ui={indexPattern:indexPattern,pageTitle:pageTitle,showJobInput:false,showJobFinished:false,dirty:true,formValid:false,bucketSpanValid:true,bucketSpanEstimator:{status:0,message:""},aggTypeOptions:(0,_filter_agg_types.filterAggTypes)(_index.aggTypes.byType[METRIC_AGG_TYPE]),fields:[],timeFields:[],intervals:[{title:"Auto",value:"auto"},{title:"Millisecond",value:"ms"},{title:"Second",value:"s"},{title:"Minute",value:"m"},{title:"Hourly",value:"h"},{title:"Daily",value:"d"},{title:"Weekly",value:"w"},{title:"Monthly",value:"M"},{title:"Yearly",value:"y"},{title:"Custom",value:"custom"}],chartHeight:310,showAdvanced:false,resultsUrl:"",validation:{checks:{jobId:{valid:true},groupIds:{valid:true},modelMemoryLimit:{valid:true}}},isCountOrSum:false};$scope.formConfig={agg:{type:undefined},field:null,bucketSpan:"15m",chartInterval:undefined,resultsIntervalSeconds:undefined,start:0,end:0,timeField:indexPattern.timeFieldName,indexPattern:undefined,usesSavedSearch:savedSearch.id!==undefined,query:query,filters:filters,combinedQuery:combinedQuery,jobId:"",description:"",jobGroups:[],useDedicatedIndex:false,isSparseData:false,modelMemoryLimit:DEFAULT_MODEL_MEMORY_LIMIT};$scope.bucketSpanEstimatorExportedFunctions={};$scope.aggChange=function(){loadFields();$scope.ui.isFormValid();$scope.ui.dirty=true;$scope.ui.isCountOrSum=$scope.formConfig.agg.type.dslName==="count"||$scope.formConfig.agg.type.dslName==="sum";if($scope.formConfig.agg.type.dslName==="count"){$scope.formConfig.field=null}};$scope.fieldChange=function(){$scope.ui.isFormValid();$scope.ui.dirty=true};$scope.bucketSpanFieldChange=function(){$scope.ui.isFormValid();$scope.ui.bucketSpanEstimator.status=0;$scope.ui.bucketSpanEstimator.message="";$scope.ui.bucketSpanValid=true;var bucketSpanInterval=(0,_parse_interval.parseInterval)($scope.formConfig.bucketSpan);if(bucketSpanInterval===null||bucketSpanInterval.asMilliseconds()===0){$scope.ui.bucketSpanValid=false}};function setTime(){$scope.ui.bucketSpanValid=true;$scope.formConfig.start=_datemath2.default.parse(_timefilter.timefilter.getTime().from).valueOf();$scope.formConfig.end=_datemath2.default.parse(_timefilter.timefilter.getTime().to).valueOf();$scope.formConfig.format="epoch_millis";var bucketSpanInterval=(0,_parse_interval.parseInterval)($scope.formConfig.bucketSpan);if(bucketSpanInterval===null||bucketSpanInterval.asMilliseconds()===0){$scope.ui.bucketSpanValid=false}var bounds=_timefilter.timefilter.getActiveBounds();$scope.formConfig.chartInterval=new MlTimeBuckets;$scope.formConfig.chartInterval.setBarTarget(BAR_TARGET);$scope.formConfig.chartInterval.setMaxBars(MAX_BARS);$scope.formConfig.chartInterval.setInterval("auto");$scope.formConfig.chartInterval.setBounds(bounds);(0,_adjust_interval.adjustIntervalDisplayed)($scope.formConfig);$scope.ui.isFormValid();$scope.ui.dirty=true}function loadFields(){var agg=$scope.formConfig.agg;var fields=[];agg.type.params.forEach(function(param){if(param.name==="field"){fields=(0,_create_fields.getIndexedFields)(indexPattern,param.filterFieldTypes.split(","))}});$scope.ui.fields=[];_lodash2.default.each(fields,function(field,i){var id=(0,_job_utils.getSafeAggregationName)(field.displayName,i);var f={id:id,name:field.displayName,tooltip:field.displayName,agg:agg,mlType:field.mlType};$scope.ui.fields.push(f)});if($scope.ui.fields.length===1||$scope.formConfig.field===null&&agg.type.name==="cardinality"){$scope.formConfig.field=$scope.ui.fields[0]}}$scope.ui.isFormValid=function(){if($scope.formConfig.agg.type===undefined||$scope.formConfig.timeField===undefined){$scope.ui.formValid=false}else{$scope.ui.formValid=true}return $scope.ui.formValid};$scope.loadVis=function(){setTime();$scope.ui.isFormValid();if($scope.ui.formValid){$scope.ui.showJobInput=true;$scope.ui.showJobFinished=false;$scope.formConfig.indexPattern=indexPattern;$scope.ui.dirty=false;$scope.chartState=_states.CHART_STATE.LOADING;$scope.$applyAsync();mlSingleMetricJobService.getLineChartResults($scope.formConfig).then(function(resp){$scope.chartState=resp.totalResults?_states.CHART_STATE.LOADED:_states.CHART_STATE.NO_RESULTS}).catch(function(resp){msgs.error(resp.message);$scope.chartState=_states.CHART_STATE.NO_RESULTS}).then(function(){$scope.$broadcast("render");$scope.$applyAsync()})}};var ignoreModel=false;var refreshInterval=REFRESH_INTERVAL_MS;$scope.createJob=function(){var tempJob=mlSingleMetricJobService.getJobFromConfig($scope.formConfig);if((0,_validate_job.validateJob)(tempJob,$scope.ui.validation.checks)){msgs.clear();mlSingleMetricJobService.createJob($scope.formConfig).then(function(job){_job_service.mlJobService.openJob(job.job_id).then(function(){saveNewDatafeed(job,true)}).catch(function(resp){msgs.error("Could not open job: ",resp);msgs.error("Job created, creating datafeed anyway");saveNewDatafeed(job,false)})}).catch(function(resp){msgs.error("Save failed: ",resp.resp);$scope.$applyAsync()})}else{if($scope.ui.validation.checks.modelMemoryLimit.valid===false){$scope.ui.showAdvanced=true}}function saveNewDatafeed(job,startDatafeedAfterSave){_job_service.mlJobService.saveNewDatafeed(job.datafeed_config,job.job_id).then(function(){if(startDatafeedAfterSave){mlSingleMetricJobService.startDatafeed($scope.formConfig).then(function(){$scope.jobState=_states.JOB_STATE.RUNNING;refreshCounter=0;ignoreModel=false;refreshInterval=REFRESH_INTERVAL_MS;$scope.formConfig.resultsIntervalSeconds=$scope.formConfig.chartInterval.getInterval().asSeconds();var bucketSpanSeconds=(0,_parse_interval.parseInterval)($scope.formConfig.bucketSpan).asSeconds();if($scope.formConfig.resultsIntervalSeconds<bucketSpanSeconds){$scope.formConfig.resultsIntervalSeconds=bucketSpanSeconds}$scope.resultsUrl=_job_service.mlJobService.createResultsUrl([$scope.formConfig.jobId],$scope.formConfig.start,$scope.formConfig.end,"timeseriesexplorer");(0,_new_job_utils.focusOnResultsLink)("job_running_view_results_link",$timeout);loadCharts()}).catch(function(resp){msgs.error("Could not start datafeed: ",resp);$scope.$applyAsync()})}else{$scope.$applyAsync()}}).catch(function(resp){msgs.error("Save datafeed failed: ",resp);$scope.$applyAsync()})}};(0,_validation_utils.addJobValidationMethods)($scope,mlSingleMetricJobService);function loadCharts(){var forceStop=globalForceStop;var counterLimit=20-refreshInterval/REFRESH_INTERVAL_MS;if(refreshCounter>=counterLimit){refreshCounter=0;mlSingleMetricJobService.checkDatafeedState($scope.formConfig).then(function(state){if(state==="stopped"){console.log("Stopping poll because datafeed state is: "+state);$scope.$broadcast("render-results");forceStop=true;$scope.$applyAsync()}run()})}else{run()}function run(){refreshCounter++;reloadSwimlane().then(function(){if(forceStop===false&&$scope.chartData.percentComplete<100){if($scope.jobState===_states.JOB_STATE.STOPPING){$scope.jobState=_states.JOB_STATE.STOPPING}else{$scope.jobState=_states.JOB_STATE.RUNNING}}else{$scope.jobState=_states.JOB_STATE.FINISHED;(0,_new_job_utils.focusOnResultsLink)("job_finished_view_results_link",$timeout)}if(ignoreModel){jobCheck()}else{var fullModelRefresh=false;_lodash2.default.each(jobProgressChecks,function(c,i){if(jobProgressChecks[i]===false&&$scope.chartData.percentComplete>=i){jobProgressChecks[i]=true;fullModelRefresh=true}});if(fullModelRefresh){$scope.chartData.model=[]}reloadModelChart().catch(function(){if(refreshCounter%10===0){console.log("Model has failed to load 10 times. Stop trying to load it.");ignoreModel=true}}).then(function(){jobCheck()})}$scope.$applyAsync()})}}function jobCheck(){var isLastRun=false;if($scope.jobState===_states.JOB_STATE.RUNNING||$scope.jobState===_states.JOB_STATE.STOPPING){refreshInterval=adjustRefreshInterval($scope.chartData.loadingDifference,refreshInterval);_lodash2.default.delay(loadCharts,refreshInterval)}else{$scope.chartData.percentComplete=100;isLastRun=true}if(isLastRun&&!ignoreModel){$scope.chartData.model=[];reloadModelChart().catch().then(function(){$scope.chartData.percentComplete=100;$scope.$broadcast("render-results");$scope.$applyAsync()})}else{$scope.$broadcast("render-results");$scope.$applyAsync()}}function reloadModelChart(){return mlSingleMetricJobService.loadModelData($scope.formConfig)}function reloadSwimlane(){return mlSingleMetricJobService.loadSwimlaneData($scope.formConfig)}function adjustRefreshInterval(loadingDifference,currentInterval){var INTERVAL_INCREASE_MS=100;var MAX_INTERVAL=1e4;var interval=currentInterval;if(interval<MAX_INTERVAL){if(loadingDifference<MAX_BUCKET_DIFF){interval=interval+INTERVAL_INCREASE_MS}else{if(interval-INTERVAL_INCREASE_MS>=REFRESH_INTERVAL_MS){interval=interval-INTERVAL_INCREASE_MS}}}return interval}$scope.resetJob=function(){$scope.jobState=_states.JOB_STATE.NOT_STARTED;_angular2.default.element(".model-chart, .swimlane").css("opacity",0);_lodash2.default.each(jobProgressChecks,function(c,i){jobProgressChecks[i]=false});window.setTimeout(function(){$scope.ui.showJobInput=true;$scope.loadVis()},500)};$scope.stopJob=function(){$scope.jobState=_states.JOB_STATE.STOPPING;mlSingleMetricJobService.stopDatafeed($scope.formConfig)};$scope.moveToAdvancedJobCreation=function(){var job=mlSingleMetricJobService.getJobFromConfig($scope.formConfig);moveToAdvancedJobCreation(job)};$scope.setFullTimeRange=function(){return mlFullTimeRangeSelectorService.setFullTimeRange($scope.ui.indexPattern,$scope.formConfig.combinedQuery)};$scope.$listenAndDigestAsync(_timefilter.timefilter,"fetch",$scope.loadVis);$scope.$on("$destroy",function(){globalForceStop=true});$scope.$evalAsync(function(){(0,_prepopulate_job_settings.preLoadJob)($scope,appState)})})},2305:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TimeBucketsCalcAutoIntervalProvider=TimeBucketsCalcAutoIntervalProvider;var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var d=_moment2.default.duration;function TimeBucketsCalcAutoIntervalProvider(){var roundingRules=[[d(500,"ms"),d(100,"ms")],[d(5,"second"),d(1,"second")],[d(10,"second"),d(5,"second")],[d(15,"second"),d(10,"second")],[d(30,"second"),d(15,"second")],[d(1,"minute"),d(30,"second")],[d(5,"minute"),d(1,"minute")],[d(10,"minute"),d(5,"minute")],[d(15,"minute"),d(10,"minute")],[d(30,"minute"),d(10,"minute")],[d(1,"hour"),d(30,"minute")],[d(2,"hour"),d(1,"hour")],[d(4,"hour"),d(2,"hour")],[d(6,"hour"),d(4,"hour")],[d(8,"hour"),d(6,"hour")],[d(12,"hour"),d(8,"hour")],[d(24,"hour"),d(12,"hour")],[d(2,"d"),d(1,"d")],[d(4,"d"),d(2,"d")],[d(1,"week"),d(4,"d")],[d(1,"month"),d(1,"week")],[d(1,"year"),d(1,"month")],[Infinity,d(1,"year")]];var revRoundingRules=roundingRules.slice(0).reverse();function find(rules,check,last){function pick(buckets,duration){var target=duration/buckets;var lastResp=void 0;for(var i=0;i<rules.length;i++){var rule=rules[i];var resp=check(rule[0],rule[1],target);if(resp==null){if(!last){continue}if(lastResp){return lastResp}break}if(!last){return resp}lastResp=resp}var ms=Math.max(Math.floor(target),1);return _moment2.default.duration(ms,"ms")}return function(buckets,duration){var interval=pick(buckets,duration);if(interval){return _moment2.default.duration(interval._data)}}}return{near:find(revRoundingRules,function near(upperBound,lowerBound,target){if(upperBound>target){if(upperBound===Infinity){return lowerBound}var boundMs=upperBound.asMilliseconds();var intervalMs=lowerBound.asMilliseconds();var retInterval=Math.abs(boundMs-target)<=Math.abs(intervalMs)?upperBound:lowerBound;return retInterval}},true),lessThan:find(revRoundingRules,function(upperBound,lowerBound,target){if(lowerBound<target){return upperBound!==Infinity?upperBound:lowerBound}}),atLeast:find(revRoundingRules,function atLeast(upperBound,lowerBound,target){if(lowerBound<=target){return lowerBound}})}}},2306:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.inherits=inherits;function describeConst(val){return{writable:false,enumerable:false,configurable:false,value:val}}function inherits(SubClass,SuperClass){var prototype=Object.create(SuperClass.prototype,{constructor:describeConst(SubClass),superConstructor:describeConst(SuperClass)});Object.defineProperties(SubClass,{prototype:describeConst(prototype),Super:describeConst(SuperClass)});return SubClass}},2307:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.populateAppStateSettings=populateAppStateSettings;var _jquery=__webpack_require__(17);var _jquery2=_interopRequireDefault(_jquery);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function populateAppStateSettings(appState,scope){if(appState.mlJobSettings!==undefined&&Object.keys(appState.mlJobSettings).length){var finish=function finish(success){if(success){(0,_jquery2.default)("#job-id-input").focus()}};var jobSettings=appState.mlJobSettings;(function(){if(scope.formConfig.hasOwnProperty("field")){return populateSingleMetricSettings(jobSettings,scope)}else if(scope.formConfig.hasOwnProperty("overField")){return populatePopulationSettings(jobSettings,scope)}else if(scope.formConfig.hasOwnProperty("fields")){return populateMultiMetricSettings(jobSettings,scope)}})().then(function(){return finish(true)}).catch(function(){return finish(false)})}}function populateSingleMetricSettings(jobSettings,scope){return new Promise(function(resolve,reject){jobSettings.fields.forEach(function(f){if(f.agg!==undefined){var agg=scope.ui.aggTypeOptions.find(function(o){return o.mlName===f.agg});if(agg!==undefined){scope.formConfig.agg.type=agg;scope.aggChange()}}if(f.fieldName!==undefined){var field=scope.ui.fields.find(function(o){return o.name===f.fieldName});scope.formConfig.field=field||null}});if(scope.formConfig.agg.type!==undefined&&scope.formConfig.field!==undefined||scope.formConfig.agg.type.name==="count"&&scope.formConfig.field===undefined){populateCommonSettings(jobSettings,scope);resolve()}else{reject()}})}function populateMultiMetricSettings(jobSettings,scope){return new Promise(function(resolve,reject){jobSettings.fields.forEach(function(f){var fieldName=f.fieldName!==undefined?f.fieldName:"__ml_event_rate_count__";var field=scope.ui.fields.find(function(o){return o.id===fieldName});if(field!==undefined){scope.formConfig.fields[field.id]=field}if(f.agg!==undefined){var agg=scope.ui.aggTypeOptions.find(function(o){return o.mlName===f.agg});if(agg!==undefined){scope.formConfig.fields[field.id].agg.type=agg}}});if(jobSettings.split!==undefined){var field=scope.ui.splitFields.find(function(o){return o.name===jobSettings.split});if(field!==undefined){scope.formConfig.splitField=field;scope.splitChange()}}if(scope.formConfig.fields!==undefined&&Object.keys(scope.formConfig.fields).length>0){populateCommonSettings(jobSettings,scope);resolve()}else{reject()}})}function populatePopulationSettings(jobSettings,scope){return new Promise(function(resolve,reject){if(jobSettings.population!==undefined){var loop=function loop(i){var f=jobSettings.fields[i];if(f.split!==undefined){var splitField=scope.ui.splitFields.find(function(o){return o.name===f.split});if(splitField!==undefined){scope.splitChange(i,splitField).then(function(){check(i)})}else{check(i)}}else{check(i)}};var check=function check(i){if(i+1<jobSettings.fields.length){loop(i+1)}};var overField=scope.ui.overFields.find(function(o){return o.name===jobSettings.population});if(overField!==undefined){scope.formConfig.overField=overField;scope.overChange()}jobSettings.fields.forEach(function(f){var fieldName=f.fieldName!==undefined?f.fieldName:"__ml_event_rate_count__";var tempField=scope.ui.fields.find(function(o){return o.id===fieldName});var field=_extends({},tempField);if(field!==undefined){if(f.agg!==undefined){var agg=scope.ui.aggTypeOptions.find(function(o){return o.mlName===f.agg});if(agg!==undefined){field.agg={type:agg}}}scope.formConfig.fields.push(field)}});scope.formChange();loop(0)}if(scope.formConfig.fields!==undefined&&Object.keys(scope.formConfig.fields).length>0){populateCommonSettings(jobSettings,scope);resolve()}else{reject()}})}function populateCommonSettings(jobSettings,scope){if(typeof jobSettings.modelMemoryLimit==="string"){scope.formConfig.modelMemoryLimit=jobSettings.modelMemoryLimit}if(typeof jobSettings.bucketSpan==="string"){scope.formConfig.bucketSpan=jobSettings.bucketSpan}else{runEstimateBucketSpan(scope)}if(typeof jobSettings.description==="string"){scope.formConfig.description=jobSettings.description}if(Array.isArray(jobSettings.groups)){scope.formConfig.jobGroups=jobSettings.groups}if(Array.isArray(jobSettings.influencers)){scope.formConfig.influencerFields=jobSettings.influencers.map(function(i){return scope.ui.fields.find(function(f){return f.id===i})})}scope.formConfig.useDedicatedIndex=jobSettings.resultsIndexName!=="shared";scope.ui.showAdvanced=scope.formConfig.useDedicatedIndex}function runEstimateBucketSpan(scope){setTimeout(function(){if(scope.bucketSpanEstimatorExportedFunctions.guessBucketSpan&&typeof scope.bucketSpanEstimatorExportedFunctions.guessBucketSpan==="function"){scope.bucketSpanEstimatorExportedFunctions.guessBucketSpan()}},0)}},2308:function(module,exports){module.exports='<ml-nav-menu name="new_job_single_metric"></ml-nav-menu>\n<ml-new-job-single-metric>\n  <ml-message-bar></ml-message-bar>\n  <div ng-controller="MlCreateSingleMetricJob" class="single-metric-job-container">\n    <div class="row">\n      <div class="col-md-6">\n        <h1 class="euiTitle euiTitle--large">New job from {{ui.pageTitle}}</h1>\n      </div>\n      <div class="col-md-6">\n        <div class="pull-right">\n          <span style="font-size:10px;" ng-show="formConfig.chartInterval !== undefined">Chart interval: {{formConfig.chartInterval.getInterval().expression}}</span>\n          <ml-full-time-range-selector\n            disabled=\'(jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED)\'\n            index-pattern=\'ui.indexPattern\'\n            query=\'formConfig.combinedQuery\'\n          ></ml-full-time-range-selector>\n        </div>\n      </div>\n    </div>\n\n    <div class="euiSpacer euiSpacer--l"></div>\n\n    <div class="row form-controls">\n\n      <div class="form-group col-md-4">\n        <ml-form-label label-id="new_job_detector_function">Aggregation</ml-form-label>\n        <ui-select\n          aria-labelledby="ml_aria_label_new_job_detector_function"\n          aria-describedby="ml_aria_description_new_job_detector_function"\n          ng-model="formConfig.agg.type"\n          name="agg-type"\n          required\n          on-select="aggChange()"\n          ng-disabled="jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n          class=""\n        >\n          <ui-select-match placeholder="Select an aggregation">\n            {{$select.selected.title}}\n          </ui-select-match>\n          <ui-select-choices\n            repeat="agg in ui.aggTypeOptions | filter: { title: $select.search }"\n          >\n            <div ng-bind-html="agg.title | highlight: $select.search"></div>\n          </ui-select-choices>\n        </ui-select>\n      </div>\n\n      <div class="form-group col-md-4">\n        <ml-form-label label-id="new_job_detector_fieldname_subset" tooltip-append-to-body="true">Field</ml-form-label>\n        <ui-select\n          aria-labelledby="ml_aria_label_new_job_detector_fieldname_subset"\n          aria-describedby="ml_aria_description_new_job_detector_fieldname_subset"\n          ng-model="formConfig.field"\n          name="field-type"\n          required\n          on-select="fieldChange()"\n          ng-disabled="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n          class=""\n        >\n          <ui-select-match placeholder="Select a field">\n            <ml-field-type-icon type="$select.selected.mlType"></ml-field-type-icon>{{$select.selected.name}}\n          </ui-select-match>\n          <ui-select-choices repeat="field in ui.fields | filter: { name: $select.search }" group-by="\'mlType\'">\n            <ml-field-type-icon type="field.mlType"></ml-field-type-icon>\n            <span class="select-item" ng-bind-html="field.name | highlight: $select.search"></span>\n          </ui-select-choices>\n        </ui-select>\n      </div>\n\n      <div class="form-group col-md-4">\n        <ml-form-label label-id="new_job_bucketspan">Bucket span</ml-form-label>\n        <div class=\'bucket-span-container\'>\n          <input\n            aria-labelledby="ml_aria_label_new_job_bucketspan"\n            aria-describedby="ml_aria_description_new_job_bucketspan"\n            ng-model="formConfig.bucketSpan"\n            required\n            placeholder={{formConfig-bucketSpan}}\n            ng-disabled="jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED || ui.bucketSpanEstimator.status===1"\n            ng-change="bucketSpanFieldChange()"\n            ng-class=\'{"ng-invalid": (!ui.bucketSpanValid)}\'\n            class="form-control lowercase bucket-span-input" />\n\n          <ml-bucket-span-estimator\n            form-config=\'formConfig\'\n            job-state-wrapper=\'{jobState:jobState}\'\n            job-state=\'JOB_STATE\'\n            ui=\'ui\'\n            bucket-span-field-change="bucketSpanFieldChange"\n            exported-functions=\'bucketSpanEstimatorExportedFunctions\'>\n          </ml-bucket-span-estimator>\n\n          <button class="euiButton euiButton--primary euiButton--small euiButton--fill navbar-btn-link btn-load-vis"\n            aria-label="Run search"\n            ng-click="loadVis()"\n            ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED" >\n            <i class="fa fa-play" ></i>\n          </button>\n        </div>\n        <div ng-hide="ui.bucketSpanValid" class="validation-error">Invalid interval format</div>\n        <div ng-show="ui.bucketSpanEstimator.status===-1" class="validation-error">{{ui.bucketSpanEstimator.message}}</div>\n      </div>\n    </div>\n    <div class="row form-controls" ng-show=\'ui.isCountOrSum\'>\n      <div class="col-md-12">\n        <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n          <input type="checkbox"\n            aria-labelledby="ml_aria_label_new_job_sparsedata"\n            aria-describedby="ml_aria_description_new_job_sparsedata"\n            class=\'kuiCheckBox\'\n            ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n            ng-model="formConfig.isSparseData" />\n          <span id="ml_aria_label_new_job_sparsedata" class=\'kuiCheckBoxLabel__text\'>Sparse data</span>\n          <i ml-info-icon="new_job_sparsedata" />\n        </label>\n      </div>\n    </div>\n\n    <div ng-show="ui.showJobInput">\n      <div class=\'chart-container\'>\n        <ml-single-metric-job-chart\n          chart-data="chartData"\n          chart-height=\'ui.chartHeight\'\n          chart-ticks-margin="chartData.chartTicksMargin">\n        </ml-single-metric-job-chart>\n\n        <div ng-show="chartState === CHART_STATE.NOT_STARTED || chartState === CHART_STATE.LOADING || chartState === CHART_STATE.NO_RESULTS"\n          class=\'chart-loader\'\n          style=\'height: {{ui.chartHeight}}px; margin-top: -{{ui.chartHeight + 32}}px; margin-left: {{chartData.chartTicksMargin.width - 1}}px;\'>\n            <div class=\'status-label\' ng-show="chartState === CHART_STATE.NOT_STARTED"></div>\n            <div class=\'status-label\' ng-show="chartState === CHART_STATE.LOADING">\n              <h2 class="euiTitle euiTitle"><i class=\'fa fa-spinner fa-spin\'></i></h2>\n            </div>\n            <div class=\'status-label\' ng-show="chartState === CHART_STATE.NO_RESULTS">\n              <div class=\'no-results\'>\n                <h4 class="euiTitle euiTitle--small"><i class="fa fa-info-circle"></i> No results found</h4>\n                <span>Consider using the <a ng-click="setFullTimeRange()">full {{ui.indexPattern.title}} data</a></span>\n              </div>\n            </div>\n        </div>\n      </div>\n    </div>\n\n    <div ng-show="ui.showJobInput && (jobState === JOB_STATE.NOT_STARTED || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING)">\n      <div class="form-group">\n        <ml-form-label label-id="new_job_id" tooltip-append-to-body="true">Name</ml-form-label>\n        <input\n          aria-labelledby="ml_aria_label_new_job_id"\n          aria-describedby="ml_aria_description_new_job_id"\n          id="job-id-input"\n          ng-model="formConfig.jobId"\n          required\n          placeholder="Job ID"\n          ng-change="changeJobIDCase(formConfig)"\n          ng-disabled="jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n          class="form-control lowercase" />\n          <div ng-hide="ui.validation.checks.jobId.valid" class="validation-error">{{ ( ui.validation.checks.jobId.message || "Enter a name for the job" ) }}</div>\n      </div>\n\n      <div class="form-group">\n        <ml-form-label label-id="new_job_description">Description</ml-form-label>\n        <input\n          aria-labelledby="ml_aria_label_new_job_description"\n          aria-describedby="ml_aria_description_new_job_description"\n          ng-model="formConfig.description"\n          placeholder="Job description"\n          ng-disabled="jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n          class="form-control" />\n      </div>\n\n      <div class="form-group">\n        <ml-form-label label-id="new_job_group">Job Groups</ml-form-label>\n        <ml-job-group-select\n          aria-labelledby="ml_aria_label_new_job_group"\n          aria-describedby="ml_aria_description_new_job_group"\n          job-groups=\'formConfig.jobGroups\'\n          disabled=\'(jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED)\' />\n        <div ng-hide="ui.validation.checks.groupIds.valid" class="validation-error">{{ ui.validation.checks.groupIds.message }}</div>\n      </div>\n\n      <div class="form-group">\n        <div ng-click="ui.showAdvanced = (!ui.showAdvanced || formConfig.useDedicatedIndex)" class="advanced-button-container">\n          <button\n            aria-label="{{ ui.showAdvanced ? \'Hide Advanced\' : \'Show Advanced\' }}"\n            aria-describedby="ml_aria_description_new_job_advanced_settings"\n            type="button"\n            ng-disabled="formConfig.useDedicatedIndex"\n            class="kuiButton kuiButton--small kuiButton--hollow advanced-button">\n            <i aria-hidden="true" ng-class="{ \'fa-caret-down\': ui.showAdvanced, \'fa-caret-right\': !ui.showAdvanced }" class="fa"></i>\n          </button>\n          <label>Advanced</label><i ml-info-icon="new_job_advanced_settings" />\n        </div>\n        <div class=\'advanced-group\' ng-show="ui.showAdvanced">\n          <div class="form-group">\n            <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n              <input type="checkbox"\n                aria-labelledby="ml_aria_label_new_job_dedicated_index"\n                aria-describedby="ml_aria_description_new_job_dedicated_index"\n                class=\'kuiCheckBox\'\n                ng-model="formConfig.useDedicatedIndex" />\n              <span class=\'kuiCheckBoxLabel__text\'>\n                <span id="ml_aria_label_new_job_dedicated_index">Use dedicated index</span>\n                <i ml-info-icon="new_job_dedicated_index" />\n              </span>\n            </label>\n          </div>\n          <div class="form-group">\n            <label class=\'kuiFormLabel kuiVerticalRhythm\'>\n              <span id="ml_aria_label_new_job_model_memory_limit">\n                Model memory limit\n              </span>\n              <i ml-info-icon="new_job_model_memory_limit" />\n            </label>\n            <div></div>\n            <input\n              aria-labelledby="ml_aria_label_new_job_model_memory_limit"\n              aria-describedby="ml_aria_description_new_job_model_memory_limit"\n              type="text"\n              ng-model=\'formConfig.modelMemoryLimit\'\n              class="kuiTextInput kuiTextInput--large" />\n            <div ng-hide="ui.validation.checks.modelMemoryLimit.valid" class="validation-error">{{ ui.validation.checks.modelMemoryLimit.message }}</div>\n          </div>\n        </div>\n      </div>\n\n      <div class="form-group">\n        <a href="" ng-click="moveToAdvancedJobCreation()">Move to advanced job configuration</a>\n      </div>\n      <div class="euiFlexGroup euiFlexGroup--gutterSmall euiFlexGroup--alignItemsCenter euiFlexGroup--responsive">\n        <div class="euiFlexItem euiFlexItem--flexGrowZero">\n          <ml-validate-job\n            get-duration="getDuration"\n            get-job-config="getJobConfig"\n            fill="false"\n            is-current-job-config="isCurrentJobConfig"\n            is-disabled=\'ui.formValid === false || ui.dirty === true || formConfig.jobId === undefined || ui.bucketSpanValid === false\'\n            ng-show="jobState === JOB_STATE.NOT_STARTED"\n          />\n        </div>\n        <div class="euiFlexItem euiFlexItem--flexGrowZero">\n          <button\n            aria-label="Create Job"\n            ng-click="createJob()"\n            type="button"\n            ng-show="jobState === JOB_STATE.NOT_STARTED"\n            ng-disabled=\'ui.formValid === false || ui.dirty === true || formConfig.jobId === undefined || ui.bucketSpanValid === false\'\n            class="euiButton euiButton--primary euiButton--small euiButton--fill">\n            <span class="euiButton__content">\n              Create Job\n            </span>\n          </button>\n        </div>\n      </div>\n\n      <div class=\'job-state-info\' ng-show="jobState === JOB_STATE.RUNNING">Analysis running <i class=\'fa fa-spinner fa-spin\'></i></div>\n      <div class=\'job-state-info\' ng-show="jobState === JOB_STATE.STOPPING">Analysis stopping <i class=\'fa fa-spinner fa-spin\'></i></div>\n\n      <button\n        aria-label="Stop Job"\n        ng-click="stopJob()"\n        type="button"\n        ng-show="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING"\n        ng-disabled="jobState === JOB_STATE.STOPPING"\n        class="euiButton euiButton--danger euiButton--small">\n        <span class="euiButton__content">\n          {{(jobState === JOB_STATE.STOPPING) ? \'Analysis stopping\' : \'Stop analysis\' }}\n        </span>\n      </button>\n\n      <a\n        href=\'{{resultsUrl}}\'\n        id="job_running_view_results_link"\n        ng-click="addNewJobToRecentlyAccessed(formConfig.jobId, resultsUrl)"\n        aria-label="View results of running job"\n        ng-show="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING"\n        class="euiButton euiButton--primary euiButton--small euiButton--fill">\n        <span class="euiButton__content">\n          View Results\n        </span>\n      </a>\n\n    </div>\n    <div ng-show="jobState === JOB_STATE.FINISHED">\n      <h3 class="euiTitle euiTitle--large">Job {{formConfig.jobId }} created\n        <i style="color:green;" class="fa fa-check" aria-label="Job finished"></i>\n      </h3>\n      <div class="euiSpacer euiSpacer--m"></div>\n\n      <button\n        aria-label="Reset"\n        ng-click="resetJob()"\n        type="button"\n        class="euiButton euiButton--primary euiButton--small euiButton--fill">\n        <span class="euiButton__content">\n          Reset\n        </span>\n      </button>\n      <a\n        href=\'{{resultsUrl}}\'\n        id="job_finished_view_results_link"\n        ng-click="addNewJobToRecentlyAccessed(formConfig.jobId, resultsUrl)"\n        aria-label="View results of finished job"\n        class="euiButton euiButton--primary euiButton--small euiButton--fill">\n        <span class="euiButton__content">\n          View Results\n        </span>\n      </a>\n\n    </div>\n    <div ng-if=\'jobState === JOB_STATE.FINISHED\'>\n      <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n      <ml-post-save-options\n        job-id=\'formConfig.jobId\'\n        bucket-span=\'formConfig.bucketSpan\'\n        include-influencers=\'false\'\n      ></ml-post-save-options>\n    </div>\n  </div>\n</ml-new-job-single-metric>\n'},2309:function(module,exports,__webpack_require__){"use strict";var _jquery=__webpack_require__(17);var _jquery2=_interopRequireDefault(_jquery);var _d=__webpack_require__(20);var _d2=_interopRequireDefault(_d);var _angular=__webpack_require__(21);var _angular2=_interopRequireDefault(_angular);var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _time_buckets=__webpack_require__(218);var _chart_utils=__webpack_require__(197);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlSingleMetricJobChart",function(){function link(scope,element){var svgWidth=_angular2.default.element(".single-metric-job-container").width();var lineChartHeight=scope.chartHeight;var swimlaneHeight=30;var margin={top:0,right:0,bottom:0,left:scope.chartTicksMargin.width};var svgHeight=lineChartHeight+swimlaneHeight+margin.top+margin.bottom;var vizWidth=svgWidth-margin.left-margin.right;var chartLimits={max:0,min:0};var lineChartXScale=null;var lineChartYScale=null;var lineChartValuesLine=null;var lineChartBoundedArea=null;var lineChartGroup=void 0;var modelChartGroup=void 0;var swimlaneGroup=void 0;var $progressBar=void 0;scope.$on("render",function(){init();createSVGGroups();drawLineChart()});scope.$on("render-results",function(){drawResults()});element.on("$destroy",function(){scope.$destroy()});function init(){margin.left=scope.chartTicksMargin.width;vizWidth=svgWidth-margin.left-margin.right;lineChartXScale=_d2.default.time.scale().range([0,vizWidth]);lineChartYScale=_d2.default.scale.linear().range([lineChartHeight,0]);lineChartValuesLine=_d2.default.svg.line().x(function(d){return lineChartXScale(d.date)}).y(function(d){return lineChartYScale(d.value)}).defined(function(d){return d.value!==null});lineChartBoundedArea=_d2.default.svg.area().x(function(d){return lineChartXScale(d.date)||0}).y0(function(d){return lineChartYScale(Math.max(chartLimits.min,Math.min(chartLimits.max,d.upper)))}).y1(function(d){return lineChartYScale(Math.min(chartLimits.max,Math.max(chartLimits.min,d.lower)))})}function createSVGGroups(){if(scope.chartData.line===undefined){return}var chartElement=_d2.default.select(element.get(0));chartElement.select("svg").remove();chartElement.select(".progress").remove();if(chartElement.select(".progress-bar")[0][0]===null){var style="width: "+(+vizWidth+2)+"px;\n          margin-bottom: -"+(+lineChartHeight+5)+"px;\n          margin-left: "+(+margin.left-1)+"px;'";chartElement.append("div").attr("class","progress").attr("style",style).append("div").attr("class","progress-bar")}$progressBar=(0,_jquery2.default)(".progress-bar");var svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight);swimlaneGroup=svg.append("g").attr("class","swimlane").attr("transform","translate("+margin.left+","+margin.top+")");modelChartGroup=svg.append("g").attr("class","model-chart").attr("transform","translate("+margin.left+","+margin.top+")");lineChartGroup=svg.append("g").attr("class","line-chart").attr("transform","translate("+margin.left+","+margin.top+")")}function drawLineChart(){var data=scope.chartData.line;lineChartXScale=lineChartXScale.domain(_d2.default.extent(data,function(d){return d.date}));var timeBuckets=new _time_buckets.TimeBuckets;timeBuckets.setInterval("auto");if(data.length>0){var xDomain=lineChartXScale.domain();var bounds={min:(0,_moment2.default)(xDomain[0]),max:(0,_moment2.default)(xDomain[1])};timeBuckets.setBounds(bounds)}var xAxisTickFormat=timeBuckets.getScaledDateFormat();chartLimits.max=_d2.default.max(data,function(d){return d.value});chartLimits.min=_d2.default.min(data,function(d){return d.value});var padding=(chartLimits.max-chartLimits.min)*.1;chartLimits.max+=padding;chartLimits.min-=padding;lineChartYScale=lineChartYScale.domain([chartLimits.min,chartLimits.max]);var xAxis=_d2.default.svg.axis().scale(lineChartXScale).orient("bottom").innerTickSize(-lineChartHeight).outerTickSize(0).tickPadding(10).ticks((0,_chart_utils.numTicksForDateFormat)(vizWidth,xAxisTickFormat)).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)});var yAxis=_d2.default.svg.axis().scale(lineChartYScale).orient("left").innerTickSize(-vizWidth).outerTickSize(0).tickPadding(10);if(scope.chartData.fieldFormat!==undefined){yAxis.tickFormat(function(d){return scope.chartData.fieldFormat.convert(d,"text")})}lineChartGroup.append("rect").attr("x",0).attr("y",0).attr("height",lineChartHeight).attr("width",vizWidth).style("stroke","#cccccc").style("fill","none").style("stroke-width",1);drawLineChartAxes(xAxis,yAxis);drawLineChartPaths(data);(0,_chart_utils.drawLineChartDots)(data,lineChartGroup,lineChartValuesLine)}function drawLineChartAxes(xAxis,yAxis){var axes=lineChartGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0,"+lineChartHeight+")").call(xAxis);axes.append("g").attr("class","y axis").call(yAxis)}function drawLineChartPaths(data){lineChartGroup.append("path").attr("class","values-line").attr("d",lineChartValuesLine(data))}function drawResults(){var model=scope.chartData.model;drawModelPaths(model);drawSwimlane(vizWidth,lineChartHeight);updateProgressBar()}function drawModelPaths(model){modelChartGroup.selectAll("*").remove();modelChartGroup.append("path").attr("class","area bounds").attr("d",lineChartBoundedArea(model))}function drawSwimlane(swlWidth,swlHeight){var data=scope.chartData.swimlane;var cellWidth=0;if(data.length>0){cellWidth=lineChartXScale(data[0].time+scope.chartData.swimlaneInterval)-lineChartXScale(data[0].time)}_d2.default.time.scale().range([0,swlWidth]).domain(_d2.default.extent(data,function(d){return d.date}));_d2.default.scale.linear().range([swlHeight,0]).domain([0,swlHeight]);var color=_d2.default.scale.threshold().domain([3,25,50,75,100]).range(["#d2e9f7","#8bc8fb","#ffdd00","#ff7e00","#fe5050"]);swimlaneGroup.select(".swimlane-cells").remove();var cells=swimlaneGroup.append("g").attr("class","swimlane-cells").selectAll("cells").data(data);cells.enter().append("rect").attr("x",function(d){return lineChartXScale(d.date)}).attr("y",0).attr("rx",0).attr("ry",0).attr("class",function(d){return d.value>0?"swimlane-cell":"swimlane-cell-hidden"}).attr("width",cellWidth).attr("height",swlHeight).style("fill",function(d){return color(d.value)})}function updateProgressBar(){var pcnt=scope.chartData.percentComplete<100?scope.chartData.percentComplete:0;$progressBar.css("width",pcnt+"%")}}return{scope:{chartData:"=",chartHeight:"=",chartTicksMargin:"="},link:link}})},2310:function(module,exports,__webpack_require__){"use strict";var _post_save_service=__webpack_require__(2311);var _create_watch_service=__webpack_require__(337);var _check_license=__webpack_require__(43);var _post_save_options=__webpack_require__(2312);var _post_save_options2=_interopRequireDefault(_post_save_options);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlPostSaveOptions",function(Private){return{restrict:"AE",replace:false,scope:{jobId:"=",bucketSpan:"=",includeInfluencers:"="},template:_post_save_options2.default,link:function link($scope){var xpackFeature=Private(_check_license.xpackFeatureProvider);$scope.watcherEnabled=xpackFeature.isAvailable("watcher");$scope.status=_post_save_service.postSaveService.status;$scope.STATUS=_post_save_service.postSaveService.STATUS;_create_watch_service.mlCreateWatchService.reset();_create_watch_service.mlCreateWatchService.config.includeInfluencers=$scope.includeInfluencers;$scope.runInRealtime=false;$scope.createWatch=false;$scope.embedded=true;$scope.clickRunInRealtime=function(){$scope.createWatch=!$scope.runInRealtime?false:$scope.createWatch};$scope.apply=function(){_post_save_service.postSaveService.apply($scope.jobId,$scope.runInRealtime,$scope.createWatch).catch().then(function(){$scope.$applyAsync()})}}}})},2311:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.postSaveService=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _job_service=__webpack_require__(23);var _create_watch_service=__webpack_require__(337);var _messagebar_service=__webpack_require__(178);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var msgs=_messagebar_service.mlMessageBarService;var PostSaveService=function(){function PostSaveService(){_classCallCheck(this,PostSaveService);this.STATUS={SAVE_FAILED:-1,SAVING:0,SAVED:1};this.status={realtimeJob:null,watch:null};_create_watch_service.mlCreateWatchService.status=this.status;this.externalCreateWatch}_createClass(PostSaveService,[{key:"startRealtimeJob",value:function startRealtimeJob(jobId){var _this=this;return new Promise(function(resolve,reject){_this.status.realtimeJob=_this.STATUS.SAVING;var datafeedId=_job_service.mlJobService.getDatafeedId(jobId);_job_service.mlJobService.openJob(jobId).catch().then(function(){_job_service.mlJobService.startDatafeed(datafeedId,jobId,0,undefined).then(function(){_this.status.realtimeJob=_this.STATUS.SAVED;resolve()}).catch(function(resp){msgs.error("Could not start datafeed: ",resp);_this.status.realtimeJob=_this.STATUS.SAVE_FAILED;reject()})})})}},{key:"apply",value:function apply(jobId,runInRealtime,createWatch){var _this2=this;return new Promise(function(resolve){if(runInRealtime){_this2.startRealtimeJob(jobId).then(function(){if(createWatch){_create_watch_service.mlCreateWatchService.createNewWatch(jobId).catch().then(function(){resolve()})}else{resolve()}})}else{resolve()}})}}]);return PostSaveService}();var postSaveService=exports.postSaveService=new PostSaveService},2312:function(module,exports){module.exports='<div class=\'post-save-options\'>\n\n  <div class=\'form-group\'>\n    <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n      <input ng-model=\'runInRealtime\' ng-disabled="status.realtimeJob!==null" type="checkbox" class=\'kuiCheckBox\' ng-click="clickRunInRealtime()"/>\n      <span class="kuiCheckBoxLabel__text">\n        Continue job in real-time\n        <span ng-hide="status.realtimeJob===null">\n          <i ng-show="status.realtimeJob === STATUS.SAVE_FAILED" aria-hidden="true" style="color:red;" class="fa fa-remove"></i>\n          <i ng-show="status.realtimeJob === STATUS.SAVING" aria-hidden="true" class="fa fa-spinner fa-spin"></i>\n          <i ng-show="status.realtimeJob === STATUS.SAVED" aria-hidden="true" style="color:green;" class="fa fa-check"></i>\n         </span>\n      </span>\n    </label>\n  </div>\n  <div ng-show=\'watcherEnabled\' class=\'form-group\'>\n    <label\n      class=\'kuiCheckBoxLabel kuiVerticalRhythm\'\n      ng-class="{\'disabled\': !runInRealtime}">\n      <input ng-model=\'createWatch\' ng-disabled="!runInRealtime || status.realtimeJob!==null" type="checkbox" class=\'kuiCheckBox\' />\n      <span class="kuiCheckBoxLabel__text">\n        Create watch for real-time job\n        <span ng-hide="status.watch===null">\n          <i ng-show="status.watch === STATUS.SAVE_FAILED" aria-hidden="true" style="color:red;" class="fa fa-remove"></i>\n          <i ng-show="status.watch === STATUS.SAVING" aria-hidden="true" class="fa fa-spinner fa-spin"></i>\n          <i ng-show="status.watch === STATUS.SAVED" aria-hidden="true" style="color:green;" class="fa fa-check"></i>\n        </span>\n      </span>\n    </label>\n\n    <div ng-if=\'runInRealtime && createWatch\'>\n      <ml-create-watch\n        job-id=\'jobId\'\n        bucket-span=\'bucketSpan\'\n        include-influencers=\'includeInfluencers\'\n        embedded=\'embedded\'\n      ></ml-create-watch>\n    </div>\n  </div>\n\n  <button\n    aria-label="Create watch"\n    ng-click="apply()"\n    ng-hide=\'(status.realtimeJob===STATUS.SAVED && createWatch===false) || (status.realtimeJob===STATUS.SAVED && status.watch===STATUS.SAVED && createWatch===true)\'\n    ng-disabled=\'runInRealtime===false\'\n    type="button"\n    class="kuiButton kuiButton--primary">\n      Apply\n  </button>\n\n</div>\n'},2313:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2314)},2314:function(module,exports,__webpack_require__){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _bucket_span_estimator_view=__webpack_require__(2315);var _general=__webpack_require__(259);var _ml_api_service=__webpack_require__(22);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlBucketSpanEstimator",function(){return{restrict:"AE",replace:false,scope:{bucketSpanFieldChange:"=",formConfig:"=",jobStateWrapper:"=",JOB_STATE:"=jobState",ui:"=ui",exportedFunctions:"="},link:function link($scope,$element){var STATUS={FAILED:-1,NOT_RUNNING:0,RUNNING:1,FINISHED:2};var errorHandler=function errorHandler(error){console.log("Bucket span could not be estimated",error);$scope.ui.bucketSpanEstimator.status=STATUS.FAILED;$scope.ui.bucketSpanEstimator.message="Bucket span could not be estimated";$scope.$applyAsync()};$scope.guessBucketSpan=function(){$scope.ui.bucketSpanEstimator.status=STATUS.RUNNING;$scope.ui.bucketSpanEstimator.message="";$scope.$applyAsync();var data={aggTypes:[],duration:{start:$scope.formConfig.start,end:$scope.formConfig.end},fields:[],filters:$scope.formConfig.filters,index:$scope.formConfig.indexPattern.title,query:$scope.formConfig.combinedQuery,splitField:$scope.formConfig.splitField&&$scope.formConfig.splitField.name,timeField:$scope.formConfig.timeField};if($scope.formConfig.fields===undefined){var fieldName=$scope.formConfig.field===null?null:$scope.formConfig.field.name;data.fields.push(fieldName);data.aggTypes.push($scope.formConfig.agg.type.dslName)}else{Object.keys($scope.formConfig.fields).map(function(id){var field=$scope.formConfig.fields[id];var fieldName=field.id===_general.EVENT_RATE_COUNT_FIELD?null:field.name;data.fields.push(fieldName);data.aggTypes.push(field.agg.type.dslName)})}_ml_api_service.ml.estimateBucketSpan(data).then(function(interval){if(interval.error){errorHandler(interval.message);return}var notify=$scope.formConfig.bucketSpan!==interval.name;$scope.formConfig.bucketSpan=interval.name;$scope.ui.bucketSpanEstimator.status=STATUS.FINISHED;if(notify&&typeof $scope.bucketSpanFieldChange==="function"){$scope.bucketSpanFieldChange()}$scope.$applyAsync()}).catch(errorHandler)};if($scope.exportedFunctions!==undefined&&_typeof($scope.exportedFunctions)==="object"){$scope.exportedFunctions.guessBucketSpan=$scope.guessBucketSpan}$scope.$watch("formConfig.agg.type",updateButton,true);$scope.$watch("jobStateWrapper.jobState",updateButton,true);$scope.$watch("[ui.showJobInput,ui.formValid,ui.bucketSpanEstimator.status]",updateButton,true);function updateButton(){var buttonDisabled=$scope.ui.showJobInput===false||$scope.ui.formValid===false||$scope.formConfig.agg.type===undefined||$scope.jobStateWrapper.jobState===$scope.JOB_STATE.RUNNING||$scope.jobStateWrapper.jobState===$scope.JOB_STATE.STOPPING||$scope.jobStateWrapper.jobState===$scope.JOB_STATE.FINISHED||$scope.ui.bucketSpanEstimator.status===STATUS.RUNNING;var estimatorRunning=$scope.ui.bucketSpanEstimator.status===STATUS.RUNNING;var buttonText=estimatorRunning?"Estimating bucket span":"Estimate bucket span";var props={buttonDisabled:buttonDisabled,estimatorRunning:estimatorRunning,guessBucketSpan:$scope.guessBucketSpan,buttonText:buttonText};_reactDom2.default.render(_react2.default.createElement(_bucket_span_estimator_view.BucketSpanEstimator,props),$element[0])}updateButton()}}})},2315:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.BucketSpanEstimator=BucketSpanEstimator;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function BucketSpanEstimator(_ref){var buttonDisabled=_ref.buttonDisabled,buttonText=_ref.buttonText,estimatorRunning=_ref.estimatorRunning,guessBucketSpan=_ref.guessBucketSpan;return _react2.default.createElement("div",{className:"bucket-span-estimator"},_react2.default.createElement(_eui.EuiToolTip,{content:"Experimental feature for estimating bucket span.",position:"bottom"},_react2.default.createElement(_eui.EuiButton,{disabled:buttonDisabled,fill:true,iconSide:"right",isLoading:estimatorRunning,onClick:guessBucketSpan,size:"s"},buttonText)))}BucketSpanEstimator.propTypes={buttonDisabled:_propTypes2.default.bool.isRequired,buttonText:_propTypes2.default.string.isRequired,estimatorRunning:_propTypes2.default.bool.isRequired,guessBucketSpan:_propTypes2.default.func.isRequired}},2316:function(module,exports,__webpack_require__){"use strict";var _full_time_range_selector=__webpack_require__(2317);var _full_time_range_selector2=_interopRequireDefault(_full_time_range_selector);var _full_time_range_selector_service=__webpack_require__(471);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlFullTimeRangeSelector",function(Private){return{restrict:"E",replace:true,template:_full_time_range_selector2.default,scope:{indexPattern:"=",disabled:"=",query:"="},controller:function controller($scope){var mlFullTimeRangeSelectorService=Private(_full_time_range_selector_service.FullTimeRangeSelectorServiceProvider);$scope.setFullTimeRange=function(){mlFullTimeRangeSelectorService.setFullTimeRange($scope.indexPattern,$scope.query)}}}})},2317:function(module,exports){module.exports='<button\n  ng-click="setFullTimeRange()"\n  type="button"\n  ng-disabled="disabled"\n  class="euiButton euiButton--primary euiButton--small euiButton--fill">\n  <span class="euiButton__content">\n    Use full {{indexPattern.title}} data\n  </span>\n</button>\n'},2318:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _field_type_icon=__webpack_require__(996);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlFieldTypeIcon",function(){return{restrict:"E",replace:false,scope:{tooltipEnabled:"=",type:"="},link:function link(scope,element){scope.$watch("type",updateComponent);updateComponent();function updateComponent(){var props={tooltipEnabled:scope.tooltipEnabled,type:scope.type};_reactDom2.default.render(_react2.default.createElement(_field_type_icon.FieldTypeIcon,props),element[0])}}}})},2319:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2320)},2320:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2321);__webpack_require__(998);__webpack_require__(2323);__webpack_require__(209);__webpack_require__(339);__webpack_require__(472);__webpack_require__(639);__webpack_require__(999);__webpack_require__(2325);__webpack_require__(1e3);__webpack_require__(1001);__webpack_require__(1002);__webpack_require__(1003);__webpack_require__(1004);__webpack_require__(406);__webpack_require__(473);__webpack_require__(274)},2321:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _index=__webpack_require__(293);var _validation_utils=__webpack_require__(470);var _parse_interval=__webpack_require__(219);var _datemath=__webpack_require__(57);var _datemath2=_interopRequireDefault(_datemath);var _angular=__webpack_require__(21);var _angular2=_interopRequireDefault(_angular);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _check_license=__webpack_require__(43);var _check_privilege=__webpack_require__(32);var _ml_time_buckets=__webpack_require__(258);var _filter_agg_types=__webpack_require__(635);var _validate_job=__webpack_require__(469);var _adjust_interval=__webpack_require__(636);var _states=__webpack_require__(407);var _create_fields=__webpack_require__(637);var _index_utils=__webpack_require__(62);var _chart_data_utils=__webpack_require__(997);var _check_ml_nodes=__webpack_require__(47);var _new_job_defaults=__webpack_require__(241);var _string_utils=__webpack_require__(38);var _new_job_utils=__webpack_require__(220);var _job_service=__webpack_require__(23);var _prepopulate_job_settings=__webpack_require__(638);var _create_job_service=__webpack_require__(998);var _full_time_range_selector_service=__webpack_require__(471);var _messagebar_service=__webpack_require__(178);var _ml_api_service=__webpack_require__(22);var _create_job=__webpack_require__(2322);var _create_job2=_interopRequireDefault(_create_job);var _timefilter=__webpack_require__(16);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_routes2.default.when("/jobs/new_job/simple/multi_metric",{template:_create_job2.default,resolve:{CheckLicense:_check_license.checkLicenseExpired,privileges:_check_privilege.checkCreateJobsPrivilege,indexPattern:_index_utils.loadCurrentIndexPattern,savedSearch:_index_utils.loadCurrentSavedSearch,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable,loadNewJobDefaults:_new_job_defaults.loadNewJobDefaults}});var _module=_modules.uiModules.get("apps/ml");_module.controller("MlCreateMultiMetricJob",function($scope,$timeout,Private,AppState){_timefilter.timefilter.enableTimeRangeSelector();_timefilter.timefilter.disableAutoRefreshSelector();var msgs=_messagebar_service.mlMessageBarService;var MlTimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider);var moveToAdvancedJobCreation=Private(_new_job_utils.moveToAdvancedJobCreationProvider);var chartDataUtils=Private(_chart_data_utils.ChartDataUtilsProvider);var mlMultiMetricJobService=Private(_create_job_service.MultiMetricJobServiceProvider);var mlFullTimeRangeSelectorService=Private(_full_time_range_selector_service.FullTimeRangeSelectorServiceProvider);$scope.addNewJobToRecentlyAccessed=_new_job_utils.addNewJobToRecentlyAccessed;var stateDefaults={mlJobSettings:{}};var appState=new AppState(stateDefaults);mlMultiMetricJobService.clearChartData();$scope.chartData=mlMultiMetricJobService.chartData;var PAGE_WIDTH=_angular2.default.element(".multi-metric-job-container").width();var BAR_TARGET=PAGE_WIDTH>1600?800:PAGE_WIDTH/2;var MAX_BARS=BAR_TARGET+BAR_TARGET/100*100;var REFRESH_INTERVAL_MS=100;var MAX_BUCKET_DIFF=3;var METRIC_AGG_TYPE="metrics";var DEFAULT_MODEL_MEMORY_LIMIT="10MB";var refreshCounter=0;$scope.JOB_STATE=_states.JOB_STATE;$scope.jobState=$scope.JOB_STATE.NOT_STARTED;$scope.CHART_STATE=_states.CHART_STATE;$scope.chartStates={eventRate:_states.CHART_STATE.LOADING,fields:{}};var globalForceStop=false;var createSearchItems=Private(_new_job_utils.SearchItemsProvider);var _createSearchItems=createSearchItems(),indexPattern=_createSearchItems.indexPattern,savedSearch=_createSearchItems.savedSearch,query=_createSearchItems.query,filters=_createSearchItems.filters,combinedQuery=_createSearchItems.combinedQuery;(0,_index_utils.timeBasedIndexCheck)(indexPattern,true);var pageTitle=savedSearch.id!==undefined?"saved search "+savedSearch.title:"index pattern "+indexPattern.title;$scope.ui={indexPattern:indexPattern,pageTitle:pageTitle,showJobInput:true,showJobFinished:false,dirty:false,formValid:false,bucketSpanValid:true,bucketSpanEstimator:{status:0,message:""},cardinalityValidator:{status:0,message:""},aggTypeOptions:(0,_filter_agg_types.filterAggTypes)(_index.aggTypes.byType[METRIC_AGG_TYPE]),fields:[],splitFields:[],timeFields:[],splitText:"",intervals:[{title:"Auto",value:"auto"},{title:"Millisecond",value:"ms"},{title:"Second",value:"s"},{title:"Minute",value:"m"},{title:"Hourly",value:"h"},{title:"Daily",value:"d"},{title:"Weekly",value:"w"},{title:"Monthly",value:"M"},{title:"Yearly",value:"y"},{title:"Custom",value:"custom"}],eventRateChartHeight:100,chartHeight:150,showFieldCharts:false,showAdvanced:false,validation:{checks:{jobId:{valid:true},groupIds:{valid:true},modelMemoryLimit:{valid:true}}},isCountOrSum:false};$scope.formConfig={agg:{type:undefined},fields:{},bucketSpan:"15m",chartInterval:undefined,resultsIntervalSeconds:undefined,start:0,end:0,timeField:indexPattern.timeFieldName,splitField:undefined,influencerFields:[],firstSplitFieldName:undefined,indexPattern:indexPattern,query:query,filters:filters,combinedQuery:combinedQuery,usesSavedSearch:savedSearch.id!==undefined,jobId:"",description:"",jobGroups:[],useDedicatedIndex:false,enableModelPlot:false,isSparseData:false,modelMemoryLimit:DEFAULT_MODEL_MEMORY_LIMIT};$scope.formChange=function(){$scope.ui.isFormValid();$scope.ui.dirty=true;$scope.loadVis()};$scope.splitChange=function(){var splitField=$scope.formConfig.splitField;$scope.formConfig.firstSplitFieldName=undefined;if(splitField!==undefined){$scope.addDefaultFieldsToInfluencerList();$scope.ui.splitText="Data split by "+splitField.name;chartDataUtils.getSplitFields($scope.formConfig,$scope.formConfig.splitField.name,10).then(function(resp){if(resp.results.values&&resp.results.values.length){$scope.formConfig.firstSplitFieldName=resp.results.values[0]}setFieldsChartStates(_states.CHART_STATE.LOADING);drawCards(resp.results.values);$scope.formChange()});$scope.setModelMemoryLimit()}else{setFieldsChartStates(_states.CHART_STATE.LOADING);$scope.ui.splitText="";$scope.formConfig.modelMemoryLimit=DEFAULT_MODEL_MEMORY_LIMIT;destroyCards();$scope.formChange()}};$scope.splitReset=function(){$scope.formConfig.splitField=undefined;$scope.splitChange()};function setTime(){$scope.ui.bucketSpanValid=true;$scope.formConfig.start=_datemath2.default.parse(_timefilter.timefilter.getTime().from).valueOf();$scope.formConfig.end=_datemath2.default.parse(_timefilter.timefilter.getTime().to).valueOf();$scope.formConfig.format="epoch_millis";var bucketSpanInterval=(0,_parse_interval.parseInterval)($scope.formConfig.bucketSpan);if(bucketSpanInterval===null||bucketSpanInterval.asMilliseconds()===0){$scope.ui.bucketSpanValid=false}var bounds=_timefilter.timefilter.getActiveBounds();$scope.formConfig.chartInterval=new MlTimeBuckets;$scope.formConfig.chartInterval.setBarTarget(BAR_TARGET);$scope.formConfig.chartInterval.setMaxBars(MAX_BARS);$scope.formConfig.chartInterval.setInterval("auto");$scope.formConfig.chartInterval.setBounds(bounds);(0,_adjust_interval.adjustIntervalDisplayed)($scope.formConfig);$scope.ui.isFormValid();$scope.ui.dirty=true}function initAgg(){_lodash2.default.each($scope.ui.aggTypeOptions,function(agg){if(agg.title==="Mean"){$scope.formConfig.agg.type=agg}})}$scope.ui.isFormValid=function(){if($scope.formConfig.agg.type===undefined||$scope.formConfig.timeField===undefined||Object.keys($scope.formConfig.fields).length===0){$scope.ui.formValid=false}else{$scope.ui.formValid=true}return $scope.ui.formValid};$scope.loadVis=function(){var thisLoadTimestamp=Date.now();$scope.chartData.lastLoadTimestamp=thisLoadTimestamp;setTime();$scope.ui.isFormValid();$scope.ui.showJobInput=true;$scope.ui.showJobFinished=false;$scope.ui.dirty=false;showSparseDataCheckbox();mlMultiMetricJobService.clearChartData();setFieldsChartStates(_states.CHART_STATE.LOADING);if(Object.keys($scope.formConfig.fields).length){$scope.ui.showFieldCharts=true;mlMultiMetricJobService.getLineChartResults($scope.formConfig,thisLoadTimestamp).then(function(resp){$scope.$applyAsync();loadDocCountData(resp.detectors)}).catch(function(resp){msgs.error(resp.message);_lodash2.default.each($scope.formConfig.fields,function(field,id){$scope.chartStates.fields[id]=_states.CHART_STATE.NO_RESULTS});$scope.$applyAsync()})}else{$scope.ui.showFieldCharts=false;loadDocCountData([])}function loadDocCountData(dtrs){chartDataUtils.loadDocCountData($scope.formConfig,$scope.chartData).then(function(resp){if(thisLoadTimestamp===$scope.chartData.lastLoadTimestamp){_lodash2.default.each(dtrs,function(dtr,id){var state=resp.totalResults?_states.CHART_STATE.LOADED:_states.CHART_STATE.NO_RESULTS;$scope.chartStates.fields[id]=state});$scope.chartData.lastLoadTimestamp=null;chartDataUtils.updateChartMargin($scope.chartData);$scope.chartStates.eventRate=resp.totalResults?_states.CHART_STATE.LOADED:_states.CHART_STATE.NO_RESULTS;$scope.$broadcast("render")}}).catch(function(resp){$scope.chartStates.eventRate=_states.CHART_STATE.NO_RESULTS;msgs.error(resp.message)}).then(function(){$scope.$applyAsync()})}};function setFieldsChartStates(state){_lodash2.default.each($scope.chartStates.fields,function(chart,key){$scope.chartStates.fields[key]=state});$scope.$applyAsync()}function showSparseDataCheckbox(){$scope.ui.isCountOrSum=false;_lodash2.default.each($scope.formConfig.fields,function(fd){if(fd.agg.type.dslName==="count"||fd.agg.type.dslName==="sum"){$scope.ui.isCountOrSum=true}})}function drawCards(labels){var $frontCard=_angular2.default.element(".multi-metric-job-container .detector-container .card-front");$frontCard.addClass("card");$frontCard.find(".card-title").text(labels[0]);var marginTop=labels.length>1?54:0;$frontCard.css("margin-top",marginTop);var backCardTitle="";if(labels.length===2){backCardTitle=$scope.formConfig.fields[Object.keys($scope.formConfig.fields)[0]].agg.type.title;backCardTitle+=" ";backCardTitle+=Object.keys($scope.formConfig.fields)[0]}_angular2.default.element(".card-behind").remove();for(var _i=0;_i<labels.length;_i++){var el='<div class="card card-behind card-behind-'+_i+'"><div class="card-title">';el+=(0,_string_utils.mlEscape)(labels[_i]);el+='</div><label class="kuiFormLabel">';el+=(0,_string_utils.mlEscape)(backCardTitle);el+="</label></div>";var $backCard=_angular2.default.element(el);$backCard.css("z-index",9-_i);$backCard.insertBefore($frontCard)}var cardsBehind=_angular2.default.element(".card-behind");for(var _i2=0;_i2<cardsBehind.length;_i2++){cardsBehind[_i2].style.marginTop=marginTop+"px";marginTop-=(10-_i2*(10/labels.length))*(10/labels.length)}var i=0;var then=window.performance.now();var fps=20;var fpsInterval=1e3/fps;function fadeCard(callTime){if(i<cardsBehind.length){var now=callTime;var elapsed=now-then;if(elapsed>fpsInterval){cardsBehind[i].style.opacity=1;i++;then=now-elapsed%fpsInterval}window.requestAnimationFrame(fadeCard)}}fadeCard()}function destroyCards(){_angular2.default.element(".card-behind").remove();var $frontCard=_angular2.default.element(".multi-metric-job-container .detector-container .card-front");$frontCard.removeClass("card");$frontCard.find(".card-title").text("");$frontCard.css("margin-top",0)}var refreshInterval=REFRESH_INTERVAL_MS;$scope.createJob=function(){var tempJob=mlMultiMetricJobService.getJobFromConfig($scope.formConfig);if((0,_validate_job.validateJob)(tempJob,$scope.ui.validation.checks)){msgs.clear();mlMultiMetricJobService.createJob($scope.formConfig).then(function(job){_job_service.mlJobService.openJob(job.job_id).then(function(){saveNewDatafeed(job,true)}).catch(function(resp){msgs.error("Could not open job: ",resp);msgs.error("Job created, creating datafeed anyway");saveNewDatafeed(job,false)})}).catch(function(resp){msgs.error("Save failed: ",resp.resp);$scope.$applyAsync()})}else{if($scope.ui.validation.checks.modelMemoryLimit.valid===false){$scope.ui.showAdvanced=true}}function saveNewDatafeed(job,startDatafeedAfterSave){_job_service.mlJobService.saveNewDatafeed(job.datafeed_config,job.job_id).then(function(){if(startDatafeedAfterSave){mlMultiMetricJobService.startDatafeed($scope.formConfig).then(function(){$scope.jobState=_states.JOB_STATE.RUNNING;refreshCounter=0;refreshInterval=REFRESH_INTERVAL_MS;$scope.formConfig.resultsIntervalSeconds=$scope.formConfig.chartInterval.getInterval().asSeconds();var bucketSpanSeconds=(0,_parse_interval.parseInterval)($scope.formConfig.bucketSpan).asSeconds();if($scope.formConfig.resultsIntervalSeconds<bucketSpanSeconds){$scope.formConfig.resultsIntervalSeconds=bucketSpanSeconds}$scope.resultsUrl=_job_service.mlJobService.createResultsUrl([$scope.formConfig.jobId],$scope.formConfig.start,$scope.formConfig.end,"explorer");(0,_new_job_utils.focusOnResultsLink)("job_running_view_results_link",$timeout);loadCharts()}).catch(function(resp){msgs.error("Could not start datafeed: ",resp)}).then(function(){$scope.$applyAsync()})}else{$scope.$applyAsync()}}).catch(function(resp){msgs.error("Save datafeed failed: ",resp);$scope.$applyAsync()})}};$scope.getJobFromConfig=mlMultiMetricJobService.getJobFromConfig;(0,_validation_utils.addJobValidationMethods)($scope,mlMultiMetricJobService);function loadCharts(){var forceStop=globalForceStop;var counterLimit=20-refreshInterval/REFRESH_INTERVAL_MS;if(refreshCounter>=counterLimit){refreshCounter=0;_job_service.mlJobService.updateSingleJobDatafeedState($scope.formConfig.jobId).then(function(state){if(state==="stopped"){console.log("Stopping poll because datafeed state is: "+state);$scope.$applyAsync();$scope.$broadcast("render-results");forceStop=true}run()})}else{run()}function run(){refreshCounter++;reloadJobSwimlaneData().then(function(){reloadDetectorSwimlane().then(function(){if(forceStop===false&&$scope.chartData.percentComplete<100){if($scope.jobState===_states.JOB_STATE.STOPPING){$scope.jobState=_states.JOB_STATE.STOPPING}else{$scope.jobState=_states.JOB_STATE.RUNNING}}else{$scope.jobState=_states.JOB_STATE.FINISHED;(0,_new_job_utils.focusOnResultsLink)("job_finished_view_results_link",$timeout)}jobCheck()})})}}function jobCheck(){if($scope.jobState===_states.JOB_STATE.RUNNING||$scope.jobState===_states.JOB_STATE.STOPPING){refreshInterval=adjustRefreshInterval($scope.chartData.loadingDifference,refreshInterval);_lodash2.default.delay(loadCharts,refreshInterval)}else{_lodash2.default.each($scope.chartData.detectors,function(chart){chart.percentComplete=100})}if($scope.chartData.percentComplete>0){toggleSwimlaneVisibility()}$scope.$applyAsync();$scope.$broadcast("render-results")}function reloadJobSwimlaneData(){return chartDataUtils.loadJobSwimlaneData($scope.formConfig,$scope.chartData)}function reloadDetectorSwimlane(){return chartDataUtils.loadDetectorSwimlaneData($scope.formConfig,$scope.chartData)}function adjustRefreshInterval(loadingDifference,currentInterval){var INTERVAL_INCREASE_MS=100;var MAX_INTERVAL=1e4;var interval=currentInterval;if(interval<MAX_INTERVAL){if(loadingDifference<MAX_BUCKET_DIFF){interval=interval+INTERVAL_INCREASE_MS}else{if(interval-INTERVAL_INCREASE_MS>=REFRESH_INTERVAL_MS){interval=interval-INTERVAL_INCREASE_MS}}}return interval}$scope.resetJob=function(){$scope.jobState=_states.JOB_STATE.NOT_STARTED;toggleSwimlaneVisibility();window.setTimeout(function(){$scope.ui.showJobInput=true;$scope.loadVis()},500)};function toggleSwimlaneVisibility(){if($scope.jobState===_states.JOB_STATE.NOT_STARTED){_angular2.default.element(".swimlane-cells").css("opacity",0);_angular2.default.element(".bar").css("opacity",1)}else{_angular2.default.element(".bar").css("opacity",.1)}}$scope.stopJob=function(){$scope.jobState=_states.JOB_STATE.STOPPING;mlMultiMetricJobService.stopDatafeed($scope.formConfig).catch().then(function(){$scope.$applyAsync()})};$scope.moveToAdvancedJobCreation=function(){var job=mlMultiMetricJobService.getJobFromConfig($scope.formConfig);moveToAdvancedJobCreation(job)};var lastEstimatedModelMemoryLimit=null;$scope.setModelMemoryLimit=function(){var formConfig=$scope.formConfig;_ml_api_service.ml.calculateModelMemoryLimit({indexPattern:formConfig.indexPattern.title,splitFieldName:formConfig.splitField.name,query:formConfig.combinedQuery,fieldNames:Object.keys(formConfig.fields),influencerNames:formConfig.influencerFields.map(function(f){return f.name}),timeFieldName:formConfig.timeField,earliestMs:formConfig.start,latestMs:formConfig.end}).then(function(resp){var currentModelMemoryLimit=formConfig.modelMemoryLimit.toLowerCase();var defaultModelMemoryLimit=DEFAULT_MODEL_MEMORY_LIMIT.toLowerCase();if(currentModelMemoryLimit===defaultModelMemoryLimit||currentModelMemoryLimit===lastEstimatedModelMemoryLimit){formConfig.modelMemoryLimit=resp.modelMemoryLimit}lastEstimatedModelMemoryLimit=resp.modelMemoryLimit.toLowerCase()}).catch(function(){var currentModelMemoryLimit=formConfig.modelMemoryLimit.toLowerCase();if(currentModelMemoryLimit===lastEstimatedModelMemoryLimit){formConfig.modelMemoryLimit=DEFAULT_MODEL_MEMORY_LIMIT}})};$scope.setFullTimeRange=function(){return mlFullTimeRangeSelectorService.setFullTimeRange($scope.ui.indexPattern,$scope.formConfig.combinedQuery)};initAgg();(0,_create_fields.createFields)($scope,indexPattern);$scope.loadVis();$scope.$evalAsync(function(){(0,_prepopulate_job_settings.preLoadJob)($scope,appState)});$scope.$listenAndDigestAsync(_timefilter.timefilter,"fetch",function(){$scope.loadVis();if($scope.formConfig.splitField!==undefined){$scope.setModelMemoryLimit()}});$scope.$on("$destroy",function(){globalForceStop=true;_angular2.default.element(window).off("resize")})})},2322:function(module,exports){module.exports='<ml-nav-menu name="new_job_multi_metric"></ml-nav-menu>\n<ml-new-job-multi-metric>\n  <ml-message-bar></ml-message-bar>\n  <div ng-controller="MlCreateMultiMetricJob" class="multi-metric-job-container">\n    <div class="row">\n      <div class="col-md-6">\n        <h1 class="euiTitle euiTitle--large">New job from {{ui.pageTitle}}</h1>\n      </div>\n      <div class="col-md-6">\n        <div class="pull-right">\n          <span style="font-size:10px;" ng-show="formConfig.chartInterval !== undefined">Chart interval: {{formConfig.chartInterval.getInterval().expression}}</span>\n          <ml-full-time-range-selector\n            disabled=\'(jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED)\'\n            index-pattern=\'ui.indexPattern\'\n            query=\'formConfig.combinedQuery\'\n          ></ml-full-time-range-selector>\n        </div>\n      </div>\n    </div>\n\n    <div class="euiSpacer euiSpacer--s"></div>\n\n    <div class="row">\n      <div class="col-md-4">\n        <div class="row form-controls">\n          <h4 class="euiTitle euiTitle--small">Job settings</h4>\n          <div>\n            <div class=\'form-section\'>\n              <ml-fields-selection></ml-fields-selection>\n            </div>\n\n            <div class=\'form-section form-section-overflow\' >\n              <h4 class="euiTitle euiTitle--small">\n                Split Data\n                <button\n                  ng-if="formConfig.splitField !== undefined && (!ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED)"\n                  ng-click="splitReset()"\n                  aria-label="Reset Split Data to none."\n                  ng-disabled="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                  class="euiButton euiButton--primary euiButton--small remove-split"\n                >\n                  Remove split\n                </button>\n              </h4>\n              <div class="euiSpacer euiSpacer--s"></div>\n              <div class="row">\n                <div class="col-md-12">\n                  <div class="form-group">\n                    <ui-select\n                      ng-model="formConfig.splitField"\n                      ng-change="splitChange()"\n                      ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                    >\n                        <ui-select-match placeholder="Select a field">\n                          <ml-field-type-icon type="$select.selected.mlType"></ml-field-type-icon>{{$select.selected.name}}\n                        </ui-select-match>\n                        <ui-select-choices repeat="field in ui.splitFields | filter: { name: $select.search }" group-by="\'mlType\'">\n                          <div>\n                            <ml-field-type-icon type="field.mlType"></ml-field-type-icon>\n                            <span\n                              class="select-item"\n                              ng-bind-html="field.name | highlight: $select.search">\n                            </span>\n                          </div>\n                        </ui-select-choices>\n                    </ui-select>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div class=\'form-section\' >\n              <ml-influencers-selection></ml-influencers-selection>\n            </div>\n\n            <div class=\'form-section\' >\n              <ml-bucket-span-selection></ml-bucket-span-selection>\n            </div>\n\n            <div class=\'form-section\' >\n              <div ng-show="jobState !== JOB_STATE.FINISHED">\n                <h4 class="euiTitle euiTitle--small">Job Details</h4>\n                <div class="euiSpacer euiSpacer--s"></div>\n              </div>\n\n              <div class="form-group">\n                <div ng-show="ui.showJobInput && (jobState === JOB_STATE.NOT_STARTED || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING)">\n                  <ml-general-job-details></ml-general-job-details>\n\n                  <div class="form-group">\n                    <a href="" ng-click="moveToAdvancedJobCreation()">Move to advanced job configuration</a>\n                  </div>\n\n                  <div class="euiFlexGroup euiFlexGroup--gutterSmall euiFlexGroup--alignItemsCenter euiFlexGroup--responsive">\n                    <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                      <ml-validate-job\n                        get-duration="getDuration"\n                        get-job-config="getJobConfig"\n                        fill="false"\n                        is-current-job-config="isCurrentJobConfig"\n                        is-disabled="!ui.formValid"\n                        ng-show="jobState === JOB_STATE.NOT_STARTED"\n                      />\n                    </div>\n                    <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                      <button\n                        aria-label="Create Job"\n                        ng-click="createJob()"\n                        type="button"\n                        ng-show="jobState === JOB_STATE.NOT_STARTED"\n                        ng-disabled="!ui.formValid"\n                        class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                        <span class="euiButton__content">\n                          Create Job\n                        </span>\n                      </button>\n                    </div>\n                  </div>\n\n                  <div class=\'job-state-info\' ng-show="jobState === JOB_STATE.RUNNING">Analysis running <i class=\'fa fa-spinner fa-spin\'></i></div>\n                  <div class=\'job-state-info\' ng-show="jobState === JOB_STATE.STOPPING">Analysis stopping <i class=\'fa fa-spinner fa-spin\'></i></div>\n\n                  <div class="euiSpacer euiSpacer--s"></div>\n\n                  <button\n                    aria-label="Stop Job"\n                    ng-click="stopJob()"\n                    type="button"\n                    ng-show="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING"\n                    ng-disabled="jobState === JOB_STATE.STOPPING"\n                    class="euiButton euiButton--danger euiButton--small">\n                    <span class="euiButton__content">\n                      {{(jobState === JOB_STATE.STOPPING) ? \'Analysis stopping\' : \'Stop analysis\' }}\n                    </span>\n                  </button>\n\n                  <a\n                    href=\'{{resultsUrl}}\'\n                    id="job_running_view_results_link"\n                    ng-click="addNewJobToRecentlyAccessed(formConfig.jobId, resultsUrl)"\n                    aria-label="View results of running job"\n                    ng-show="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      View Results\n                    </span>\n                  </a>\n                </div>\n                <div ng-show="jobState === JOB_STATE.FINISHED">\n                  <h3 class="euiTitle euiTitle--large">Job {{formConfig.jobId }} created\n                    <i style="color:green;" class="fa fa-check" aria-label="Job finished"></i>\n                  </h3>\n                  <div class="euiSpacer euiSpacer--m"></div>\n\n                  <button\n                    aria-label="Reset"\n                    ng-click="resetJob()"\n                    type="button"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      Reset\n                    </span>\n                  </button>\n                  <a\n                    href=\'{{resultsUrl}}\'\n                    id="job_finished_view_results_link"\n                    ng-click="addNewJobToRecentlyAccessed(formConfig.jobId, resultsUrl)"\n                    aria-label="View results of finished job"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      View Results\n                    </span>\n                  </a>\n                </div>\n\n                <div ng-if=\'jobState === JOB_STATE.FINISHED\'>\n                  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n                  <ml-post-save-options\n                    job-id=\'formConfig.jobId\'\n                    bucket-span=\'formConfig.bucketSpan\'\n                    include-influencers=\'true\'\n                    ></ml-post-save-options>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class="col-md-8">\n        <div class="row charts-container">\n          <h4 class="euiTitle euiTitle--small">Results</h4>\n          <div>\n            <div class=\'chart-list-panel event-rate-container\' style=\'height: {{ui.eventRateChartHeight + 70}}px;\'>\n              <label class="kuiFormLabel">Document count</label>\n\n              <div class=\'chart-container\'>\n                <div style=\'height: {{ui.eventRateChartHeight + 25}}px;\'>\n                  <ml-event-rate-chart\n                    chart-data="chartData.job"\n                    event-rate-chart-height=\'ui.eventRateChartHeight\'\n                    chart-ticks-margin="chartData.chartTicksMargin">\n                  </ml-event-rate-chart>\n                </div>\n\n                <div ng-show="chartStates.eventRate === CHART_STATE.NOT_STARTED || chartStates.eventRate === CHART_STATE.LOADING || chartStates.eventRate === CHART_STATE.NO_RESULTS"\n                  class=\'chart-loader event-rate-chart-loader\'\n                  style=\'height: {{ui.eventRateChartHeight}}px; margin-top: -{{ui.eventRateChartHeight + 30}}px;\'>\n                    <div class=\'status-label\' ng-if="chartStates.eventRate === CHART_STATE.NOT_STARTED"></div>\n                    <div class=\'status-label\' ng-if="chartStates.eventRate === CHART_STATE.LOADING">\n                      <h2 class="euiTitle euiTitle"><i class=\'fa fa-spinner fa-spin\'></i></h2>\n                    </div>\n                    <div class=\'status-label\' ng-if="chartStates.eventRate === CHART_STATE.NO_RESULTS">\n                      <div class=\'no-results\'>\n                        <h4 class="euiTitle euiTitle--small"><i class="fa fa-info-circle"></i> No results found</h4>\n                        <span>Consider using the <a ng-click="setFullTimeRange()">full {{ui.indexPattern.title}} data</a></span>\n                      </div>\n                    </div>\n                </div>\n\n              </div>\n\n            </div>\n            <div class=\'chart-list-panel detector-container\' ng-show=\'ui.showFieldCharts\'>\n              <label  class="kuiFormLabel" ng-hide="ui.splitText === \'\'">{{ui.splitText}}</label>\n              <div class=\'card-front\'>\n                <div class="card-title"></div>\n                <div ng-repeat=\'(id, chart) in chartData.detectors\' class=\'chart\' style=\'height: {{ui.chartHeight + 50}}px;\'>\n                  <label class="kuiFormLabel">{{formConfig.fields[id].agg.type.title}} {{formConfig.fields[id].name}}</label>\n                  <div class=\'chart-container\'>\n                    <div style=\'height: {{ui.chartHeight + 25}}px;\'>\n                      <ml-multi-metric-job-chart\n                        chart-data="chart"\n                        chart-height=\'ui.chartHeight\'\n                        chart-ticks-margin="chartData.chartTicksMargin">\n                      </ml-multi-metric-job-chart>\n                    </div>\n\n                    <div ng-show="chartStates.fields[id] === CHART_STATE.NOT_STARTED || chartStates.fields[id] === CHART_STATE.LOADING || chartStates.fields[id] === CHART_STATE.NO_RESULTS"\n                      class=\'chart-loader fields-chart-loader\'\n                      style=\'height: {{ui.chartHeight}}px; margin-top: -{{ui.chartHeight + 30}}px; margin-left: {{chartData.chartTicksMargin.width - 1}}px;\'>\n                        <div class=\'status-label\' ng-show="chartStates.fields[id] === CHART_STATE.NOT_STARTED"></div>\n                        <div class=\'status-label\' ng-show="chartStates.fields[id] === CHART_STATE.LOADING">\n                          <h2 class="euiTitle euiTitle"><i class=\'fa fa-spinner fa-spin\'></i></h2>\n                        </div>\n                        <div class=\'status-label\' ng-show="chartStates.fields[id] === CHART_STATE.NO_RESULTS">\n                          <div class=\'no-results\'>\n                            <h4 class="euiTitle euiTitle--small"><i class="fa fa-info-circle"></i> No results found</h4>\n                          </div>\n                        </div>\n                    </div>\n\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</ml-new-job-multi-metric>\n'},2323:function(module,exports,__webpack_require__){"use strict";var _jquery=__webpack_require__(17);var _jquery2=_interopRequireDefault(_jquery);var _d=__webpack_require__(20);var _d2=_interopRequireDefault(_d);var _angular=__webpack_require__(21);var _angular2=_interopRequireDefault(_angular);var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _time_buckets=__webpack_require__(218);var _chart_utils=__webpack_require__(197);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlMultiMetricJobChart",function(){function link(scope,element){var svgWidth=0;var lineChartHeight=scope.chartHeight;var marginTop=5;var progressBarMarginBottom=lineChartHeight+marginTop-15;var margin={top:marginTop,right:1,bottom:20,left:scope.chartTicksMargin.width};var svgHeight=lineChartHeight+margin.top+margin.bottom;var vizWidth=svgWidth-margin.left-margin.right;var chartLimits={max:0,min:0};var lineChartXScale=null;var lineChartYScale=null;var lineChartGroup=void 0;var swimlaneGroup=void 0;var lineChartValuesLine=null;var $progressBar=void 0;scope.$on("render",function(){init();createSVGGroups();drawLineChart()});scope.$on("render-results",function(){drawResults()});element.on("$destroy",function(){scope.$destroy()});function init(){var $el=_angular2.default.element(".multi-metric-job-container .card-front");var offset=$el.hasClass("card")?30:0;margin.left=scope.chartTicksMargin.width;svgWidth=$el.width()-offset;vizWidth=svgWidth-margin.left-margin.right;lineChartXScale=_d2.default.time.scale().range([0,vizWidth]);lineChartYScale=_d2.default.scale.linear().range([lineChartHeight,0]);lineChartValuesLine=_d2.default.svg.line().x(function(d){return lineChartXScale(d.date)}).y(function(d){return lineChartYScale(d.value)}).defined(function(d){return d.value!==null})}function createSVGGroups(){if(scope.chartData.line===undefined){return}var chartElement=_d2.default.select(element.get(0));chartElement.select("svg").remove();chartElement.select(".progress").remove();if(chartElement.select(".progress-bar")[0][0]===null){var style="width: "+(+vizWidth+2)+"px;\n          margin-bottom: -"+ +progressBarMarginBottom+"px;\n          margin-left: "+(+margin.left-1)+"px;'";chartElement.append("div").attr("class","progress").attr("style",style).append("div").attr("class","progress-bar")}$progressBar=(0,_jquery2.default)(".progress-bar");var svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight);swimlaneGroup=svg.append("g").attr("class","swimlane").attr("transform","translate("+margin.left+", "+margin.top+")");lineChartGroup=svg.append("g").attr("class","line-chart").attr("transform","translate("+margin.left+", "+margin.top+")")}function drawLineChart(){var data=scope.chartData.line;lineChartXScale=lineChartXScale.domain(_d2.default.extent(data,function(d){return d.date}));chartLimits.max=_d2.default.max(data,function(d){return d.value});chartLimits.min=_d2.default.min(data,function(d){return d.value});var padding=(chartLimits.max-chartLimits.min)*.05;chartLimits.max+=padding;chartLimits.min-=padding;lineChartYScale=lineChartYScale.domain([chartLimits.min,chartLimits.max]);var timeBuckets=new _time_buckets.TimeBuckets;timeBuckets.setInterval("auto");if(data.length>0){var xDomain=lineChartXScale.domain();var bounds={min:(0,_moment2.default)(xDomain[0]),max:(0,_moment2.default)(xDomain[1])};timeBuckets.setBounds(bounds)}var xAxisTickFormat=timeBuckets.getScaledDateFormat();var xAxis=_d2.default.svg.axis().scale(lineChartXScale).orient("bottom").innerTickSize(-lineChartHeight).outerTickSize(0).tickPadding(10).ticks((0,_chart_utils.numTicksForDateFormat)(vizWidth,xAxisTickFormat)).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)});var yAxis=_d2.default.svg.axis().scale(lineChartYScale).orient("left").innerTickSize(-vizWidth).outerTickSize(0).tickPadding(10);if(scope.chartData.fieldFormat!==undefined){yAxis.tickFormat(function(d){return scope.chartData.fieldFormat.convert(d,"text")})}swimlaneGroup.append("rect").attr("x",0).attr("y",0).attr("height",lineChartHeight).attr("width",vizWidth).style("fill","#FFFFFF");lineChartGroup.append("rect").attr("x",0).attr("y",0).attr("height",lineChartHeight).attr("width",vizWidth).style("stroke","#cccccc").style("fill","none").style("stroke-width",1);drawLineChartAxes(xAxis,yAxis);drawLineChartPaths(data);(0,_chart_utils.drawLineChartDots)(data,lineChartGroup,lineChartValuesLine)}function drawLineChartAxes(xAxis,yAxis){var axes=lineChartGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0, "+lineChartHeight+")").call(xAxis);axes.append("g").attr("class","y axis").call(yAxis)}function drawLineChartPaths(data){lineChartGroup.append("path").attr("class","values-line").attr("d",lineChartValuesLine(data))}function drawResults(){drawSwimlane(vizWidth,lineChartHeight);updateProgressBar()}function drawSwimlane(swlWidth,swlHeight){var data=scope.chartData.swimlane;var cellWidth=0;if(data.length>0){cellWidth=lineChartXScale(data[0].time+scope.chartData.swimlaneInterval)-lineChartXScale(data[0].time)}_d2.default.time.scale().range([0,swlWidth]).domain(_d2.default.extent(data,function(d){return d.date}));_d2.default.scale.linear().range([swlHeight,0]).domain([0,swlHeight]);var color=_d2.default.scale.threshold().domain([3,25,50,75,100]).range(["#d2e9f7","#8bc8fb","#ffdd00","#ff7e00","#fe5050"]);swimlaneGroup.select(".swimlane-cells").remove();var cells=swimlaneGroup.append("g").attr("class","swimlane-cells").selectAll("cells").data(data);cells.enter().append("rect").attr("x",function(d){return lineChartXScale(d.date)}).attr("y",0).attr("rx",0).attr("ry",0).attr("class",function(d){return d.value>0?"swimlane-cell":"swimlane-cell-hidden"}).attr("width",cellWidth-0).attr("height",swlHeight-0).style("fill",function(d){return color(d.value)})}function updateProgressBar(){var pcnt=scope.chartData.percentComplete<100?scope.chartData.percentComplete:0;$progressBar.css("width",pcnt+"%")}}return{scope:{chartData:"=",chartHeight:"=",chartTicksMargin:"="},link:link}})},2324:function(module,exports,__webpack_require__){"use strict";var _jquery=__webpack_require__(17);var _jquery2=_interopRequireDefault(_jquery);var _d=__webpack_require__(20);var _d2=_interopRequireDefault(_d);var _angular=__webpack_require__(21);var _angular2=_interopRequireDefault(_angular);var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _time_buckets=__webpack_require__(218);var _chart_utils=__webpack_require__(197);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlEventRateChart",function(){function link(scope,element){var svgWidth=0;var barChartHeight=scope.eventRateChartHeight;var marginTop=5;var progressBarMarginBottom=barChartHeight+marginTop-15;var margin={top:marginTop,right:1,bottom:20,left:scope.chartTicksMargin.width};var svgHeight=barChartHeight+margin.top+margin.bottom;var vizWidth=svgWidth-margin.left-margin.right;var chartLimits={max:0,min:0};var barChartXScale=null;var swimlaneXScale=null;var barChartYScale=null;var barChartGroup=void 0;var swimlaneGroup=void 0;var $progressBar=void 0;scope.$on("render",function(){init();createSVGGroups();drawBarChart()});scope.$on("render-results",function(){drawResults()});element.on("$destroy",function(){scope.$destroy()});function init(){var $el=_angular2.default.element(".event-rate-container");margin.left=scope.chartTicksMargin.width;svgWidth=$el.width();vizWidth=svgWidth-margin.left-margin.right;barChartXScale=_d2.default.scale.linear().rangeRound([0,vizWidth],.05);swimlaneXScale=_d2.default.time.scale().range([0,vizWidth]);barChartYScale=_d2.default.scale.linear().range([barChartHeight,0])}function createSVGGroups(){if(scope.chartData.bars===undefined){return}var chartElement=_d2.default.select(element.get(0));chartElement.select("svg").remove();chartElement.select(".progress").remove();if(chartElement.select(".progress-bar")[0][0]===null){var style="width: "+(+vizWidth+2)+"px;\n          margin-bottom: -"+ +progressBarMarginBottom+"px;\n          margin-left: "+(+margin.left-1)+"px;'";chartElement.append("div").attr("class","progress").attr("style",style).append("div").attr("class","progress-bar")}$progressBar=(0,_jquery2.default)(".progress-bar");var svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight);barChartGroup=svg.append("g").attr("class","bar-chart").attr("transform","translate("+margin.left+","+margin.top+")");swimlaneGroup=svg.append("g").attr("class","swimlane").attr("transform","translate("+margin.left+","+margin.top+")")}function drawBarChart(){var data=scope.chartData.bars;var finerData=scope.chartData.bars;if(scope.chartData.line.length>0){finerData=scope.chartData.line}swimlaneXScale.domain(_d2.default.extent(finerData,function(d){return d.date}));var timeExtent=_d2.default.extent(data,function(d){return d.date});timeExtent[1]=new Date(timeExtent[1].getTime()+scope.chartData.barsInterval);barChartXScale=_d2.default.time.scale().range([0,vizWidth]).domain(timeExtent);chartLimits.max=_d2.default.max(data,function(d){return d.value});chartLimits.min=0;var padding=(chartLimits.max-chartLimits.min)*.05;chartLimits.max+=padding;barChartYScale=barChartYScale.domain([chartLimits.min,chartLimits.max]);var timeBuckets=new _time_buckets.TimeBuckets;timeBuckets.setInterval("auto");if(data.length>0){var xDomain=barChartXScale.domain();var bounds={min:(0,_moment2.default)(xDomain[0]),max:(0,_moment2.default)(xDomain[1])};timeBuckets.setBounds(bounds)}var xAxisTickFormat=timeBuckets.getScaledDateFormat();var xAxis=_d2.default.svg.axis().scale(swimlaneXScale).orient("bottom").innerTickSize(-barChartHeight).outerTickSize(0).tickPadding(10).ticks((0,_chart_utils.numTicksForDateFormat)(vizWidth,xAxisTickFormat)).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)});var yAxis=_d2.default.svg.axis().scale(barChartYScale).orient("left").innerTickSize(-vizWidth).outerTickSize(0).tickPadding(10);barChartGroup.append("rect").attr("x",0).attr("y",0).attr("height",barChartHeight).attr("width",vizWidth).style("fill","#FFFFFF");barChartGroup.append("rect").attr("x",0).attr("y",0).attr("height",barChartHeight).attr("width",vizWidth).style("stroke","#cccccc").style("fill","none").style("stroke-width",1);drawBarChartAxes(xAxis,yAxis);drawBarChartPaths(data)}function drawBarChartAxes(xAxis,yAxis){var axes=barChartGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0,"+barChartHeight+")").call(xAxis);axes.append("g").attr("class","y axis").call(yAxis)}function drawBarChartPaths(data){var earliestTime=scope.chartData.earliestTime;var cellWidth=0;if(data.length>0){cellWidth=barChartXScale(earliestTime+scope.chartData.barsInterval)-barChartXScale(earliestTime)}barChartGroup.selectAll("bar").data(data).enter().append("rect").style("fill","#32a7c2").attr("class","bar").attr("x",function(d){return barChartXScale(d.time)}).attr("width",cellWidth).attr("y",function(d){return barChartYScale(d.value)}).attr("height",function(d){return barChartHeight-barChartYScale(d.value)})}function drawResults(){updateProgressBar();drawSwimlane(vizWidth,barChartHeight)}function drawSwimlane(swlWidth,swlHeight){var lineData=scope.chartData.line;var data=scope.chartData.swimlane;var earliestTime=scope.chartData.earliestTime;var cellWidth=0;if(data.length>0){cellWidth=barChartXScale(earliestTime+scope.chartData.swimlaneInterval)-barChartXScale(earliestTime)}_d2.default.time.scale().range([0,swlWidth]).domain(_d2.default.extent(lineData,function(d){return d.date}));_d2.default.scale.linear().range([swlHeight,0]).domain([0,swlHeight]);var color=_d2.default.scale.threshold().domain([3,25,50,75,100]).range(["#d2e9f7","#8bc8fb","#ffdd00","#ff7e00","#fe5050"]);swimlaneGroup.select(".swimlane-cells").remove();var cells=swimlaneGroup.append("g").attr("class","swimlane-cells").selectAll("cells").data(data);cells.enter().append("rect").attr("x",function(d){return swimlaneXScale(d.date)}).attr("y",0).attr("rx",0).attr("ry",0).attr("class",function(d){return d.value>0?"swimlane-cell":"swimlane-cell-hidden"}).attr("width",cellWidth-0).attr("height",swlHeight-0).style("fill",function(d){return color(d.value)})}function updateProgressBar(){var pcnt=scope.chartData.percentComplete;$progressBar.css("width",pcnt+"%")}}return{scope:{chartData:"=",eventRateChartHeight:"=",chartTicksMargin:"="},link:link}})},2325:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2326)},2326:function(module,exports,__webpack_require__){"use strict";var _states=__webpack_require__(407);var _fields_selection=__webpack_require__(2327);var _fields_selection2=_interopRequireDefault(_fields_selection);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlFieldsSelection",function(){return{restrict:"E",replace:true,template:_fields_selection2.default,controller:function controller($scope){$scope.toggleFields=function(field){var key=field.id;var f=$scope.formConfig.fields[key];if(f===undefined){$scope.formConfig.fields[key]=field;$scope.chartStates.fields[key]=_states.CHART_STATE.LOADING}else{delete $scope.formConfig.fields[key];delete $scope.chartStates.fields[key]}if($scope.formConfig.splitField!==undefined){$scope.setModelMemoryLimit()}}}}})},2327:function(module,exports){module.exports='<div class=\'fields-selection\'>\n  <h4 class="euiTitle euiTitle--small">Fields</h4>\n  <div class="euiSpacer euiSpacer--s"></div>\n  <div class="row">\n    <div class="col-md-12">\n      <div class="form-group">\n\n        <div class=\'selection-list-container fields-list\'>\n          <div class="checkbox field-row" ng-repeat="field in ui.fields" >\n            <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n              <input type="checkbox"\n                class=\'kuiCheckBox\'\n                ng-checked="formConfig.fields[field.id] !== undefined"\n                ng-click="toggleFields(field); formChange()"\n                ng-disabled="jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                />\n              <span\n                class=\'kuiCheckBoxLabel__text\'\n                tooltip=\'{{field.tooltip}}\'\n                tooltip-append-to-body="true">\n                {{field.name}}\n              </span>\n            </label>\n            <div class="agg-type-select-wrapper">\n              <select\n                ng-model="field.agg.type"\n                ng-options="agg as agg.title for agg in ui.aggTypeOptions | filterAggTypes:field"\n                ng-change="formChange()"\n                ng-disabled="formConfig.fields[field.id] === undefined || jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                class="form-control agg-type-select">\n              </select>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="row form-controls" ng-show=\'ui.isCountOrSum\'>\n    <span class="col-md-12">\n      <label class=\'kuiCheckBoxLabel kuiVerticalRhythm sparse-data\'>\n        <input type="checkbox"\n          class=\'kuiCheckBox\'\n          ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n          ng-model  ="formConfig.isSparseData" />\n          <span class=\'kuiCheckBoxLabel__text\'>\n            Sparse data <i ml-info-icon="new_job_sparsedata" tooltip-append-to-body="true"></i>\n          </span>\n      </label>\n    </span>\n  </div>\n</div>\n'},2328:function(module,exports,__webpack_require__){"use strict";var _influencers_selection=__webpack_require__(2329);var _influencers_selection2=_interopRequireDefault(_influencers_selection);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlInfluencersSelection",function(){return{restrict:"E",replace:true,template:_influencers_selection2.default,controller:function controller($scope){$scope.isDefaultInfluencer=function(field){var defaultFields=getDefaultFields();return defaultFields.find(function(f){return f.name===field.name})!==undefined};$scope.toggleInfluencerChange=function(){$scope.addDefaultFieldsToInfluencerList()};$scope.addDefaultFieldsToInfluencerList=function(){var defaultFields=getDefaultFields();var nonDefaultFields=getNonDefaultFields(defaultFields);$scope.formConfig.influencerFields=defaultFields.concat(nonDefaultFields)};function getDefaultFields(){var defaultFields=getSplitFields();if($scope.formConfig.hasOwnProperty("overField")===true){if(defaultFields.find(function(f){return f.name===$scope.formConfig.overField.name})===undefined){defaultFields.push($scope.formConfig.overField)}}return defaultFields}function getNonDefaultFields(defaultFields){return $scope.formConfig.influencerFields.filter(function(f){return defaultFields.find(function(sp){return sp.name===f.name})===undefined})}function getSplitFields(){if($scope.formConfig.hasOwnProperty("splitField")===false){var splitFields=$scope.formConfig.fields.map(function(f){return f.splitField}).filter(function(f){return f!==undefined&&f!==""});splitFields=_lodash2.default.uniq(splitFields,"name");return splitFields}else{if($scope.formConfig.splitField===undefined){return[]}else{return[$scope.formConfig.splitField]}}}}}})},2329:function(module,exports){module.exports='<div class="influencers-selection">\n  <div>\n    <h4 class="euiTitle euiTitle--small">Key Fields (Influencers)</h4>\n    <div class="euiSpacer euiSpacer--s"></div>\n  </div>\n  <div class="row">\n    <div class="col-md-12">\n      <div class="form-group">\n        <div class=\'selection-list-container\'>\n          <ui-select\n            ng-model="formConfig.influencerFields"\n            ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n            on-select="toggleInfluencerChange()"\n            on-remove="toggleInfluencerChange()"\n            multiple\n            append-to-body=true\n          >\n            <ui-select-match placeholder="Key fields">\n              <span ng-class="{\'default-influencer\': isDefaultInfluencer($item)}">\n                <ml-field-type-icon type="$item.mlType"></ml-field-type-icon>{{$item.name}}\n              </span>\n            </ui-select-match>\n            <ui-select-choices repeat="field in ui.splitFields | filter: { name: $select.search }" group-by="\'mlType\'">\n              <ml-field-type-icon type="field.mlType"></ml-field-type-icon>\n              <span class="select-item" ng-bind-html="(field.name | highlight: $select.search)"></span>\n            </ui-select-choices>\n          </ui-select>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'},2330:function(module,exports,__webpack_require__){"use strict";var _bucket_span_selection=__webpack_require__(2331);var _bucket_span_selection2=_interopRequireDefault(_bucket_span_selection);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlBucketSpanSelection",function(){return{restrict:"E",replace:true,template:_bucket_span_selection2.default,controller:function controller($scope){$scope.bucketSpanFieldChange=function(){$scope.ui.bucketSpanEstimator.status=0;$scope.ui.bucketSpanEstimator.message="";$scope.formChange()};$scope.bucketSpanEstimatorExportedFunctions={}}}})},2331:function(module,exports){module.exports='<div class=\'bucket-span-selection\'>\n  <h4 class="euiTitle euiTitle--small" id="ml_aria_label_new_job_bucketspan">Bucket span</h4><i ml-info-icon="new_job_bucketspan" />\n  <div class="euiSpacer euiSpacer--s"></div>\n  <div class="row">\n    <div class="col-md-12">\n      <div class="form-group">\n        <div>\n          <input\n            aria-labelledby="ml_aria_label_new_job_bucketspan"\n            aria-describedby="ml_aria_description_new_job_bucketspan"\n            ng-model="formConfig.bucketSpan"\n            required\n            placeholder={{formConfig-bucketSpan}}\n            ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED || ui.bucketSpanEstimator.status===1"\n            ng-change="bucketSpanFieldChange()"\n            ng-class=\'{"ng-invalid": (!ui.bucketSpanValid)}\'\n            class="form-control lowercase bucket-span-input" />\n\n          <ml-bucket-span-estimator\n            bucket-span-field-change="bucketSpanFieldChange"\n            form-config=\'formConfig\'\n            job-state-wrapper=\'{jobState:jobState}\'\n            job-state=\'JOB_STATE\'\n            ui=\'ui\'\n            exported-functions=\'bucketSpanEstimatorExportedFunctions\'>\n          </ml-bucket-span-estimator>\n\n        </div>\n        <div ng-hide="ui.bucketSpanValid" class="validation-error">Invalid interval format</div>\n        <div ng-show="ui.bucketSpanEstimator.status===-1" class="validation-error">{{ui.bucketSpanEstimator.message}}</div>\n      </div>\n    </div>\n\n    <div class="col-md-0">\n    </div>\n  </div>\n</div>\n'},2332:function(module,exports,__webpack_require__){"use strict";var _general_job_details=__webpack_require__(2333);var _general_job_details2=_interopRequireDefault(_general_job_details);var _change_job_id_case=__webpack_require__(994);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlGeneralJobDetails",function(){return{restrict:"E",replace:true,template:_general_job_details2.default,controller:function controller($scope){$scope.changeJobIDCase=_change_job_id_case.changeJobIDCase}}})},2333:function(module,exports){module.exports='<div class="general-job-details">\n  <div class="form-group">\n    <ml-form-label label-id="new_job_id" tooltip-append-to-body="true">Name</ml-form-label>\n    <input\n      aria-labelledby="ml_aria_label_new_job_id"\n      aria-describedby="ml_aria_description_new_job_id"\n      id="job-id-input"\n      ng-model="formConfig.jobId"\n      required\n      placeholder="Job ID"\n      ng-change="changeJobIDCase(formConfig)"\n      ng-disabled="jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n      class="form-control lowercase" />\n    <div ng-hide="ui.validation.checks.jobId.valid" class="validation-error">{{ ( ui.validation.checks.jobId.message || "Enter a name for the job" ) }}</div>\n  </div>\n\n  <div class="form-group">\n    <ml-form-label label-id="new_job_description">Description</ml-form-label>\n    <input\n      aria-labelledby="ml_aria_label_new_job_description"\n      aria-describedby="ml_aria_description_new_job_description"\n      ng-model="formConfig.description"\n      placeholder="Job description"\n      ng-disabled="jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n      class="form-control" />\n  </div>\n  <div class="form-group">\n    <ml-form-label label-id="new_job_group">Job Groups</ml-form-label>\n    <ml-job-group-select\n      aria-labelledby="ml_aria_label_new_job_group"\n      aria-describedby="ml_aria_description_new_job_group"\n      job-groups=\'formConfig.jobGroups\'\n      disabled=\'(jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED)\' />\n    <div ng-hide="ui.validation.checks.groupIds.valid" class="validation-error">{{ ui.validation.checks.groupIds.message }}</div>\n  </div>\n\n  <div class="form-group">\n    <div ng-click="ui.showAdvanced = (!ui.showAdvanced || formConfig.useDedicatedIndex)" class="advanced-button-container">\n      <button\n        aria-label="{{ ui.showAdvanced ? \'Hide Advanced\' : \'Show Advanced\' }}"\n        ng-disabled="formConfig.useDedicatedIndex"\n        type="button"\n        class="kuiButton kuiButton--small kuiButton--hollow advanced-button">\n        <i aria-hidden="true" ng-class="{ \'fa-caret-down\': ui.showAdvanced, \'fa-caret-right\': !ui.showAdvanced }" class="fa"></i>\n      </button>\n      <label class="kuiFormLabel" aria-describedby="ml_aria_description_new_job_advanced_settings">Advanced</label>\n      <i ml-info-icon="new_job_advanced_settings" ></i>\n    </div>\n    <div class=\'advanced-group\' ng-show="ui.showAdvanced">\n      <div class="form-group">\n        <ml-enable-model-plot-checkbox\n          form-config=\'formConfig\'\n          ui=\'ui\'\n          get-job-from-config=\'getJobFromConfig\'>\n        </ml-enable-model-plot-checkbox>\n      </div>\n      <div class="form-group">\n      <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n        <input type="checkbox"\n          aria-labelledby="ml_aria_label_new_job_dedicated_index"\n          aria-describedby="ml_aria_description_new_job_dedicated_index"\n          class=\'kuiCheckBox\'\n          ng-model  ="formConfig.useDedicatedIndex" />\n        <span class=\'kuiCheckBoxLabel__text dedicated-index-label\'>\n          <span id="ml_aria_label_new_job_dedicated_index">Use dedicated index</span>\n          <i ml-info-icon="new_job_dedicated_index" ></i>\n        </span>\n      </label>\n      </div>\n      <div class="form-group">\n        <label class=\'kuiFormLabel kuiVerticalRhythm\'>\n          <span id="ml_aria_label_new_job_model_memory_limit">\n            Model memory limit\n          </span>\n          <i ml-info-icon="new_job_model_memory_limit"></i>\n        </label>\n        <div></div>\n        <input\n          aria-labelledby="ml_aria_label_new_job_model_memory_limit"\n          aria-describedby="ml_aria_description_new_job_model_memory_limit"\n          type="text"\n          ng-model=\'formConfig.modelMemoryLimit\'\n          class="kuiTextInput kuiTextInput--large model-memory-input-input" />\n        <div ng-hide="ui.validation.checks.modelMemoryLimit.valid" class="validation-error">{{ ui.validation.checks.modelMemoryLimit.message }}</div>\n      </div>\n    </div>\n  </div>\n  <div class="form-group"></div>\n</div>\n'},2334:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _enable_model_plot_checkbox_view=__webpack_require__(2335);var _ml_api_service=__webpack_require__(22);var _new_job_utils=__webpack_require__(220);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlEnableModelPlotCheckbox",function(){return{restrict:"AE",replace:false,scope:{formConfig:"=",ui:"=ui",getJobFromConfig:"="},link:function link($scope,$element){var STATUS={FAILED:-1,NOT_RUNNING:0,RUNNING:1,FINISHED:2,WARNING:3};function errorHandler(error){console.log("Cardinality could not be validated",error);$scope.ui.cardinalityValidator.status=STATUS.FAILED;$scope.ui.cardinalityValidator.message="An error occurred validating the configuration\n            for running the job with model plot enabled.\n            Creating model plots can be resource intensive and not recommended where the cardinality of the selected fields is high.\n            You may want to select a dedicated results index on the Job Details tab.";$scope.formConfig.useDedicatedIndex=true}function validateCardinality(){$scope.ui.cardinalityValidator.status=STATUS.RUNNING;$scope.ui.cardinalityValidator.message="";var tempJob=$scope.getJobFromConfig($scope.formConfig);_ml_api_service.ml.validateCardinality(tempJob).then(function(response){var validationResult=(0,_new_job_utils.checkCardinalitySuccess)(response);if(validationResult.success===true){$scope.formConfig.enableModelPlot=true;$scope.ui.cardinalityValidator.status=STATUS.FINISHED}else{$scope.ui.cardinalityValidator.message="Creating model plots is resource intensive and not recommended\n                where the cardinality of the selected fields is greater than 100. Estimated cardinality\n                for this job is "+validationResult.highCardinality+".\n                If you enable model plot with this configuration we recommend you use a dedicated results index.";$scope.ui.cardinalityValidator.status=STATUS.WARNING;$scope.formConfig.useDedicatedIndex=true;$scope.ui.showAdvanced=true}}).catch(errorHandler).then(function(){$scope.$applyAsync()})}function revalidateCardinalityOnFieldChange(){if($scope.formConfig.enableModelPlot===true&&$scope.ui.formValid===true){validateCardinality()}}$scope.handleCheckboxChange=function(isChecked){if(isChecked){$scope.formConfig.enableModelPlot=true;validateCardinality()}else{$scope.formConfig.enableModelPlot=false;$scope.ui.cardinalityValidator.status=STATUS.FINISHED;$scope.ui.cardinalityValidator.message="";updateCheckbox()}};$scope.$watch("ui.formValid",updateCheckbox,true);$scope.$watch("ui.cardinalityValidator.status",updateCheckbox,true);$scope.$watch("formConfig.fields",revalidateCardinalityOnFieldChange,true);$scope.$watch("formConfig.splitField",revalidateCardinalityOnFieldChange,true);$scope.$watch("formConfig.overField",revalidateCardinalityOnFieldChange,true);function updateCheckbox(){var checkboxDisabled=$scope.ui.cardinalityValidator.status===STATUS.RUNNING&&$scope.formConfig.enableModelPlot===true||$scope.ui.formValid!==true&&$scope.formConfig.enableModelPlot===false;var validatorRunning=$scope.ui.cardinalityValidator.status===STATUS.RUNNING;var warningStatus=($scope.ui.cardinalityValidator.status===STATUS.WARNING||$scope.ui.cardinalityValidator.status===STATUS.FAILED)&&$scope.ui.formValid===true;var checkboxText=validatorRunning?"Validating cardinality...":"Enable model plot";var props={checkboxDisabled:checkboxDisabled,checkboxText:checkboxText,onCheckboxChange:$scope.handleCheckboxChange,warningContent:$scope.ui.cardinalityValidator.message,warningStatus:warningStatus};_reactDom2.default.render(_react2.default.createElement(_enable_model_plot_checkbox_view.EnableModelPlotCheckbox,props),$element[0])}updateCheckbox()}}})},2335:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EnableModelPlotCheckbox=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _json_tooltip=__webpack_require__(640);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var EnableModelPlotCheckbox=exports.EnableModelPlotCheckbox=function(_Component){_inherits(EnableModelPlotCheckbox,_Component);function EnableModelPlotCheckbox(props){_classCallCheck(this,EnableModelPlotCheckbox);var _this=_possibleConstructorReturn(this,(EnableModelPlotCheckbox.__proto__||Object.getPrototypeOf(EnableModelPlotCheckbox)).call(this,props));_this.warningTitle="Proceed with caution!";_this.onChange=function(e){_this.setState({checked:e.target.checked});_this.props.onCheckboxChange(e.target.checked)};_this.renderWarningCallout=function(){return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_eui.EuiFlexGroup,{direction:"column"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiCallOut,{title:_this.warningTitle,color:"warning",iconType:"help"},_react2.default.createElement("p",null,_this.props.warningContent)))))};_this.state={checked:false};return _this}_createClass(EnableModelPlotCheckbox,[{key:"render",value:function render(){return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:false},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiCheckbox,{id:"new_job_enable_model_plot",label:this.props.checkboxText,onChange:this.onChange,disabled:this.props.checkboxDisabled,checked:this.state.checked})),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_json_tooltip.JsonTooltip,{id:"new_job_enable_model_plot",position:"top"}))),this.props.warningStatus&&this.renderWarningCallout())}}]);return EnableModelPlotCheckbox}(_react.Component);EnableModelPlotCheckbox.propTypes={checkboxDisabled:_propTypes2.default.bool,checkboxText:_propTypes2.default.string.isRequired,onCheckboxChange:_propTypes2.default.func.isRequired,warningStatus:_propTypes2.default.bool.isRequired,warningContent:_propTypes2.default.string.isRequired};EnableModelPlotCheckbox.defaultProps={checkboxDisabled:false}},2337:function(module,exports,__webpack_require__){"use strict";var _field_types=__webpack_require__(257);var _general=__webpack_require__(259);var _modules=__webpack_require__(4);var _module=_modules.uiModules.get("apps/ml");_module.filter("filterAggTypes",function(){return function(aggTypes,field){return aggTypes.filter(function(type){if(field.id===_general.EVENT_RATE_COUNT_FIELD){if(type.isCountType){return true}}else{if(!type.isCountType){if(field.mlType===_field_types.ML_JOB_FIELD_TYPES.KEYWORD||field.mlType===_field_types.ML_JOB_FIELD_TYPES.IP){if(type.isAggregatableStringType){return true}}else{return true}}}return false})}})},2338:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2339)},2339:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2340);__webpack_require__(1005);__webpack_require__(2342);__webpack_require__(209);__webpack_require__(339);__webpack_require__(472);__webpack_require__(639);__webpack_require__(999);__webpack_require__(2343);__webpack_require__(1e3);__webpack_require__(1001);__webpack_require__(1002);__webpack_require__(1003);__webpack_require__(1004);__webpack_require__(406);__webpack_require__(473);__webpack_require__(274);__webpack_require__(474)},2340:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _index=__webpack_require__(293);var _validation_utils=__webpack_require__(470);var _parse_interval=__webpack_require__(219);var _datemath=__webpack_require__(57);var _datemath2=_interopRequireDefault(_datemath);var _angular=__webpack_require__(21);var _angular2=_interopRequireDefault(_angular);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _check_license=__webpack_require__(43);var _check_privilege=__webpack_require__(32);var _ml_time_buckets=__webpack_require__(258);var _filter_agg_types=__webpack_require__(635);var _validate_job=__webpack_require__(469);var _adjust_interval=__webpack_require__(636);var _states=__webpack_require__(407);var _create_fields=__webpack_require__(637);var _index_utils=__webpack_require__(62);var _chart_data_utils=__webpack_require__(997);var _check_ml_nodes=__webpack_require__(47);var _new_job_defaults=__webpack_require__(241);var _string_utils=__webpack_require__(38);var _new_job_utils=__webpack_require__(220);var _job_service=__webpack_require__(23);var _prepopulate_job_settings=__webpack_require__(638);var _create_job_service=__webpack_require__(1005);var _full_time_range_selector_service=__webpack_require__(471);var _messagebar_service=__webpack_require__(178);var _create_job=__webpack_require__(2341);var _create_job2=_interopRequireDefault(_create_job);var _timefilter=__webpack_require__(16);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_routes2.default.when("/jobs/new_job/simple/population",{template:_create_job2.default,resolve:{CheckLicense:_check_license.checkLicenseExpired,privileges:_check_privilege.checkCreateJobsPrivilege,indexPattern:_index_utils.loadCurrentIndexPattern,savedSearch:_index_utils.loadCurrentSavedSearch,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable,loadNewJobDefaults:_new_job_defaults.loadNewJobDefaults}});var _module=_modules.uiModules.get("apps/ml");_module.controller("MlCreatePopulationJob",function($scope,$timeout,Private,AppState){_timefilter.timefilter.enableTimeRangeSelector();_timefilter.timefilter.disableAutoRefreshSelector();var msgs=_messagebar_service.mlMessageBarService;var MlTimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider);var moveToAdvancedJobCreation=Private(_new_job_utils.moveToAdvancedJobCreationProvider);var chartDataUtils=Private(_chart_data_utils.ChartDataUtilsProvider);var mlPopulationJobService=Private(_create_job_service.PopulationJobServiceProvider);var mlFullTimeRangeSelectorService=Private(_full_time_range_selector_service.FullTimeRangeSelectorServiceProvider);$scope.addNewJobToRecentlyAccessed=_new_job_utils.addNewJobToRecentlyAccessed;var stateDefaults={mlJobSettings:{}};var appState=new AppState(stateDefaults);mlPopulationJobService.clearChartData();$scope.chartData=mlPopulationJobService.chartData;var jobDefaults=(0,_new_job_defaults.newJobDefaults)();var PAGE_WIDTH=_angular2.default.element(".population-job-container").width();var BAR_TARGET=PAGE_WIDTH>1600?800:PAGE_WIDTH/2;var MAX_BARS=BAR_TARGET+BAR_TARGET/100*100;var REFRESH_INTERVAL_MS=100;var MAX_BUCKET_DIFF=3;var METRIC_AGG_TYPE="metrics";var DEFAULT_MODEL_MEMORY_LIMIT=jobDefaults.anomaly_detectors.model_memory_limit;var refreshCounter=0;$scope.JOB_STATE=_states.JOB_STATE;$scope.jobState=$scope.JOB_STATE.NOT_STARTED;$scope.CHART_STATE=_states.CHART_STATE;$scope.chartStates={eventRate:_states.CHART_STATE.LOADING,fields:{}};var globalForceStop=false;var createSearchItems=Private(_new_job_utils.SearchItemsProvider);var _createSearchItems=createSearchItems(),indexPattern=_createSearchItems.indexPattern,savedSearch=_createSearchItems.savedSearch,query=_createSearchItems.query,filters=_createSearchItems.filters,combinedQuery=_createSearchItems.combinedQuery;(0,_index_utils.timeBasedIndexCheck)(indexPattern,true);var pageTitle=savedSearch.id!==undefined?"saved search "+savedSearch.title:"index pattern "+indexPattern.title;$scope.ui={indexPattern:indexPattern,pageTitle:pageTitle,showJobInput:true,showJobFinished:false,dirty:false,formValid:false,bucketSpanValid:true,bucketSpanEstimator:{status:0,message:""},cardinalityValidator:{status:0,message:""},aggTypeOptions:(0,_filter_agg_types.filterAggTypes)(_index.aggTypes.byType[METRIC_AGG_TYPE]),fields:[],overFields:[],splitFields:[],timeFields:[],splitText:"",intervals:[{title:"Auto",value:"auto"},{title:"Millisecond",value:"ms"},{title:"Second",value:"s"},{title:"Minute",value:"m"},{title:"Hourly",value:"h"},{title:"Daily",value:"d"},{title:"Weekly",value:"w"},{title:"Monthly",value:"M"},{title:"Yearly",value:"y"},{title:"Custom",value:"custom"}],eventRateChartHeight:100,chartHeight:150,showFieldCharts:false,showAdvanced:false,validation:{checks:{jobId:{valid:true},groupIds:{valid:true},modelMemoryLimit:{valid:true},duplicateDetectors:{valid:true}}},isOverField:function isOverField(field){return field.name===$scope.formConfig.overField.name?null:field}};$scope.formConfig={agg:{type:undefined},fields:[],bucketSpan:"15m",chartInterval:undefined,resultsIntervalSeconds:undefined,start:0,end:0,overField:undefined,timeField:indexPattern.timeFieldName,influencerFields:[],firstSplitFieldName:undefined,indexPattern:indexPattern,query:query,filters:filters,combinedQuery:combinedQuery,usesSavedSearch:savedSearch.id!==undefined,jobId:"",description:"",jobGroups:[],useDedicatedIndex:false,enableModelPlot:false,modelMemoryLimit:DEFAULT_MODEL_MEMORY_LIMIT};$scope.formChange=function(refreshCardLayout){$scope.ui.isFormValid();$scope.ui.dirty=true;$scope.loadVis();if(refreshCardLayout){sortSplitCards()}};$scope.overChange=function(){$scope.addDefaultFieldsToInfluencerList();$scope.formChange()};$scope.splitChange=function(fieldIndex,splitField){return new Promise(function(resolve){$scope.formConfig.fields[fieldIndex].firstSplitFieldName=undefined;if(splitField!==undefined){$scope.formConfig.fields[fieldIndex].splitField=splitField;$scope.addDefaultFieldsToInfluencerList();chartDataUtils.getSplitFields($scope.formConfig,splitField.name,10).then(function(resp){if(resp.results.values&&resp.results.values.length){$scope.formConfig.fields[fieldIndex].firstSplitFieldName=resp.results.values[0];$scope.formConfig.fields[fieldIndex].cardLabels=resp.results.values}drawCards(fieldIndex,true);$scope.formChange();resolve()})}else{$scope.formConfig.fields[fieldIndex].splitField=undefined;$scope.formConfig.fields[fieldIndex].cardLabels=undefined;setFieldsChartStates(_states.CHART_STATE.LOADING);$scope.toggleInfluencerChange();$scope.ui.splitText="";destroyCards(fieldIndex);$scope.formChange();resolve()}})};$scope.splitReset=function(fieldIndex){$scope.splitChange(fieldIndex,undefined)};function setTime(){$scope.ui.bucketSpanValid=true;$scope.formConfig.start=_datemath2.default.parse(_timefilter.timefilter.getTime().from).valueOf();$scope.formConfig.end=_datemath2.default.parse(_timefilter.timefilter.getTime().to).valueOf();$scope.formConfig.format="epoch_millis";var bucketSpanInterval=(0,_parse_interval.parseInterval)($scope.formConfig.bucketSpan);if(bucketSpanInterval===null||bucketSpanInterval.asMilliseconds()===0){$scope.ui.bucketSpanValid=false}var bounds=_timefilter.timefilter.getActiveBounds();$scope.formConfig.chartInterval=new MlTimeBuckets;$scope.formConfig.chartInterval.setBarTarget(BAR_TARGET);$scope.formConfig.chartInterval.setMaxBars(MAX_BARS);$scope.formConfig.chartInterval.setInterval("auto");$scope.formConfig.chartInterval.setBounds(bounds);(0,_adjust_interval.adjustIntervalDisplayed)($scope.formConfig);$scope.ui.isFormValid();$scope.ui.dirty=true}function initAgg(){_lodash2.default.each($scope.ui.aggTypeOptions,function(agg){if(agg.title==="Mean"){$scope.formConfig.agg.type=agg}})}$scope.ui.isFormValid=function(){if($scope.formConfig.agg.type===undefined||$scope.formConfig.timeField===undefined||$scope.formConfig.fields.length===0){$scope.ui.formValid=false}else{$scope.ui.formValid=true}return $scope.ui.formValid};$scope.loadVis=function(){var thisLoadTimestamp=Date.now();$scope.chartData.lastLoadTimestamp=thisLoadTimestamp;setTime();$scope.ui.isFormValid();$scope.ui.showJobInput=true;$scope.ui.showJobFinished=false;$scope.ui.dirty=false;mlPopulationJobService.clearChartData();setFieldsChartStates(_states.CHART_STATE.LOADING);if($scope.formConfig.fields.length){$scope.ui.showFieldCharts=true;mlPopulationJobService.getLineChartResults($scope.formConfig,thisLoadTimestamp).then(function(resp){$scope.$applyAsync();loadDocCountData(resp.detectors)}).catch(function(resp){msgs.error(resp.message);$scope.formConfig.fields.forEach(function(field){var id=field.id;$scope.chartStates.fields[id]=_states.CHART_STATE.NO_RESULTS});$scope.$applyAsync()})}else{$scope.ui.showFieldCharts=false;loadDocCountData([])}function loadDocCountData(dtrs){chartDataUtils.loadDocCountData($scope.formConfig,$scope.chartData).then(function(resp){if(thisLoadTimestamp===$scope.chartData.lastLoadTimestamp){_lodash2.default.each(dtrs,function(dtr,id){var state=resp.totalResults?_states.CHART_STATE.LOADED:_states.CHART_STATE.NO_RESULTS;$scope.chartStates.fields[id]=state});$scope.chartData.lastLoadTimestamp=null;chartDataUtils.updateChartMargin($scope.chartData);$scope.chartStates.eventRate=resp.totalResults?_states.CHART_STATE.LOADED:_states.CHART_STATE.NO_RESULTS;$scope.$broadcast("render")}}).catch(function(resp){$scope.chartStates.eventRate=_states.CHART_STATE.NO_RESULTS;msgs.error(resp.message)}).then(function(){$scope.$applyAsync()})}};function setFieldsChartStates(state){_lodash2.default.each($scope.chartStates.fields,function(chart,key){$scope.chartStates.fields[key]=state});$scope.$applyAsync()}function drawCards(fieldIndex){var animate=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var labels=$scope.formConfig.fields[fieldIndex].cardLabels;var $frontCard=_angular2.default.element(".population-job-container .detector-container.card-"+fieldIndex+" .card-front");$frontCard.addClass("card");$frontCard.find(".card-title").text(labels[0]);var marginTop=labels.length>1?54:0;$frontCard.css("margin-top",marginTop);var backCardTitle="";if(labels.length===2){backCardTitle=$scope.formConfig.fields[Object.keys($scope.formConfig.fields)[0]].agg.type.title;backCardTitle+=" ";backCardTitle+=Object.keys($scope.formConfig.fields)[0]}_angular2.default.element(".detector-container.card-"+fieldIndex+" .card-behind").remove();for(var _i=0;_i<labels.length;_i++){var el='<div class="card card-behind card-behind-'+_i+'"><div class="card-title">';el+=(0,_string_utils.mlEscape)(labels[_i]);el+='</div><label class="kuiFormLabel">';el+=(0,_string_utils.mlEscape)(backCardTitle);el+="</label></div>";var $backCard=_angular2.default.element(el);$backCard.css("z-index",9-_i);$backCard.insertBefore($frontCard)}var cardsBehind=_angular2.default.element(".detector-container.card-"+fieldIndex+" .card-behind");for(var _i2=0;_i2<cardsBehind.length;_i2++){cardsBehind[_i2].style.marginTop=marginTop+"px";marginTop-=(10-_i2*(10/labels.length))*(10/labels.length)}var i=0;var then=window.performance.now();var fps=20;var fpsInterval=1e3/fps;function fadeCard(callTime){if(i<cardsBehind.length){var now=callTime;var elapsed=now-then;if(elapsed>fpsInterval){cardsBehind[i].style.opacity=1;i++;then=now-elapsed%fpsInterval}window.requestAnimationFrame(fadeCard)}}if(animate){fadeCard()}else{for(var j=0;j<cardsBehind.length;j++){cardsBehind[j].style.opacity=1}}}function destroyCards(fieldIndex){_angular2.default.element(".detector-container.card-"+fieldIndex+" .card-behind").remove();var $frontCard=_angular2.default.element(".population-job-container .detector-container.card-"+fieldIndex+" .card-front");$frontCard.removeClass("card");$frontCard.find(".card-title").text("");$frontCard.css("margin-top",0)}function sortSplitCards(){$timeout(function(){$scope.formConfig.fields.forEach(function(f,i){if(f.splitField===undefined){destroyCards(i)}else{drawCards(i,false)}})},0)}var refreshInterval=REFRESH_INTERVAL_MS;$scope.createJob=function(){var tempJob=mlPopulationJobService.getJobFromConfig($scope.formConfig);if((0,_validate_job.validateJob)(tempJob,$scope.ui.validation.checks)){msgs.clear();mlPopulationJobService.createJob($scope.formConfig).then(function(job){_job_service.mlJobService.openJob(job.job_id).then(function(){saveNewDatafeed(job,true)}).catch(function(resp){msgs.error("Could not open job: ",resp);msgs.error("Job created, creating datafeed anyway");saveNewDatafeed(job,false)})}).catch(function(resp){msgs.error("Save failed: ",resp.resp);$scope.$applyAsync()})}else{if($scope.ui.validation.checks.modelMemoryLimit.valid===false){$scope.ui.showAdvanced=true}}function saveNewDatafeed(job,startDatafeedAfterSave){_job_service.mlJobService.saveNewDatafeed(job.datafeed_config,job.job_id).then(function(){if(startDatafeedAfterSave){mlPopulationJobService.startDatafeed($scope.formConfig).then(function(){$scope.jobState=_states.JOB_STATE.RUNNING;refreshCounter=0;refreshInterval=REFRESH_INTERVAL_MS;$scope.formConfig.resultsIntervalSeconds=$scope.formConfig.chartInterval.getInterval().asSeconds();var bucketSpanSeconds=(0,_parse_interval.parseInterval)($scope.formConfig.bucketSpan).asSeconds();if($scope.formConfig.resultsIntervalSeconds<bucketSpanSeconds){$scope.formConfig.resultsIntervalSeconds=bucketSpanSeconds}$scope.resultsUrl=_job_service.mlJobService.createResultsUrl([$scope.formConfig.jobId],$scope.formConfig.start,$scope.formConfig.end,"explorer");(0,_new_job_utils.focusOnResultsLink)("job_running_view_results_link",$timeout);loadCharts()}).catch(function(resp){msgs.error("Could not start datafeed: ",resp)}).then(function(){$scope.$applyAsync()})}else{$scope.$applyAsync()}}).catch(function(resp){msgs.error("Save datafeed failed: ",resp);$scope.$applyAsync()})}};$scope.getJobFromConfig=mlPopulationJobService.getJobFromConfig;(0,_validation_utils.addJobValidationMethods)($scope,mlPopulationJobService);function loadCharts(){var forceStop=globalForceStop;var counterLimit=20-refreshInterval/REFRESH_INTERVAL_MS;if(refreshCounter>=counterLimit){refreshCounter=0;_job_service.mlJobService.updateSingleJobDatafeedState($scope.formConfig.jobId).then(function(state){if(state==="stopped"){console.log("Stopping poll because datafeed state is: "+state);$scope.$applyAsync();$scope.$broadcast("render-results");forceStop=true}run()})}else{run()}function run(){refreshCounter++;reloadJobSwimlaneData().then(function(){reloadDetectorSwimlane().then(function(){if(forceStop===false&&$scope.chartData.percentComplete<100){if($scope.jobState===_states.JOB_STATE.STOPPING){$scope.jobState=_states.JOB_STATE.STOPPING}else{$scope.jobState=_states.JOB_STATE.RUNNING}}else{$scope.jobState=_states.JOB_STATE.FINISHED;(0,_new_job_utils.focusOnResultsLink)("job_finished_view_results_link",$timeout)}jobCheck()})})}}function jobCheck(){if($scope.jobState===_states.JOB_STATE.RUNNING||$scope.jobState===_states.JOB_STATE.STOPPING){refreshInterval=adjustRefreshInterval($scope.chartData.loadingDifference,refreshInterval);_lodash2.default.delay(loadCharts,refreshInterval)}else{_lodash2.default.each($scope.chartData.detectors,function(chart){chart.percentComplete=100})}if($scope.chartData.percentComplete>0){toggleSwimlaneVisibility()}$scope.$applyAsync();$scope.$broadcast("render-results")}function reloadJobSwimlaneData(){return chartDataUtils.loadJobSwimlaneData($scope.formConfig,$scope.chartData)}function reloadDetectorSwimlane(){return chartDataUtils.loadDetectorSwimlaneData($scope.formConfig,$scope.chartData)}function adjustRefreshInterval(loadingDifference,currentInterval){var INTERVAL_INCREASE_MS=100;var MAX_INTERVAL=1e4;var interval=currentInterval;if(interval<MAX_INTERVAL){if(loadingDifference<MAX_BUCKET_DIFF){interval=interval+INTERVAL_INCREASE_MS}else{if(interval-INTERVAL_INCREASE_MS>=REFRESH_INTERVAL_MS){interval=interval-INTERVAL_INCREASE_MS}}}return interval}$scope.resetJob=function(){$scope.jobState=_states.JOB_STATE.NOT_STARTED;toggleSwimlaneVisibility();window.setTimeout(function(){$scope.ui.showJobInput=true;$scope.loadVis()},500)};function toggleSwimlaneVisibility(){if($scope.jobState===_states.JOB_STATE.NOT_STARTED){_angular2.default.element(".swimlane-cells").css("opacity",0);_angular2.default.element(".bar").css("opacity",1)}else{_angular2.default.element(".bar").css("opacity",.1)}}$scope.stopJob=function(){$scope.jobState=_states.JOB_STATE.STOPPING;mlPopulationJobService.stopDatafeed($scope.formConfig).catch().then(function(){$scope.$applyAsync()})};$scope.moveToAdvancedJobCreation=function(){var job=mlPopulationJobService.getJobFromConfig($scope.formConfig);moveToAdvancedJobCreation(job)};$scope.setFullTimeRange=function(){return mlFullTimeRangeSelectorService.setFullTimeRange($scope.ui.indexPattern,$scope.formConfig.combinedQuery)};initAgg();(0,_create_fields.createFields)($scope,indexPattern);$scope.loadVis();$scope.$evalAsync(function(){(0,_prepopulate_job_settings.preLoadJob)($scope,appState)});$scope.$listenAndDigestAsync(_timefilter.timefilter,"fetch",$scope.loadVis);$scope.$on("$destroy",function(){globalForceStop=true;_angular2.default.element(window).off("resize")})})},2341:function(module,exports){module.exports='<ml-nav-menu name="new_job_population"></ml-nav-menu>\n<ml-chart-tooltip></ml-chart-tooltip>\n<ml-new-job-population>\n  <ml-message-bar></ml-message-bar>\n  <div ng-controller="MlCreatePopulationJob" class="population-job-container">\n    <div class="row">\n      <div class="col-md-6">\n        <h3 class="euiTitle euiTitle--large">New job from {{ui.pageTitle}}</h3>\n      </div>\n      <div class="col-md-6">\n        <div class="pull-right">\n          <span style="font-size:10px;" ng-show="formConfig.chartInterval !== undefined">Chart interval: {{formConfig.chartInterval.getInterval().expression}}</span>\n          <ml-full-time-range-selector\n            disabled=\'(jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED)\'\n            index-pattern=\'ui.indexPattern\'\n            query=\'formConfig.combinedQuery\'\n          ></ml-full-time-range-selector>\n        </div>\n      </div>\n    </div>\n\n    <div class="euiSpacer euiSpacer--s"></div>\n\n    <div class="row">\n      <div class="col-md-4">\n        <div class="row form-controls">\n          <h4 class="euiTitle euiTitle--small">Job settings</h4>\n          <div>\n            <div class=\'form-section form-section-overflow\' >\n              <h4 class="euiTitle euiTitle--small">Population</h4>\n              <div class="euiSpacer euiSpacer--s"></div>\n              <div class="row">\n                <div class="col-md-12">\n                  <div class="form-group">\n                    <ui-select\n                      ng-model="formConfig.overField"\n                      on-select="overChange()"\n                      ng-disabled="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                      append-to-body=true>\n                      <ui-select-match placeholder="Select population field">\n                        <ml-field-type-icon type="$select.selected.mlType"></ml-field-type-icon>{{$select.selected.name}}\n                      </ui-select-match>\n                      <ui-select-choices repeat="field in ui.overFields | filter: { name: $select.search }" group-by="\'mlType\'">\n                        <div>\n                          <ml-field-type-icon type="field.mlType"></ml-field-type-icon>\n                          <span\n                            class="select-item"\n                            ng-bind-html="field.name | highlight: $select.search">\n                          </span>\n                        </div>\n                      </ui-select-choices>\n                    </ui-select>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div class=\'form-section form-section-overflow\'>\n              <ml-fields-selection-population></ml-fields-selection-population>\n              <div ng-hide="ui.validation.checks.duplicateDetectors.valid" class="validation-error">{{ ui.validation.checks.duplicateDetectors.message }}</div>\n            </div>\n\n            \x3c!-- <div class=\'form-section\' >\n              <h4 class="euiTitle euiTitle--small">Split Data</h4>\n              <div class="row">\n                <div class="col-md-12">\n                  <div class="form-group">\n                    <select\n                      ng-model="formConfig.splitField"\n                      ng-change="splitChange()"\n                      ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                      class="form-control">\n                        <option value=\'{{undefined}}\'>--No split--</option>\n                        <option ng-repeat="field in ui.splitFields" value=\'{{field}}\'>{{field}}</option>\n                    </select>\n                  </div>\n                </div>\n              </div>\n            </div> --\x3e\n\n            <div class=\'form-section\' >\n              <ml-influencers-selection></ml-influencers-selection>\n            </div>\n\n            <div class=\'form-section\' >\n              <ml-bucket-span-selection></ml-bucket-span-selection>\n            </div>\n\n            <div class=\'form-section\' >\n              <div ng-show="jobState !== JOB_STATE.FINISHED">\n                <h4 class="euiTitle euiTitle--small">Job Details</h4>\n                <div class="euiSpacer euiSpacer--s"></div>\n              </div>\n\n              <div class="form-group">\n                <div ng-show="ui.showJobInput && (jobState === JOB_STATE.NOT_STARTED || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING)">\n                  <ml-general-job-details></ml-general-job-details>\n\n                  <div class="form-group">\n                    <a href="" ng-click="moveToAdvancedJobCreation()">Move to advanced job configuration</a>\n                  </div>\n\n                  <div class="euiFlexGroup euiFlexGroup--gutterSmall euiFlexGroup--alignItemsCenter euiFlexGroup--responsive">\n                    <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                      <ml-validate-job\n                        get-duration="getDuration"\n                        get-job-config="getJobConfig"\n                        fill="false"\n                        is-current-job-config="isCurrentJobConfig"\n                        is-disabled="!ui.formValid"\n                        ng-show="jobState === JOB_STATE.NOT_STARTED"\n                      />\n                    </div>\n                    <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                      <button\n                        aria-label="Create Job"\n                        ng-click="createJob()"\n                        type="button"\n                        ng-show="jobState === JOB_STATE.NOT_STARTED"\n                        ng-disabled="!ui.formValid"\n                        class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                        <span class="euiButton__content">\n                          Create Job\n                        </span>\n                      </button>\n                    </div>\n                  </div>\n\n                  <div class=\'job-state-info\' ng-show="jobState === JOB_STATE.RUNNING">Analysis running <i class=\'fa fa-spinner fa-spin\'></i></div>\n                  <div class=\'job-state-info\' ng-show="jobState === JOB_STATE.STOPPING">Analysis stopping <i class=\'fa fa-spinner fa-spin\'></i></div>\n\n                  <div class="euiSpacer euiSpacer--s"></div>\n\n                  <button\n                    aria-label="Stop Job"\n                    ng-click="stopJob()"\n                    type="button"\n                    ng-show="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING"\n                    ng-disabled="jobState === JOB_STATE.STOPPING"\n                    class="euiButton euiButton--danger euiButton--small">\n                    <span class="euiButton__content">\n                      {{(jobState === JOB_STATE.STOPPING) ? \'Analysis stopping\' : \'Stop analysis\' }}\n                    </span>\n                  </button>\n\n                  <a\n                    href=\'{{resultsUrl}}\'\n                    id="job_running_view_results_link"\n                    ng-click="addNewJobToRecentlyAccessed(formConfig.jobId, resultsUrl)"\n                    aria-label="View results of running job"\n                    ng-show="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      View Results\n                    </span>\n                  </a>\n                </div>\n                <div ng-show="jobState === JOB_STATE.FINISHED">\n                  <h3 class="euiTitle euiTitle--large">Job {{formConfig.jobId }} created\n                    <i style="color:green;" class="fa fa-check" aria-label="Job finished"></i>\n                  </h3>\n                  <div class="euiSpacer euiSpacer--m"></div>\n\n                  <button\n                    aria-label="Reset"\n                    ng-click="resetJob()"\n                    type="button"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      Reset\n                    </span>\n                  </button>\n                  <a\n                    href=\'{{resultsUrl}}\'\n                    id="job_finished_view_results_link"\n                    ng-click="addNewJobToRecentlyAccessed(formConfig.jobId, resultsUrl)"\n                    aria-label="View results of finished job"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      View Results\n                    </span>\n                  </a>\n                </div>\n\n                <div ng-if=\'jobState === JOB_STATE.FINISHED\'>\n                  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n                  <ml-post-save-options\n                    job-id=\'formConfig.jobId\'\n                    bucket-span=\'formConfig.bucketSpan\'\n                    include-influencers=\'true\'\n                    ></ml-post-save-options>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class="col-md-8">\n        <div class="row charts-container">\n          <h4 class="euiTitle euiTitle--small">Results</h4>\n          <div>\n            <div class=\'chart-list-panel event-rate-container\' style=\'height: {{ui.eventRateChartHeight + 70}}px;\'>\n              <label class="kuiFormLabel">Document count</label>\n\n              <div class=\'chart-container\'>\n                <div style=\'height: {{ui.eventRateChartHeight + 25}}px;\'>\n                  <ml-event-rate-chart\n                    chart-data="chartData.job"\n                    event-rate-chart-height=\'ui.eventRateChartHeight\'\n                    chart-ticks-margin="chartData.chartTicksMargin">\n                  </ml-event-rate-chart>\n                </div>\n\n                <div ng-show="chartStates.eventRate === CHART_STATE.NOT_STARTED || chartStates.eventRate === CHART_STATE.LOADING || chartStates.eventRate === CHART_STATE.NO_RESULTS"\n                  class=\'chart-loader event-rate-chart-loader\'\n                  style=\'height: {{ui.eventRateChartHeight}}px; margin-top: -{{ui.eventRateChartHeight + 30}}px;\'>\n                    <div class=\'status-label\' ng-if="chartStates.eventRate === CHART_STATE.NOT_STARTED"></div>\n                    <div class=\'status-label\' ng-if="chartStates.eventRate === CHART_STATE.LOADING">\n                      <h2 class="euiTitle euiTitle"><i class=\'fa fa-spinner fa-spin\'></i></h2>\n                    </div>\n                    <div class=\'status-label\' ng-if="chartStates.eventRate === CHART_STATE.NO_RESULTS">\n                      <div class=\'no-results\'>\n                        <h4 class="euiTitle euiTitle--small"><i class="fa fa-info-circle"></i> No results found</h4>\n                        <span>Consider using the <a ng-click="setFullTimeRange()">full {{ui.indexPattern.title}} data</a></span>\n                      </div>\n                    </div>\n                </div>\n\n              </div>\n\n            </div>\n            <div ng-repeat=\'(id, chart) in chartData.detectors track by id\'>\n              <div class=\'chart-list-panel chart-list-panel-population detector-container card-{{id}}\' ng-show=\'ui.showFieldCharts\'>\n                <div class=\'card-front\'>\n                  <div class="card-title"></div>\n                  <div class=\'chart\' style=\'height: {{ui.chartHeight + 90}}px;\'>\n                    <label class="kuiFormLabel">{{formConfig.fields[id].agg.type.title}} {{formConfig.fields[id].name}} over {{formConfig.overField.name}} <span ng-if="formConfig.fields[id].splitField!==undefined"> split by {{formConfig.fields[id].splitField.name}}</span></label>\n                    <div class="split-controls">\n                      <div class="split-align">Split data: </div>\n                      <div class="split-field-container">\n                        <ui-select\n                          class="split-field-select"\n                          ng-model="formConfig.fields[id].splitField"\n                          ng-change="splitChange(id, $select.selected)"\n                          append-to-body="true"\n                          ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                        >\n                            <ui-select-match placeholder="Select a field">\n                              <ml-field-type-icon type="$select.selected.mlType"></ml-field-type-icon>{{$select.selected.name}}\n                            </ui-select-match>\n                            <ui-select-choices repeat="field in ui.splitFields | filter: { name: $select.search } | filter: ui.isOverField" group-by="\'mlType\'">\n                              <div>\n                                <ml-field-type-icon type="field.mlType"></ml-field-type-icon>\n                                <span\n                                  class="select-item"\n                                  ng-bind-html="field.name | highlight: $select.search">\n                                </span>\n                              </div>\n                            </ui-select-choices>\n                        </ui-select>\n                      </div>\n                      <button\n                        ng-if="formConfig.fields[id].splitField !== undefined && (!ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED)"\n                        ng-click="splitReset(id)"\n                        aria-label="Remove split"\n                        ng-disabled="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                        class="euiButton euiButton--primary euiButton--small split-align remove-split"\n                      >\n                        Remove split\n                      </button>\n                    </div>\n\n                    <div class=\'chart-container\'>\n                      <div style=\'height: {{ui.chartHeight + 25}}px;\'>\n                        <ml-population-job-chart\n                          chart-data="chart"\n                          chart-height=\'ui.chartHeight\'\n                          chart-ticks-margin="chartData.chartTicksMargin"\n                          over-field-name="formConfig.overField.name">\n                        </ml-population-job-chart>\n                      </div>\n\n                      <div ng-show="chartStates.fields[id] === CHART_STATE.NOT_STARTED || chartStates.fields[id] === CHART_STATE.LOADING || chartStates.fields[id] === CHART_STATE.NO_RESULTS"\n                        class=\'chart-loader fields-chart-loader\'\n                        style=\'height: {{ui.chartHeight}}px; margin-top: -{{ui.chartHeight + 30}}px; margin-left: {{chartData.chartTicksMargin.width - 1}}px;\'>\n                          <div class=\'status-label\' ng-show="chartStates.fields[id] === CHART_STATE.NOT_STARTED"></div>\n                          <div class=\'status-label\' ng-show="chartStates.fields[id] === CHART_STATE.LOADING">\n                            <h2 class="euiTitle euiTitle"><i class=\'fa fa-spinner fa-spin\'></i></h2>\n                          </div>\n                          <div class=\'status-label\' ng-show="chartStates.fields[id] === CHART_STATE.NO_RESULTS">\n                            <div class=\'no-results\'>\n                              <h4 class="euiTitle euiTitle--small"><i class="fa fa-info-circle"></i> No results found</h4>\n                            </div>\n                          </div>\n                      </div>\n\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</ml-new-job-population>\n'},2342:function(module,exports,__webpack_require__){"use strict";var _jquery=__webpack_require__(17);var _jquery2=_interopRequireDefault(_jquery);var _d=__webpack_require__(20);var _d2=_interopRequireDefault(_d);var _angular=__webpack_require__(21);var _angular2=_interopRequireDefault(_angular);var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _date_utils=__webpack_require__(221);var _time_buckets=__webpack_require__(218);var _chart_utils=__webpack_require__(197);var _string_utils=__webpack_require__(38);var _chart_tooltip_service=__webpack_require__(242);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlPopulationJobChart",function(){function link(scope,element){var svgWidth=0;var chartHeight=scope.chartHeight;var margin={top:0,right:0,bottom:20,left:scope.chartTicksMargin.width};var svgHeight=chartHeight+margin.top+margin.bottom;var vizWidth=svgWidth-margin.left-margin.right;var chartLimits={max:0,min:0};var chartXScale=null;var chartYScale=null;var chartGroup=void 0;var swimlaneGroup=void 0;var $progressBar=void 0;scope.$on("render",function(){init();createSVGGroups();drawChart()});scope.$on("render-results",function(){drawResults()});element.on("$destroy",function(){scope.$destroy()});function init(){var $el=_angular2.default.element(".population-job-container .card-front");var offset=$el.hasClass("card")?30:0;margin.left=scope.chartTicksMargin.width;svgWidth=$el.width()-offset;vizWidth=svgWidth-margin.left-margin.right;chartXScale=_d2.default.time.scale().range([0,vizWidth]);chartYScale=_d2.default.scale.linear().range([chartHeight,0])}function createSVGGroups(){if(scope.chartData.line===undefined){return}var chartElement=_d2.default.select(element.get(0));chartElement.select("svg").remove();chartElement.select(".progress").remove();if(chartElement.select(".progress-bar")[0][0]===null){var style="width: "+(+vizWidth+2)+"px;\n          margin-bottom: -"+(+chartHeight-15)+"px;\n          margin-left: "+(+margin.left-1)+"px;'";chartElement.append("div").attr("class","progress").attr("style",style).append("div").attr("class","progress-bar")}$progressBar=(0,_jquery2.default)(".progress-bar");var svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight);swimlaneGroup=svg.append("g").attr("class","swimlane").attr("transform","translate("+margin.left+", "+margin.top+")");chartGroup=svg.append("g").attr("class","line-chart").attr("transform","translate("+margin.left+", "+margin.top+")")}function drawChart(){if(scope.chartData.line.length===0){return}var data=scope.chartData.line.reduce(function(p,c){if(c.values.length){c.values.forEach(function(v){p.push({date:c.date,value:v.value,label:v.label})})}else{p.push({date:c.date,value:null,label:null})}return p},[]);chartXScale=chartXScale.domain(_d2.default.extent(data,function(d){return d.date}));chartLimits.max=_d2.default.max(data,function(d){return d.value});chartLimits.min=_d2.default.min(data,function(d){return d.value});var padding=(chartLimits.max-chartLimits.min)*.05;chartLimits.max+=padding;chartLimits.min-=padding;chartYScale=chartYScale.domain([chartLimits.min,chartLimits.max]);var timeBuckets=new _time_buckets.TimeBuckets;timeBuckets.setInterval("auto");if(data.length>0){var xDomain=chartXScale.domain();var bounds={min:(0,_moment2.default)(xDomain[0]),max:(0,_moment2.default)(xDomain[1])};timeBuckets.setBounds(bounds)}var xAxisTickFormat=timeBuckets.getScaledDateFormat();var xAxis=_d2.default.svg.axis().scale(chartXScale).orient("bottom").innerTickSize(-chartHeight).outerTickSize(0).tickPadding(10).ticks((0,_chart_utils.numTicksForDateFormat)(vizWidth,xAxisTickFormat)).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)});var yAxis=_d2.default.svg.axis().scale(chartYScale).orient("left").innerTickSize(-vizWidth).outerTickSize(0).tickPadding(10);if(scope.chartData.fieldFormat!==undefined){yAxis.tickFormat(function(d){return scope.chartData.fieldFormat.convert(d,"text")})}swimlaneGroup.append("rect").attr("x",0).attr("y",0).attr("height",chartHeight).attr("width",vizWidth).style("fill","#FFFFFF");chartGroup.append("rect").attr("x",0).attr("y",0).attr("height",chartHeight).attr("width",vizWidth).style("stroke","#cccccc").style("fill","none").style("stroke-width",1);drawChartAxes(xAxis,yAxis);drawChartDots(data)}function drawChartAxes(xAxis,yAxis){var axes=chartGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0, "+chartHeight+")").call(xAxis);axes.append("g").attr("class","y axis").call(yAxis)}function drawChartDots(data){var dotGroup=chartGroup.append("g").classed("values-dots",true);dotGroup.selectAll("circle").data(data).enter().append("circle").attr("cx",function(d){return chartXScale(d.date)}).attr("cy",function(d){return chartYScale(d.value)}).attr("r",3).style("display",function(d){return d.value===null?"none":"auto"}).on("mouseover",function(d){showTooltip(d,this)}).on("mouseout",function(){return _chart_tooltip_service.mlChartTooltipService.hide()})}function showTooltip(data,el){scope;var contents="";var formattedDate=(0,_date_utils.formatHumanReadableDateTime)(data.date);contents+=formattedDate+"<br/><hr/>";contents+=(0,_string_utils.mlEscape)(scope.overFieldName)+": "+(0,_string_utils.mlEscape)(data.label)+"<br/>";if(scope.chartData.fieldFormat!==undefined){contents+="Value: "+scope.chartData.fieldFormat.convert(data.value,"text")}else{contents+="Value: "+parseInt(data.value)}_chart_tooltip_service.mlChartTooltipService.show(contents,el,{x:5,y:10})}function drawResults(){drawSwimlane(vizWidth,chartHeight);updateProgressBar()}function drawSwimlane(swlWidth,swlHeight){var data=scope.chartData.swimlane;var cellWidth=0;if(data.length>0){cellWidth=chartXScale(data[0].time+scope.chartData.swimlaneInterval)-chartXScale(data[0].time)}_d2.default.time.scale().range([0,swlWidth]).domain(_d2.default.extent(data,function(d){return d.date}));_d2.default.scale.linear().range([swlHeight,0]).domain([0,swlHeight]);var color=_d2.default.scale.threshold().domain([3,25,50,75,100]).range(["#d2e9f7","#8bc8fb","#ffdd00","#ff7e00","#fe5050"]);swimlaneGroup.select(".swimlane-cells").remove();var cells=swimlaneGroup.append("g").attr("class","swimlane-cells").selectAll("cells").data(data);cells.enter().append("rect").attr("x",function(d){return chartXScale(d.date)}).attr("y",0).attr("rx",0).attr("ry",0).attr("class",function(d){return d.value>0?"swimlane-cell":"swimlane-cell-hidden"}).attr("width",cellWidth-0).attr("height",swlHeight-0).style("fill",function(d){return color(d.value)})}function updateProgressBar(){var pcnt=scope.chartData.percentComplete<100?scope.chartData.percentComplete:0;$progressBar.css("width",pcnt+"%")}}return{scope:{chartData:"=",chartHeight:"=",chartTicksMargin:"=",overFieldName:"="},link:link}})},2343:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2344);__webpack_require__(274)},2344:function(module,exports,__webpack_require__){"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _states=__webpack_require__(407);var _general=__webpack_require__(259);var _fields_selection=__webpack_require__(2345);var _fields_selection2=_interopRequireDefault(_fields_selection);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlFieldsSelectionPopulation",function(){return{restrict:"E",replace:true,template:_fields_selection2.default,controller:function controller($scope){$scope.eventRateSelected=false;$scope.tempSelectedField={field:undefined};$scope.selectField=function(){$scope.addField()};$scope.addField=function(){if($scope.eventRateSelected===false||$scope.eventRateSelected===true&&$scope.tempSelectedField.field.id!==_general.EVENT_RATE_COUNT_FIELD){var field=_extends({},$scope.tempSelectedField.field,{agg:{type:$scope.tempSelectedField.field.agg.type}});$scope.formConfig.fields.push(field);$scope.chartStates.fields[field.id]=_states.CHART_STATE.LOADING;$scope.sortFields();$scope.formChange(true)}$scope.tempSelectedField.field=undefined};$scope.removeField=function(index,field){$scope.formConfig.fields.splice(index,1);delete $scope.chartStates.fields[field.id];$scope.sortFields();$scope.formChange(true)};$scope.sortFields=function(){$scope.eventRateSelected=false;var eventRateIndex=-1;$scope.formConfig.fields.forEach(function(f,i){if(f.id===_general.EVENT_RATE_COUNT_FIELD){eventRateIndex=i;$scope.eventRateSelected=true}});if(eventRateIndex>=0){$scope.formConfig.fields.splice(0,0,$scope.formConfig.fields.splice(eventRateIndex,1)[0])}}}}})},2345:function(module,exports){module.exports='<div class=\'fields-selection-population\'>\n  <h4 class="euiTitle euiTitle--small">Fields</h4>\n  <div class="euiSpacer euiSpacer--s"></div>\n  <div class="row">\n    <div class="col-md-12">\n      <div class="form-group">\n        <div class="field-select-container">\n          <ui-select\n            ng-model="tempSelectedField.field"\n            on-select="selectField()"\n            ng-disabled="formConfig.overField === undefined || jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n            append-to-body=true>\n            <ui-select-match placeholder="Add field">\n                <ml-field-type-icon type="$select.selected.mlType"></ml-field-type-icon>{{$select.selected.name}}\n            </ui-select-match>\n            <ui-select-choices repeat="field in ui.fields | filter: { name: $select.search }" group-by="\'mlType\'">\n              <ml-field-type-icon type="field.mlType"></ml-field-type-icon>\n              <span class="select-item" ng-bind-html="field.name | highlight: $select.search"></span>\n            </ui-select-choices>\n          </ui-select>\n\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class="row" ng-show="formConfig.fields.length > 0">\n    <div class="col-md-12">\n      <div class="form-group">\n\n        <div class=\'selection-list-container fields-list\'>\n          <div class="checkbox field-row" ng-repeat="field in formConfig.fields track by $index">\n            <div class=\'field kuiCheckBoxLabel kuiVerticalRhythm\'>\n              <span\n                class=\'kuiCheckBoxLabel__text\'\n                tooltip=\'{{field.tooltip}}\'\n                tooltip-append-to-body="true">\n                {{field.name}}\n              </span>\n            </div>\n            <div>\n              <div class="agg-type">\n                <div class="agg-type-select-wrapper">\n                  <select\n                    class="form-control agg-type-select"\n                    ng-model="field.agg.type"\n                    ng-options="agg as agg.title for agg in ui.aggTypeOptions | filterAggTypes:field"\n                    ng-change="formChange()"\n                    ng-disabled="formConfig.fields[$index] === undefined || jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED">\n                  </select>\n                </div>\n                <button\n                  aria-label="Remove Detector"\n                  ng-click="removeField($index, field)"\n                  tooltip-append-to-body="true"\n                  ng-disabled="formConfig.fields[$index] === undefined || jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                  type="button"\n                  class="euiButton euiButton--danger euiButton--small remove-button">\n                    <i aria-hidden="true" class="fa fa-trash"></i>\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'},2346:function(module,exports,__webpack_require__){"use strict";var _chart_tooltip=__webpack_require__(2347);var _chart_tooltip2=_interopRequireDefault(_chart_tooltip);var _modules=__webpack_require__(4);var _chart_tooltip_service=__webpack_require__(242);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlChartTooltip",function(){return{restrict:"E",replace:true,template:_chart_tooltip2.default,link:function link(scope,element){_chart_tooltip_service.mlChartTooltipService.element=element}}})},2347:function(module,exports){module.exports='<div class="ml-chart-tooltip euiText"></div>\n'},2348:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2349)},2349:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2350);__webpack_require__(1006);__webpack_require__(339);__webpack_require__(406)},2350:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _angular=__webpack_require__(21);var _angular2=_interopRequireDefault(_angular);var _datemath=__webpack_require__(57);var _datemath2=_interopRequireDefault(_datemath);var _job_utils=__webpack_require__(34);var _new_job_utils=__webpack_require__(220);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _check_license=__webpack_require__(43);var _check_privilege=__webpack_require__(32);var _index_utils=__webpack_require__(62);var _check_ml_nodes=__webpack_require__(47);var _job_service=__webpack_require__(23);var _create_job_service=__webpack_require__(1006);var _messagebar_service=__webpack_require__(178);var _ml_api_service=__webpack_require__(22);var _create_job=__webpack_require__(2351);var _create_job2=_interopRequireDefault(_create_job);var _timefilter=__webpack_require__(16);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_routes2.default.when("/jobs/new_job/simple/recognize",{template:_create_job2.default,resolve:{CheckLicense:_check_license.checkLicenseExpired,privileges:_check_privilege.checkCreateJobsPrivilege,indexPattern:_index_utils.loadCurrentIndexPattern,savedSearch:_index_utils.loadCurrentSavedSearch,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable}});var _module=_modules.uiModules.get("apps/ml");_module.controller("MlCreateRecognizerJobs",function($scope,$window,$route,Private){var mlCreateRecognizerJobsService=Private(_create_job_service.CreateRecognizerJobsServiceProvider);_timefilter.timefilter.disableTimeRangeSelector();_timefilter.timefilter.disableAutoRefreshSelector();var msgs=_messagebar_service.mlMessageBarService;var SAVE_STATE={NOT_SAVED:0,SAVING:1,SAVED:2,FAILED:3,PARTIAL_FAILURE:4};var DATAFEED_STATE={NOT_STARTED:0,STARTING:1,STARTED:2,FINISHED:3,STOPPING:4,FAILED:5};$scope.addNewJobToRecentlyAccessed=_new_job_utils.addNewJobToRecentlyAccessed;$scope.SAVE_STATE=SAVE_STATE;$scope.DATAFEED_STATE=DATAFEED_STATE;$scope.overallState=SAVE_STATE.NOT_SAVED;var moduleId=$route.current.params.id;$scope.moduleId=moduleId;var createSearchItems=Private(_new_job_utils.SearchItemsProvider);var _createSearchItems=createSearchItems(),indexPattern=_createSearchItems.indexPattern,savedSearch=_createSearchItems.savedSearch,query=_createSearchItems.query,combinedQuery=_createSearchItems.combinedQuery;var pageTitle=savedSearch.id!==undefined?"saved search "+savedSearch.title:"index pattern "+indexPattern.title;$scope.displayQueryWarning=savedSearch.id!==undefined;$scope.ui={formValid:true,indexPattern:indexPattern,pageTitle:pageTitle,showJobInput:true,numberOfJobs:0,kibanaLabels:{dashboard:"Dashboards",search:"Searches",visualization:"Visualizations"},validation:{checks:{jobLabel:{valid:true},groupIds:{valid:true}}}};$scope.formConfig={indexPattern:indexPattern,jobLabel:"",jobGroups:[],jobs:[],kibanaObjects:{},start:0,end:0,query:query,filters:[],useFullIndexData:true,startDatafeedAfterSave:true,useDedicatedIndex:false};$scope.resultsUrl="";$scope.resetJob=function(){$scope.overallState=SAVE_STATE.NOT_SAVED;$scope.formConfig.jobs=[];$scope.formConfig.filters=[];$scope.formConfig.kibanaObjects={};loadJobConfigs()};function loadJobConfigs(){_ml_api_service.ml.getDataRecognizerModule({moduleId:moduleId}).then(function(resp){if(resp.jobs&&resp.jobs.length){var tempGroups={};resp.jobs.forEach(function(job){$scope.formConfig.jobs.push({id:job.id,jobConfig:job.config,jobState:SAVE_STATE.NOT_SAVED,datafeedId:null,datafeedConfig:{},datafeedState:SAVE_STATE.NOT_SAVED,runningState:DATAFEED_STATE.NOT_STARTED,errors:[]});$scope.ui.numberOfJobs++;if(job.config.groups&&job.config.groups.length){job.config.groups.forEach(function(group){tempGroups[group]=null})}});$scope.formConfig.jobGroups=Object.keys(tempGroups);resp.datafeeds.forEach(function(datafeed){var job=_lodash2.default.find($scope.formConfig.jobs,{id:datafeed.config.job_id});if(job!==undefined){var datafeedId=_job_service.mlJobService.getDatafeedId(job.id);job.datafeedId=datafeedId;job.datafeedConfig=datafeed.config}})}if(resp.kibana){_lodash2.default.each(resp.kibana,function(obj,key){$scope.formConfig.kibanaObjects[key]=obj.map(function(o){return{id:o.id,title:o.title,saveState:SAVE_STATE.NOT_SAVED,config:o.config,exists:false}})});checkIfKibanaObjectsExist($scope.formConfig.kibanaObjects)}$scope.$applyAsync()})}$scope.changeUseFullIndexData=function(){var shouldEnableTimeFilter=!$scope.formConfig.useFullIndexData;if(shouldEnableTimeFilter){_timefilter.timefilter.enableTimeRangeSelector()}else{_timefilter.timefilter.disableTimeRangeSelector()}$scope.$applyAsync()};$scope.changeJobLabelCase=function(){$scope.formConfig.jobLabel=$scope.formConfig.jobLabel.toLowerCase()};$scope.save=function(){if(validateJobs()){msgs.clear();$scope.overallState=SAVE_STATE.SAVING;_angular2.default.element(".results").css("opacity",1);window.setTimeout(function(){saveDataRecognizerItems().then(function(){if($scope.formConfig.startDatafeedAfterSave){startDatafeeds().then(function(){$scope.setOverallState()}).catch(function(){$scope.setOverallState()})}else{$scope.setOverallState()}})},500)}};function saveDataRecognizerItems(){return new Promise(function(resolve){setAllToSaving();var prefix=$scope.formConfig.jobLabel;var indexPatternName=$scope.formConfig.indexPattern.title;var groups=$scope.formConfig.jobGroups;var useDedicatedIndex=$scope.formConfig.useDedicatedIndex;var tempQuery=savedSearch.id===undefined?undefined:combinedQuery;_ml_api_service.ml.setupDataRecognizerConfig({moduleId:moduleId,prefix:prefix,groups:groups,query:tempQuery,indexPatternName:indexPatternName,useDedicatedIndex:useDedicatedIndex}).then(function(resp){if(resp.jobs){$scope.formConfig.jobs.forEach(function(job){var jobId=""+prefix+job.id;var jobResult=resp.jobs.find(function(j){return j.id===jobId});if(jobResult!==undefined){if(jobResult.success){job.jobState=SAVE_STATE.SAVED}else{job.jobState=SAVE_STATE.FAILED;if(jobResult.error&&jobResult.error.msg){job.errors.push(jobResult.error.msg)}}}else{job.jobState=SAVE_STATE.FAILED;job.errors.push("Could not save job "+jobId)}var datafeedId=(0,_job_utils.prefixDatafeedId)(job.datafeedId,prefix);var datafeedResult=resp.datafeeds.find(function(d){return d.id===datafeedId});if(datafeedResult!==undefined){if(datafeedResult.success){job.datafeedState=SAVE_STATE.SAVED}else{job.datafeedState=SAVE_STATE.FAILED;if(datafeedResult.error&&datafeedResult.error.msg){job.errors.push(datafeedResult.error.msg)}}}else{job.datafeedState=SAVE_STATE.FAILED;job.errors.push("Could not save datafeed "+datafeedId)}$scope.$applyAsync()})}if(resp.kibana){_lodash2.default.each($scope.formConfig.kibanaObjects,function(kibanaObject,objName){kibanaObject.forEach(function(obj){var kibanaObjectResult=resp.kibana[objName].find(function(o){return o.id===obj.id});if(kibanaObjectResult!==undefined){if(kibanaObjectResult.success||kibanaObjectResult.success===false&&kibanaObjectResult.exists===true){obj.saveState=SAVE_STATE.SAVED}else{obj.saveState=SAVE_STATE.FAILED}}else{obj.saveState=SAVE_STATE.FAILED;obj.errors.push("Could not save "+objName+" "+obj.id)}$scope.$applyAsync()})})}resolve()})})}function setAllToSaving(){$scope.formConfig.jobs.forEach(function(j){j.jobState=SAVE_STATE.SAVING;j.datafeedState=SAVE_STATE.SAVING});_lodash2.default.each($scope.formConfig.kibanaObjects,function(kibanaObject){kibanaObject.forEach(function(obj){obj.saveState=SAVE_STATE.SAVING})});$scope.$applyAsync()}function startDatafeeds(){return new Promise(function(resolve,reject){var jobs=$scope.formConfig.jobs;var numberOfJobs=jobs.length;mlCreateRecognizerJobsService.indexTimeRange($scope.formConfig.indexPattern,$scope.formConfig).then(function(resp){if($scope.formConfig.useFullIndexData){$scope.formConfig.start=resp.start.epoch;$scope.formConfig.end=resp.end.epoch}else{$scope.formConfig.start=_datemath2.default.parse(_timefilter.timefilter.getTime().from).valueOf();$scope.formConfig.end=_datemath2.default.parse(_timefilter.timefilter.getTime().to).valueOf()}var jobsCounter=0;var datafeedCounter=0;open(jobs[jobsCounter]);function incrementAndOpen(job){jobsCounter++;if(jobsCounter<numberOfJobs){open(jobs[jobsCounter])}else{if(job.runningState===DATAFEED_STATE.FAILED){reject()}}}function open(job){if(job.jobState===SAVE_STATE.FAILED){datafeedCounter++;job.runningState=DATAFEED_STATE.FAILED;incrementAndOpen(job);return}job.runningState=DATAFEED_STATE.STARTING;var jobId=$scope.formConfig.jobLabel+job.id;_job_service.mlJobService.openJob(jobId).then(function(){incrementAndOpen(job);start(job)}).catch(function(err){console.log("Opening job failed",err);start(job);job.errors.push(err.message);incrementAndOpen(job)})}function start(job){var jobId=$scope.formConfig.jobLabel+job.id;var datafeedId=(0,_job_utils.prefixDatafeedId)(job.datafeedId,$scope.formConfig.jobLabel);mlCreateRecognizerJobsService.startDatafeed(datafeedId,jobId,$scope.formConfig.start,$scope.formConfig.end).then(function(){job.runningState=DATAFEED_STATE.STARTED;datafeedCounter++;if(datafeedCounter===numberOfJobs){resolve()}}).catch(function(err){console.log("Starting datafeed failed",err);job.errors.push(err.message);job.runningState=DATAFEED_STATE.FAILED;reject(err)}).then(function(){$scope.$applyAsync()})}})})}function checkIfKibanaObjectsExist(kibanaObjects){_lodash2.default.each(kibanaObjects,function(objects,type){objects.forEach(function(obj){checkForSavedObject(type,obj).then(function(result){if(result){obj.saveState=SAVE_STATE.SAVED;obj.exists=true}})})})}function checkForSavedObject(type,savedObject){return new Promise(function(resolve,reject){var exists=false;mlCreateRecognizerJobsService.loadExistingSavedObjects(type).then(function(resp){var savedObjects=resp.savedObjects;savedObjects.forEach(function(obj){if(savedObject.title===obj.attributes.title){exists=true;savedObject.id=obj.id}});resolve(exists)}).catch(function(resp){console.log("Could not load saved objects",resp);reject(resp)})})}$scope.setOverallState=function(){var jobIds=[];var failedJobsCount=$scope.formConfig.jobs.reduce(function(count,job){if(job.jobState===SAVE_STATE.FAILED||job.datafeedState===SAVE_STATE.FAILED){return count+1}else{jobIds.push(""+$scope.formConfig.jobLabel+job.id);return count}},0);if(failedJobsCount){if(failedJobsCount===$scope.formConfig.jobs.length){$scope.overallState=SAVE_STATE.FAILED}else{$scope.overallState=SAVE_STATE.PARTIAL_FAILURE}}else{$scope.overallState=SAVE_STATE.SAVED}$scope.resultsUrl=_job_service.mlJobService.createResultsUrl(jobIds,$scope.formConfig.start,$scope.formConfig.end,"explorer");$scope.$applyAsync()};function validateJobs(){var valid=true;var checks=$scope.ui.validation.checks;_lodash2.default.each(checks,function(item){item.valid=true});var label=$scope.formConfig.jobLabel+"extra";if((0,_job_utils.isJobIdValid)(label)===false){valid=false;checks.jobLabel.valid=false;var msg="Job label can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; ";msg+="must start and end with an alphanumeric character";checks.jobLabel.message=msg}$scope.formConfig.jobGroups.forEach(function(group){if((0,_job_utils.isJobIdValid)(group)===false){valid=false;checks.groupIds.valid=false;var _msg="Job group names can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; ";_msg+="must start and end with an alphanumeric character";checks.groupIds.message=_msg}});return valid}loadJobConfigs()})},2351:function(module,exports){module.exports='<ml-nav-menu name="new_job_multi_metric"></ml-nav-menu>\n<ml-new-job-recognizer>\n  <ml-message-bar></ml-message-bar>\n  <div ng-controller="MlCreateRecognizerJobs" class="recognizer-job-container">\n    <div class="row">\n      <div class="col-md-12">\n        <h3 class="euiTitle euiTitle--large">New job from {{ui.pageTitle}}</h3>\n\n        <div ng-if="displayQueryWarning === true" class="euiCallOut euiCallOut--warning">\n            <div class="euiCallOutHeader">\n              <svg class="euiIcon euiCallOutHeader__icon euiIcon--medium" xmlns="http://www.w3.org/2000/svg"\n                  width="16" height="16" viewBox="0 0 16 16">\n                <g fill-rule="evenodd">\n                  <path d="M7.5 2.236L1.618 14h11.764L7.5 2.236zm.894-.447l5.882 11.764A1 1 0 0 1 13.382 15H1.618a1 1 0 0 1-.894-1.447L6.606 1.789a1 1 0 0 1 1.788 0z"\n                  />\n                  <path d="M7 6h1v5H7zM7 12h1v1H7z" />\n                </g>\n              </svg>\n              <span class="euiCallOutHeader__title">Search will be overwritten</span>\n            </div>\n            <div class="euiText euiText--small">\n              <p>\n                Using a saved search will mean the query used in the datafeeds will be different from the default ones we supply in the {{moduleId}} module.\n              </p>\n            </div>\n          </div>\n      </div>\n    </div>\n\n    <div class="euiSpacer euiSpacer--s"></div>\n\n    <div class="row">\n      <div class="col-md-4">\n        <div class="row form-controls">\n          <h4 class="euiTitle euiTitle--small">Job settings</h4>\n          <div>\n\n            <div class=\'form-section\' >\n              <div ng-show="jobState !== SAVE_STATE.FINISHED">\n                <h4 class="euiTitle euiTitle--small">Job Details</h4>\n                <div class="euiSpacer euiSpacer--s"></div>\n              </div>\n\n              <div class="form-group">\n                <div ng-show="ui.showJobInput && (overallState === SAVE_STATE.NOT_SAVED || overallState === SAVE_STATE.SAVING)">\n                  <div class="form-group">\n                    <ml-form-label label-id="new_job_recognizer_job_prefix">Job ID prefix</ml-form-label>\n                    <input\n                      aria-labelledby="ml_aria_label_new_job_recognizer_job_prefix"\n                      aria-describedby="ml_aria_description_new_job_recognizer_job_prefix"\n                      ng-model="formConfig.jobLabel"\n                      placeholder="Job ID prefix"\n                      ng-change="changeJobLabelCase()"\n                      ng-disabled="overallState === SAVE_STATE.SAVING"\n                      class="form-control lowercase" />\n                      <div ng-hide="ui.validation.checks.jobLabel.valid" class="validation-error">{{ ui.validation.checks.jobLabel.message }}</div>\n                  </div>\n                  <div class="form-group">\n                    <ml-form-label label-id="new_job_group">Job groups</ml-form-label>\n                    <ml-job-group-select\n                      aria-labelledby="ml_aria_label_new_job_group"\n                      aria-describedby="ml_aria_description_new_job_group"\n                      job-groups=\'formConfig.jobGroups\'\n                      disabled=\'(overallState === SAVE_STATE.SAVING)\' />\n                    <div ng-hide="ui.validation.checks.groupIds.valid" class="validation-error">{{ ui.validation.checks.groupIds.message }}</div>\n                  </div>\n                  <div class="form-group">\n                    <div ng-click="ui.showAdvanced = (!ui.showAdvanced || formConfig.useDedicatedIndex)" class="advanced-button-container">\n                      <button\n                        aria-label="{{ ui.showAdvanced ? \'Hide Advanced\' : \'Show Advanced\' }}"\n                        ng-disabled="formConfig.useDedicatedIndex"\n                        type="button"\n                        class="kuiButton kuiButton--small kuiButton--hollow advanced-button">\n                        <i ng-class="{ \'fa-caret-down\': ui.showAdvanced, \'fa-caret-right\': !ui.showAdvanced }" class="fa" aria-label="Show advanced" ></i>\n                      </button>\n                      <label class="kuiFormLabel" aria-describedby="ml_aria_description_new_job_advanced_settings">Advanced</label>\n                      <i ml-info-icon="new_job_advanced_settings" aria-label="Advanced settings" />\n                    </div>\n                    <div class=\'advanced-group\' ng-show="ui.showAdvanced">\n                      <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n                        <input type="checkbox"\n                          aria-labelledby="ml_aria_label_new_job_dedicated_index"\n                          aria-describedby="ml_aria_description_new_job_dedicated_index"\n                          class=\'kuiCheckBox\'\n                          ng-model="formConfig.useDedicatedIndex" />\n                        <span class=\'kuiCheckBoxLabel__text\'>\n                          <span id="ml_aria_label_new_job_dedicated_index">Use dedicated index</span>\n                          <i ml-info-icon="new_job_dedicated_index" aria-label="Use dedicated index" />\n                        </span>\n                      </label>\n                    </div>\n                  </div>\n\n                  <div class="form-group">\n                    <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n                      <input type="checkbox"\n                        class=\'kuiCheckBox\'\n                        ng-model="formConfig.startDatafeedAfterSave" />\n                        <span class=\'kuiCheckBoxLabel__text\'>\n                          Start datafeed after save\n                        </span>\n                    </label>\n                  </div>\n                  <div class="form-group">\n                    <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n                      <input type="checkbox"\n                        class=\'kuiCheckBox\'\n                        ng-change="changeUseFullIndexData()"\n                        ng-model="formConfig.useFullIndexData" />\n                        <span class=\'kuiCheckBoxLabel__text\'>\n                          Use full {{formConfig.indexPattern.title}} data\n                        </span>\n                    </label>\n                  </div>\n\n                  <button\n                    aria-label="Create Job"\n                    ng-click="save()"\n                    type="button"\n                    ng-show="overallState === SAVE_STATE.NOT_SAVED"\n                    ng-disabled="!ui.formValid"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      Create Job{{((ui.numberOfJobs > 1)?\'s\':\'\')}}\n                    </span>\n                  </button>\n\n                  <div class=\'job-state-info\' ng-show="overallState === SAVE_STATE.SAVING">Analysis running <i class=\'fa fa-spinner fa-spin\' aria-label="Analysis running" ></i></div>\n                </div>\n                <div ng-show="overallState === SAVE_STATE.SAVED || overallState === SAVE_STATE.PARTIAL_FAILURE">\n                  <h3 ng-if="overallState === SAVE_STATE.SAVED" class="euiTitle euiTitle--large">Jobs created\n                    <i style="color:green;" class="fa fa-check" aria-label="Saved"></i>\n                  </h3>\n\n                  <h3 ng-if="overallState === SAVE_STATE.PARTIAL_FAILURE" class="euiTitle euiTitle--large">Some jobs failed to be created\n                    <i style="color:red;" class="fa fa-remove" aria-label="Save failed"></i>\n                  </h3>\n\n                  <div class="euiSpacer euiSpacer--m"></div>\n\n                  <button\n                    aria-label="Reset"\n                    ng-click="resetJob()"\n                    type="button"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      Reset\n                    </span>\n                  </button>\n                  <a\n                    href=\'{{resultsUrl}}\'\n                    ng-click="addNewJobToRecentlyAccessed(formConfig.jobId, resultsUrl)"\n                    aria-label="View Results"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      View Results\n                    </span>\n                  </a>\n                </div>\n\n                <div ng-show="overallState === SAVE_STATE.FAILED">\n                  <h3 class="euiTitle euiTitle--large">Jobs creation failed\n                    <i style="color:red;" class="fa fa-remove" aria-label="Save failed"></i>\n                  </h3>\n                  <div class="euiSpacer euiSpacer--m"></div>\n\n                  <button\n                    aria-label="Reset"\n                    ng-click="resetJob()"\n                    type="button"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      Reset\n                    </span>\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class="col-md-8">\n        <div class="row charts-container">\n          <h4 class="euiTitle euiTitle--small">Jobs</h4>\n          <div class=\'jobs-list\'>\n            <div ng-repeat=\'job in formConfig.jobs\' class=\'job-container\'>\n              <div class=\'labels\'>\n                <div class=\'title\'>{{formConfig.jobLabel}}{{job.id}}</div>\n                <div class=\'sub-title\'>{{job.jobConfig.description}}</div>\n                <div class=\'validation-error\' ng-repeat="error in job.errors">{{error}}</div>\n              </div>\n              <div class=\'results\'>\n                <div class=\'result-box\'>\n                  <div class=\'result-box-title\'>Job</div>\n                  <div class=\'result-box-inner\'>\n                    <i ng-show="job.jobState === SAVE_STATE.NOT_SAVED" aria-label="Not saved" ></i>\n                    <i ng-show="job.jobState === SAVE_STATE.FAILED" style="color:red;" class="fa fa-remove"aria-label="Save failed" ></i>\n                    <i ng-show="job.jobState === SAVE_STATE.SAVING" class="fa fa-spinner fa-spin"aria-label="Saving" ></i>\n                    <i ng-show="job.jobState === SAVE_STATE.SAVED" style="color:green;" class="fa fa-check"aria-label="Saved" ></i>\n                  </div>\n                </div>\n                <div class=\'result-box\'>\n                  <div class=\'result-box-title\'>Datafeed</div>\n                  <div class=\'result-box-inner\'>\n                    <i ng-show="job.datafeedState === SAVE_STATE.NOT_SAVED" aria-label="Not saved" ></i>\n                    <i ng-show="job.datafeedState === SAVE_STATE.FAILED" style="color:red;" class="fa fa-remove"aria-label="Save failed" ></i>\n                    <i ng-show="job.datafeedState === SAVE_STATE.SAVING" class="fa fa-spinner fa-spin"aria-label="Saving" ></i>\n                    <i ng-show="job.datafeedState === SAVE_STATE.SAVED" style="color:green;" class="fa fa-check"aria-label="Saved" ></i>\n                  </div>\n                </div>\n                <div class=\'result-box\' ng-if="formConfig.startDatafeedAfterSave">\n                  <div class=\'result-box-title\'>Running</div>\n                  <div class=\'result-box-inner\'>\n                    <i ng-show="job.runningState === DATAFEED_STATE.NOT_STARTED" aria-label="Not started" ></i>\n                    <i ng-show="job.runningState === DATAFEED_STATE.FAILED" style="color:red;" class="fa fa-remove"aria-label="Start failed" ></i>\n                    <i ng-show="job.runningState === DATAFEED_STATE.STARTING" class="fa fa-spinner fa-spin"aria-label="Starting" ></i>\n                    <i ng-show="job.runningState === DATAFEED_STATE.STARTED" style="color:green;" class="fa fa-check"aria-label="Started" ></i>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class="row charts-container" ng-repeat=\'(key, value) in formConfig.kibanaObjects\'>\n          <h4 class="euiTitle euiTitle--small">{{ui.kibanaLabels[key]}}</h4>\n          <div class=\'save-objects-list\'>\n            <div ng-repeat=\'obj in value | orderBy:"title"\' class=\'job-container\'>\n              <div class=\'labels\'>\n                <div class=\'title\' ng-class="{exists: obj.exists}">\n                  {{obj.title}}\n                  <span ng-if="obj.exists">(already exists)</span>\n                </div>\n              </div>\n              <div class=\'results\'>\n                <div class=\'result-box\'>\n                  <div class=\'result-box-inner\'>\n                    <i ng-show="obj.saveState === SAVE_STATE.NOT_SAVED" aria-label="Not saved" ></i>\n                    <i ng-show="obj.saveState === SAVE_STATE.FAILED" style="color:red;" class="fa fa-remove"aria-label="Save failed" ></i>\n                    <i ng-show="obj.saveState === SAVE_STATE.SAVING" class="fa fa-spinner fa-spin"aria-label="Saving" ></i>\n                    <i ng-show="obj.saveState === SAVE_STATE.SAVED  && !obj.exists" style="color:green;" class="fa fa-check"aria-label="Saved" ></i>\n                    <i ng-show="obj.saveState === SAVE_STATE.SAVED && obj.exists" style="color:#BBBBBB;" class="fa fa-check"aria-label="Already saved" ></i>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</ml-new-job-recognizer>\n'},2352:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2353);__webpack_require__(2357);__webpack_require__(1007)},2353:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2354)},2354:function(module,exports,__webpack_require__){"use strict";var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _check_license=__webpack_require__(43);var _preconfigured_job_redirect=__webpack_require__(2355);var _check_privilege=__webpack_require__(32);var _index_utils=__webpack_require__(62);var _check_ml_nodes=__webpack_require__(47);var _index_or_search=__webpack_require__(2356);var _index_or_search2=_interopRequireDefault(_index_or_search);var _timefilter=__webpack_require__(16);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_routes2.default.when("/jobs/new_job",{redirectTo:"/jobs/new_job/step/index_or_search"});_routes2.default.when("/jobs/new_job/step/index_or_search",{template:_index_or_search2.default,resolve:{CheckLicense:_check_license.checkLicenseExpired,privileges:_check_privilege.checkCreateJobsPrivilege,indexPatterns:_index_utils.loadIndexPatterns,preConfiguredJobRedirect:_preconfigured_job_redirect.preConfiguredJobRedirect,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable,nextStepPath:function nextStepPath(){return"#/jobs/new_job/step/job_type"}}});_routes2.default.when("/datavisualizer_index_select",{template:_index_or_search2.default,resolve:{CheckLicense:_check_license.checkBasicLicense,privileges:_check_privilege.checkFindFileStructurePrivilege,indexPatterns:_index_utils.loadIndexPatterns,nextStepPath:function nextStepPath(){return"#jobs/new_job/datavisualizer"}}});var _module=_modules.uiModules.get("apps/ml");_module.controller("MlNewJobStepIndexOrSearch",function($scope,$route){_timefilter.timefilter.disableTimeRangeSelector();_timefilter.timefilter.disableAutoRefreshSelector();$scope.indexPatterns=(0,_index_utils.getIndexPatterns)().filter(function(indexPattern){return!indexPattern.get("type")});var path=$route.current.locals.nextStepPath;$scope.withIndexPatternUrl=function(pattern){if(!pattern){return}return path+"?index="+encodeURIComponent(pattern.id)};$scope.withSavedSearchUrl=function(savedSearch){if(!savedSearch){return}return path+"?savedSearchId="+encodeURIComponent(savedSearch.id)}})},2355:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.preConfiguredJobRedirect=preConfiguredJobRedirect;var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _lodash=__webpack_require__(1);var _general=__webpack_require__(259);var _job_service=__webpack_require__(23);var _index_utils=__webpack_require__(62);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function preConfiguredJobRedirect(AppState,Private,courier){return new Promise(function(resolve,reject){var basePath=_chrome2.default.getBasePath()+"/app/ml#";var stateDefaults={mlJobSettings:{}};var appState=new AppState(stateDefaults);var redirectUrl=getWizardUrlFromAppState(appState);if(redirectUrl===null){var job=_job_service.mlJobService.currentJob;if(job){(0,_index_utils.loadIndexPatterns)(Private,courier).then(function(){redirectUrl=getWizardUrlFromCloningJob(job);if(redirectUrl===null){window.location.href=basePath+"/jobs/new_job/advanced";reject()}else{window.location.href=basePath+"/"+redirectUrl;reject()}}).catch(function(error){console.log(error);resolve()})}else{resolve()}}else{window.location.href=basePath+"/"+redirectUrl;reject()}})}function getWizardUrlFromAppState(appState){if(appState.mlJobSettings!==undefined&&Object.keys(appState.mlJobSettings).length){var page="";var jobSettings=appState.mlJobSettings;if(jobSettings.fields&&jobSettings.fields.length){if(jobSettings.fields.length>1||jobSettings.split!==undefined){if(jobSettings.population!==undefined){page="population"}else{page="multi_metric"}}else{page="single_metric"}}return"jobs/new_job/simple/"+page}else{return null}}function getWizardUrlFromCloningJob(job){var created=(0,_lodash.get)(job,"custom_settings.created_by");var page="";if(created!==undefined){if(created===_general.WIZARD_TYPE.SINGLE_METRIC){page="single_metric"}else if(created===_general.WIZARD_TYPE.MULTI_METRIC){page="multi_metric"}else if(created===_general.WIZARD_TYPE.POPULATION){page="population"}var indexPatternId=(0,_index_utils.getIndexPatternIdFromName)(job.datafeed_config.indices[0]);return"jobs/new_job/simple/"+page+"?index="+indexPatternId+"&_g=()"}else{return null}}},2356:function(module,exports){module.exports='<ml-nav-menu name="new_job"></ml-nav-menu>\n<ml-new-job class="index-or-saved-search-selection">\n  <ml-message-bar></ml-message-bar>\n  <div class=\'kuiViewContent kuiViewContent--constrainedWidth kuiViewContentItem\' >\n    <div ng-controller="MlNewJobStepIndexOrSearch" class="visWizard">\n      <div class="visWizard__column visWizard__column--small">\n        <h3 class="kuiTitle kuiVerticalRhythm">From a New Search, Select Index</h3>\n        <paginated-selectable-list\n          per-page="20"\n          list="indexPatterns"\n          list-property="attributes.title"\n          user-make-url="withIndexPatternUrl"\n          class="visWizard__row visWizard__list--paginated--selectable kuiVerticalRhythm"\n          disable-auto-focus="true"\n        ></paginated-selectable-list>\n      </div>\n      <div class="visWizard__column visWizard__column--large">\n\n        <h3 class="kuiTitle kuiVerticalRhythm">Or, From a Saved Search</h3>\n        <saved-object-finder\n          title="Saved Searches"\n          type="searches"\n          class="visWizard__row visWizard__savedObjectFinder kuiVerticalRhythm"\n          make-url="withSavedSearchUrl"\n          disable-auto-focus="true"\n        ></saved-object-finder>\n       </div>\n    </div>\n    </div>\n</ml-new-job>\n'},2357:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2358)},2358:function(module,exports,__webpack_require__){"use strict";var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _check_license=__webpack_require__(43);var _check_privilege=__webpack_require__(32);var _new_job_utils=__webpack_require__(220);var _index_utils=__webpack_require__(62);var _recently_accessed=__webpack_require__(468);var _check_ml_nodes=__webpack_require__(47);var _job_type=__webpack_require__(2359);var _job_type2=_interopRequireDefault(_job_type);var _timefilter=__webpack_require__(16);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_routes2.default.when("/jobs/new_job/step/job_type",{template:_job_type2.default,resolve:{CheckLicense:_check_license.checkLicenseExpired,privileges:_check_privilege.checkCreateJobsPrivilege,indexPattern:_index_utils.loadCurrentIndexPattern,savedSearch:_index_utils.loadCurrentSavedSearch,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable}});var _module=_modules.uiModules.get("apps/ml");_module.controller("MlNewJobStepJobType",function($scope,Private){_timefilter.timefilter.disableTimeRangeSelector();_timefilter.timefilter.disableAutoRefreshSelector();var createSearchItems=Private(_new_job_utils.SearchItemsProvider);var _createSearchItems=createSearchItems(),indexPattern=_createSearchItems.indexPattern,savedSearch=_createSearchItems.savedSearch;$scope.indexWarningTitle="";$scope.isTimeBasedIndex=(0,_index_utils.timeBasedIndexCheck)(indexPattern);if($scope.isTimeBasedIndex===false){$scope.indexWarningTitle=savedSearch.id===undefined?"Index pattern "+indexPattern.title+" is not time based":savedSearch.title+" uses index pattern "+indexPattern.title+" which is not time based"}$scope.indexPattern=indexPattern;$scope.savedSearch=savedSearch;$scope.recognizerResults={count:0,onChange:function onChange(){$scope.$applyAsync()}};$scope.pageTitleLabel=savedSearch.id!==undefined?"saved search "+savedSearch.title:"index pattern "+indexPattern.title;$scope.getUrl=function(basePath){return savedSearch.id===undefined?basePath+"?index="+indexPattern.id:basePath+"?savedSearchId="+savedSearch.id};$scope.addSelectionToRecentlyAccessed=function(){var title=savedSearch.id===undefined?indexPattern.title:savedSearch.title;var url=$scope.getUrl("");(0,_recently_accessed.addItemToRecentlyAccessed)("jobs/new_job/datavisualizer",title,url)}})},2359:function(module,exports){module.exports='<ml-nav-menu name="new_job"></ml-nav-menu>\n<ml-new-job class="job-type-gallery">\n  <ml-message-bar></ml-message-bar>\n  <div ng-controller="MlNewJobStepJobType">\n    \x3c!-- Presents the various options for creating a job --\x3e\n    <div class="job-types-content">\n      <h1 class="euiTitle euiTitle--large">Create a job from the {{pageTitleLabel}}</h1>\n      <div class="euiSpacer euiSpacer--l"></div>\n\n      <div ng-if="isTimeBasedIndex===false">\n        <div class="index-warning">\n          <div class="euiCallOut euiCallOut--warning">\n            <div class="euiCallOutHeader">\n              <svg class="euiIcon euiCallOutHeader__icon euiIcon--medium" xmlns="http://www.w3.org/2000/svg"\n              width="16" height="16" viewBox="0 0 16 16">\n                <g fill-rule="evenodd">\n                  <path d="M7.5 2.236L1.618 14h11.764L7.5 2.236zm.894-.447l5.882 11.764A1 1 0 0 1 13.382 15H1.618a1 1 0 0 1-.894-1.447L6.606 1.789a1 1 0 0 1 1.788 0z"\n                  />\n                  <path d="M7 6h1v5H7zM7 12h1v1H7z" />\n                </g>\n              </svg>\n              <span class="euiCallOutHeader__title">{{indexWarningTitle}}</span>\n            </div>\n            <div class="euiText euiText--small">\n              <p>Anomaly detection can only be run over indices which are time based.<br/>\n                <a class="euiLink euiLink--primary" href="#jobs/new_job">Select a different index</a>\n              </p>\n            </div>\n          </div>\n        </div>\n        <div class="euiSpacer euiSpacer--xxl"></div>\n      </div>\n\n      <div ng-show="recognizerResults.count!==0" class="recognizer-section">\n        <div class="euiText">\n          <h3 class="euiTitle euiTitle--small">Use a supplied configuration</h3>\n          <p>\n            The fields in your data have been recognized as matching known configurations.\n            Select to create a set of machine learning jobs and associated dashboards.\n          </p>\n        </div>\n        <div class="euiSpacer euiSpacer--m"></div>\n        <ml-data-recognizer\n          class-name=\'"euiFlexGrid euiFlexGrid--gutterLarge euiFlexGrid--fourths"\'\n          item-class-name=\'""\'\n          index-pattern=\'indexPattern\'\n          saved-search=\'savedSearch\'\n          results=recognizerResults/>\n        <div class="euiSpacer euiSpacer--xxl"></div>\n      </div>\n\n      <div class="euiText">\n        <h3 class="euiTitle euiTitle--small">Use a wizard</h3>\n        <p>\n          Use one of the wizards to create a machine learning job to find anomalies in your data.\n        </p>\n      </div>\n\n      <div class="euiSpacer euiSpacer--m"></div>\n\n      <div class="euiFlexGrid euiFlexGrid--gutterLarge euiFlexGrid--fourths">\n        <div class="euiFlexItem" ng-class=\'{disabled: isTimeBasedIndex===false}\'>\n          <a ng-href="{{getUrl(\'#jobs/new_job/simple/single_metric\')}}" ng-class=\'{disabled: isTimeBasedIndex===false}\' class="euiLink synopsis">\n            <div class="euiPanel euiPanel--paddingMedium synopsisPanel">\n              <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive">\n                <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                  <icon type="\'createSingleMetricJob\'" size="\'xl\'" aria-label="Single metric job" class="synopsisIcon" />\n                </div>\n                <div class="euiFlexItem synopsisContent">\n                  <h4 class="euiTitle euiTitle--small synopsisTitle">Single metric</h4>\n                  <div class="euiText synopsisBody">\n                    <p>\n                      <span class="euiTextColor euiTextColor--subdued">\n                      Detect anomalies in a single time series.\n                      </span>\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </a>\n        </div>\n        <div class="euiFlexItem" ng-class=\'{disabled: isTimeBasedIndex===false}\'>\n          <a ng-href="{{getUrl(\'#jobs/new_job/simple/multi_metric\')}}" ng-class=\'{disabled: isTimeBasedIndex===false}\' class="euiLink synopsis">\n            <div class="euiPanel euiPanel--paddingMedium synopsisPanel">\n              <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive">\n                <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                  <icon type="\'createMultiMetricJob\'" size="\'xl\'" aria-label="Multi metric job" class="synopsisIcon" />\n                </div>\n                <div class="euiFlexItem synopsisContent">\n                  <h4 class="euiTitle euiTitle--small synopsisTitle">Multi metric</h4>\n                  <div class="euiText synopsisBody">\n                    <p>\n                      <span class="euiTextColor euiTextColor--subdued">\n                      Detect anomalies in multiple metrics by splitting a time series by a categorical field.\n                      </span>\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </a>\n        </div>\n        <div class="euiFlexItem" ng-class=\'{disabled: isTimeBasedIndex===false}\'>\n          <a ng-href="{{getUrl(\'#jobs/new_job/simple/population\')}}" ng-class=\'{disabled: isTimeBasedIndex===false}\' class="euiLink synopsis">\n            <div class="euiPanel euiPanel--paddingMedium synopsisPanel">\n              <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive">\n                <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                  <icon type="\'createPopulationJob\'" size="\'xl\'" aria-label="Population job" class="synopsisIcon" />\n                </div>\n                <div class="euiFlexItem synopsisContent">\n                  <h4 class="euiTitle euiTitle--small synopsisTitle">Population</h4>\n                  <div class="euiText synopsisBody">\n                    <p>\n                      <span class="euiTextColor euiTextColor--subdued">\n                      Detect activity that is unusual compared to the behavior of the population.\n                      </span>\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </a>\n        </div>\n        <div class="euiFlexItem" ng-class=\'{disabled: isTimeBasedIndex===false}\'>\n          <a ng-href="{{getUrl(\'#jobs/new_job/advanced\')}}" ng-class=\'{disabled: isTimeBasedIndex===false}\' class="euiLink synopsis">\n            <div class="euiPanel euiPanel--paddingMedium synopsisPanel">\n              <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive">\n                <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                  <icon type="\'createAdvancedJob\'" size="\'xl\'" aria-label="Advanced job" class="synopsisIcon" />\n                </div>\n                <div class="euiFlexItem synopsisContent">\n                  <h4 class="euiTitle euiTitle--small synopsisTitle">Advanced</h4>\n                  <div class="euiText synopsisBody">\n                    <p>\n                      <span class="euiTextColor euiTextColor--subdued">\n                      Use the full range of options to create a job for more advanced use cases.\n                      </span>\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </a>\n        </div>\n      </div>\n\n      <div class="euiSpacer euiSpacer--xxl"></div>\n\n      <div class="euiText">\n        <h3 class="euiTitle euiTitle--small">Learn more about your data</h3>\n        <p>\n          If you\'re not sure what type of job to create, first explore the fields and metrics in your data.\n        </p>\n      </div>\n      <div class="euiSpacer euiSpacer--m"></div>\n\n      <div class="euiFlexGrid euiFlexGrid--gutterLarge euiFlexGrid--fourths">\n        <div class="euiFlexItem" ng-class=\'{disabled: isTimeBasedIndex===false}\'>\n          <a\n            ng-href="{{getUrl(\'#jobs/new_job/datavisualizer\')}}"\n            ng-click="addSelectionToRecentlyAccessed()"\n            ng-class=\'{disabled: isTimeBasedIndex===false}\'\n            class="euiLink synopsis">\n            <div class="euiPanel euiPanel--paddingMedium synopsisPanel">\n              <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive">\n                <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                  <icon type="\'dataVisualizer\'" size="\'xl\'" aria-label="Data Visualizer" class="synopsisIcon" />\n                </div>\n                <div class="euiFlexItem synopsisContent">\n                  <h4 class="euiTitle euiTitle--small synopsisTitle">Data Visualizer</h4>\n                  <div class="euiText synopsisBody">\n                    <p>\n                      <span class="euiTextColor euiTextColor--subdued">\n                      Learn more about the characteristics of your data and identify the fields for analysis with machine learning.\n                      </span>\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </a>\n        </div>\n      </div>\n\n    </div>\n\n  </div>\n</ml-new-job>\n'},2360:function(module,exports,__webpack_require__){"use strict";__webpack_require__(53);var _data_recognizer=__webpack_require__(1008);var _modules=__webpack_require__(4);var _module=_modules.uiModules.get("apps/ml",["react"]);_module.directive("mlDataRecognizer",function(reactDirective){return reactDirective(_data_recognizer.DataRecognizer,undefined,{restrict:"AE"})})},2361:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.RecognizedResult=undefined;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var RecognizedResult=exports.RecognizedResult=function RecognizedResult(_ref){var config=_ref.config,indexPattern=_ref.indexPattern,savedSearch=_ref.savedSearch;var id=savedSearch===undefined||savedSearch.id===undefined?"index="+indexPattern.id:"savedSearchId="+savedSearch.id;var href="#/jobs/new_job/simple/recognize?id="+config.id+"&"+id;var logo=null;if(config.logo&&config.logo.src){logo=_react2.default.createElement("div",null,_react2.default.createElement("img",{className:"synopsisIcon",alt:"",src:config.logo.src}))}else{logo=_react2.default.createElement("h3",{className:"euiTitle euiTitle--small"},config.id)}return _react2.default.createElement("div",{className:"euiFlexItem"},_react2.default.createElement("a",{href:href,className:"euiLink synopsis"},_react2.default.createElement("div",{className:"euiPanel euiPanel--paddingMedium synopsisPanel"},_react2.default.createElement("div",{className:"euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive"},_react2.default.createElement("div",{className:"euiFlexItem euiFlexItem--flexGrowZero ml-data-recognizer-logo"},logo),_react2.default.createElement("div",{className:"euiFlexItem synopsisContent"},_react2.default.createElement("h4",{className:"euiTitle euiTitle--small synopsisTitle"},config.title),_react2.default.createElement("div",{className:"euiText synopsisBody"},_react2.default.createElement("p",null,_react2.default.createElement("span",{className:"euiTextColor euiTextColor--subdued"},config.description))))))))};RecognizedResult.propTypes={config:_propTypes2.default.object,indexPattern:_propTypes2.default.object,savedSearch:_propTypes2.default.object}},2362:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2363)},2363:function(module,exports,__webpack_require__){"use strict";__webpack_require__(53);var _modules=__webpack_require__(4);var _validate_job_view=__webpack_require__(2364);var _job_service=__webpack_require__(23);var _module=_modules.uiModules.get("apps/ml",["react"]);_module.directive("mlValidateJob",function(reactDirective){return reactDirective(_validate_job_view.ValidateJob,undefined,{restrict:"E"},{mlJobService:_job_service.mlJobService})})},2364:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ValidateJob=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _metadata=__webpack_require__(190);var _validation=__webpack_require__(400);var _validation_utils=__webpack_require__(470);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var jobTipsUrl="https://www.elastic.co/guide/en/kibana/"+_metadata.metadata.branch+"/job-tips.html";var defaultIconType="questionInCircle";var getDefaultState=function getDefaultState(){return{ui:{iconType:defaultIconType,isLoading:false,isModalVisible:false},data:{messages:[],success:false},title:""}};var statusToEuiColor=function statusToEuiColor(status){switch(status){case _validation.VALIDATION_STATUS.INFO:return"primary";break;case _validation.VALIDATION_STATUS.ERROR:return"danger";break;default:return status}};var statusToEuiIconType=function statusToEuiIconType(status){switch(status){case _validation.VALIDATION_STATUS.INFO:return"iInCircle";break;case _validation.VALIDATION_STATUS.ERROR:return"cross";break;case _validation.VALIDATION_STATUS.SUCCESS:return"check";break;case _validation.VALIDATION_STATUS.WARNING:return"alert";break;default:return status}};var Link=function Link(_ref){var url=_ref.url;return _react2.default.createElement(_eui.EuiLink,{href:url,target:"_BLANK"},"Learn more")};Link.propTypes={url:_propTypes2.default.string.isRequired};var Message=function Message(_ref2){var message=_ref2.message;return _react2.default.createElement(_react2.default.Fragment,null,message.text," ",message.url&&_react2.default.createElement(Link,{url:message.url}))};Message.propTypes={message:_propTypes2.default.shape({text:_propTypes2.default.string,url:_propTypes2.default.string})};var Callout=function Callout(_ref3){var message=_ref3.message;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiCallOut,{color:statusToEuiColor(message.status),size:"s",title:message.heading||_react2.default.createElement(Message,{message:message}),iconType:statusToEuiIconType(message.status)},message.heading&&_react2.default.createElement(Message,{message:message})),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}))};Callout.propTypes={message:_propTypes2.default.shape({status:_propTypes2.default.string,text:_propTypes2.default.string,url:_propTypes2.default.string})};var Modal=function Modal(_ref4){var close=_ref4.close,title=_ref4.title,children=_ref4.children;return _react2.default.createElement(_eui.EuiOverlayMask,null,_react2.default.createElement(_eui.EuiModal,{onClose:close,style:{width:"800px"}},_react2.default.createElement(_eui.EuiModalHeader,null,_react2.default.createElement(_eui.EuiModalHeaderTitle,null,title)),_react2.default.createElement(_eui.EuiModalBody,null,children),_react2.default.createElement(_eui.EuiModalFooter,null,_react2.default.createElement(_eui.EuiButton,{onClick:close,size:"s",fill:true},"Close"))))};Modal.propType={close:_propTypes2.default.func.isRequired,title:_propTypes2.default.string};var ValidateJob=function(_Component){_inherits(ValidateJob,_Component);function ValidateJob(props){_classCallCheck(this,ValidateJob);var _this=_possibleConstructorReturn(this,(ValidateJob.__proto__||Object.getPrototypeOf(ValidateJob)).call(this,props));_this.closeModal=function(){var newState=getDefaultState();newState.ui.iconType=_this.state.ui.iconType;_this.setState(newState)};_this.openModal=function(){var job=_this.props.getJobConfig();var getDuration=_this.props.getDuration;var duration=typeof getDuration==="function"?getDuration():undefined;var fields=_this.props.fields;if((typeof job==="undefined"?"undefined":_typeof(job))==="object"){var shouldShowLoadingIndicator=true;_this.props.mlJobService.validateJob({duration:duration,fields:fields,job:job}).then(function(data){shouldShowLoadingIndicator=false;_this.setState(_extends({},_this.state,{ui:_extends({},_this.state.ui,{iconType:statusToEuiIconType((0,_validation_utils.getMostSevereMessageStatus)(data.messages)),isLoading:false,isModalVisible:true}),data:data,title:job.job_id}))});var delay=250;setTimeout(function(){if(shouldShowLoadingIndicator){_this.setState(_extends({},_this.state,{ui:_extends({},_this.state.ui,{isLoading:true,isModalVisible:false})}))}},delay)}};_this.state=getDefaultState();return _this}_createClass(ValidateJob,[{key:"render",value:function render(){var fill=this.props.fill===false?false:true;var isCurrentJobConfig=this.props.isCurrentJobConfig!==true?false:true;var isDisabled=this.props.isDisabled!==true?false:true;return _react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiButton,{onClick:this.openModal,size:"s",fill:fill,iconType:isCurrentJobConfig?this.state.ui.iconType:defaultIconType,iconSide:"right",isDisabled:isDisabled,isLoading:this.state.ui.isLoading},"Validate Job"),!isDisabled&&this.state.ui.isModalVisible&&_react2.default.createElement(Modal,{close:this.closeModal,title:"Validate job "+this.state.title},this.state.data.messages.map(function(m,i){return _react2.default.createElement(Callout,{key:m.id+"_"+i,message:m})}),_react2.default.createElement(_eui.EuiText,null,"Job validation performs certain checks against job configurations and underlying source data and provides specific advice on how to adjust settings that are more likely to produce insightful results."),_react2.default.createElement(_eui.EuiText,null,"For more information, see ",_react2.default.createElement(_eui.EuiLink,{href:jobTipsUrl,target:"_blank"},"Machine Learning Job Tips"),".")))}}]);return ValidateJob}(_react.Component);ValidateJob.propTypes={fields:_propTypes2.default.object,fill:_propTypes2.default.bool,getDuration:_propTypes2.default.func,getJobConfig:_propTypes2.default.func.isRequired,isCurrentJobConfig:_propTypes2.default.bool,isDisabled:_propTypes2.default.bool,mlJobService:_propTypes2.default.object.isRequired};exports.ValidateJob=ValidateJob},2365:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2366)},2366:function(module,exports,__webpack_require__){"use strict";var _messagebar=__webpack_require__(2367);var _messagebar2=_interopRequireDefault(_messagebar);var _messagebar_service=__webpack_require__(178);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.controller("MlMessageBarController",function($scope){$scope.messages=_messagebar_service.mlMessageBarService.getMessages();$scope.removeMessage=_messagebar_service.mlMessageBarService.removeMessage}).directive("mlMessageBar",function(){return{restrict:"AE",template:_messagebar2.default}})},2367:function(module,exports){module.exports='<div ng-controller="MlMessageBarController">\n  <div\n    ng-repeat="msg in messages"\n    class=\'ml-message {{msg.style}}\'>\n      {{msg.text}} <a ng-click="removeMessage($index)">x</a>\n  </div>\n</div>'},2368:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2369);__webpack_require__(2372);__webpack_require__(1007);__webpack_require__(2377);__webpack_require__(339);__webpack_require__(473)},2369:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2370)},2370:function(module,exports,__webpack_require__){"use strict";__webpack_require__(53);var _modules=__webpack_require__(4);var _check_license=__webpack_require__(43);var _check_privilege=__webpack_require__(32);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _datavisualizer_selector=__webpack_require__(2371);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml",["react"]);var template='<ml-nav-menu name="datavisualizer" /><datavisualizer-selector class="ml-datavisualizer-selector"/>';_routes2.default.when("/datavisualizer",{template:template,resolve:{CheckLicense:_check_license.checkBasicLicense,privileges:_check_privilege.checkFindFileStructurePrivilege}});_module.directive("datavisualizerSelector",function($injector){var reactDirective=$injector.get("reactDirective");return reactDirective(_datavisualizer_selector.DatavisualizerSelector,undefined,{restrict:"E"},{})})},2371:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DatavisualizerSelector=DatavisualizerSelector;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _check_license=__webpack_require__(43);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function startTrialDescription(){return _react2.default.createElement("span",null,"To experience the full Machine Learning features that a "," ",_react2.default.createElement(_eui.EuiLink,{href:"https://www.elastic.co/subscriptions",target:"_blank"},"Platinum subscription")," ","offers, start a 30-day trial.")}function DatavisualizerSelector(){var startTrialVisible=(0,_check_license.isFullLicense)()===false;return _react2.default.createElement(_eui.EuiPage,{restrictWidth:1e3},_react2.default.createElement(_eui.EuiPageBody,null,_react2.default.createElement(_eui.EuiFlexGroup,{gutterSize:"xl"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiTitle,{size:"l"},_react2.default.createElement("h2",null,"Data Visualizer")))),_react2.default.createElement(_eui.EuiSpacer,{size:"xl"}),_react2.default.createElement(_eui.EuiFlexGroup,{gutterSize:"xl"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiText,{color:"subdued"},"The Machine Learning Data Visualizer tool helps you understand your data, by analyzing the metrics and fields in a log file or an existing Elasticsearch index."))),_react2.default.createElement(_eui.EuiSpacer,{size:"xl"}),_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceAround",gutterSize:"xl"},_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiCard,{icon:_react2.default.createElement(_eui.EuiIcon,{size:"xxl",type:"addDataApp"}),title:"Import data",description:"Import data from a log file. You can upload files up to 100 MB.",betaBadgeLabel:"Experimental",betaBadgeTooltipContent:"Experimental feature. We'd love to hear your feedback.",footer:_react2.default.createElement(_eui.EuiButton,{target:"_self",href:"#/filedatavisualizer"},"Upload file")})),_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiCard,{icon:_react2.default.createElement(_eui.EuiIcon,{size:"xxl",type:"dataVisualizer"}),title:"Select an index pattern",description:"Visualize the data in an existing Elasticsearch index.",footer:_react2.default.createElement(_eui.EuiButton,{target:"_self",href:"#datavisualizer_index_select"},"Select index")}))),startTrialVisible===true&&_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"xxl"}),_react2.default.createElement(_eui.EuiSpacer,{size:"xxl"}),_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceAround",gutterSize:"xl"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false,style:{width:"600px"}},_react2.default.createElement(_eui.EuiCard,{title:"Start trial",description:startTrialDescription(),footer:_react2.default.createElement(_eui.EuiButton,{target:"_blank",href:"kibana#/management/elasticsearch/license_management/home"},"Start trial")}))))))}},2372:function(module,exports,__webpack_require__){"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _risonNode=__webpack_require__(206);var _risonNode2=_interopRequireDefault(_risonNode);__webpack_require__(2373);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _esQuery=__webpack_require__(40);var _notify=__webpack_require__(10);var _field_types=__webpack_require__(257);var _field_types_utils=__webpack_require__(993);var _ml_time_buckets=__webpack_require__(258);var _check_license=__webpack_require__(43);var _check_privilege=__webpack_require__(32);var _new_job_utils=__webpack_require__(220);var _index_utils=__webpack_require__(62);var _check_ml_nodes=__webpack_require__(47);var _ml_api_service=__webpack_require__(22);var _datavisualizer=__webpack_require__(2376);var _datavisualizer2=_interopRequireDefault(_datavisualizer);var _timefilter=__webpack_require__(16);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_routes2.default.when("/jobs/new_job/datavisualizer",{template:_datavisualizer2.default,resolve:{CheckLicense:_check_license.checkBasicLicense,privileges:_check_privilege.checkGetJobsPrivilege,indexPattern:_index_utils.loadCurrentIndexPattern,savedSearch:_index_utils.loadCurrentSavedSearch,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable}});var _module=_modules.uiModules.get("apps/ml");_module.controller("MlDataVisualizerViewFields",function($scope,$timeout,$window,Private,AppState,config){_timefilter.timefilter.enableTimeRangeSelector();_timefilter.timefilter.enableAutoRefreshSelector();var createSearchItems=Private(_new_job_utils.SearchItemsProvider);var _createSearchItems=createSearchItems(),indexPattern=_createSearchItems.indexPattern,query=_createSearchItems.query;(0,_index_utils.timeBasedIndexCheck)(indexPattern,true);var OMIT_FIELDS=["_source","_type","_index","_id","_version","_score"];$scope.metricCards=[];$scope.totalMetricFieldCount=0;$scope.populatedMetricFieldCount=0;$scope.showAllMetrics=false;$scope.fieldCards=[];$scope.totalNonMetricFieldCount=0;$scope.populatedNonMetricFieldCount=0;$scope.ML_JOB_FIELD_TYPES=_field_types.ML_JOB_FIELD_TYPES;$scope.showAllFields=false;$scope.filterFieldType="*";$scope.urlBasePath=_chrome2.default.getBasePath();$scope.appState=new AppState;$scope.indexPattern=indexPattern;$scope.earliest=_timefilter.timefilter.getActiveBounds().min.valueOf();$scope.latest=_timefilter.timefilter.getActiveBounds().max.valueOf();$scope.metricFilterIcon=0;$scope.metricFieldFilter="";$scope.fieldFilterIcon=0;$scope.fieldFilter="";$scope.recognizerResults={count:0,onChange:function onChange(){$scope.$applyAsync()}};$scope.showSidebar=(0,_check_license.isFullLicense)();$scope.searchQueryText="";var queryBarQry=$scope.appState.query!==undefined?$scope.appState.query:query;if(queryBarQry.language==="lucene"){$scope.searchQueryText=_lodash2.default.get(queryBarQry,"query","")}else{_notify.toastNotifications.addWarning({title:(queryBarQry.language!==undefined?queryBarQry.language:"")+" syntax not supported",text:"The Data Visualizer currently only supports queries using the lucene query syntax."})}$scope.searchQuery=buildSearchQuery();$scope.samplerShardSize=$scope.appState.samplerShardSize?$scope.appState.samplerShardSize:5e3;var MlTimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider);var metricFieldRegexp=void 0;var metricFieldFilterTimeout=void 0;var fieldRegexp=void 0;var fieldFilterTimeout=void 0;var indexedFieldTypes=[];_lodash2.default.each(indexPattern.fields,function(field){if(!field.scripted){var dataVisualizerType=(0,_field_types_utils.kbnTypeToMLJobType)(field);if(dataVisualizerType!==undefined){indexedFieldTypes.push(dataVisualizerType)}}});indexedFieldTypes=_lodash2.default.chain(indexedFieldTypes).unique().without(_field_types.ML_JOB_FIELD_TYPES.NUMBER).value();$scope.indexedFieldTypes=indexedFieldTypes.sort();$scope.$listenAndDigestAsync(_timefilter.timefilter,"fetch",function(){$scope.earliest=_timefilter.timefilter.getActiveBounds().min.valueOf();$scope.latest=_timefilter.timefilter.getActiveBounds().max.valueOf();loadOverallStats()});$scope.submitSearchQuery=function(){$scope.searchQuery=buildSearchQuery();saveAppState();loadOverallStats()};$scope.samplerShardSizeChanged=function(){saveAppState();loadOverallStats()};$scope.toggleAllMetrics=function(){$scope.showAllMetrics=!$scope.showAllMetrics;createMetricCards()};$scope.toggleAllFields=function(){$scope.showAllFields=!$scope.showAllFields;createNonMetricCards()};$scope.filterFieldTypeChanged=function(fieldType){$scope.filterFieldType=fieldType;createNonMetricCards()};$scope.metricFieldFilterChanged=function(){if(metricFieldFilterTimeout!==undefined){$timeout.cancel(metricFieldFilterTimeout)}metricFieldFilterTimeout=$timeout(function(){if($scope.metricFieldFilter&&$scope.metricFieldFilter!==""){metricFieldRegexp=new RegExp("("+$scope.metricFieldFilter+")","gi")}else{metricFieldRegexp=undefined}createMetricCards();metricFieldFilterTimeout=undefined},1500);$timeout(function(){$scope.metricFilterIcon=1},250)};$scope.clearMetricFilter=function(){$scope.metricFieldFilter="";metricFieldRegexp=undefined;createMetricCards()};$scope.fieldFilterChanged=function(){if(fieldFilterTimeout!==undefined){$timeout.cancel(fieldFilterTimeout)}fieldFilterTimeout=$timeout(function(){if($scope.fieldFilter&&$scope.fieldFilter!==""){fieldRegexp=new RegExp("("+$scope.fieldFilter+")","gi")}else{fieldRegexp=undefined}createNonMetricCards();fieldFilterTimeout=undefined},1500);$timeout(function(){$scope.fieldFilterIcon=1},250)};$scope.clearFieldFilter=function(){$scope.fieldFilter="";fieldRegexp=undefined;createNonMetricCards()};$scope.createJob=function(){var _a=_risonNode2.default.encode({query:{language:"lucene",query:$scope.searchQueryText}});var path=$scope.urlBasePath+"/app/ml#/jobs/new_job/advanced?index="+$scope.indexPattern+"&_a="+_a;$window.open(path,"_self")};function buildSearchQuery(){var searchQuery=(0,_esQuery.luceneStringToDsl)($scope.searchQueryText);(0,_esQuery.decorateQuery)(searchQuery,config);return searchQuery}function saveAppState(){$scope.appState.query={language:"lucene",query:$scope.searchQueryText};$scope.appState.samplerShardSize=$scope.samplerShardSize;$scope.appState.save()}function createMetricCards(){$scope.metricCards.length=0;var aggregatableExistsFields=$scope.overallStats.aggregatableExistsFields||[];var allMetricFields=[];if(metricFieldRegexp===undefined){allMetricFields=_lodash2.default.filter(indexPattern.fields,function(f){return f.type===_field_types.KBN_FIELD_TYPES.NUMBER&&!_lodash2.default.contains(OMIT_FIELDS,f.displayName)})}else{allMetricFields=_lodash2.default.filter(indexPattern.fields,function(f){return f.type===_field_types.KBN_FIELD_TYPES.NUMBER&&!_lodash2.default.contains(OMIT_FIELDS,f.displayName)&&f.displayName.match(metricFieldRegexp)})}var metricExistsFields=_lodash2.default.filter(allMetricFields,function(f){return _lodash2.default.find(aggregatableExistsFields,{fieldName:f.displayName})});var metricCards=[];metricCards.push({type:_field_types.ML_JOB_FIELD_TYPES.NUMBER,existsInDocs:true,loading:true});$scope.totalMetricFieldCount=allMetricFields.length+1;$scope.populatedMetricFieldCount=metricExistsFields.length+1;if($scope.totalMetricFieldCount===$scope.populatedMetricFieldCount){$scope.showAllMetrics=true}var aggregatableFields=$scope.overallStats.aggregatableExistsFields;if($scope.showAllMetrics===true){aggregatableFields=aggregatableFields.concat($scope.overallStats.aggregatableNotExistsFields)}var metricFields=$scope.showAllMetrics?allMetricFields:metricExistsFields;_lodash2.default.each(metricFields,function(field){var fieldData=_lodash2.default.find(aggregatableFields,{fieldName:field.displayName});var card=_extends({},fieldData,{fieldFormat:field.format,type:_field_types.ML_JOB_FIELD_TYPES.NUMBER,loading:true});metricCards.push(card)});$scope.metricCards=metricCards;loadMetricFieldStats()}function createNonMetricCards(){$scope.fieldCards.length=0;var allNonMetricFields=[];if($scope.filterFieldType==="*"){allNonMetricFields=_lodash2.default.filter(indexPattern.fields,function(f){return f.type!==_field_types.KBN_FIELD_TYPES.NUMBER&&!_lodash2.default.contains(OMIT_FIELDS,f.displayName)})}else{if($scope.filterFieldType===_field_types.ML_JOB_FIELD_TYPES.TEXT||$scope.filterFieldType===_field_types.ML_JOB_FIELD_TYPES.KEYWORD){var aggregatableCheck=$scope.filterFieldType===_field_types.ML_JOB_FIELD_TYPES.KEYWORD?true:false;allNonMetricFields=_lodash2.default.filter(indexPattern.fields,function(f){return!_lodash2.default.contains(OMIT_FIELDS,f.displayName)&&f.type===_field_types.KBN_FIELD_TYPES.STRING&&f.aggregatable===aggregatableCheck})}else{allNonMetricFields=_lodash2.default.filter(indexPattern.fields,function(f){return!_lodash2.default.contains(OMIT_FIELDS,f.displayName)&&f.type===$scope.filterFieldType})}}if(fieldRegexp!==undefined){allNonMetricFields=_lodash2.default.filter(allNonMetricFields,function(f){return f.displayName.match(fieldRegexp)})}$scope.totalNonMetricFieldCount=allNonMetricFields.length;var populatedNonMetricFields=[];var nonMetricFieldData=[];var populatedNonMetricFieldCount=0;_lodash2.default.each(allNonMetricFields,function(f){var checkAggregatableField=_lodash2.default.find($scope.overallStats.aggregatableExistsFields,{fieldName:f.displayName});if(checkAggregatableField!==undefined){populatedNonMetricFields.push(f);nonMetricFieldData.push(checkAggregatableField);populatedNonMetricFieldCount++}else{var checkNonAggregatableField=_lodash2.default.find($scope.overallStats.nonAggregatableExistsFields,{fieldName:f.displayName});if(checkNonAggregatableField!==undefined){populatedNonMetricFields.push(f);nonMetricFieldData.push(checkNonAggregatableField);populatedNonMetricFieldCount++}}});$scope.populatedNonMetricFieldCount=populatedNonMetricFieldCount;if($scope.totalNonMetricFieldCount===$scope.populatedNonMetricFieldCount){$scope.showAllFields=true}var nonMetricFieldsToShow=$scope.showAllFields===true?allNonMetricFields:populatedNonMetricFields;if($scope.showAllFields===true){nonMetricFieldData=nonMetricFieldData.concat($scope.overallStats.aggregatableNotExistsFields,$scope.overallStats.nonAggregatableNotExistsFields)}var fieldCards=[];_lodash2.default.each(nonMetricFieldsToShow,function(field){var fieldData=_lodash2.default.find(nonMetricFieldData,{fieldName:field.displayName});var card=_extends({},fieldData,{fieldFormat:field.format,aggregatable:field.aggregatable,scripted:field.scripted,loading:fieldData.existsInDocs});var dataVisualizerType=(0,_field_types_utils.kbnTypeToMLJobType)(field);if(dataVisualizerType!==undefined){card.type=dataVisualizerType}else{card.type=field.type;card.isUnsupportedType=true}fieldCards.push(card)});$scope.fieldCards=_lodash2.default.sortBy(fieldCards,"fieldName");loadNonMetricFieldStats()}function loadMetricFieldStats(){var numberFields=_lodash2.default.filter($scope.metricCards,{existsInDocs:true});numberFields=_lodash2.default.map(numberFields,function(card){var props={fieldName:card.fieldName,type:card.type};if(_lodash2.default.has(card,["stats","cardinality"])){props.cardinality=card.stats.cardinality}return props});var buckets=new MlTimeBuckets;var bounds=_timefilter.timefilter.getActiveBounds();var BAR_TARGET=75;buckets.setInterval("auto");buckets.setBounds(bounds);buckets.setBarTarget(BAR_TARGET);var aggInterval=buckets.getInterval();_ml_api_service.ml.getVisualizerFieldStats({indexPatternTitle:indexPattern.title,query:$scope.searchQuery,timeFieldName:indexPattern.timeFieldName,earliest:$scope.earliest,latest:$scope.latest,samplerShardSize:$scope.samplerShardSize,interval:aggInterval.expression,fields:numberFields}).then(function(resp){_lodash2.default.each($scope.metricCards,function(card){if(card.fieldName!==undefined){card.stats=_extends({},card.stats,_lodash2.default.find(resp,{fieldName:card.fieldName}))}else{card.stats=_lodash2.default.find(resp,function(stats){return stats.fieldName===undefined})}card.loading=false});$scope.metricFilterIcon=0}).catch(function(err){console.log("DataVisualizer - error getting stats for metric cards from elasticsearch:",err);if(err.statusCode===500){_notify.notify.error("Error loading data for metrics in index "+indexPattern.title+". "+err.message+". "+"The request may have timed out. Try using a smaller sample size or narrowing the time range.",{lifetime:3e4})}else{_notify.notify.error("Error loading data for metrics in index "+indexPattern.title+". "+err.message,{lifetime:3e4})}}).then(function(){$scope.$applyAsync()})}function loadNonMetricFieldStats(){var fields=_lodash2.default.filter($scope.fieldCards,{existsInDocs:true});fields=_lodash2.default.map(fields,function(card){var props={fieldName:card.fieldName,type:card.type};if(_lodash2.default.has(card,["stats","cardinality"])){props.cardinality=card.stats.cardinality}return props});if(fields.length>0){_ml_api_service.ml.getVisualizerFieldStats({indexPatternTitle:indexPattern.title,query:$scope.searchQuery,fields:fields,timeFieldName:indexPattern.timeFieldName,earliest:$scope.earliest,latest:$scope.latest,samplerShardSize:$scope.samplerShardSize,maxExamples:10}).then(function(resp){_lodash2.default.each($scope.fieldCards,function(card){card.stats=_extends({},card.stats,_lodash2.default.find(resp,{fieldName:card.fieldName}));card.loading=false});$scope.fieldFilterIcon=0}).catch(function(err){console.log("DataVisualizer - error getting non metric field stats from elasticsearch:",err);if(err.statusCode===500){_notify.notify.error("Error loading data for fields in index "+indexPattern.title+". "+err.message+". "+"The request may have timed out. Try using a smaller sample size or narrowing the time range.",{lifetime:3e4})}else{_notify.notify.error("Error loading data for fields in index "+indexPattern.title+". "+err.message,{lifetime:3e4})}}).then(function(){$scope.$applyAsync()})}else{$scope.fieldFilterIcon=0}}function loadOverallStats(){var aggregatableFields=[];var nonAggregatableFields=[];_lodash2.default.each(indexPattern.fields,function(field){if(OMIT_FIELDS.indexOf(field.displayName)===-1){if(field.aggregatable===true){aggregatableFields.push(field.displayName)}else{nonAggregatableFields.push(field.displayName)}}});_ml_api_service.ml.getVisualizerOverallStats({indexPatternTitle:indexPattern.title,query:$scope.searchQuery,timeFieldName:indexPattern.timeFieldName,samplerShardSize:$scope.samplerShardSize,earliest:$scope.earliest,latest:$scope.latest,aggregatableFields:aggregatableFields,nonAggregatableFields:nonAggregatableFields}).then(function(resp){$scope.overallStats=resp;createMetricCards();createNonMetricCards()}).catch(function(err){console.log("DataVisualizer - error getting overall stats from elasticsearch:",err);if(err.statusCode===500){_notify.notify.error("Error loading data for fields in index "+indexPattern.title+". "+err.message+". "+"The request may have timed out. Try using a smaller sample size or narrowing the time range.",{lifetime:3e4})}else{_notify.notify.error("Error loading data for fields in index "+indexPattern.title+". "+err.message,{lifetime:3e4})}$scope.$applyAsync()})}loadOverallStats()})},2373:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2374)},2374:function(module,exports,__webpack_require__){"use strict";var _form_filter_input=__webpack_require__(2375);var _form_filter_input2=_interopRequireDefault(_form_filter_input);var _angular=__webpack_require__(21);var _angular2=_interopRequireDefault(_angular);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlFormFilterInput",function(){return{scope:{placeholder:"@?",filter:"=",filterIcon:"=",filterChanged:"=",clearFilter:"="},restrict:"E",replace:false,template:_form_filter_input2.default,link:function link(scope){scope.placeholder=_angular2.default.isDefined(scope.placeholder)?scope.placeholder:"Filter"}}})},2375:function(module,exports){module.exports='<div class="fa fa-search"></div>\n<input\n  class="form-control ml-filter-input-left-icon"\n  type="text"\n  aria-label="{{placeholder}}"\n  placeholder="{{placeholder}}"\n  ng-model="filter"\n  ng-change="filterChanged()" />\n<div class="ml-filter-progress-icon">\n  <div ng-show="filterIcon===1">\n    <i class=\'fa fa-spinner fa-spin\'></i>\n  </div>\n  <div ng-show="filterIcon===0">\n    <a aria-label="Clear filter" ng-click="clearFilter()">\n      <i class="fa fa-times-circle"></i>\n    </a>\n  </div>\n</div>\n'},2376:function(module,exports){module.exports='<ml-nav-menu name="datavisualizer"></ml-nav-menu>\n<ml-chart-tooltip></ml-chart-tooltip>\n<ml-datavisualizer class="data-visualizer-container">\n  <div ng-controller="MlDataVisualizerViewFields" >\n    <div class="title-container euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--justifyContentSpaceBetween euiFlexGroup--alignItemsCenter euiFlexGroup--responsive">\n      <div class="euiFlexItem euiFlexItem--flexGrowZero euiText">\n        <h1>{{indexPattern.title}}</h1>\n      </div>\n      <div class="euiFlexItem euiFlexItem--flexGrowZero">\n          <ml-full-time-range-selector index-pattern=\'indexPattern\' query=\'searchQuery\' />\n      </div>\n    </div>\n\n    <div\n      class="main-container"\n      ng-class="{\'no-sidebar\': showSidebar===false}"\n    >\n\n      <div class="kuiPanel kuiVerticalRhythm datavisualizer-panel">\n\n        <form\n          ng-submit="submitSearchQuery()"\n          name="querybarform"\n          class="flexGroup__filler query-bar-form"\n          style="width: 100%"\n        >\n          <div class="kuiLocalSearch">\n            <input\n              type="text"\n              class="kuiLocalSearchInput"\n              ng-model="searchQueryText"\n              placeholder="Search... (e.g. status:200 AND extension:PHP)"\n              aria-label="Search input"\n              autocomplete="off"\n            >\n            <button\n              class="kuiLocalSearchButton"\n              type="submit"\n              aria-label="Search"\n            >\n              <span aria-hidden="true" class="kuiIcon fa-search"></span>\n            </button>\n          </div>\n        </form>\n\n        <div class="document-count-container">\n          <label for="sampleShardSize">Sample</label>\n          <select id="sampleShardSize" class="kuiSelect type-input" ng-model="samplerShardSize" ng-change="samplerShardSizeChanged(samplerShardSize)">\n            <option ng-value="1000">1000</option>\n            <option ng-value="5000">5000</option>\n            <option ng-value="10000">10000</option>\n            <option ng-value="100000">100000</option>\n            <option ng-value="-1">all</option>\n          </select>\n          <span>documents per shard from a total of</span>\n          <span class="field-emphasis">{{ overallStats.totalCount }}</span>\n          <ng-pluralize count="overallStats.totalCount" when="{\'1\':\'document\', \'other\':\'documents\'}">documents</ng-pluralize>\n          <i aria-hidden="true" class="fa fa-info-circle" tooltip-placement="right"\n            tooltip="Selecting a smaller sample size will reduce query run times and the load on the cluster."></i>\n        </div>\n\n      </div>\n\n      <div class="kuiPanel kuiVerticalRhythm datavisualizer-panel card-panel">\n      \t<div class="euiText">\n          <h2 class="kuiSubTitle kuiVerticalRhythm">Metrics</h2>\n        </div>\n\n        <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--justifyContentSpaceBetween euiFlexGroup--responsive euiFlexGroup--wrap">\n          <div class="field-sort-controls euiFlexItem euiFlexItem--flexGrowZero">\n            <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive">\n              <div ng-if="showAllMetrics === false" class="field-count-label euiFlexItem euiFlexItem--flexGrowZero">\n                <span class="field-emphasis">{{ metricCards.length }}</span>\n                <ng-pluralize count="metricCards.length" when="{\'1\':\'field exists\', \'other\':\'fields exist\'}">fields exist</ng-pluralize> in documents (\n                <span class="field-emphasis">{{ totalMetricFieldCount }}</span> in total)\n              </div>\n\n              <div ng-if="showAllMetrics === true" class="field-count-label euiFlexItem euiFlexItem--flexGrowZero">\n                <span class="field-emphasis">{{ metricCards.length }}</span>\n                <ng-pluralize count="metricCards.length" when="{\'1\':\'field\', \'other\':\'fields\'}">fields</ng-pluralize>\n                (\n                <span class="field-emphasis">{{ populatedMetricFieldCount }}</span>\n                <ng-pluralize count="populatedMetricFieldCount" when="{\'1\':\'exists\', \'other\':\'exist\'}">exist</ng-pluralize> in documents)\n              </div>\n\n              <div ng-hide="populatedMetricFieldCount === totalMetricFieldCount" class="field-group-input euiFlexItem euiFlexItem--flexGrowZero">\n                <input id="toggleAllMetricsCheckbox" type="checkbox" class="kuiCheckBox" ng-click="toggleAllMetrics()" ng-checked="showAllMetrics === true">\n                <label for="toggleAllMetricsCheckbox">show empty fields</label>\n              </div>\n            </div>\n          </div>\n          <div class="field-filter-controls euiFlexItem euiFlexItem--flexGrowZero">\n            <ml-form-filter-input\n              filter="metricFieldFilter"\n              filter-icon="metricFilterIcon"\n              filter-changed="metricFieldFilterChanged"\n              clear-filter="clearMetricFilter" />\n          </div>\n        </div>\n\n        <div class="card-container" ng-repeat="card in metricCards">\n          <ml-field-data-card\n            index-pattern="indexPattern"\n            query="searchQuery"\n            earliest="earliest"\n            latest="latest"\n            card="card">\n          </ml-field-data-card>\n        </div>\n\n      </div>\n\n      <div class="kuiPanel kuiVerticalRhythm datavisualizer-panel card-panel">\n        <div class="euiText">\n          <h2 class="kuiSubTitle kuiVerticalRhythm">Fields</h2>\n        </div>\n\n        <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--justifyContentSpaceBetween euiFlexGroup--responsive euiFlexGroup--wrap">\n          <div class="field-sort-controls euiFlexItem euiFlexItem--flexGrowZero">\n            <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive">\n              <div ng-if="showAllFields === false" class="field-count-label euiFlexItem euiFlexItem--flexGrowZero">\n                <span class="field-emphasis">{{ fieldCards.length }}</span>\n                <ng-pluralize count="fieldCards.length" when="{\'1\':\'field exists\', \'other\':\'fields exist\'}">fields exist</ng-pluralize> in documents\n                (<span class="field-emphasis">{{ totalNonMetricFieldCount }}</span> in total)\n              </div>\n\n              <div ng-if="showAllFields === true" class="field-count-label euiFlexItem euiFlexItem--flexGrowZero">\n                <span class="field-emphasis">{{ fieldCards.length }}</span>\n                <ng-pluralize count="fieldCards.length" when="{\'1\':\'field\', \'other\':\'fields\'}">fields</ng-pluralize>\n                (<span class="field-emphasis">{{ populatedNonMetricFieldCount }}</span>\n                <ng-pluralize count="populatedNonMetricFieldCount" when="{\'1\':\'exists\', \'other\':\'exist\'}">exist</ng-pluralize> in documents)\n              </div>\n\n              <div ng-hide="populatedNonMetricFieldCount === totalNonMetricFieldCount" class="field-group-input euiFlexItem euiFlexItem--flexGrowZero">\n                <input id="toggleAllFieldsCheckbox" type="checkbox" class="kuiCheckBox" ng-click="toggleAllFields()" ng-checked="showAllFields === true">\n                <label for="toggleAllFieldsCheckbox">show empty fields</label>\n              </div>\n            </div>\n          </div>\n          <div class="field-filter-controls euiFlexItem euiFlexItem--flexGrowZero">\n            <div class="euiFlexGroup euiFlexGroup--gutterSmall euiFlexGroup--responsive">\n              <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                <select class="kuiSelect type-input"\n                  ng-model="filterFieldType"\n                  ng-change="filterFieldTypeChanged(filterFieldType)"\n                  aria-label="Select field types">\n                  <option value="*">All field types</option>\n                  <option ng-repeat="type in indexedFieldTypes" value="{{type}}">{{type}} types</option>\n                </select>\n              </div>\n              <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                <ml-form-filter-input\n                  filter="fieldFilter"\n                  filter-icon="fieldFilterIcon"\n                  filter-changed="fieldFilterChanged"\n                  clear-filter="clearFieldFilter" />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class="card-container" ng-repeat="card in fieldCards">\n          <ml-field-data-card\n            index-pattern="indexPattern"\n            query="searchQuery"\n            earliest="earliest"\n            latest="latest"\n            card="card">\n          </ml-field-data-card>\n        </div>\n\n      </div>\n\n    </div>\n\n    <div ng-if="showSidebar" class="datavisualizer-sidebar">\n      <ng-include src="urlBasePath+\'/plugins/ml/datavisualizer/datavisualizer_sidebar.html\'"></ng-include>\n    </div>\n\n  </div>\n</ml-datavisualizer>\n'},2377:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2378);__webpack_require__(2379);__webpack_require__(2381);__webpack_require__(2382);__webpack_require__(2384);__webpack_require__(274);__webpack_require__(474)},2378:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _d=__webpack_require__(20);var _d2=_interopRequireDefault(_d);var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _parse_interval=__webpack_require__(196);var _chart_utils=__webpack_require__(197);var _string_utils=__webpack_require__(38);var _ml_time_buckets=__webpack_require__(258);var _chart_tooltip_service=__webpack_require__(242);var _date_utils=__webpack_require__(221);var _modules=__webpack_require__(4);var _timefilter=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlDocumentCountChart",function(Private){function link(scope,element,attrs){var svgWidth=attrs.width?+attrs.width:400;var svgHeight=scope.height=attrs.height?+attrs.height:400;var margin={top:0,right:5,bottom:20,left:15};var chartWidth=svgWidth-(margin.left+margin.right);var chartHeight=svgHeight-(margin.top+margin.bottom);var xScale=null;var yScale=_d2.default.scale.linear().range([chartHeight,0]);var xAxisTickFormat="YYYY-MM-DD HH:mm";var barChartGroup=void 0;var barWidth=5;var MlTimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider);scope.chartData=[];element.on("$destroy",function(){scope.$destroy()});function processChartData(){var bucketsData=_lodash2.default.get(scope,["card","stats","documentCounts","buckets"],{});var chartData=[];_lodash2.default.each(bucketsData,function(value,time){chartData.push({date:new Date(+time),time:+time,value:value})});scope.chartData=chartData}function render(){var chartElement=_d2.default.select(element.get(0)).select(".content-wrapper");chartElement.selectAll("*").remove();if(scope.chartData===undefined){return}var svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight);var maxYVal=_d2.default.max(scope.chartData,function(d){return d.value});yScale=yScale.domain([0,maxYVal]);var yAxis=_d2.default.svg.axis().scale(yScale).orient("left").outerTickSize(0);var maxYAxisLabelWidth=(0,_string_utils.calculateTextWidth)(maxYVal,true,svg);margin.left=Math.max(maxYAxisLabelWidth+yAxis.tickPadding()+5,25);chartWidth=Math.max(svgWidth-margin.left-margin.right,0);var bounds=_timefilter.timefilter.getActiveBounds();xScale=_d2.default.time.scale().domain([new Date(bounds.min.valueOf()),new Date(bounds.max.valueOf())]).range([0,chartWidth]);if(scope.chartData.length>0){var buckets=new MlTimeBuckets;var aggInterval=_lodash2.default.get(scope,["card","stats","documentCounts","interval"]);buckets.setInterval(aggInterval);buckets.setBounds(bounds);xAxisTickFormat=buckets.getScaledDateFormat();var intervalMs=(0,_parse_interval.parseInterval)(aggInterval).asMilliseconds();barWidth=xScale(scope.chartData[0].time+intervalMs)-xScale(scope.chartData[0].time)}var xAxis=_d2.default.svg.axis().scale(xScale).orient("bottom").outerTickSize(0).ticks((0,_chart_utils.numTicksForDateFormat)(chartWidth,xAxisTickFormat)).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)});barChartGroup=svg.append("g").attr("class","bar-chart").attr("transform","translate("+margin.left+", "+margin.top+")");drawBarChartAxes(xAxis,yAxis);drawBarChartPaths()}function drawBarChartAxes(xAxis,yAxis){var axes=barChartGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0, "+chartHeight+")").call(xAxis);axes.append("g").attr("class","y axis").call(yAxis)}function drawBarChartPaths(){barChartGroup.selectAll("bar").data(scope.chartData).enter().append("rect").attr("class","bar").attr("x",function(d){return xScale(d.time)}).attr("width",barWidth).attr("y",function(d){return yScale(d.value)}).attr("height",function(d){return chartHeight-yScale(d.value)}).on("mouseover",function(d){showChartTooltip(d,this)}).on("mousemove",function(d){showChartTooltip(d,this)}).on("mouseout",function(){return _chart_tooltip_service.mlChartTooltipService.hide()});function showChartTooltip(data,rect){var formattedDate=(0,_date_utils.formatHumanReadableDateTime)(data.time);var contents=formattedDate+"<br/><hr/>count: "+data.value;var rectY=_d2.default.select(rect).attr("y");var mouseY=+_d2.default.mouse(rect)[1];_chart_tooltip_service.mlChartTooltipService.show(contents,rect,{x:5,y:mouseY-rectY})}}processChartData();render()}return{scope:false,link:link}})},2379:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _jquery=__webpack_require__(17);var _jquery2=_interopRequireDefault(_jquery);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);__webpack_require__(334);var _field_data_card=__webpack_require__(2380);var _field_data_card2=_interopRequireDefault(_field_data_card);var _field_types=__webpack_require__(257);var _string_utils=__webpack_require__(38);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlFieldDataCard",function(){function link(scope,element){scope.ML_JOB_FIELD_TYPES=_field_types.ML_JOB_FIELD_TYPES;scope.mlEscape=_string_utils.mlEscape;if(scope.card.type===_field_types.ML_JOB_FIELD_TYPES.NUMBER){if(scope.card.fieldName){scope.$watch("card.stats",function(){var cardinality=_lodash2.default.get(scope,["card","stats","cardinality"],0);scope.detailsMode=cardinality>100?"distribution":"top"});var cardinality=_lodash2.default.get(scope,["card","stats","cardinality"],0);scope.detailsMode=cardinality>100?"distribution":"top"}(0,_jquery2.default)(".ml-field-data-card-tooltip").remove();(0,_jquery2.default)("body").append('<div class="ml-field-data-card-tooltip" style="opacity:0; display: none;">')}if(scope.card.type===_field_types.ML_JOB_FIELD_TYPES.DATE){scope.$watch("card.stats",function(){if(_lodash2.default.has(scope,"card.stats.earliest")){scope.card.stats.earliest=new Date(scope.card.stats.earliest)}if(_lodash2.default.has(scope,"card.stats.latest")){scope.card.stats.latest=new Date(scope.card.stats.latest)}},true)}scope.getCardUrl=function(){var urlBasePath=_chrome2.default.getBasePath();var baseCardPath=urlBasePath+"/plugins/ml/components/field_data_card/content_types";var cardType=scope.card.type;switch(cardType){case _field_types.ML_JOB_FIELD_TYPES.BOOLEAN:return baseCardPath+"/card_boolean.html";case _field_types.ML_JOB_FIELD_TYPES.DATE:return baseCardPath+"/card_date.html";case _field_types.ML_JOB_FIELD_TYPES.GEO_POINT:return baseCardPath+"/card_geo_point.html";case _field_types.ML_JOB_FIELD_TYPES.IP:return baseCardPath+"/card_ip.html";case _field_types.ML_JOB_FIELD_TYPES.KEYWORD:return baseCardPath+"/card_keyword.html";case _field_types.ML_JOB_FIELD_TYPES.NUMBER:if(scope.card.fieldName){return baseCardPath+"/card_number.html"}else{return baseCardPath+"/card_document_count.html"}case _field_types.ML_JOB_FIELD_TYPES.TEXT:return baseCardPath+"/card_text.html";default:return baseCardPath+"/card_other.html"}};element.on("$destroy",function(){scope.$destroy()})}return{scope:{card:"=",indexPattern:"=",query:"=",earliest:"=",latest:"="},template:_field_data_card2.default,link:link}}).filter("formatField",function(){return function(value,fieldFormat){return fieldFormat.convert(value,"text")}})},2380:function(module,exports){module.exports='<div class="ml-field-data-card">\n  <ml-field-title-bar card="card" />\n\n  <div ng-if="card.loading === true" class="card-contents">\n    <ml-loading-indicator\n      label="Loading"\n      is-loading="card.loading"\n      height="200"\n    />\n  </div>\n\n  <div ng-if="card.existsInDocs === false" class="card-contents">\n    <div class="not-exist-message">\n      <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>\n      This field does not appear in any documents for the selected time range\n    </div>\n  </div>\n\n  <ng-include ng-if="card.loading === false" src="getCardUrl()"></ng-include>\n</div>\n'},2381:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _d=__webpack_require__(20);var _d2=_interopRequireDefault(_d);var _chart_utils=__webpack_require__(197);var _ordinal_suffix=__webpack_require__(902);var _chart_tooltip_service=__webpack_require__(242);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlMetricDistributionChart",function(){function link(scope,element,attrs){var svgWidth=attrs.width?+attrs.width:400;var svgHeight=scope.height=attrs.height?+attrs.height:400;var margin={top:0,right:15,bottom:20,left:15};var infoLabelHeight=15;var chartWidth=svgWidth-(margin.left+margin.right);var chartHeight=svgHeight-(margin.top+margin.bottom+infoLabelHeight);var xScale=_d2.default.scale.linear().range([0,chartWidth]);var yScale=_d2.default.scale.linear().range([chartHeight,0]);var xAxisMin=0;var xAxisMax=1;var chartGroup=void 0;var distributionArea=_d2.default.svg.area().x(function(d){return xScale(d.x)}).y0(function(){return yScale(0)}).y1(function(d){return yScale(d.y)});var MIN_BAR_WIDTH=3;element.on("$destroy",function(){scope.$destroy()});function processDistributionData(){var distributionData=_lodash2.default.get(scope,["card","stats","distribution","percentiles"],[]);var chartData=[];if(distributionData.length===0){return chartData}var minX=distributionData[0].minValue;var maxX=distributionData[distributionData.length-1].maxValue;xAxisMin=minX;xAxisMax=maxX;if(maxX===minX){if(minX!==0){xAxisMin=0;xAxisMax=2*minX}else{xAxisMax=1}}var minBarWidth=MIN_BAR_WIDTH/chartWidth*(xAxisMax-xAxisMin);var processedData=[];var lastBar=undefined;_lodash2.default.each(distributionData,function(data,index){if(index===0){var bar={x0:data.minValue,x1:Math.max(data.minValue+minBarWidth,data.maxValue),dataMin:data.minValue,dataMax:data.maxValue,percent:data.percent};bar.y=data.percent/(bar.x1-bar.x0)*Math.max(1,minBarWidth/Math.max(data.maxValue-data.minValue,.5*minBarWidth));bar.isMinWidth=data.maxValue<=data.minValue+minBarWidth;processedData.push(bar);lastBar=bar}else{if(lastBar.isMinWidth===false||data.maxValue>lastBar.x1){var _bar={x0:lastBar.x1,x1:Math.max(lastBar.x1+minBarWidth,data.maxValue),dataMin:data.minValue,dataMax:data.maxValue,percent:data.percent};_bar.y=data.percent/(_bar.x1-_bar.x0)*Math.max(1,minBarWidth/Math.max(data.maxValue-data.minValue,.5*minBarWidth));_bar.isMinWidth=data.maxValue<=lastBar.x1+minBarWidth;processedData.push(_bar);lastBar=_bar}else{lastBar.percent=lastBar.percent+data.percent;lastBar.y=lastBar.percent/(lastBar.x1-lastBar.x0);lastBar.dataMax=data.maxValue}}});if(maxX!==minX){xAxisMax=_lodash2.default.last(processedData).x1}var barHeights=_lodash2.default.pluck(processedData,"y");barHeights=barHeights.sort(function(a,b){return a-b});var maxBarHeight=0;var processedDataLength=processedData.length;if(Math.abs(processedDataLength%2)===1){maxBarHeight=20*barHeights[Math.floor(processedDataLength/2)]}else{maxBarHeight=20*(barHeights[Math.floor(processedDataLength/2)-1]+barHeights[Math.floor(processedDataLength/2)])/2}_lodash2.default.each(processedData,function(data){data.y=Math.min(data.y,maxBarHeight)});scope.processedData=processedData;chartData.push({x:minX,y:0});_lodash2.default.each(processedData,function(data){chartData.push({x:data.x0,y:data.y});chartData.push({x:data.x1,y:data.y})});chartData.push({x:processedData[processedData.length-1].x1,y:0});return chartData}function init(){scope.chartData=processDistributionData();var chartElement=_d2.default.select(element.get(0)).select(".content-wrapper");chartElement.select("svg").remove();var svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight);var minPercentile=_lodash2.default.get(scope,["card","stats","distribution","minPercentile"]);var maxPercentile=_lodash2.default.get(scope,["card","stats","distribution","maxPercentile"]);var minPercent=(0,_ordinal_suffix.ordinalSuffix)(minPercentile);var maxPercent=(0,_ordinal_suffix.ordinalSuffix)(maxPercentile);svg.append("text").attr("x",chartWidth/2).attr("y",10).attr("class","info-text").attr("transform","translate("+margin.left+", "+margin.top+")").text("Displaying "+minPercent+" - "+maxPercent+" percentiles");var translateTop=margin.top+infoLabelHeight;chartGroup=svg.append("g").attr("class","distribution-chart").attr("transform","translate("+margin.left+", "+translateTop+")");var dataLength=scope.chartData.length;if(dataLength>0){xScale=xScale.domain([xAxisMin,xAxisMax]);var yMax=_d2.default.max(scope.chartData,function(d){return d.y});yScale=yScale.domain([0,yMax])}}function drawAxes(){var axes=chartGroup.append("g").attr("class","axes");var xAxis=_d2.default.svg.axis().scale(xScale).orient("bottom").outerTickSize(0).ticks((0,_chart_utils.numTicks)(chartWidth)).tickFormat(function(d){return scope.card.fieldFormat.convert(d,"text")});var yAxis=_d2.default.svg.axis().scale(yScale).orient("left").outerTickSize(0).ticks(0);axes.append("g").attr("class","x axis").attr("transform","translate(0, "+chartHeight+")").call(xAxis);axes.append("g").attr("class","y axis").call(yAxis)}function drawDistributionArea(){var path=chartGroup.append("path");path.datum(scope.chartData).attr("class","area").attr("d",distributionArea).on("mouseover",showChartTooltip).on("mouseout",function(){return _chart_tooltip_service.mlChartTooltipService.hide()}).on("mousemove",showChartTooltip);function showChartTooltip(){var xPos=_d2.default.mouse(this)[0];var yPos=_d2.default.mouse(this)[1];var xVal=xScale.invert(xPos);var processedDataIdx=0;for(var i=0;i<scope.processedData.length;i++){if(xVal<scope.processedData[i].x1){processedDataIdx=i;break}}var contents="value:"+xVal;var bar=scope.processedData[processedDataIdx];var minValFormatted=scope.card.fieldFormat.convert(bar.dataMin,"text");if(bar.dataMax>bar.dataMin){var maxValFormatted=scope.card.fieldFormat.convert(bar.dataMax,"text");contents=bar.percent+"% of documents have<br>values between "+minValFormatted+" and "+maxValFormatted}else{contents=bar.percent+"% of documents have<br>a value of "+minValFormatted}contents="<div class='eui-textCenter'>"+contents+"</div>";if(path.length&&path[0].length){_chart_tooltip_service.mlChartTooltipService.show(contents,path[0][0],{x:xPos+5,y:yPos+10})}}}init();drawAxes();drawDistributionArea()}return{scope:false,link:link}})},2382:function(module,exports,__webpack_require__){"use strict";var _top_values=__webpack_require__(2383);var _top_values2=_interopRequireDefault(_top_values);var _string_utils=__webpack_require__(38);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlTopValues",function(){return{restrict:"E",template:_top_values2.default,link:function link(scope){scope.mlEscape=_string_utils.mlEscape}}})},2383:function(module,exports){module.exports='<div ng-repeat="value in card.stats.topValues" class="top-value">\n  <div class="field-label"\n    tooltip-html-unsafe="{{mlEscape(value.key) | formatField:card.fieldFormat}}"\n    tooltip-append-to-body="true"\n    tooltip-placement="right">\n    {{value.key | formatField:card.fieldFormat}}\n  </div>\n  <div class="top-value-bar-holder">\n    <div ng-if="card.stats.isTopValuesSampled === false"\n      class="top-value-bar {{card.type}}"\n      ng-attr-style="width: {{ 100 * value.doc_count/card.stats.count }}%;"\n      tooltip-html-unsafe="{{ 100 * value.doc_count/card.stats.count >= 0.1 ? (100 * value.doc_count/card.stats.count | number:1): \'< 0.1\' }}%"\n      tooltip-append-to-body="true"\n      tooltip-placement="right">\n    </div>\n    <div ng-if="card.stats.isTopValuesSampled === true"\n      class="top-value-bar {{card.type}}"\n      ng-attr-style="width: {{ 100 * value.doc_count/card.stats.topValuesSampleSize }}%;"\n      tooltip-html-unsafe="{{ 100 * value.doc_count/card.stats.topValuesSampleSize >= 0.1 ? (100 * value.doc_count/card.stats.topValuesSampleSize | number:1): \'< 0.1\' }}%"\n      tooltip-append-to-body="true"\n      tooltip-placement="right">\n    </div>\n  </div>\n  <div ng-if="card.stats.isTopValuesSampled === false" class="count-label">{{value.doc_count}}</div>\n  <div ng-if="card.stats.isTopValuesSampled === true" class="count-label">\n    {{ 100 * value.doc_count/card.stats.topValuesSampleSize >= 0.1 ? (100 * value.doc_count/card.stats.topValuesSampleSize | number:1): \'< 0.1\' }}%\n  </div>\n</div>\n<div ng-if="card.stats.isTopValuesSampled === true" class="sampled-message euiText">\n  Calculated from sample of {{ card.stats.topValuesSamplerShardSize }} documents per shard\n</div>\n'},2384:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2385)},2385:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _field_title_bar=__webpack_require__(2386);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlFieldTitleBar",function(){return{restrict:"E",replace:false,scope:{card:"="},link:function link(scope,element){scope.$watch("card",updateComponent);updateComponent();function updateComponent(){var props={card:scope.card};_reactDom2.default.render(_react2.default.createElement(_field_title_bar.FieldTitleBar,props),element[0])}}}})},2386:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.FieldTitleBar=FieldTitleBar;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _field_type_icon=__webpack_require__(274);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function FieldTitleBar(_ref){var card=_ref.card;if((typeof card==="undefined"?"undefined":_typeof(card))!=="object"||card===null){return null}var classNames=["ml-field-title-bar"];if(card.fieldName===undefined){classNames.push("document_count")}else if(card.isUnsupportedType===true){classNames.push("type-other")}else{classNames.push(card.type)}var fieldName=card.fieldName||"document count";return _react2.default.createElement(_eui.EuiText,{className:classNames.join(" ")},_react2.default.createElement(_field_type_icon.FieldTypeIcon,{type:card.type,tooltipEnabled:true}),_react2.default.createElement(_eui.EuiToolTip,{position:"left",content:fieldName},_react2.default.createElement("div",{className:"field-name"},fieldName)))}FieldTitleBar.propTypes={card:_propTypes2.default.object.isRequired}},2387:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2388);__webpack_require__(409);__webpack_require__(2432);__webpack_require__(2434);__webpack_require__(2445);__webpack_require__(641)},2388:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _jquery=__webpack_require__(17);var _jquery2=_interopRequireDefault(_jquery);var _dragselect=__webpack_require__(3111);var _dragselect2=_interopRequireDefault(_dragselect);var _momentTimezone=__webpack_require__(191);var _momentTimezone2=_interopRequireDefault(_momentTimezone);__webpack_require__(626);__webpack_require__(1009);__webpack_require__(1012);__webpack_require__(2423);__webpack_require__(641);var _query_filter=__webpack_require__(239);var _parse_interval=__webpack_require__(196);var _explorer=__webpack_require__(2431);var _explorer2=_interopRequireDefault(_explorer);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _check_license=__webpack_require__(43);var _check_privilege=__webpack_require__(32);var _index_utils=__webpack_require__(62);var _refresh_interval_watcher=__webpack_require__(1014);var _ml_time_buckets=__webpack_require__(258);var _ml_api_service=__webpack_require__(22);var _explorer_dashboard_service=__webpack_require__(409);var _results_service=__webpack_require__(338);var _job_service=__webpack_require__(23);var _field_format_service=__webpack_require__(209);var _job_select_service=__webpack_require__(408);var _job_utils=__webpack_require__(34);var _timefilter=__webpack_require__(16);var _date_utils=__webpack_require__(221);var _explorer_constants=__webpack_require__(273);var _search=__webpack_require__(629);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}var mlAnnotationsEnabled=_chrome2.default.getInjected("mlAnnotationsEnabled",false);_routes2.default.when("/explorer/?",{template:_explorer2.default,resolve:{CheckLicense:_check_license.checkFullLicense,privileges:_check_privilege.checkGetJobsPrivilege,indexPatterns:_index_utils.loadIndexPatterns}});var _module=_modules.uiModules.get("apps/ml");function getDefaultViewBySwimlaneData(){return{fieldName:"",laneLabels:[],points:[],interval:3600}}_module.controller("MlExplorerController",function($scope,$timeout,AppState,Private,config,mlCheckboxShowChartsService,mlSelectLimitService,mlSelectIntervalService,mlSelectSeverityService){var loadAnnotationsTableData=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var cellData,jobIds,timeRange,resp;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:$scope.annotationsData=[];cellData=$scope.cellData;jobIds=$scope.cellData!==undefined&&cellData.fieldName===VIEW_BY_JOB_LABEL?cellData.lanes:$scope.getSelectedJobIds();timeRange=getSelectionTimeRange(cellData);if(!mlAnnotationsEnabled){_context.next=9;break}_context.next=7;return _ml_api_service.ml.annotations.getAnnotations({jobIds:jobIds,earliestMs:timeRange.earliestMs,latestMs:timeRange.latestMs,maxAnnotations:_search.ANNOTATIONS_TABLE_DEFAULT_QUERY_SIZE});case 7:resp=_context.sent;$scope.$evalAsync(function(){var annotationsData=[];jobIds.forEach(function(jobId){var jobAnnotations=resp.annotations[jobId];if(jobAnnotations!==undefined){annotationsData.push.apply(annotationsData,_toConsumableArray(jobAnnotations))}});$scope.annotationsData=annotationsData.sort(function(a,b){return a.timestamp-b.timestamp}).map(function(d,i){d.key=String.fromCharCode(65+i);return d})});case 9:case"end":return _context.stop()}}},_callee,this)}));return function loadAnnotationsTableData(){return _ref.apply(this,arguments)}}();$scope.annotationsData=[];$scope.anomalyChartRecords=[];$scope.timeFieldName="timestamp";$scope.loading=true;_timefilter.timefilter.enableTimeRangeSelector();_timefilter.timefilter.enableAutoRefreshSelector();var tzConfig=config.get("dateFormat:tz");var dateFormatTz=tzConfig!=="Browser"?tzConfig:_momentTimezone2.default.tz.guess();var TimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider);var queryFilter=Private(_query_filter.FilterBarQueryFilterProvider);var mlJobSelectService=Private(_job_select_service.JobSelectServiceProvider);var resizeTimeout=null;var $mlExplorer=(0,_jquery2.default)(".ml-explorer");var MAX_INFLUENCER_FIELD_VALUES=10;var MAX_CATEGORY_EXAMPLES=10;var VIEW_BY_JOB_LABEL="job ID";var ALLOW_CELL_RANGE_SELECTION=_explorer_dashboard_service.mlExplorerDashboardService.allowCellRangeSelection;var disableDragSelectOnMouseLeave=true;var skipCellClicks=true;$scope.queryFilters=[];var dragSelect=new _dragselect2.default({selectables:document.getElementsByClassName("sl-cell"),callback:function callback(elements){if(elements.length>1&&!ALLOW_CELL_RANGE_SELECTION){elements=[elements[0]]}if(elements.length>0){_explorer_dashboard_service.mlExplorerDashboardService.dragSelect.changed({action:_explorer_constants.DRAG_SELECT_ACTION.NEW_SELECTION,elements:elements})}disableDragSelectOnMouseLeave=true},onDragStart:function onDragStart(){if(ALLOW_CELL_RANGE_SELECTION){_explorer_dashboard_service.mlExplorerDashboardService.dragSelect.changed({action:_explorer_constants.DRAG_SELECT_ACTION.DRAG_START});disableDragSelectOnMouseLeave=false}},onElementSelect:function onElementSelect(){if(ALLOW_CELL_RANGE_SELECTION){_explorer_dashboard_service.mlExplorerDashboardService.dragSelect.changed({action:_explorer_constants.DRAG_SELECT_ACTION.ELEMENT_SELECT})}}});$scope.selectedJobs=null;$scope.getSelectedJobIds=function(){var selectedJobs=_lodash2.default.filter($scope.jobs,function(job){return job.selected});return _lodash2.default.map(selectedJobs,function(job){return job.id})};$scope.viewBySwimlaneOptions=[];$scope.viewBySwimlaneData=getDefaultViewBySwimlaneData();var isChartsContainerInitialized=false;var chartsCallback=function chartsCallback(){};function initializeAfterChartsContainerDone(){if(isChartsContainerInitialized===false){chartsCallback()}isChartsContainerInitialized=true}$scope.initializeVis=function(){var stateDefaults={filters:[],mlExplorerSwimlane:{}};$scope.appState=new AppState(stateDefaults);$scope.jobs=[];_job_service.mlJobService.loadJobs().then(function(resp){if(resp.jobs.length>0){$scope.jobs=createJobs(resp.jobs);var selectedJobIds=mlJobSelectService.getSelectedJobIds(true);$scope.setSelectedJobs(selectedJobIds,true)}else{$scope.loading=false}$scope.$applyAsync()}).catch(function(resp){console.log("Explorer - error getting job info from elasticsearch:",resp)});_explorer_dashboard_service.mlExplorerDashboardService.init();_explorer_dashboard_service.mlExplorerDashboardService.chartsInitDone.watch(initializeAfterChartsContainerDone)};function createJobs(jobs){return jobs.map(function(job){var bucketSpan=(0,_parse_interval.parseInterval)(job.analysis_config.bucket_span);return{id:job.job_id,selected:false,bucketSpanSeconds:bucketSpan.asSeconds()}})}function restoreCellDataFromAppState(){if($scope.cellData===undefined&&$scope.appState.mlExplorerSwimlane.selectedType!==undefined){$scope.cellData={type:$scope.appState.mlExplorerSwimlane.selectedType,lanes:$scope.appState.mlExplorerSwimlane.selectedLanes,times:$scope.appState.mlExplorerSwimlane.selectedTimes};if($scope.cellData.type===_explorer_constants.SWIMLANE_TYPE.VIEW_BY){$scope.cellData.fieldName=$scope.appState.mlExplorerSwimlane.viewBy}$scope.swimlaneViewByFieldName=$scope.appState.mlExplorerSwimlane.viewBy}}$scope.setSelectedJobs=function(selectedIds){var keepSwimlaneSelection=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var previousSelected=0;if($scope.selectedJobs!==null){previousSelected=$scope.selectedJobs.length}var recreateJobs=false;var hasInfluencers=false;selectedIds.forEach(function(id){if(recreateJobs===false&&_lodash2.default.find($scope.jobs,{id:id})===undefined){recreateJobs=true}var job=_job_service.mlJobService.getJob(id);var influencers=[];if(job!==undefined){influencers=job.analysis_config.influencers||[]}hasInfluencers=hasInfluencers||influencers.length>0});if(recreateJobs===true){$scope.jobs=createJobs(_job_service.mlJobService.jobs)}$scope.noInfluencersConfigured=!hasInfluencers;$scope.selectedJobs=[];_lodash2.default.each($scope.jobs,function(job){job.selected=_lodash2.default.indexOf(selectedIds,job.id)!==-1;if(job.selected){$scope.selectedJobs.push(job)}});$scope.appState.fetch();if(previousSelected<=1&&$scope.selectedJobs.length>1||$scope.selectedJobs.length===1&&previousSelected>1){delete $scope.appState.mlExplorerSwimlane.viewBy}$scope.appState.save();_field_format_service.mlFieldFormatService.populateFormats(selectedIds,(0,_index_utils.getIndexPatterns)()).catch(function(err){console.log("Error populating field formats:",err)}).then(function(){loadOverallData();if(keepSwimlaneSelection===false){clearSelectedAnomalies()}else{restoreCellDataFromAppState();updateExplorer()}$scope.$applyAsync()})};$scope.setSwimlaneSelectActive=function(active){if(!active&&disableDragSelectOnMouseLeave){dragSelect.clearSelection();dragSelect.stop();return}dragSelect.start()};$scope.setSwimlaneViewBy=function(viewByFieldName){$scope.swimlaneViewByFieldName=viewByFieldName;$scope.appState.fetch();$scope.appState.mlExplorerSwimlane.viewBy=viewByFieldName;$scope.appState.save();loadViewBySwimlane([]);clearSelectedAnomalies()};$scope.$listenAndDigestAsync(_timefilter.timefilter,"fetch",function(){loadOverallData();clearSelectedAnomalies()});var refreshWatcher=Private(_refresh_interval_watcher.refreshIntervalWatcher);refreshWatcher.init(function(){loadOverallData();clearSelectedAnomalies()});mlJobSelectService.listenJobSelectionChange($scope,function(event,selections){clearSwimlaneSelectionFromAppState();$scope.setSelectedJobs(selections)});function jqueryRedrawOnResize(){if(resizeTimeout!==null){$timeout.cancel(resizeTimeout)}resizeTimeout=$timeout(redrawOnResize,500)}(0,_jquery2.default)(window).resize(jqueryRedrawOnResize);var navListener=$scope.$on("globalNav:update",function(){$timeout(function(){redrawOnResize()},300)});function clearSwimlaneSelectionFromAppState(){$scope.appState.fetch();delete $scope.appState.mlExplorerSwimlane.selectedType;delete $scope.appState.mlExplorerSwimlane.selectedLanes;delete $scope.appState.mlExplorerSwimlane.selectedTimes;$scope.appState.save()}function getSwimlaneData(swimlaneType){switch(swimlaneType){case _explorer_constants.SWIMLANE_TYPE.OVERALL:return $scope.overallSwimlaneData;case _explorer_constants.SWIMLANE_TYPE.VIEW_BY:return $scope.viewBySwimlaneData}}function mapScopeToSwimlaneProps(swimlaneType){return{chartWidth:$scope.swimlaneWidth,MlTimeBuckets:TimeBuckets,showViewBySwimlane:$scope.showViewBySwimlane,swimlaneData:getSwimlaneData(swimlaneType),swimlaneType:swimlaneType,selection:$scope.appState.mlExplorerSwimlane}}function redrawOnResize(){$scope.swimlaneWidth=getSwimlaneContainerWidth();$scope.$apply();_explorer_dashboard_service.mlExplorerDashboardService.swimlaneDataChange.changed(mapScopeToSwimlaneProps(_explorer_constants.SWIMLANE_TYPE.OVERALL));_explorer_dashboard_service.mlExplorerDashboardService.swimlaneDataChange.changed(mapScopeToSwimlaneProps(_explorer_constants.SWIMLANE_TYPE.VIEW_BY));if(mlCheckboxShowChartsService.state.get("showCharts")&&$scope.anomalyChartRecords.length>0){var timerange=getSelectionTimeRange($scope.cellData);_explorer_dashboard_service.mlExplorerDashboardService.anomalyDataChange.changed($scope.anomalyChartRecords,timerange.earliestMs,timerange.latestMs)}}$scope.$listen(queryFilter,"update",function(){$scope.queryFilters=queryFilter.getFilters();console.log("explorer_controller queryFilter update, filters:",$scope.queryFilters)});$scope.initializeVis();function setShowViewBySwimlane(){$scope.showViewBySwimlane=$scope.viewBySwimlaneData!==null&&$scope.viewBySwimlaneData.laneLabels&&$scope.viewBySwimlaneData.laneLabels.length>0}function getSelectionTimeRange(cellData){var bounds=_timefilter.timefilter.getActiveBounds();var earliestMs=bounds.min.valueOf();var latestMs=bounds.max.valueOf();if(cellData!==undefined&&cellData.times!==undefined){earliestMs=cellData.times[0]!==undefined?cellData.times[0]*1e3:bounds.min.valueOf();latestMs=bounds.max.valueOf();if(cellData.times[1]!==undefined){var interval=$scope.swimlaneBucketInterval.asSeconds();latestMs=(cellData.times[1]+interval)*1e3-1}}return{earliestMs:earliestMs,latestMs:latestMs}}function getSelectionInfluencers(cellData){var influencers=[];if(cellData!==undefined&&cellData.fieldName!==undefined&&cellData.fieldName!==VIEW_BY_JOB_LABEL){cellData.lanes.forEach(function(laneLabel){influencers.push({fieldName:$scope.swimlaneViewByFieldName,fieldValue:laneLabel})})}return influencers}var swimlaneCellClickListenerQueue=[];var swimlaneCellClickListener=function swimlaneCellClickListener(cellData){if(skipCellClicks===true){swimlaneCellClickListenerQueue.push(cellData);return}if(_lodash2.default.keys(cellData).length===0){if($scope.viewByLoadedForTimeFormatted){loadViewBySwimlane([])}clearSelectedAnomalies()}else{$scope.appState.fetch();$scope.appState.mlExplorerSwimlane.selectedType=cellData.type;$scope.appState.mlExplorerSwimlane.selectedLanes=cellData.lanes;$scope.appState.mlExplorerSwimlane.selectedTimes=cellData.times;$scope.appState.save();$scope.cellData=cellData;updateExplorer()}};_explorer_dashboard_service.mlExplorerDashboardService.swimlaneCellClick.watch(swimlaneCellClickListener);var checkboxShowChartsListener=function checkboxShowChartsListener(){var showCharts=mlCheckboxShowChartsService.state.get("showCharts");if(showCharts&&$scope.cellData!==undefined){updateExplorer()}else{var timerange=getSelectionTimeRange($scope.cellData);_explorer_dashboard_service.mlExplorerDashboardService.anomalyDataChange.changed([],timerange.earliestMs,timerange.latestMs)}};mlCheckboxShowChartsService.state.watch(checkboxShowChartsListener);var anomalyChartsSeverityListener=function anomalyChartsSeverityListener(){var showCharts=mlCheckboxShowChartsService.state.get("showCharts");if(showCharts&&$scope.cellData!==undefined){var timerange=getSelectionTimeRange($scope.cellData);_explorer_dashboard_service.mlExplorerDashboardService.anomalyDataChange.changed($scope.anomalyChartRecords,timerange.earliestMs,timerange.latestMs)}};mlSelectSeverityService.state.watch(anomalyChartsSeverityListener);var tableControlsListener=function tableControlsListener(){loadAnomaliesTableData()};mlSelectIntervalService.state.watch(tableControlsListener);mlSelectSeverityService.state.watch(tableControlsListener);var swimlaneLimitListener=function swimlaneLimitListener(){loadViewBySwimlane([]);clearSelectedAnomalies()};mlSelectLimitService.state.watch(swimlaneLimitListener);var swimlaneRenderDoneListener=function swimlaneRenderDoneListener(){dragSelect.clearSelection();dragSelect.setSelectables(document.getElementsByClassName("sl-cell"))};_explorer_dashboard_service.mlExplorerDashboardService.swimlaneRenderDone.watch(swimlaneRenderDoneListener);$scope.$on("$destroy",function(){dragSelect.stop();mlCheckboxShowChartsService.state.unwatch(checkboxShowChartsListener);_explorer_dashboard_service.mlExplorerDashboardService.swimlaneCellClick.unwatch(swimlaneCellClickListener);_explorer_dashboard_service.mlExplorerDashboardService.swimlaneRenderDone.unwatch(swimlaneRenderDoneListener);mlSelectSeverityService.state.unwatch(anomalyChartsSeverityListener);mlSelectIntervalService.state.unwatch(tableControlsListener);mlSelectSeverityService.state.unwatch(tableControlsListener);mlSelectLimitService.state.unwatch(swimlaneLimitListener);_explorer_dashboard_service.mlExplorerDashboardService.chartsInitDone.unwatch(initializeAfterChartsContainerDone);delete $scope.cellData;refreshWatcher.cancel();(0,_jquery2.default)(window).off("resize",jqueryRedrawOnResize);navListener()});var requestCount=0;function loadDataForCharts(jobIds,earliestMs,latestMs){var influencers=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];if($scope.cellData===undefined&&influencers.length===0){return}var newRequestCount=++requestCount;requestCount=newRequestCount;_results_service.mlResultsService.getRecordsForInfluencer(jobIds,influencers,0,earliestMs,latestMs,500).then(function(resp){if(newRequestCount<requestCount){return}if($scope.cellData!==undefined&&_lodash2.default.keys($scope.cellData).length>0){$scope.anomalyChartRecords=resp.records;console.log("Explorer anomaly charts data set:",$scope.anomalyChartRecords);if(mlCheckboxShowChartsService.state.get("showCharts")){_explorer_dashboard_service.mlExplorerDashboardService.anomalyDataChange.changed($scope.anomalyChartRecords,earliestMs,latestMs)}}if($scope.cellData===undefined){return}if(influencers.length>0){var recordInfluencersByName={};influencers.forEach(function(influencer){var fieldName=influencer.fieldName;if(recordInfluencersByName[influencer.fieldName]===undefined){recordInfluencersByName[influencer.fieldName]=[]}recordInfluencersByName[fieldName].push(influencer.fieldValue)});resp.records.forEach(function(record){var influencersByName=record.influencers||[];influencersByName.forEach(function(influencer){var _recordInfluencersByN;var fieldName=influencer.influencer_field_name;var fieldValues=influencer.influencer_field_values;if(recordInfluencersByName[fieldName]===undefined){recordInfluencersByName[fieldName]=[]}(_recordInfluencersByN=recordInfluencersByName[fieldName]).push.apply(_recordInfluencersByN,_toConsumableArray(fieldValues))})});var uniqValuesByName={};Object.keys(recordInfluencersByName).forEach(function(fieldName){var fieldValues=recordInfluencersByName[fieldName];uniqValuesByName[fieldName]=_lodash2.default.uniq(fieldValues)});var filterInfluencers=[];Object.keys(uniqValuesByName).forEach(function(fieldName){var matchingFieldName=influencers.find(function(influencer){return influencer.fieldName===fieldName});if(matchingFieldName!==undefined){filterInfluencers.push.apply(filterInfluencers,_toConsumableArray(influencers))}else{uniqValuesByName[fieldName].forEach(function(fieldValue){filterInfluencers.push({fieldName:fieldName,fieldValue:fieldValue})})}});loadTopInfluencers(jobIds,earliestMs,latestMs,filterInfluencers)}$scope.$applyAsync()})}function setViewBySwimlaneOptions(){$scope.swimlaneViewByFieldName=null;var viewByOptions=[];var selectedJobIds=$scope.getSelectedJobIds();var fieldsByJob={"*":[]};_lodash2.default.each(_job_service.mlJobService.jobs,function(job){var fieldsForJob=[];var analysisConfig=job.analysis_config;var detectors=analysisConfig.detectors||[];_lodash2.default.each(detectors,function(detector){if(_lodash2.default.has(detector,"partition_field_name")){fieldsForJob.push(detector.partition_field_name)}if(_lodash2.default.has(detector,"over_field_name")){fieldsForJob.push(detector.over_field_name)}if(_lodash2.default.has(detector,"by_field_name")&&!_lodash2.default.has(detector,"over_field_name")){fieldsForJob.push(detector.by_field_name)}});var influencers=analysisConfig.influencers||[];fieldsForJob=fieldsForJob.concat(influencers);if(selectedJobIds.indexOf(job.job_id)!==-1){viewByOptions=viewByOptions.concat(influencers)}fieldsByJob[job.job_id]=_lodash2.default.uniq(fieldsForJob);fieldsByJob["*"]=_lodash2.default.union(fieldsByJob["*"],fieldsByJob[job.job_id])});$scope.fieldsByJob=fieldsByJob;viewByOptions=_lodash2.default.chain(viewByOptions).uniq().sortBy(function(fieldName){return fieldName.toLowerCase()}).value();viewByOptions.push(VIEW_BY_JOB_LABEL);$scope.viewBySwimlaneOptions=viewByOptions;if($scope.appState.mlExplorerSwimlane.viewBy!==undefined&&$scope.viewBySwimlaneOptions.indexOf($scope.appState.mlExplorerSwimlane.viewBy)!==-1){$scope.swimlaneViewByFieldName=$scope.appState.mlExplorerSwimlane.viewBy}else{if(selectedJobIds.length>1){$scope.swimlaneViewByFieldName=VIEW_BY_JOB_LABEL}else{var firstSelectedJob=_lodash2.default.find(_job_service.mlJobService.jobs,function(job){return job.job_id===selectedJobIds[0]});var firstJobInfluencers=firstSelectedJob.analysis_config.influencers||[];_lodash2.default.each(firstSelectedJob.analysis_config.detectors,function(detector){if(_lodash2.default.has(detector,"partition_field_name")&&firstJobInfluencers.indexOf(detector.partition_field_name)!==-1){$scope.swimlaneViewByFieldName=detector.partition_field_name;return false}if(_lodash2.default.has(detector,"over_field_name")&&firstJobInfluencers.indexOf(detector.over_field_name)!==-1){$scope.swimlaneViewByFieldName=detector.over_field_name;return false}if(_lodash2.default.has(detector,"by_field_name")&&!_lodash2.default.has(detector,"over_field_name")&&firstJobInfluencers.indexOf(detector.by_field_name)!==-1){$scope.swimlaneViewByFieldName=detector.by_field_name;return false}});if($scope.swimlaneViewByFieldName===null){if(firstJobInfluencers.length>0){$scope.swimlaneViewByFieldName=firstJobInfluencers[0]}else{$scope.swimlaneViewByFieldName=$scope.viewBySwimlaneOptions.length>0?$scope.viewBySwimlaneOptions[0]:null}}}$scope.appState.fetch();$scope.appState.mlExplorerSwimlane.viewBy=$scope.swimlaneViewByFieldName;$scope.appState.save()}}function loadOverallData(){if($scope.selectedJobs===null){return}$scope.loading=true;$scope.hasResults=false;$scope.swimlaneBucketInterval=calculateSwimlaneBucketInterval();console.log("Explorer swimlane bucketInterval:",$scope.swimlaneBucketInterval);var bounds=_timefilter.timefilter.getActiveBounds();var searchBounds=(0,_ml_time_buckets.getBoundsRoundedToInterval)(bounds,$scope.swimlaneBucketInterval,false);var selectedJobIds=$scope.getSelectedJobIds();var overallBucketsBounds=(0,_ml_time_buckets.getBoundsRoundedToInterval)(bounds,$scope.swimlaneBucketInterval,true);_results_service.mlResultsService.getOverallBucketScores(selectedJobIds,1,overallBucketsBounds.min.valueOf(),overallBucketsBounds.max.valueOf(),$scope.swimlaneBucketInterval.asSeconds()+"s").then(function(resp){skipCellClicks=false;$scope.overallSwimlaneData=processOverallResults(resp.results,searchBounds);console.log("Explorer overall swimlane data set:",$scope.overallSwimlaneData);if($scope.overallSwimlaneData.points&&$scope.overallSwimlaneData.points.length>0){$scope.hasResults=true;setViewBySwimlaneOptions()}else{$scope.hasResults=false}$scope.loading=false;$timeout(function(){_explorer_dashboard_service.mlExplorerDashboardService.swimlaneDataChange.changed(mapScopeToSwimlaneProps(_explorer_constants.SWIMLANE_TYPE.OVERALL));loadViewBySwimlane([])},0)})}function loadTopInfluencers(selectedJobIds,earliestMs,latestMs){var influencers=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];if($scope.noInfluencersConfigured!==true){_results_service.mlResultsService.getTopInfluencers(selectedJobIds,earliestMs,latestMs,MAX_INFLUENCER_FIELD_VALUES,influencers).then(function(resp){$scope.influencers=resp.influencers;$scope.$applyAsync();console.log("Explorer top influencers data set:",$scope.influencers)})}else{$scope.influencers={};$scope.$applyAsync()}}function loadViewBySwimlane(fieldValues){$scope.viewBySwimlaneData=getDefaultViewBySwimlaneData();skipCellClicks=true;function finish(resp){if(resp!==undefined){$scope.viewBySwimlaneData=processViewByResults(resp.results,fieldValues);if($scope.cellData!==undefined&&$scope.cellData.type===_explorer_constants.SWIMLANE_TYPE.VIEW_BY){var selectionExists=$scope.cellData.lanes.some(function(lane){return $scope.viewBySwimlaneData.laneLabels.includes(lane)});if(selectionExists===false){clearSelectedAnomalies()}}}skipCellClicks=false;console.log("Explorer view by swimlane data set:",$scope.viewBySwimlaneData);if(swimlaneCellClickListenerQueue.length>0){var cellData=swimlaneCellClickListenerQueue.pop();swimlaneCellClickListenerQueue.length=0;swimlaneCellClickListener(cellData);return}setShowViewBySwimlane();$timeout(function(){_explorer_dashboard_service.mlExplorerDashboardService.swimlaneDataChange.changed(mapScopeToSwimlaneProps(_explorer_constants.SWIMLANE_TYPE.VIEW_BY))},0)}if($scope.selectedJobs===undefined||$scope.swimlaneViewByFieldName===undefined||$scope.swimlaneViewByFieldName===null){finish();return}else{var bounds=_timefilter.timefilter.getActiveBounds();var searchBounds=(0,_ml_time_buckets.getBoundsRoundedToInterval)(bounds,$scope.swimlaneBucketInterval,false);var selectedJobIds=$scope.getSelectedJobIds();var limit=mlSelectLimitService.state.get("limit");var swimlaneLimit=limit===undefined?_explorer_constants.SWIMLANE_DEFAULT_LIMIT:limit.val;var interval=$scope.swimlaneBucketInterval.asSeconds()+"s";if($scope.swimlaneViewByFieldName!==VIEW_BY_JOB_LABEL){_results_service.mlResultsService.getInfluencerValueMaxScoreByTime(selectedJobIds,$scope.swimlaneViewByFieldName,fieldValues,searchBounds.min.valueOf(),searchBounds.max.valueOf(),interval,swimlaneLimit).then(finish)}else{var jobIds=fieldValues!==undefined&&fieldValues.length>0?fieldValues:selectedJobIds;_results_service.mlResultsService.getScoresByBucket(jobIds,searchBounds.min.valueOf(),searchBounds.max.valueOf(),interval,swimlaneLimit).then(finish)}}}function loadViewBySwimlaneForSelectedTime(earliestMs,latestMs){var selectedJobIds=$scope.getSelectedJobIds();var limit=mlSelectLimitService.state.get("limit");var swimlaneLimit=limit===undefined?_explorer_constants.SWIMLANE_DEFAULT_LIMIT:limit.val;if($scope.swimlaneViewByFieldName!==VIEW_BY_JOB_LABEL){_results_service.mlResultsService.getTopInfluencers(selectedJobIds,earliestMs,latestMs,swimlaneLimit).then(function(resp){var topFieldValues=[];var topInfluencers=resp.influencers[$scope.swimlaneViewByFieldName];_lodash2.default.each(topInfluencers,function(influencerData){if(influencerData.maxAnomalyScore>0){topFieldValues.push(influencerData.influencerFieldValue)}});loadViewBySwimlane(topFieldValues)})}else{_results_service.mlResultsService.getScoresByBucket(selectedJobIds,earliestMs,latestMs,$scope.swimlaneBucketInterval.asSeconds()+"s",swimlaneLimit).then(function(resp){loadViewBySwimlane(_lodash2.default.keys(resp.results))})}}function loadAnomaliesTableData(){var cellData=$scope.cellData;var jobIds=$scope.cellData!==undefined&&cellData.fieldName===VIEW_BY_JOB_LABEL?cellData.lanes:$scope.getSelectedJobIds();var influencers=getSelectionInfluencers(cellData);var timeRange=getSelectionTimeRange(cellData);_ml_api_service.ml.results.getAnomaliesTableData(jobIds,[],influencers,mlSelectIntervalService.state.get("interval").val,mlSelectSeverityService.state.get("threshold").val,timeRange.earliestMs,timeRange.latestMs,dateFormatTz,_search.ANOMALIES_TABLE_DEFAULT_QUERY_SIZE,MAX_CATEGORY_EXAMPLES).then(function(resp){var anomalies=resp.anomalies;var detectorsByJob=_job_service.mlJobService.detectorsByJob;anomalies.forEach(function(anomaly){var jobId=anomaly.jobId;var detector=_lodash2.default.get(detectorsByJob,[jobId,anomaly.detectorIndex]);anomaly.detector=_lodash2.default.get(detector,["detector_description"],anomaly.source.function_description);if(detector!==undefined&&detector.custom_rules!==undefined){anomaly.rulesLength=detector.custom_rules.length}anomaly.isTimeSeriesViewDetector=(0,_job_utils.isTimeSeriesViewDetector)(_job_service.mlJobService.getJob(jobId),anomaly.detectorIndex);if(_lodash2.default.has(_job_service.mlJobService.customUrlsByJob,jobId)){anomaly.customUrls=_job_service.mlJobService.customUrlsByJob[jobId]}});$scope.$evalAsync(function(){$scope.tableData={anomalies:anomalies,interval:resp.interval,examplesByJobId:resp.examplesByJobId,showViewSeriesLink:true}})}).catch(function(resp){console.log("Explorer - error loading data for anomalies table:",resp)})}function updateExplorer(){var finish=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setShowViewBySwimlane();_context2.next=3;return loadAnnotationsTableData();case 3:$timeout(function(){if($scope.overallSwimlaneData!==undefined){_explorer_dashboard_service.mlExplorerDashboardService.swimlaneDataChange.changed(mapScopeToSwimlaneProps(_explorer_constants.SWIMLANE_TYPE.OVERALL))}if($scope.viewBySwimlaneData!==undefined){_explorer_dashboard_service.mlExplorerDashboardService.swimlaneDataChange.changed(mapScopeToSwimlaneProps(_explorer_constants.SWIMLANE_TYPE.VIEW_BY))}_explorer_dashboard_service.mlExplorerDashboardService.anomalyDataChange.changed($scope.anomalyChartRecords||[],timerange.earliestMs,timerange.latestMs);if(cellData!==undefined&&cellData.fieldName===undefined){loadViewBySwimlaneForSelectedTime(timerange.earliestMs,timerange.latestMs);$scope.viewByLoadedForTimeFormatted=(0,_date_utils.formatHumanReadableDateTime)(timerange.earliestMs)}if(influencers.length===0){loadTopInfluencers(jobIds,timerange.earliestMs,timerange.latestMs);loadDataForCharts(jobIds,timerange.earliestMs,timerange.latestMs)}else{loadDataForCharts(jobIds,timerange.earliestMs,timerange.latestMs,influencers)}loadAnomaliesTableData()},0);case 4:case"end":return _context2.stop()}}},_callee2,this)}));return function finish(){return _ref2.apply(this,arguments)}}();var cellData=$scope.cellData;var jobIds=cellData!==undefined&&cellData.fieldName===VIEW_BY_JOB_LABEL?cellData.lanes:$scope.getSelectedJobIds();var timerange=getSelectionTimeRange(cellData);var influencers=getSelectionInfluencers(cellData);if(isChartsContainerInitialized){finish()}else{chartsCallback=finish}}function clearSelectedAnomalies(){$scope.anomalyChartRecords=[];$scope.viewByLoadedForTimeFormatted=null;delete $scope.cellData;clearSwimlaneSelectionFromAppState();updateExplorer()}function calculateSwimlaneBucketInterval(){var bounds=_timefilter.timefilter.getActiveBounds();var buckets=new TimeBuckets;buckets.setInterval("auto");buckets.setBounds(bounds);var intervalSeconds=buckets.getInterval().asSeconds();var numBuckets=parseInt((bounds.max.valueOf()-bounds.min.valueOf())/1e3/intervalSeconds);var swimlaneWidth=getSwimlaneContainerWidth();var cellWidth=Math.floor(swimlaneWidth/numBuckets);$scope.swimlaneWidth=swimlaneWidth;if(cellWidth<8){buckets.setInterval(intervalSeconds*2+"s")}var selectedJobs=_lodash2.default.filter($scope.jobs,function(job){return job.selected});var maxBucketSpanSeconds=_lodash2.default.reduce(selectedJobs,function(memo,job){return Math.max(memo,job.bucketSpanSeconds)},0);if(maxBucketSpanSeconds>intervalSeconds){buckets.setInterval(maxBucketSpanSeconds+"s");buckets.setBounds(bounds)}return buckets.getInterval()}function getSwimlaneContainerWidth(){if($scope.noInfluencersConfigured===true){return $mlExplorer.width()-250}else{return $mlExplorer.width()/6*5-220}}function processOverallResults(scoresByTime,searchBounds){var dataset={laneLabels:["Overall"],points:[],interval:$scope.swimlaneBucketInterval.asSeconds(),earliest:searchBounds.min.valueOf()/1e3,latest:searchBounds.max.valueOf()/1e3};if(_lodash2.default.keys(scoresByTime).length>0){_lodash2.default.each(scoresByTime,function(score,timeMs){var time=timeMs/1e3;dataset.points.push({laneLabel:"Overall",time:time,value:score});dataset.earliest=Math.min(time,dataset.earliest);dataset.latest=Math.max(time+dataset.interval,dataset.latest)})}return dataset}function processViewByResults(scoresByInfluencerAndTime,sortedLaneValues){var dataset={fieldName:$scope.swimlaneViewByFieldName,points:[],interval:$scope.swimlaneBucketInterval.asSeconds()};dataset.earliest=$scope.overallSwimlaneData.earliest;dataset.latest=$scope.overallSwimlaneData.latest;var laneLabels=[];var maxScoreByLaneLabel={};_lodash2.default.each(scoresByInfluencerAndTime,function(influencerData,influencerFieldValue){laneLabels.push(influencerFieldValue);maxScoreByLaneLabel[influencerFieldValue]=0;_lodash2.default.each(influencerData,function(anomalyScore,timeMs){var time=timeMs/1e3;dataset.points.push({laneLabel:influencerFieldValue,time:time,value:anomalyScore});maxScoreByLaneLabel[influencerFieldValue]=Math.max(maxScoreByLaneLabel[influencerFieldValue],anomalyScore)})});var sortValuesLength=sortedLaneValues.length;if(sortValuesLength===0){dataset.laneLabels=laneLabels.sort(function(a,b){return maxScoreByLaneLabel[b]-maxScoreByLaneLabel[a]})}else{dataset.laneLabels=laneLabels.sort(function(a,b){var aIndex=sortedLaneValues.indexOf(a);var bIndex=sortedLaneValues.indexOf(b);aIndex=aIndex>-1?aIndex:sortValuesLength;bIndex=bIndex>-1?bIndex:sortValuesLength;return aIndex-bIndex})}return dataset}})},2390:function(module,exports,__webpack_require__){"use strict";__webpack_require__(53);var _modules=__webpack_require__(4);var _timefilter=__webpack_require__(16);var _anomalies_table=__webpack_require__(2391);var _module=_modules.uiModules.get("apps/ml",["react"]);_module.directive("mlAnomaliesTable",function($injector){var reactDirective=$injector.get("reactDirective");return reactDirective(_anomalies_table.AnomaliesTable,[["filter",{watchDepth:"reference"}],["tableData",{watchDepth:"reference"}]],{restrict:"E"},{timefilter:_timefilter.timefilter})})},2391:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AnomaliesTable=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _date_utils=__webpack_require__(221);var _description_cell=__webpack_require__(2392);var _detector_cell=__webpack_require__(2394);var _entity_cell=__webpack_require__(1010);var _influencers_cell=__webpack_require__(2395);var _anomaly_details=__webpack_require__(2396);var _links_menu=__webpack_require__(2397);var _check_privilege=__webpack_require__(32);var _table_service=__webpack_require__(628);var _field_format_service=__webpack_require__(209);var _anomaly_utils=__webpack_require__(256);var _format_value=__webpack_require__(299);var _rule_editor=__webpack_require__(2398);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var INFLUENCERS_LIMIT=5;function renderTime(date,aggregationInterval){if(aggregationInterval==="hour"){return(0,_date_utils.formatHumanReadableDateTime)(date)}else if(aggregationInterval==="second"){return(0,_date_utils.formatHumanReadableDateTimeSeconds)(date)}else{return(0,_date_utils.formatHumanReadableDate)(date)}}function showLinksMenuForItem(item){var canConfigureRules=(0,_anomaly_utils.isRuleSupported)(item)&&(0,_check_privilege.checkPermission)("canUpdateJob");return canConfigureRules||item.isTimeSeriesViewDetector||item.entityName==="mlcategory"||item.customUrls!==undefined}function getColumns(items,examplesByJobId,isAggregatedData,interval,timefilter,showViewSeriesLink,showRuleEditorFlyout,itemIdToExpandedRowMap,toggleRow,filter){var columns=[{name:"",render:function render(item){return _react2.default.createElement(_eui.EuiButtonIcon,{onClick:function onClick(){return toggleRow(item)},iconType:itemIdToExpandedRowMap[item.rowId]?"arrowDown":"arrowRight","aria-label":itemIdToExpandedRowMap[item.rowId]?"Hide details":"Show details","data-row-id":item.rowId})}},{field:"time",name:"time",dataType:"date",render:function render(date){return renderTime(date,interval)},textOnly:true,sortable:true},{field:"severity",name:(isAggregatedData===true?"max ":"")+"severity",render:function render(score){return _react2.default.createElement(_eui.EuiHealth,{color:(0,_anomaly_utils.getSeverityColor)(score),compressed:"true"},score>=1?Math.floor(score):"< 1")},sortable:true},{field:"detector",name:"detector",render:function render(detectorDescription,item){return _react2.default.createElement(_detector_cell.DetectorCell,{detectorDescription:detectorDescription,numberOfRules:item.rulesLength})},textOnly:true,sortable:true}];if(items.some(function(item){return item.entityValue!==undefined})){columns.push({field:"entityValue",name:"found for",render:function render(entityValue,item){return _react2.default.createElement(_entity_cell.EntityCell,{entityName:item.entityName,entityValue:entityValue,filter:filter})},textOnly:true,sortable:true})}if(items.some(function(item){return item.influencers!==undefined})){columns.push({field:"influencers",name:"influenced by",render:function render(influencers){return _react2.default.createElement(_influencers_cell.InfluencersCell,{limit:INFLUENCERS_LIMIT,influencers:influencers})},textOnly:true,sortable:true})}if(items.some(function(item){return item.actual!==undefined})){columns.push({field:"actualSort",name:"actual",render:function render(actual,item){var fieldFormat=_field_format_service.mlFieldFormatService.getFieldFormat(item.jobId,item.source.detector_index);return(0,_format_value.formatValue)(item.actual,item.source.function,fieldFormat)},sortable:true})}if(items.some(function(item){return item.typical!==undefined})){columns.push({field:"typicalSort",name:"typical",render:function render(typical,item){var fieldFormat=_field_format_service.mlFieldFormatService.getFieldFormat(item.jobId,item.source.detector_index);return(0,_format_value.formatValue)(item.typical,item.source.function,fieldFormat)},sortable:true});var nonTimeOfDayOrWeek=items.some(function(item){var summaryRecFunc=item.source.function;return summaryRecFunc!=="time_of_day"&&summaryRecFunc!=="time_of_week"});if(nonTimeOfDayOrWeek===true){columns.push({field:"metricDescriptionSort",name:"description",render:function render(metricDescriptionSort,item){return _react2.default.createElement(_description_cell.DescriptionCell,{actual:item.actual,typical:item.typical})},textOnly:true,sortable:true})}}columns.push({field:"jobId",name:"job ID",sortable:true});var showLinks=showViewSeriesLink===true||items.some(function(item){return showLinksMenuForItem(item)});if(showLinks===true){columns.push({name:"actions",render:function render(item){if(showLinksMenuForItem(item)===true){return _react2.default.createElement(_links_menu.LinksMenu,{anomaly:item,showViewSeriesLink:showViewSeriesLink,isAggregatedData:isAggregatedData,interval:interval,timefilter:timefilter,showRuleEditorFlyout:showRuleEditorFlyout})}else{return null}},sortable:false})}var showExamples=items.some(function(item){return item.entityName==="mlcategory"});if(showExamples===true){columns.push({name:"category examples",sortable:false,truncateText:true,render:function render(item){var examples=_lodash2.default.get(examplesByJobId,[item.jobId,item.entityValue],[]);return _react2.default.createElement(_eui.EuiText,{size:"xs"},examples.map(function(example,i){return _react2.default.createElement("span",{key:"example"+i,className:"category-example"},example)}))},textOnly:true})}return columns}var AnomaliesTable=function(_Component){_inherits(AnomaliesTable,_Component);function AnomaliesTable(props){_classCallCheck(this,AnomaliesTable);var _this=_possibleConstructorReturn(this,(AnomaliesTable.__proto__||Object.getPrototypeOf(AnomaliesTable)).call(this,props));_this.isShowingAggregatedData=function(){return _this.props.tableData.interval!=="second"};_this.toggleRow=function(item){var itemIdToExpandedRowMap=_extends({},_this.state.itemIdToExpandedRowMap);if(itemIdToExpandedRowMap[item.rowId]){delete itemIdToExpandedRowMap[item.rowId]}else{var examples=item.entityName==="mlcategory"?_lodash2.default.get(_this.props.tableData,["examplesByJobId",item.jobId,item.entityValue]):undefined;itemIdToExpandedRowMap[item.rowId]=_react2.default.createElement(_anomaly_details.AnomalyDetails,{anomaly:item,examples:examples,isAggregatedData:_this.isShowingAggregatedData(),filter:_this.props.filter,influencersLimit:INFLUENCERS_LIMIT})}_this.setState({itemIdToExpandedRowMap:itemIdToExpandedRowMap})};_this.onMouseOverRow=function(record){if(_this.mouseOverRecord!==undefined){if(_this.mouseOverRecord.rowId!==record.rowId){_table_service.mlTableService.rowMouseleave.changed(_this.mouseOverRecord);_table_service.mlTableService.rowMouseenter.changed(record)}}else{_table_service.mlTableService.rowMouseenter.changed(record)}_this.mouseOverRecord=record};_this.onMouseLeaveRow=function(){if(_this.mouseOverRecord!==undefined){_table_service.mlTableService.rowMouseleave.changed(_this.mouseOverRecord);_this.mouseOverRecord=undefined}};_this.setShowRuleEditorFlyoutFunction=function(func){_this.setState({showRuleEditorFlyout:func})};_this.unsetShowRuleEditorFlyoutFunction=function(){var showRuleEditorFlyout=function showRuleEditorFlyout(){};_this.setState({showRuleEditorFlyout:showRuleEditorFlyout})};_this.state={itemIdToExpandedRowMap:{},showRuleEditorFlyout:function showRuleEditorFlyout(){}};return _this}_createClass(AnomaliesTable,[{key:"render",value:function render(){var _this2=this;var _props=this.props,timefilter=_props.timefilter,tableData=_props.tableData,filter=_props.filter;if(tableData===undefined||tableData.anomalies===undefined||tableData.anomalies.length===0){return _react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceAround"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("h4",null,"No matching anomalies found"))))}var columns=getColumns(tableData.anomalies,tableData.examplesByJobId,this.isShowingAggregatedData(),tableData.interval,timefilter,tableData.showViewSeriesLink,this.state.showRuleEditorFlyout,this.state.itemIdToExpandedRowMap,this.toggleRow,filter);var sorting={sort:{field:"severity",direction:"desc"}};var getRowProps=function getRowProps(item){return{onMouseOver:function onMouseOver(){return _this2.onMouseOverRow(item)},onMouseLeave:function onMouseLeave(){return _this2.onMouseLeaveRow()}}};return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_rule_editor.RuleEditorFlyout,{setShowFunction:this.setShowRuleEditorFlyoutFunction,unsetShowFunction:this.unsetShowRuleEditorFlyoutFunction}),_react2.default.createElement(_eui.EuiInMemoryTable,{className:"ml-anomalies-table eui-textOverflowWrap",items:tableData.anomalies,columns:columns,pagination:{pageSizeOptions:[10,25,100],initialPageSize:25},sorting:sorting,itemId:"rowId",itemIdToExpandedRowMap:this.state.itemIdToExpandedRowMap,compressed:true,rowProps:getRowProps}))}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(nextProps,prevState){var itemIdToExpandedRowMap=prevState.itemIdToExpandedRowMap;var prevExpandedNotInData=Object.keys(itemIdToExpandedRowMap).find(function(rowId){var matching=nextProps.tableData.anomalies.find(function(anomaly){return anomaly.rowId===rowId});return matching===undefined});if(prevExpandedNotInData!==undefined){return{itemIdToExpandedRowMap:{}}}return null}}]);return AnomaliesTable}(_react.Component);AnomaliesTable.propTypes={timefilter:_propTypes2.default.object.isRequired,tableData:_propTypes2.default.object,filter:_propTypes2.default.func};exports.AnomaliesTable=AnomaliesTable},2392:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DescriptionCell=DescriptionCell;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _metric_change_description=__webpack_require__(2393);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function DescriptionCell(_ref){var actual=_ref.actual,typical=_ref.typical;var _getMetricChangeDescr=(0,_metric_change_description.getMetricChangeDescription)(actual,typical),iconType=_getMetricChangeDescr.iconType,message=_getMetricChangeDescr.message;return _react2.default.createElement(_eui.EuiFlexGroup,{gutterSize:"s"},iconType!==undefined&&_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiIcon,{type:iconType,size:"s"})),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiText,{size:"xs"},_react2.default.createElement("p",null,message))))}DescriptionCell.propTypes={actual:_propTypes2.default.oneOfType([_propTypes2.default.array,_propTypes2.default.number]),typical:_propTypes2.default.oneOfType([_propTypes2.default.array,_propTypes2.default.number])}},2393:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getMetricChangeDescription=getMetricChangeDescription;var _modules=__webpack_require__(4);var _module=_modules.uiModules.get("apps/ml");function getMetricChangeDescription(actualProp,typicalProp){if(actualProp===undefined||typicalProp===undefined){return{iconType:"empty",message:""}}var iconType=void 0;var message=void 0;var actual=actualProp;var typical=typicalProp;if(Array.isArray(actualProp)){if(actualProp.length===1){actual=actualProp[0]}else{return{iconType:"alert",message:"Unusual values"}}}if(Array.isArray(typicalProp)){if(typicalProp.length===1){typical=typicalProp[0]}}if(actual===typical){message="actual same as typical"}else{var isHigher=actual>typical;iconType=isHigher?"sortUp":"sortDown";if(typical!==0&&actual!==0){var factor=isHigher?actual/typical:typical/actual;var direction=isHigher?"higher":"lower";if(factor>1.5){if(factor<=100){message=Math.round(factor)+"x "+direction}else{message="More than 100x "+direction}}else if(factor>=1.05){message=factor.toPrecision(2)+"x "+direction}else{message="Unusually "+(isHigher?"high":"low")}}else{if(actual===0){message="Unexpected zero value"}else{message="Unexpected non-zero value"}}}return{iconType:iconType,message:message}}_module.filter("metricChangeDescription",function(){return function(actual,typical){var _getMetricChangeDescr=getMetricChangeDescription(actual,typical),iconType=_getMetricChangeDescr.iconType,message=_getMetricChangeDescr.message;switch(iconType){case"sortUp":return'<i class="fa fa-arrow-up"></i> '+message;case"sortDown":return'<i class="fa fa-arrow-down"></i> '+message;case"alert":return'<i class="fa fa-exclamation-triangle"></i> '+message}return message}})},2394:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DetectorCell=DetectorCell;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function DetectorCell(_ref){var detectorDescription=_ref.detectorDescription,numberOfRules=_ref.numberOfRules;var rulesIcon=void 0;if(numberOfRules!==undefined&&numberOfRules>0){rulesIcon=_react2.default.createElement(_eui.EuiToolTip,{content:"rules have been configured for this detector"},_react2.default.createElement(_eui.EuiIcon,{type:"controlsHorizontal",className:"detector-rules-icon"}))}return _react2.default.createElement(_react2.default.Fragment,null,detectorDescription,rulesIcon)}DetectorCell.propTypes={detectorDescription:_propTypes2.default.string.isRequired,numberOfRules:_propTypes2.default.number}},2395:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.InfluencersCell=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var InfluencersCell=exports.InfluencersCell=function(_Component){_inherits(InfluencersCell,_Component);function InfluencersCell(props){_classCallCheck(this,InfluencersCell);var _this=_possibleConstructorReturn(this,(InfluencersCell.__proto__||Object.getPrototypeOf(InfluencersCell)).call(this,props));_this.state={showAll:false};return _this}_createClass(InfluencersCell,[{key:"toggleAllInfluencers",value:function toggleAllInfluencers(){this.setState({showAll:!this.state.showAll})}},{key:"renderInfluencers",value:function renderInfluencers(influencers){var numberToDisplay=this.state.showAll===false?this.props.limit:influencers.length;var displayInfluencers=influencers.slice(0,numberToDisplay);var othersCount=Math.max(influencers.length-numberToDisplay,0);if(othersCount===1){displayInfluencers.push(influencers[this.props.limit]);othersCount=0}var displayRows=displayInfluencers.map(function(influencer,index){return _react2.default.createElement("div",{key:index},influencer.influencerFieldName,": ",influencer.influencerFieldValue)});return _react2.default.createElement(_react2.default.Fragment,null,displayRows,this.renderOthers(influencers.length,othersCount))}},{key:"renderOthers",value:function renderOthers(totalCount,othersCount){var _this2=this;if(othersCount>0){return _react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiLink,{onClick:function onClick(){return _this2.toggleAllInfluencers()}},"and ",othersCount," more"))}else if(totalCount>this.props.limit+1){return _react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiLink,{onClick:function onClick(){return _this2.toggleAllInfluencers()}},"show less"))}}},{key:"render",value:function render(){var recordInfluencers=this.props.influencers||[];var influencers=[];recordInfluencers.forEach(function(influencer){_lodash2.default.each(influencer,function(influencerFieldValue,influencerFieldName){influencers.push({influencerFieldName:influencerFieldName,influencerFieldValue:influencerFieldValue})})});return _react2.default.createElement("div",null,this.renderInfluencers(influencers),this.renderOthers(influencers))}}]);return InfluencersCell}(_react.Component);InfluencersCell.propTypes={influencers:_propTypes2.default.array,limit:_propTypes2.default.number}},2396:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AnomalyDetails=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _eui=__webpack_require__(2);var _date_utils=__webpack_require__(221);var _entity_cell=__webpack_require__(1010);var _anomaly_utils=__webpack_require__(256);var _multi_bucket_impact=__webpack_require__(634);var _format_value=__webpack_require__(299);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TIME_FIELD_NAME="timestamp";function getFilterEntity(entityName,entityValue,filter){return _react2.default.createElement(_entity_cell.EntityCell,{entityName:entityName,entityValue:entityValue,filter:filter})}function getDetailsItems(anomaly,examples,filter){var source=anomaly.source;var causes=[];var sourceCauses=source.causes||[];var singleCauseByFieldName=undefined;var singleCauseByFieldValue=undefined;if(sourceCauses.length===1){if(sourceCauses[0].by_field_name!==undefined){singleCauseByFieldName=sourceCauses[0].by_field_name;singleCauseByFieldValue=sourceCauses[0].by_field_value}}else{causes=sourceCauses.map(function(cause){var simplified=_lodash2.default.pick(cause,"typical","actual","probability");simplified.entityName=_lodash2.default.has(cause,"by_field_name")?cause.by_field_name:cause.over_field_name;simplified.entityValue=_lodash2.default.has(cause,"by_field_value")?cause.by_field_value:cause.over_field_value;return simplified})}var items=[];if(source.partition_field_value!==undefined){items.push({title:source.partition_field_name,description:getFilterEntity(source.partition_field_name,source.partition_field_value,filter)})}if(source.by_field_value!==undefined){items.push({title:source.by_field_name,description:getFilterEntity(source.by_field_name,source.by_field_value,filter)})}if(singleCauseByFieldName!==undefined){items.push({title:singleCauseByFieldName,description:getFilterEntity(singleCauseByFieldName,singleCauseByFieldValue,filter)})}if(source.over_field_value!==undefined){items.push({title:source.over_field_name,description:getFilterEntity(source.over_field_name,source.over_field_value,filter)})}var anomalyTime=source[TIME_FIELD_NAME];var timeDesc=""+(0,_date_utils.formatHumanReadableDateTimeSeconds)(anomalyTime);if(source.bucket_span!==undefined){var anomalyEndTime=anomalyTime+source.bucket_span*1e3;timeDesc+=" to "+(0,_date_utils.formatHumanReadableDateTimeSeconds)(anomalyEndTime)}items.push({title:"time",description:timeDesc});if(examples!==undefined&&examples.length>0){examples.forEach(function(example,index){var title=index===0?"category examples":"";items.push({title:title,description:example})})}items.push({title:"function",description:source.function!=="metric"?source.function:source.function_description});if(source.field_name!==undefined){items.push({title:"fieldName",description:source.field_name})}var functionDescription=source.function_description||"";if(anomaly.actual!==undefined&&(0,_anomaly_utils.showActualForFunction)(functionDescription)===true){items.push({title:"actual",description:(0,_format_value.formatValue)(anomaly.actual,source.function)})}if(anomaly.typical!==undefined&&(0,_anomaly_utils.showTypicalForFunction)(functionDescription)===true){items.push({title:"typical",description:(0,_format_value.formatValue)(anomaly.typical,source.function)})}items.push({title:"job ID",description:anomaly.jobId});if(source.multi_bucket_impact!==undefined&&source.multi_bucket_impact>=_multi_bucket_impact.MULTI_BUCKET_IMPACT.LOW){items.push({title:"multi-bucket impact",description:(0,_anomaly_utils.getMultiBucketImpactLabel)(source.multi_bucket_impact)})}items.push({title:"probability",description:source.probability});if(causes.length>1){causes.forEach(function(cause,index){var title=index===0?cause.entityName+" values":"";var description=cause.entityValue+" (actual "+(0,_format_value.formatValue)(cause.actual,source.function)+", ";description+="typical "+(0,_format_value.formatValue)(cause.typical,source.function)+", probability "+cause.probability+")";items.push({title:title,description:description})})}return items}var AnomalyDetails=exports.AnomalyDetails=function(_Component){_inherits(AnomalyDetails,_Component);function AnomalyDetails(props){_classCallCheck(this,AnomalyDetails);var _this=_possibleConstructorReturn(this,(AnomalyDetails.__proto__||Object.getPrototypeOf(AnomalyDetails)).call(this,props));_this.state={showAllInfluencers:false};return _this}_createClass(AnomalyDetails,[{key:"toggleAllInfluencers",value:function toggleAllInfluencers(){this.setState({showAllInfluencers:!this.state.showAllInfluencers})}},{key:"renderDescription",value:function renderDescription(){var anomaly=this.props.anomaly;var source=anomaly.source;var anomalyDescription=(0,_anomaly_utils.getSeverity)(anomaly.severity)+" anomaly in "+anomaly.detector;if(anomaly.entityName!==undefined){anomalyDescription+=" found for "+anomaly.entityName+" "+anomaly.entityValue}if(source.partition_field_name!==undefined&&source.partition_field_name!==anomaly.entityName){anomalyDescription+=" detected in "+source.partition_field_name;anomalyDescription+=" "+source.partition_field_value}var mvDescription=undefined;if(source.correlated_by_field_value!==undefined){mvDescription="multivariate correlations found in "+source.by_field_name+"; ";mvDescription+=source.by_field_value+" is considered anomalous given "+source.correlated_by_field_value}return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiText,{size:"xs"},_react2.default.createElement("h4",null,"Description"),anomalyDescription),mvDescription!==undefined&&_react2.default.createElement(_eui.EuiText,{size:"xs"},mvDescription))}},{key:"renderDetails",value:function renderDetails(){var detailItems=getDetailsItems(this.props.anomaly,this.props.examples,this.props.filter);var isInterimResult=_lodash2.default.get(this.props.anomaly,"source.is_interim",false);return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiText,{size:"xs"},this.props.isAggregatedData===true?_react2.default.createElement("h4",null,"Details on highest severity anomaly"):_react2.default.createElement("h4",null,"Anomaly details"),isInterimResult===true&&_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiIcon,{type:"alert"}),_react2.default.createElement("span",{className:"interim-result"},"Interim result"))),_react2.default.createElement(_eui.EuiDescriptionList,{type:"column",listItems:detailItems,className:"anomaly-description-list"}))}},{key:"renderInfluencers",value:function renderInfluencers(){var _this2=this;var anomalyInfluencers=this.props.anomaly.influencers;var listItems=[];var othersCount=0;var numToDisplay=0;if(anomalyInfluencers!==undefined){numToDisplay=this.state.showAllInfluencers===true?anomalyInfluencers.length:Math.min(this.props.influencersLimit,anomalyInfluencers.length);othersCount=Math.max(anomalyInfluencers.length-numToDisplay,0);if(othersCount===1){numToDisplay++;othersCount=0}var _loop=function _loop(i){Object.keys(anomalyInfluencers[i]).forEach(function(influencerFieldName){listItems.push({title:influencerFieldName,description:anomalyInfluencers[i][influencerFieldName]})})};for(var i=0;i<numToDisplay;i++){_loop(i)}}if(listItems.length>0){return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_eui.EuiText,{size:"xs"},_react2.default.createElement("h4",null,"Influencers")),_react2.default.createElement(_eui.EuiDescriptionList,{type:"column",listItems:listItems,className:"anomaly-description-list"}),othersCount>0&&_react2.default.createElement(_eui.EuiLink,{onClick:function onClick(){return _this2.toggleAllInfluencers()}},"and ",othersCount," more"),numToDisplay>this.props.influencersLimit+1&&_react2.default.createElement(_eui.EuiLink,{onClick:function onClick(){return _this2.toggleAllInfluencers()}},"show less"))}}},{key:"render",value:function render(){return _react2.default.createElement("div",{className:"ml-anomalies-table-details"},this.renderDescription(),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),this.renderDetails(),this.renderInfluencers())}}]);return AnomalyDetails}(_react.Component);AnomalyDetails.propTypes={anomaly:_propTypes2.default.object.isRequired,examples:_propTypes2.default.array,isAggregatedData:_propTypes2.default.bool,filter:_propTypes2.default.func,influencersLimit:_propTypes2.default.number}},2397:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.LinksMenu=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _risonNode=__webpack_require__(206);var _risonNode2=_interopRequireDefault(_risonNode);var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _notify=__webpack_require__(10);var _field_types=__webpack_require__(257);var _check_privilege=__webpack_require__(32);var _anomaly_utils=__webpack_require__(256);var _parse_interval=__webpack_require__(219);var _mapping_service=__webpack_require__(339);var _ml_api_service=__webpack_require__(22);var _job_service=__webpack_require__(23);var _custom_url_utils=__webpack_require__(405);var _index_utils=__webpack_require__(62);var _string_utils=__webpack_require__(38);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var LinksMenu=exports.LinksMenu=function(_Component){_inherits(LinksMenu,_Component);function LinksMenu(props){_classCallCheck(this,LinksMenu);var _this=_possibleConstructorReturn(this,(LinksMenu.__proto__||Object.getPrototypeOf(LinksMenu)).call(this,props));_this.openCustomUrl=function(customUrl){var _this$props=_this.props,anomaly=_this$props.anomaly,interval=_this$props.interval,isAggregatedData=_this$props.isAggregatedData;console.log("Anomalies Table - open customUrl for record:",anomaly);var record=_lodash2.default.cloneDeep(anomaly.source);var timestamp=record.timestamp;var configuredUrlValue=customUrl.url_value;var timeRangeInterval=(0,_parse_interval.parseInterval)(customUrl.time_range);if(configuredUrlValue.includes("$earliest$")){var earliestMoment=(0,_moment2.default)(timestamp);if(timeRangeInterval!==null){earliestMoment.subtract(timeRangeInterval)}else{earliestMoment=(0,_moment2.default)(timestamp).startOf(interval);if(interval==="hour"){earliestMoment.subtract(1,"h")}}record.earliest=earliestMoment.toISOString()}if(configuredUrlValue.includes("$latest$")){var latestMoment=(0,_moment2.default)(timestamp).add(record.bucket_span,"s");if(timeRangeInterval!==null){latestMoment.add(timeRangeInterval)}else{if(isAggregatedData===true){latestMoment=(0,_moment2.default)(timestamp).endOf(interval);if(interval==="hour"){latestMoment.add(1,"h")}}}record.latest=latestMoment.toISOString()}if((configuredUrlValue.includes("$mlcategoryterms$")||configuredUrlValue.includes("$mlcategoryregex$"))&&_lodash2.default.has(record,"mlcategory")){var jobId=record.job_id;var categoryId=record.mlcategory[0];_ml_api_service.ml.results.getCategoryDefinition(jobId,categoryId).then(function(resp){var termsArray=resp.terms.split(" ").map(function(term){return"+"+term});record.mlcategoryterms=termsArray.join(" ");record.mlcategoryregex=resp.regex;var urlPath=(0,_string_utils.replaceStringTokens)(customUrl.url_value,record,true);window.open(urlPath,"_blank")}).catch(function(resp){console.log("openCustomUrl(): error loading categoryDefinition:",resp);_notify.toastNotifications.addDanger("Unable to open link as an error occurred loading details on category ID "+categoryId)})}else{var urlPath=(0,_custom_url_utils.getUrlForRecord)(customUrl,record);window.open(urlPath,"_blank")}};_this.viewSeries=function(){var record=_this.props.anomaly.source;var bounds=_this.props.timefilter.getActiveBounds();var from=bounds.min.toISOString();var to=bounds.max.toISOString();var recordTime=(0,_moment2.default)(record.timestamp);var zoomFrom=recordTime.subtract(50*record.bucket_span,"s").toISOString();var zoomTo=recordTime.add(100*record.bucket_span,"s").toISOString();var entityCondition={};if(_lodash2.default.has(record,"partition_field_value")){entityCondition[record.partition_field_name]=record.partition_field_value}if(_lodash2.default.has(record,"over_field_value")){entityCondition[record.over_field_name]=record.over_field_value}if(_lodash2.default.has(record,"by_field_value")){entityCondition[record.by_field_name]=record.by_field_value}var _g=_risonNode2.default.encode({ml:{jobIds:[record.job_id]},refreshInterval:{display:"Off",pause:false,value:0},time:{from:from,to:to,mode:"absolute"}});var _a=_risonNode2.default.encode({mlTimeSeriesExplorer:{zoom:{from:zoomFrom,to:zoomTo},detectorIndex:record.detector_index,entities:entityCondition},filters:[],query:{query_string:{analyze_wildcard:true,query:"*"}}});var path=_chrome2.default.getBasePath()+"/app/ml#/timeseriesexplorer";path+="?_g="+_g+"&_a="+encodeURIComponent(_a);window.open(path,"_blank")};_this.viewExamples=function(){var categoryId=_this.props.anomaly.entityValue;var record=_this.props.anomaly.source;var indexPatterns=(0,_index_utils.getIndexPatterns)();var job=_job_service.mlJobService.getJob(_this.props.anomaly.jobId);if(job===undefined){console.log("viewExamples(): no job found with ID: "+_this.props.anomaly.jobId);_notify.toastNotifications.addDanger("Unable to view examples as no details could be found for job ID "+_this.props.anomaly.jobId);return}var categorizationFieldName=job.analysis_config.categorization_field_name;var datafeedIndices=job.datafeed_config.indices;var i=0;findFieldType(datafeedIndices[i]);function findFieldType(index){(0,_mapping_service.getFieldTypeFromMapping)(index,categorizationFieldName).then(function(resp){if(resp!==""){createAndOpenUrl(index,resp)}else{i++;if(i<datafeedIndices.length){findFieldType(datafeedIndices[i])}else{error()}}}).catch(function(){error()})}function createAndOpenUrl(index,categorizationFieldType){var indexPatternId=index;for(var j=0;j<indexPatterns.length;j++){if(indexPatterns[j].get("title")===index){indexPatternId=indexPatterns[j].id;break}}_ml_api_service.ml.results.getCategoryDefinition(record.job_id,categoryId).then(function(resp){var query=null;if(categorizationFieldType===_field_types.ES_FIELD_TYPES.KEYWORD){if(resp.regex){query=categorizationFieldName+":/"+resp.regex+"/"}}else{if(resp.terms){query=categorizationFieldName+":"+resp.terms.split(" ").join(" AND "+categorizationFieldName+":")}}var recordTime=(0,_moment2.default)(record.timestamp);var from=recordTime.toISOString();var to=recordTime.add(record.bucket_span,"s").toISOString();var _g=_risonNode2.default.encode({refreshInterval:{display:"Off",pause:false,value:0},time:{from:from,to:to,mode:"absolute"}});var appStateProps={index:indexPatternId,filters:[]};if(query!==null){appStateProps.query={query_string:{analyze_wildcard:true,query:query}}}var _a=_risonNode2.default.encode(appStateProps);var path=_chrome2.default.getBasePath();path+="/app/kibana#/discover";path+="?_g="+_g;path+="&_a="+encodeURIComponent(_a);window.open(path,"_blank")}).catch(function(resp){console.log("viewExamples(): error loading categoryDefinition:",resp);_notify.toastNotifications.addDanger("Unable to view examples as an error occurred loading details on category ID "+categoryId)})}function error(){console.log("viewExamples(): error finding type of field "+categorizationFieldName+" in indices:",datafeedIndices);_notify.toastNotifications.addDanger("Unable to view examples of documents with mlcategory "+categoryId+" "+("as no mapping could be found for the categorization field "+categorizationFieldName))}};_this.onButtonClick=function(){_this.setState(function(prevState){return{isPopoverOpen:!prevState.isPopoverOpen}})};_this.closePopover=function(){_this.setState({isPopoverOpen:false})};_this.state={isPopoverOpen:false,toasts:[]};return _this}_createClass(LinksMenu,[{key:"render",value:function render(){var _this2=this;var _props=this.props,anomaly=_props.anomaly,showViewSeriesLink=_props.showViewSeriesLink;var canConfigureRules=(0,_anomaly_utils.isRuleSupported)(anomaly.source)&&(0,_check_privilege.checkPermission)("canUpdateJob");var button=_react2.default.createElement(_eui.EuiButtonIcon,{size:"s",color:"text",onClick:this.onButtonClick,iconType:"gear","aria-label":"Select action"});var items=[];if(anomaly.customUrls!==undefined){anomaly.customUrls.forEach(function(customUrl,index){items.push(_react2.default.createElement(_eui.EuiContextMenuItem,{key:"custom_url_"+index,icon:"popout",onClick:function onClick(){_this2.closePopover();_this2.openCustomUrl(customUrl)}},customUrl.url_name))})}if(showViewSeriesLink===true&&anomaly.isTimeSeriesViewDetector===true){items.push(_react2.default.createElement(_eui.EuiContextMenuItem,{key:"view_series",icon:"popout",onClick:function onClick(){_this2.closePopover();_this2.viewSeries()}},"View series"))}if(anomaly.entityName==="mlcategory"){items.push(_react2.default.createElement(_eui.EuiContextMenuItem,{key:"view_examples",icon:"popout",onClick:function onClick(){_this2.closePopover();_this2.viewExamples()}},"View examples"))}if(canConfigureRules){items.push(_react2.default.createElement(_eui.EuiContextMenuItem,{key:"create_rule",icon:"controlsHorizontal",onClick:function onClick(){_this2.closePopover();_this2.props.showRuleEditorFlyout(anomaly)}},"Configure rules"))}return _react2.default.createElement(_eui.EuiPopover,{id:"singlePanel",button:button,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover,panelPaddingSize:"none",anchorPosition:"downLeft"},_react2.default.createElement(_eui.EuiContextMenuPanel,{items:items}))}}]);return LinksMenu}(_react.Component);LinksMenu.propTypes={anomaly:_propTypes2.default.object.isRequired,showViewSeriesLink:_propTypes2.default.bool,isAggregatedData:_propTypes2.default.bool,interval:_propTypes2.default.string,timefilter:_propTypes2.default.object.isRequired,showRuleEditorFlyout:_propTypes2.default.func}},2398:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _rule_editor_flyout=__webpack_require__(2399);Object.defineProperty(exports,"RuleEditorFlyout",{enumerable:true,get:function get(){return _rule_editor_flyout.RuleEditorFlyout}})},2399:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.RuleEditorFlyout=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _notify=__webpack_require__(10);var _detector_description_list=__webpack_require__(1011);var _actions_section=__webpack_require__(2401);var _check_privilege=__webpack_require__(32);var _conditions_section=__webpack_require__(2402);var _scope_section=__webpack_require__(2404);var _select_rule_action=__webpack_require__(2406);var _utils=__webpack_require__(340);var _detector_rule=__webpack_require__(298);var _job_utils=__webpack_require__(34);var _job_service=__webpack_require__(23);var _ml_api_service=__webpack_require__(22);var _metadata=__webpack_require__(190);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var docsUrl="https://www.elastic.co/guide/en/elastic-stack-overview/"+_metadata.metadata.branch+"/ml-rules.html";var RuleEditorFlyout=exports.RuleEditorFlyout=function(_Component){_inherits(RuleEditorFlyout,_Component);function RuleEditorFlyout(props){_classCallCheck(this,RuleEditorFlyout);var _this=_possibleConstructorReturn(this,(RuleEditorFlyout.__proto__||Object.getPrototypeOf(RuleEditorFlyout)).call(this,props));_this.showFlyout=function(anomaly){var ruleIndex=-1;var job=_job_service.mlJobService.getJob(anomaly.jobId);if(job===undefined){_notify.toastNotifications.addDanger("Unable to configure rules as an error occurred obtaining details for job ID "+anomaly.jobId);_this.setState({job:job,isFlyoutVisible:false});return}_this.partitioningFieldNames=(0,_job_utils.getPartitioningFieldNames)(job,anomaly.detectorIndex);var detectorIndex=anomaly.detectorIndex;var detector=job.analysis_config.detectors[detectorIndex];if(detector.custom_rules===undefined){ruleIndex=0}var isConditionsEnabled=false;if(ruleIndex===0){isConditionsEnabled=_this.partitioningFieldNames.length===0}_this.setState({anomaly:anomaly,job:job,ruleIndex:ruleIndex,isConditionsEnabled:isConditionsEnabled,isScopeEnabled:false,isFlyoutVisible:true});if(_this.partitioningFieldNames.length>0&&_this.canGetFilters){_ml_api_service.ml.filters.filters().then(function(filters){var filterListIds=filters.map(function(filter){return filter.filter_id});_this.setState({filterListIds:filterListIds})}).catch(function(resp){console.log("Error loading list of filters:",resp);_notify.toastNotifications.addDanger("Error loading the filter lists used in the rule scope")})}};_this.closeFlyout=function(){_this.setState({isFlyoutVisible:false})};_this.setEditRuleIndex=function(ruleIndex){var detectorIndex=_this.state.anomaly.detectorIndex;var detector=_this.state.job.analysis_config.detectors[detectorIndex];var rules=detector.custom_rules;var rule=rules===undefined||ruleIndex>=rules.length?(0,_utils.getNewRuleDefaults)():rules[ruleIndex];var isConditionsEnabled=_this.partitioningFieldNames.length===0||rule.conditions!==undefined&&rule.conditions.length>0;var isScopeEnabled=rule.scope!==undefined&&Object.keys(rule.scope).length>0;if(isScopeEnabled===true){Object.keys(rule.scope).forEach(function(field){rule.scope[field].enabled=true})}_this.setState({ruleIndex:ruleIndex,rule:rule,isConditionsEnabled:isConditionsEnabled,isScopeEnabled:isScopeEnabled})};_this.onSkipResultChange=function(e){var checked=e.target.checked;_this.setState(function(prevState){var actions=[].concat(_toConsumableArray(prevState.rule.actions));var idx=actions.indexOf(_detector_rule.ACTION.SKIP_RESULT);if(idx===-1&&checked){actions.push(_detector_rule.ACTION.SKIP_RESULT)}else if(idx>-1&&!checked){actions.splice(idx,1)}return{rule:_extends({},prevState.rule,{actions:actions})}})};_this.onSkipModelUpdateChange=function(e){var checked=e.target.checked;_this.setState(function(prevState){var actions=[].concat(_toConsumableArray(prevState.rule.actions));var idx=actions.indexOf(_detector_rule.ACTION.SKIP_MODEL_UPDATE);if(idx===-1&&checked){actions.push(_detector_rule.ACTION.SKIP_MODEL_UPDATE)}else if(idx>-1&&!checked){actions.splice(idx,1)}return{rule:_extends({},prevState.rule,{actions:actions})}})};_this.onConditionsEnabledChange=function(e){var isConditionsEnabled=e.target.checked;_this.setState(function(prevState){var conditions=void 0;if(isConditionsEnabled===false){conditions=[]}else{conditions=[(0,_utils.getNewConditionDefaults)()]}return{rule:_extends({},prevState.rule,{conditions:conditions}),isConditionsEnabled:isConditionsEnabled}})};_this.addCondition=function(){_this.setState(function(prevState){var conditions=[].concat(_toConsumableArray(prevState.rule.conditions));conditions.push((0,_utils.getNewConditionDefaults)());return{rule:_extends({},prevState.rule,{conditions:conditions})}})};_this.updateCondition=function(index,appliesTo,operator,value){_this.setState(function(prevState){var conditions=[].concat(_toConsumableArray(prevState.rule.conditions));if(index<conditions.length){conditions[index]={applies_to:appliesTo,operator:operator,value:value}}return{rule:_extends({},prevState.rule,{conditions:conditions})}})};_this.deleteCondition=function(index){_this.setState(function(prevState){var conditions=[].concat(_toConsumableArray(prevState.rule.conditions));if(index<conditions.length){conditions.splice(index,1)}return{rule:_extends({},prevState.rule,{conditions:conditions})}})};_this.onScopeEnabledChange=function(e){var isScopeEnabled=e.target.checked;_this.setState(function(prevState){var rule=_extends({},prevState.rule);if(isScopeEnabled===false){delete rule.scope}return{rule:rule,isScopeEnabled:isScopeEnabled}})};_this.updateScope=function(fieldName,filterId,filterType,enabled){_this.setState(function(prevState){var scope=_extends({},prevState.rule.scope);if(scope===undefined){scope={}}scope[fieldName]={filter_id:filterId,filter_type:filterType,enabled:enabled};return{rule:_extends({},prevState.rule,{scope:scope})}})};_this.saveEdit=function(){var _this$state=_this.state,rule=_this$state.rule,ruleIndex=_this$state.ruleIndex;_this.updateRuleAtIndex(ruleIndex,rule)};_this.updateRuleAtIndex=function(ruleIndex,editedRule){var _this$state2=_this.state,job=_this$state2.job,anomaly=_this$state2.anomaly;var jobId=job.job_id;var detectorIndex=anomaly.detectorIndex;(0,_utils.saveJobRule)(job,detectorIndex,ruleIndex,editedRule).then(function(resp){if(resp.success){_notify.toastNotifications.add({title:"Changes to "+jobId+" detector rules saved",color:"success",iconType:"check",text:"Note that changes will take effect for new results only."});_this.closeFlyout()}else{_notify.toastNotifications.addDanger("Error saving changes to "+jobId+" detector rules")}}).catch(function(error){console.error(error);_notify.toastNotifications.addDanger("Error saving changes to "+jobId+" detector rules")})};_this.deleteRuleAtIndex=function(index){var _this$state3=_this.state,job=_this$state3.job,anomaly=_this$state3.anomaly;var jobId=job.job_id;var detectorIndex=anomaly.detectorIndex;(0,_utils.deleteJobRule)(job,detectorIndex,index).then(function(resp){if(resp.success){_notify.toastNotifications.addSuccess("Rule deleted from "+jobId+" detector");_this.closeFlyout()}else{_notify.toastNotifications.addDanger("Error deleting rule from "+jobId+" detector")}}).catch(function(error){console.error(error);var errorMessage="Error deleting rule from "+jobId+" detector";if(error.message){errorMessage+=" : "+error.message}_notify.toastNotifications.addDanger(errorMessage)})};_this.addItemToFilterList=function(item,filterId,closeFlyoutOnAdd){(0,_utils.addItemToFilter)(item,filterId).then(function(){if(closeFlyoutOnAdd===true){_notify.toastNotifications.add({title:"Added "+item+" to "+filterId,color:"success",iconType:"check",text:"Note that changes will take effect for new results only."});_this.closeFlyout()}}).catch(function(error){console.log("Error adding "+item+" to filter "+filterId+":",error);_notify.toastNotifications.addDanger("An error occurred adding "+item+" to filter "+filterId)})};_this.state={anomaly:{},job:{},ruleIndex:-1,rule:(0,_utils.getNewRuleDefaults)(),skipModelUpdate:false,isConditionsEnabled:false,isScopeEnabled:false,filterListIds:[],isFlyoutVisible:false};_this.partitioningFieldNames=[];_this.canGetFilters=(0,_check_privilege.checkPermission)("canGetFilters");return _this}_createClass(RuleEditorFlyout,[{key:"componentDidMount",value:function componentDidMount(){if(typeof this.props.setShowFunction==="function"){this.props.setShowFunction(this.showFlyout)}}},{key:"componentWillUnmount",value:function componentWillUnmount(){if(typeof this.props.unsetShowFunction==="function"){this.props.unsetShowFunction()}}},{key:"render",value:function render(){var _state=this.state,isFlyoutVisible=_state.isFlyoutVisible,job=_state.job,anomaly=_state.anomaly,ruleIndex=_state.ruleIndex,rule=_state.rule,filterListIds=_state.filterListIds,isConditionsEnabled=_state.isConditionsEnabled,isScopeEnabled=_state.isScopeEnabled;if(isFlyoutVisible===false){return null}var flyout=void 0;if(ruleIndex===-1){flyout=_react2.default.createElement(_eui.EuiFlyout,{className:"ml-rule-editor-flyout",onClose:this.closeFlyout,"aria-labelledby":"flyoutTitle"},_react2.default.createElement(_eui.EuiFlyoutHeader,{hasBorder:true},_react2.default.createElement(_eui.EuiTitle,{size:"l"},_react2.default.createElement("h1",{id:"flyoutTitle"},"Edit Rules"))),_react2.default.createElement(_eui.EuiFlyoutBody,null,_react2.default.createElement(_select_rule_action.SelectRuleAction,{job:job,anomaly:anomaly,setEditRuleIndex:this.setEditRuleIndex,updateRuleAtIndex:this.updateRuleAtIndex,deleteRuleAtIndex:this.deleteRuleAtIndex,addItemToFilterList:this.addItemToFilterList})),_react2.default.createElement(_eui.EuiFlyoutFooter,null,_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceBetween"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonEmpty,{iconType:"cross",onClick:this.closeFlyout,flush:"left"},"Close")))))}else{var detectorIndex=anomaly.detectorIndex;var detector=job.analysis_config.detectors[detectorIndex];var rules=detector.custom_rules;var isCreate=rules===undefined||ruleIndex>=rules.length;var hasPartitioningFields=this.partitioningFieldNames&&this.partitioningFieldNames.length>0;var conditionSupported=_detector_rule.CONDITIONS_NOT_SUPPORTED_FUNCTIONS.indexOf(anomaly.source.function)===-1;var conditionsText="Add numeric conditions for when the rule applies. "+"Multiple conditions are combined using AND.";flyout=_react2.default.createElement(_eui.EuiFlyout,{className:"ml-rule-editor-flyout",onClose:this.closeFlyout,"aria-labelledby":"flyoutTitle"},_react2.default.createElement(_eui.EuiFlyoutHeader,{hasBorder:true},_react2.default.createElement(_eui.EuiTitle,{size:"l"},_react2.default.createElement("h1",{id:"flyoutTitle"},isCreate===true?"Create Rule":"Edit Rule"))),_react2.default.createElement(_eui.EuiFlyoutBody,null,_react2.default.createElement(_detector_description_list.DetectorDescriptionList,{job:job,detector:detector,anomaly:anomaly}),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("p",null,"Rules instruct anomaly detectors to change their behavior based on domain-specific knowledge that you provide. When you create a rule, you can specify conditions, scope, and actions. When the conditions of a rule are satisfied, its actions are triggered. ",_react2.default.createElement(_eui.EuiLink,{href:docsUrl,target:"_blank"},"Learn more"))),_react2.default.createElement(_eui.EuiSpacer,null),_react2.default.createElement(_eui.EuiTitle,null,_react2.default.createElement("h2",null,"Action")),_react2.default.createElement(_actions_section.ActionsSection,{actions:rule.actions,onSkipResultChange:this.onSkipResultChange,onSkipModelUpdateChange:this.onSkipModelUpdateChange}),_react2.default.createElement(_eui.EuiSpacer,{size:"xl"}),_react2.default.createElement(_eui.EuiTitle,null,_react2.default.createElement("h2",null,"Conditions")),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),conditionSupported===true?_react2.default.createElement(_eui.EuiCheckbox,{id:"enable_conditions_checkbox",className:"scope-enable-checkbox",label:conditionsText,checked:isConditionsEnabled,onChange:this.onConditionsEnabledChange,disabled:!conditionSupported||!hasPartitioningFields}):_react2.default.createElement(_eui.EuiCallOut,{title:"Conditions are not supported for detectors using the "+anomaly.source.function+" function",iconType:"iInCircle"}),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_conditions_section.ConditionsSection,{isEnabled:isConditionsEnabled,conditions:rule.conditions,addCondition:this.addCondition,updateCondition:this.updateCondition,deleteCondition:this.deleteCondition}),_react2.default.createElement(_eui.EuiSpacer,{size:"xl"}),_react2.default.createElement(_scope_section.ScopeSection,{isEnabled:isScopeEnabled,onEnabledChange:this.onScopeEnabledChange,partitioningFieldNames:this.partitioningFieldNames,filterListIds:filterListIds,scope:rule.scope,updateScope:this.updateScope}),_react2.default.createElement(_eui.EuiCallOut,{title:"Rerun job",color:"warning",iconType:"help"},_react2.default.createElement("p",null,"Changes to rules take effect for new results only."),_react2.default.createElement("p",null,"To apply these changes to existing results you must clone and rerun the job. Note rerunning the job may take some time and should only be done once you have completed all your changes to the rules for this job."))),_react2.default.createElement(_eui.EuiFlyoutFooter,null,_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceBetween"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonEmpty,{iconType:"cross",onClick:this.closeFlyout,flush:"left"},"Close")),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButton,{onClick:this.saveEdit,isDisabled:!(0,_utils.isValidRule)(rule),fill:true},"Save")))))}return _react2.default.createElement(_react2.default.Fragment,null,flyout)}}]);return RuleEditorFlyout}(_react.Component);RuleEditorFlyout.propTypes={setShowFunction:_propTypes2.default.func.isRequired,unsetShowFunction:_propTypes2.default.func.isRequired}},2400:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DetectorDescriptionList=DetectorDescriptionList;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _format_value=__webpack_require__(299);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function DetectorDescriptionList(_ref){var job=_ref.job,detector=_ref.detector,anomaly=_ref.anomaly;var listItems=[{title:"Job ID",description:job.job_id},{title:"Detector",description:detector.detector_description}];if(anomaly.actual!==undefined){var actual=(0,_format_value.formatValue)(anomaly.actual,anomaly.source.function);var typical=(0,_format_value.formatValue)(anomaly.typical,anomaly.source.function);listItems.push({title:"Selected anomaly",description:"actual "+actual+", typical "+typical})}return _react2.default.createElement(_eui.EuiDescriptionList,{className:"rule-detector-description-list",type:"column",listItems:listItems})}DetectorDescriptionList.propTypes={job:_propTypes2.default.object.isRequired,detector:_propTypes2.default.object.isRequired,anomaly:_propTypes2.default.object.isRequired}},2401:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ActionsSection=ActionsSection;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _detector_rule=__webpack_require__(298);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ActionsSection(_ref){var actions=_ref.actions,onSkipResultChange=_ref.onSkipResultChange,onSkipModelUpdateChange=_ref.onSkipModelUpdateChange;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("p",null,"Choose the action(s) to take when the rule matches an anomaly.")),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:false},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiCheckbox,{id:"skip_result_cb",label:"Skip result (recommended)",checked:actions.indexOf(_detector_rule.ACTION.SKIP_RESULT)>-1,onChange:onSkipResultChange})),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiIconTip,{content:"The result will not be created.",size:"s",position:"right"}))),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:false},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiCheckbox,{id:"skip_model_update_cb",label:"Skip model update",checked:actions.indexOf(_detector_rule.ACTION.SKIP_MODEL_UPDATE)>-1,onChange:onSkipModelUpdateChange})),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiIconTip,{content:"The value for that series will not be used to update the model.",size:"s",position:"right"}))))}ActionsSection.propTypes={actions:_propTypes2.default.array.isRequired,onSkipResultChange:_propTypes2.default.func.isRequired,onSkipModelUpdateChange:_propTypes2.default.func.isRequired}},2402:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ConditionsSection=ConditionsSection;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _condition_expression=__webpack_require__(2403);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ConditionsSection(_ref){var isEnabled=_ref.isEnabled,conditions=_ref.conditions,addCondition=_ref.addCondition,updateCondition=_ref.updateCondition,deleteCondition=_ref.deleteCondition;if(isEnabled===false){return null}var expressions=[];if(conditions!==undefined){expressions=conditions.map(function(condition,index){return _react2.default.createElement(_condition_expression.ConditionExpression,{key:index,index:index,appliesTo:condition.applies_to,operator:condition.operator,value:condition.value,updateCondition:updateCondition,deleteCondition:deleteCondition})})}return _react2.default.createElement(_react2.default.Fragment,null,expressions,_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_eui.EuiButtonEmpty,{onClick:function onClick(){return addCondition()}},"Add new condition"))}ConditionsSection.propTypes={isEnabled:_propTypes2.default.bool.isRequired,conditions:_propTypes2.default.array,addCondition:_propTypes2.default.func.isRequired,updateCondition:_propTypes2.default.func.isRequired,deleteCondition:_propTypes2.default.func.isRequired}},2403:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ConditionExpression=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _detector_rule=__webpack_require__(298);var _utils=__webpack_require__(340);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var POPOVER_STYLE={zIndex:"200"};var ConditionExpression=exports.ConditionExpression=function(_Component){_inherits(ConditionExpression,_Component);function ConditionExpression(props){_classCallCheck(this,ConditionExpression);var _this=_possibleConstructorReturn(this,(ConditionExpression.__proto__||Object.getPrototypeOf(ConditionExpression)).call(this,props));_this.openAppliesTo=function(){_this.setState({isAppliesToOpen:true,isOperatorValueOpen:false})};_this.closeAppliesTo=function(){_this.setState({isAppliesToOpen:false})};_this.openOperatorValue=function(){_this.setState({isAppliesToOpen:false,isOperatorValueOpen:true})};_this.closeOperatorValue=function(){_this.setState({isOperatorValueOpen:false})};_this.changeAppliesTo=function(event){var _this$props=_this.props,index=_this$props.index,operator=_this$props.operator,value=_this$props.value,updateCondition=_this$props.updateCondition;updateCondition(index,event.target.value,operator,value)};_this.changeOperator=function(event){var _this$props2=_this.props,index=_this$props2.index,appliesTo=_this$props2.appliesTo,value=_this$props2.value,updateCondition=_this$props2.updateCondition;updateCondition(index,appliesTo,event.target.value,value)};_this.changeValue=function(event){var _this$props3=_this.props,index=_this$props3.index,appliesTo=_this$props3.appliesTo,operator=_this$props3.operator,updateCondition=_this$props3.updateCondition;updateCondition(index,appliesTo,operator,+event.target.value)};_this.state={isAppliesToOpen:false,isOperatorValueOpen:false};return _this}_createClass(ConditionExpression,[{key:"renderAppliesToPopover",value:function renderAppliesToPopover(){return _react2.default.createElement("div",{style:POPOVER_STYLE},_react2.default.createElement(_eui.EuiPopoverTitle,null,"When"),_react2.default.createElement(_eui.EuiExpression,{style:{width:200}},_react2.default.createElement(_eui.EuiSelect,{value:this.props.appliesTo,onChange:this.changeAppliesTo,options:[{value:_detector_rule.APPLIES_TO.ACTUAL,text:(0,_utils.appliesToText)(_detector_rule.APPLIES_TO.ACTUAL)},{value:_detector_rule.APPLIES_TO.TYPICAL,text:(0,_utils.appliesToText)(_detector_rule.APPLIES_TO.TYPICAL)},{value:_detector_rule.APPLIES_TO.DIFF_FROM_TYPICAL,text:(0,_utils.appliesToText)(_detector_rule.APPLIES_TO.DIFF_FROM_TYPICAL)}]})))}},{key:"renderOperatorValuePopover",value:function renderOperatorValuePopover(){return _react2.default.createElement("div",{style:POPOVER_STYLE},_react2.default.createElement(_eui.EuiPopoverTitle,null,"Is"),_react2.default.createElement(_eui.EuiExpression,null,_react2.default.createElement(_eui.EuiFlexGroup,{style:{maxWidth:450}},_react2.default.createElement(_eui.EuiFlexItem,{grow:false,style:{width:250}},_react2.default.createElement(_eui.EuiSelect,{value:this.props.operator,onChange:this.changeOperator,options:[{value:_detector_rule.OPERATOR.LESS_THAN,text:(0,_utils.operatorToText)(_detector_rule.OPERATOR.LESS_THAN)},{value:_detector_rule.OPERATOR.LESS_THAN_OR_EQUAL,text:(0,_utils.operatorToText)(_detector_rule.OPERATOR.LESS_THAN_OR_EQUAL)},{value:_detector_rule.OPERATOR.GREATER_THAN,text:(0,_utils.operatorToText)(_detector_rule.OPERATOR.GREATER_THAN)},{value:_detector_rule.OPERATOR.GREATER_THAN_OR_EQUAL,text:(0,_utils.operatorToText)(_detector_rule.OPERATOR.GREATER_THAN_OR_EQUAL)}]})),_react2.default.createElement(_eui.EuiFlexItem,{grow:false,style:{width:200}},_react2.default.createElement(_eui.EuiFieldNumber,{value:+this.props.value,onChange:this.changeValue})))))}},{key:"render",value:function render(){var _props=this.props,index=_props.index,appliesTo=_props.appliesTo,operator=_props.operator,value=_props.value,deleteCondition=_props.deleteCondition;return _react2.default.createElement(_eui.EuiFlexGroup,{gutterSize:"m"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiPopover,{id:"appliesToPopover",button:_react2.default.createElement(_eui.EuiExpressionButton,{description:"when",buttonValue:(0,_utils.appliesToText)(appliesTo),isActive:this.state.isAppliesToOpen,onClick:this.openAppliesTo}),isOpen:this.state.isAppliesToOpen,closePopover:this.closeAppliesTo,panelPaddingSize:"none",ownFocus:true,withTitle:true,anchorPosition:"downLeft"},this.renderAppliesToPopover())),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiPopover,{id:"operatorValuePopover",button:_react2.default.createElement(_eui.EuiExpressionButton,{description:"is "+(0,_utils.operatorToText)(operator),buttonValue:""+value,isActive:this.state.isOperatorValueOpen,onClick:this.openOperatorValue}),isOpen:this.state.isOperatorValueOpen,closePopover:this.closeOperatorValue,panelPaddingSize:"none",ownFocus:true,withTitle:true,anchorPosition:"downLeft"},this.renderOperatorValuePopover())),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonIcon,{size:"s",color:"danger",onClick:function onClick(){return deleteCondition(index)},iconType:"trash","aria-label":"Next"})))}}]);return ConditionExpression}(_react.Component);ConditionExpression.propTypes={index:_propTypes2.default.number.isRequired,appliesTo:_propTypes2.default.oneOf([_detector_rule.APPLIES_TO.ACTUAL,_detector_rule.APPLIES_TO.TYPICAL,_detector_rule.APPLIES_TO.DIFF_FROM_TYPICAL]),operator:_propTypes2.default.oneOf([_detector_rule.OPERATOR.LESS_THAN,_detector_rule.OPERATOR.LESS_THAN_OR_EQUAL,_detector_rule.OPERATOR.GREATER_THAN,_detector_rule.OPERATOR.GREATER_THAN_OR_EQUAL]),value:_propTypes2.default.number.isRequired,updateCondition:_propTypes2.default.func.isRequired,deleteCondition:_propTypes2.default.func.isRequired}},2404:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ScopeSection=ScopeSection;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _scope_expression=__webpack_require__(2405);var _check_privilege=__webpack_require__(32);var _utils=__webpack_require__(340);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function NoFilterListsCallOut(){return _react2.default.createElement(_eui.EuiCallOut,{title:"No filter lists configured",iconType:"gear"},_react2.default.createElement("p",null,"To configure scope, you must first use the ",_react2.default.createElement(_eui.EuiLink,{href:"#/settings/filter_lists"},"Filter Lists")," settings page to create the list of values you want to include or exclude in the rule."))}function NoPermissionCallOut(){return _react2.default.createElement(_eui.EuiCallOut,{title:"You do not have permission to view filter lists",iconType:"gear"})}function ScopeSection(_ref){var isEnabled=_ref.isEnabled,onEnabledChange=_ref.onEnabledChange,partitioningFieldNames=_ref.partitioningFieldNames,filterListIds=_ref.filterListIds,scope=_ref.scope,updateScope=_ref.updateScope;var canGetFilters=(0,_check_privilege.checkPermission)("canGetFilters");if(partitioningFieldNames===null||partitioningFieldNames.length===0){return null}var content=void 0;if(filterListIds.length>0){content=partitioningFieldNames.map(function(fieldName,index){var filterValues=void 0;if(scope!==undefined&&scope[fieldName]!==undefined){filterValues=scope[fieldName]}else{filterValues=(0,_utils.getScopeFieldDefaults)(filterListIds)}return _react2.default.createElement(_scope_expression.ScopeExpression,{key:index,fieldName:fieldName,filterId:filterValues.filter_id,filterType:filterValues.filter_type,enabled:filterValues.enabled,filterListIds:filterListIds,updateScope:updateScope})})}else if(canGetFilters===false){content=_react2.default.createElement(NoPermissionCallOut,null)}else{content=_react2.default.createElement(NoFilterListsCallOut,null)}return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiTitle,null,_react2.default.createElement("h2",null,"Scope")),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_eui.EuiCheckbox,{id:"enable_scope_checkbox",label:"Add a filter list to limit where the rule applies.",checked:isEnabled,onChange:onEnabledChange}),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),isEnabled&&_react2.default.createElement(_react2.default.Fragment,null,content),_react2.default.createElement(_eui.EuiSpacer,{size:"xxl"}))}ScopeSection.propTypes={isEnabled:_propTypes2.default.bool.isRequired,onEnabledChange:_propTypes2.default.func.isRequired,partitioningFieldNames:_propTypes2.default.array.isRequired,filterListIds:_propTypes2.default.array.isRequired,scope:_propTypes2.default.object,updateScope:_propTypes2.default.func.isRequired}},2405:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ScopeExpression=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _detector_rule=__webpack_require__(298);var _utils=__webpack_require__(340);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var POPOVER_STYLE={zIndex:"200"};function getFilterListOptions(filterListIds){return filterListIds.map(function(filterId){return{value:filterId,text:filterId}})}var ScopeExpression=exports.ScopeExpression=function(_Component){_inherits(ScopeExpression,_Component);function ScopeExpression(props){_classCallCheck(this,ScopeExpression);var _this=_possibleConstructorReturn(this,(ScopeExpression.__proto__||Object.getPrototypeOf(ScopeExpression)).call(this,props));_this.openFilterList=function(){_this.setState({isFilterListOpen:true})};_this.closeFilterList=function(){_this.setState({isFilterListOpen:false})};_this.onChangeFilterType=function(event){var _this$props=_this.props,fieldName=_this$props.fieldName,filterId=_this$props.filterId,enabled=_this$props.enabled,updateScope=_this$props.updateScope;updateScope(fieldName,filterId,event.target.value,enabled)};_this.onChangeFilterId=function(event){var _this$props2=_this.props,fieldName=_this$props2.fieldName,filterType=_this$props2.filterType,enabled=_this$props2.enabled,updateScope=_this$props2.updateScope;updateScope(fieldName,event.target.value,filterType,enabled)};_this.onEnableChange=function(event){var _this$props3=_this.props,fieldName=_this$props3.fieldName,filterId=_this$props3.filterId,filterType=_this$props3.filterType,updateScope=_this$props3.updateScope;updateScope(fieldName,filterId,filterType,event.target.checked)};_this.state={isFilterListOpen:false};return _this}_createClass(ScopeExpression,[{key:"renderFilterListPopover",value:function renderFilterListPopover(){var _props=this.props,filterId=_props.filterId,filterType=_props.filterType,filterListIds=_props.filterListIds;return _react2.default.createElement("div",{style:POPOVER_STYLE},_react2.default.createElement(_eui.EuiPopoverTitle,null,"Is"),_react2.default.createElement(_eui.EuiExpression,null,_react2.default.createElement(_eui.EuiFlexGroup,{style:{maxWidth:450}},_react2.default.createElement(_eui.EuiFlexItem,{grow:false,style:{width:150}},_react2.default.createElement(_eui.EuiSelect,{value:filterType,onChange:this.onChangeFilterType,options:[{value:_detector_rule.FILTER_TYPE.INCLUDE,text:(0,_utils.filterTypeToText)(_detector_rule.FILTER_TYPE.INCLUDE)},{value:_detector_rule.FILTER_TYPE.EXCLUDE,text:(0,_utils.filterTypeToText)(_detector_rule.FILTER_TYPE.EXCLUDE)}]})),_react2.default.createElement(_eui.EuiFlexItem,{grow:false,style:{width:300}},_react2.default.createElement(_eui.EuiSelect,{value:filterId,onChange:this.onChangeFilterId,options:getFilterListOptions(filterListIds)})))))}},{key:"render",value:function render(){var _props2=this.props,fieldName=_props2.fieldName,filterId=_props2.filterId,filterType=_props2.filterType,enabled=_props2.enabled,filterListIds=_props2.filterListIds;return _react2.default.createElement(_eui.EuiFlexGroup,{gutterSize:"m"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false,className:"scope-field-checkbox"},_react2.default.createElement(_eui.EuiCheckbox,{id:"scope_cb_"+fieldName,checked:enabled,onChange:this.onEnableChange})),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiExpressionButton,{className:"scope-field-button",description:"when",buttonValue:fieldName,isActive:false,onClick:function onClick(event){return event.preventDefault()}})),filterListIds!==undefined&&filterListIds.length>0&&_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiPopover,{id:"operatorValuePopover",button:_react2.default.createElement(_eui.EuiExpressionButton,{description:"is "+(0,_utils.filterTypeToText)(filterType),buttonValue:filterId||"",isActive:this.state.isFilterListOpen,onClick:this.openFilterList}),isOpen:this.state.isFilterListOpen,closePopover:this.closeFilterList,panelPaddingSize:"none",ownFocus:true,withTitle:true,anchorPosition:"downLeft"},this.renderFilterListPopover())))}}]);return ScopeExpression}(_react.Component);ScopeExpression.propTypes={fieldName:_propTypes2.default.string.isRequired,filterId:_propTypes2.default.string,filterType:_propTypes2.default.oneOf([_detector_rule.FILTER_TYPE.INCLUDE,_detector_rule.FILTER_TYPE.EXCLUDE]),enabled:_propTypes2.default.bool.isRequired,filterListIds:_propTypes2.default.array.isRequired,updateScope:_propTypes2.default.func.isRequired}},2406:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _select_rule_action=__webpack_require__(2407);Object.defineProperty(exports,"SelectRuleAction",{enumerable:true,get:function get(){return _select_rule_action.SelectRuleAction}})},2407:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SelectRuleAction=SelectRuleAction;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _detector_description_list=__webpack_require__(1011);var _rule_action_panel=__webpack_require__(2408);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function SelectRuleAction(_ref){var job=_ref.job,anomaly=_ref.anomaly,setEditRuleIndex=_ref.setEditRuleIndex,updateRuleAtIndex=_ref.updateRuleAtIndex,deleteRuleAtIndex=_ref.deleteRuleAtIndex,addItemToFilterList=_ref.addItemToFilterList;var detectorIndex=anomaly.detectorIndex;var detector=job.analysis_config.detectors[detectorIndex];var rules=detector.custom_rules||[];var ruleActionPanels=void 0;if(rules.length>0){ruleActionPanels=rules.map(function(rule,index){return _react2.default.createElement(_react2.default.Fragment,{key:"rule_panel_"+index},_react2.default.createElement(_rule_action_panel.RuleActionPanel,{job:job,ruleIndex:index,anomaly:anomaly,setEditRuleIndex:setEditRuleIndex,updateRuleAtIndex:updateRuleAtIndex,deleteRuleAtIndex:deleteRuleAtIndex,addItemToFilterList:addItemToFilterList}),_react2.default.createElement(_eui.EuiSpacer,{size:"l"}))})}return _react2.default.createElement("div",{className:"select-rule-action"},rules.length>0&&_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_detector_description_list.DetectorDescriptionList,{job:job,detector:detector,anomaly:anomaly}),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),ruleActionPanels,_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_eui.EuiText,{style:{display:"inline"}},"or ")),_react2.default.createElement(_eui.EuiLink,{onClick:function onClick(){return setEditRuleIndex(rules.length)}},"create a rule"))}SelectRuleAction.propTypes={job:_propTypes2.default.object.isRequired,anomaly:_propTypes2.default.object.isRequired,setEditRuleIndex:_propTypes2.default.func.isRequired,updateRuleAtIndex:_propTypes2.default.func.isRequired,deleteRuleAtIndex:_propTypes2.default.func.isRequired,addItemToFilterList:_propTypes2.default.func.isRequired}},2408:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.RuleActionPanel=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _lodash=__webpack_require__(1);var _add_to_filter_list_link=__webpack_require__(2409);var _delete_rule_modal=__webpack_require__(2410);var _edit_condition_link=__webpack_require__(2411);var _utils=__webpack_require__(340);var _ml_api_service=__webpack_require__(22);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var RuleActionPanel=exports.RuleActionPanel=function(_Component){_inherits(RuleActionPanel,_Component);function RuleActionPanel(props){_classCallCheck(this,RuleActionPanel);var _this=_possibleConstructorReturn(this,(RuleActionPanel.__proto__||Object.getPrototypeOf(RuleActionPanel)).call(this,props));_initialiseProps.call(_this);var _this$props=_this.props,job=_this$props.job,anomaly=_this$props.anomaly,ruleIndex=_this$props.ruleIndex;var detector=job.analysis_config.detectors[anomaly.detectorIndex];var rules=detector.custom_rules;if(rules!==undefined&&ruleIndex<rules.length){_this.rule=rules[ruleIndex]}_this.state={showAddToFilterListLink:false};return _this}_createClass(RuleActionPanel,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;var scope=this.rule.scope;if(scope!==undefined&&Object.keys(scope).length===1){var partitionFieldName=Object.keys(scope)[0];var partitionFieldValue=this.props.anomaly.source[partitionFieldName];if(scope[partitionFieldName]!==undefined&&partitionFieldValue!==undefined&&partitionFieldValue.length===1&&partitionFieldValue[0].length>0){var filterId=scope[partitionFieldName].filter_id;_ml_api_service.ml.filters.filters({filterId:filterId}).then(function(filter){var filterItems=filter.items;if(filterItems.indexOf(partitionFieldValue[0])===-1){_this2.setState({showAddToFilterListLink:true})}}).catch(function(resp){console.log("Error loading filter "+filterId+":",resp)})}}}},{key:"render",value:function render(){if(this.rule===undefined){return null}var descriptionListItems=[{title:"rule",description:(0,_utils.buildRuleDescription)(this.rule,this.props.anomaly)},{title:"",description:this.getEditRuleLink()},{title:"",description:this.getDeleteRuleLink()}];var quickConditionLink=this.getQuickEditConditionLink();if(quickConditionLink!==null){descriptionListItems.splice(1,0,{title:"",description:quickConditionLink})}if(this.state.showAddToFilterListLink===true){var quickAddToFilterListLink=this.getQuickAddToFilterListLink();descriptionListItems.splice(descriptionListItems.length-2,0,{title:"",description:quickAddToFilterListLink})}descriptionListItems[1].title="actions";return _react2.default.createElement(_eui.EuiPanel,{paddingSize:"m",className:"select-rule-action-panel"},_react2.default.createElement(_eui.EuiDescriptionList,{type:"column",listItems:descriptionListItems}))}}]);return RuleActionPanel}(_react.Component);var _initialiseProps=function _initialiseProps(){var _this3=this;this.getEditRuleLink=function(){var _props=_this3.props,ruleIndex=_props.ruleIndex,setEditRuleIndex=_props.setEditRuleIndex;return _react2.default.createElement(_eui.EuiLink,{onClick:function onClick(){return setEditRuleIndex(ruleIndex)}},"Edit rule")};this.getDeleteRuleLink=function(){var _props2=_this3.props,ruleIndex=_props2.ruleIndex,deleteRuleAtIndex=_props2.deleteRuleAtIndex;return _react2.default.createElement(_delete_rule_modal.DeleteRuleModal,{ruleIndex:ruleIndex,deleteRuleAtIndex:deleteRuleAtIndex})};this.getQuickEditConditionLink=function(){var conditions=_this3.rule.conditions;var link=null;if(_this3.rule.conditions!==undefined&&conditions.length===1){link=_react2.default.createElement(_edit_condition_link.EditConditionLink,{conditionIndex:0,conditionValue:conditions[0].value,appliesTo:conditions[0].applies_to,anomaly:_this3.props.anomaly,updateConditionValue:_this3.updateConditionValue})}return link};this.getQuickAddToFilterListLink=function(){var _props3=_this3.props,anomaly=_props3.anomaly,addItemToFilterList=_props3.addItemToFilterList;var scope=_this3.rule.scope;var partitionFieldName=Object.keys(scope)[0];var partitionFieldValue=anomaly.source[partitionFieldName];var filterId=scope[partitionFieldName].filter_id;return _react2.default.createElement(_add_to_filter_list_link.AddToFilterListLink,{fieldValue:partitionFieldValue[0],filterId:filterId,addItemToFilterList:addItemToFilterList})};this.updateConditionValue=function(conditionIndex,value){var _props4=_this3.props,job=_props4.job,anomaly=_props4.anomaly,ruleIndex=_props4.ruleIndex,updateRuleAtIndex=_props4.updateRuleAtIndex;var detector=job.analysis_config.detectors[anomaly.detectorIndex];var editedRule=(0,_lodash.cloneDeep)(detector.custom_rules[ruleIndex]);var conditions=editedRule.conditions;if(conditionIndex<conditions.length){conditions[conditionIndex].value=value}updateRuleAtIndex(ruleIndex,editedRule)}};RuleActionPanel.propTypes={job:_propTypes2.default.object.isRequired,anomaly:_propTypes2.default.object.isRequired,ruleIndex:_propTypes2.default.number.isRequired,setEditRuleIndex:_propTypes2.default.func.isRequired,updateRuleAtIndex:_propTypes2.default.func.isRequired,deleteRuleAtIndex:_propTypes2.default.func.isRequired,addItemToFilterList:_propTypes2.default.func.isRequired}},2409:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AddToFilterListLink=AddToFilterListLink;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function AddToFilterListLink(_ref){var fieldValue=_ref.fieldValue,filterId=_ref.filterId,addItemToFilterList=_ref.addItemToFilterList;return _react2.default.createElement(_eui.EuiLink,{onClick:function onClick(){return addItemToFilterList(fieldValue,filterId,true)}},"Add ",fieldValue," to ",filterId)}AddToFilterListLink.propTypes={fieldValue:_propTypes2.default.string.isRequired,filterId:_propTypes2.default.string.isRequired,addItemToFilterList:_propTypes2.default.func.isRequired}},241:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.loadNewJobDefaults=loadNewJobDefaults;exports.newJobDefaults=newJobDefaults;exports.newJobLimits=newJobLimits;var _ml_api_service=__webpack_require__(22);var defaults={anomaly_detectors:{},datafeeds:{}};var limits={};function loadNewJobDefaults(){return new Promise(function(resolve){_ml_api_service.ml.mlInfo().then(function(resp){defaults=resp.defaults;limits=resp.limits;resolve({defaults:defaults,limits:limits})}).catch(function(){resolve({defaults:defaults,limits:limits})})})}function newJobDefaults(){return defaults}function newJobLimits(){return limits}},2410:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DeleteRuleModal=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DeleteRuleModal=exports.DeleteRuleModal=function(_Component){_inherits(DeleteRuleModal,_Component);function DeleteRuleModal(props){_classCallCheck(this,DeleteRuleModal);var _this=_possibleConstructorReturn(this,(DeleteRuleModal.__proto__||Object.getPrototypeOf(DeleteRuleModal)).call(this,props));_this.deleteRule=function(){var _this$props=_this.props,ruleIndex=_this$props.ruleIndex,deleteRuleAtIndex=_this$props.deleteRuleAtIndex;deleteRuleAtIndex(ruleIndex);_this.closeModal()};_this.closeModal=function(){_this.setState({isModalVisible:false})};_this.showModal=function(){_this.setState({isModalVisible:true})};_this.state={isModalVisible:false};return _this}_createClass(DeleteRuleModal,[{key:"render",value:function render(){var _this2=this;var modal=void 0;if(this.state.isModalVisible){modal=_react2.default.createElement(_eui.EuiOverlayMask,null,_react2.default.createElement(_eui.EuiConfirmModal,{title:"Delete rule",onCancel:this.closeModal,onConfirm:this.deleteRule,cancelButtonText:"Cancel",confirmButtonText:"Delete",defaultFocusedButton:_eui.EUI_MODAL_CONFIRM_BUTTON},_react2.default.createElement("p",null,"Are you sure you want to delete this rule?")))}return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiLink,{color:"danger",onClick:function onClick(){return _this2.showModal()}},"Delete rule"),modal)}}]);return DeleteRuleModal}(_react.Component);DeleteRuleModal.propTypes={ruleIndex:_propTypes2.default.number.isRequired,deleteRuleAtIndex:_propTypes2.default.func.isRequired}},2411:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EditConditionLink=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _detector_rule=__webpack_require__(298);var _format_value=__webpack_require__(299);var _utils=__webpack_require__(340);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var EditConditionLink=exports.EditConditionLink=function(_Component){_inherits(EditConditionLink,_Component);function EditConditionLink(props){_classCallCheck(this,EditConditionLink);var _this=_possibleConstructorReturn(this,(EditConditionLink.__proto__||Object.getPrototypeOf(EditConditionLink)).call(this,props));_this.onChangeValue=function(event){var enteredValue=event.target.value;_this.setState({value:enteredValue!==""?+enteredValue:""})};_this.onUpdateClick=function(){var _this$props=_this.props,conditionIndex=_this$props.conditionIndex,updateConditionValue=_this$props.updateConditionValue;updateConditionValue(conditionIndex,_this.state.value)};var value="";var anomaly=_this.props.anomaly;var anomalyValue=(0,_utils.getAppliesToValueFromAnomaly)(anomaly,props.appliesTo);if(anomalyValue!==undefined){value=+(0,_format_value.formatValue)(anomalyValue,anomaly.source.function)}_this.state={value:value};return _this}_createClass(EditConditionLink,[{key:"render",value:function render(){var _this2=this;var value=this.state.value;return _react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiText,null,"Update rule condition from ",this.props.conditionValue," to")),_react2.default.createElement(_eui.EuiFlexItem,{grow:false,className:"condition-edit-value-field"},_react2.default.createElement(_eui.EuiFieldNumber,{placeholder:"Enter value",compressed:true,value:value,onChange:this.onChangeValue,"aria-label":"Enter numeric value for condition"})),value!==""&&_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiLink,{size:"s",onClick:function onClick(){return _this2.onUpdateClick()}},"Update")))}}]);return EditConditionLink}(_react.Component);EditConditionLink.propTypes={conditionIndex:_propTypes2.default.number.isRequired,conditionValue:_propTypes2.default.number.isRequired,appliesTo:_propTypes2.default.oneOf([_detector_rule.APPLIES_TO.ACTUAL,_detector_rule.APPLIES_TO.TYPICAL,_detector_rule.APPLIES_TO.DIFF_FROM_TYPICAL]),anomaly:_propTypes2.default.object.isRequired,updateConditionValue:_propTypes2.default.func.isRequired}},2412:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2413)},2413:function(module,exports,__webpack_require__){"use strict";__webpack_require__(53);var _state_factory=__webpack_require__(399);var _modules=__webpack_require__(4);var _checkbox_showcharts=__webpack_require__(2414);var _module=_modules.uiModules.get("apps/ml",["react"]);_module.service("mlCheckboxShowChartsService",function(Private){var stateFactory=Private(_state_factory.stateFactoryProvider);this.state=stateFactory("mlCheckboxShowCharts",{showCharts:true})}).directive("mlCheckboxShowCharts",function($injector){var reactDirective=$injector.get("reactDirective");var mlCheckboxShowChartsService=$injector.get("mlCheckboxShowChartsService");return reactDirective(_checkbox_showcharts.CheckboxShowCharts,undefined,{restrict:"E"},{mlCheckboxShowChartsService:mlCheckboxShowChartsService})})},2414:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CheckboxShowCharts=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _make_id=__webpack_require__(3112);var _make_id2=_interopRequireDefault(_make_id);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CheckboxShowCharts=function(_Component){_inherits(CheckboxShowCharts,_Component);function CheckboxShowCharts(props){_classCallCheck(this,CheckboxShowCharts);var _this=_possibleConstructorReturn(this,(CheckboxShowCharts.__proto__||Object.getPrototypeOf(CheckboxShowCharts)).call(this,props));_initialiseProps.call(_this);_this.mlCheckboxShowChartsService=_this.props.mlCheckboxShowChartsService;var showCharts=_this.mlCheckboxShowChartsService.state.get("showCharts");_this.state={checked:showCharts};return _this}_createClass(CheckboxShowCharts,[{key:"render",value:function render(){return _react2.default.createElement(_eui.EuiCheckbox,{id:(0,_make_id2.default)(),label:"Show charts",checked:this.state.checked,onChange:this.onChange})}}]);return CheckboxShowCharts}(_react.Component);var _initialiseProps=function _initialiseProps(){var _this2=this;this.onChange=function(e){var showCharts=e.target.checked;_this2.mlCheckboxShowChartsService.state.set("showCharts",showCharts);_this2.mlCheckboxShowChartsService.state.changed();_this2.setState({checked:showCharts})}};exports.CheckboxShowCharts=CheckboxShowCharts},2416:function(module,exports,__webpack_require__){"use strict";var _controls_select=__webpack_require__(2417);var _controls_select2=_interopRequireDefault(_controls_select);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlControlsSelect",function(){return{restrict:"E",scope:{identifier:"@",label:"@",narrowStyle:"=",options:"=",showIcons:"=",selected:"=",updateFn:"="},template:_controls_select2.default,link:function link(scope){scope.setOption=function(d){if(typeof scope.updateFn==="function"){scope.updateFn(d)}}}}})},2417:function(module,exports){module.exports='<label for="select{{identifier}}" class="kuiLabel">{{label}}:</label>\n<div class="dropdown-group" dropdown>\n  <button id="select{{identifier}}" type="button" class="form-control dropdown-toggle" ng-class="{ \'dropdown-toggle-narrow\': narrowStyle }" dropdown-toggle ng-disabled="disabled">\n    <span><i ng-if="showIcons" class="fa fa-exclamation-triangle ml-icon-severity-{{selected.display}}"></i> {{selected.display}}</span> <span class="caret"></span>\n  </button>\n  <ul class="dropdown-menu" role="menu">\n    <li ng-repeat="option in options">\n      <a href="" ng-click="setOption(option)"><i ng-if="showIcons" class="fa fa-exclamation-triangle ml-icon-severity-{{option.display}}"></i> {{option.display}}</a>\n    </li>\n  </ul>\n</div>\n'},2418:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2419)},2419:function(module,exports,__webpack_require__){"use strict";__webpack_require__(53);var _state_factory=__webpack_require__(399);var _modules=__webpack_require__(4);var _select_interval=__webpack_require__(2420);var _module=_modules.uiModules.get("apps/ml",["react"]);_module.service("mlSelectIntervalService",function(Private){var stateFactory=Private(_state_factory.stateFactoryProvider);this.state=stateFactory("mlSelectInterval",{interval:{display:"Auto",val:"auto"}})}).directive("mlSelectInterval",function($injector){var reactDirective=$injector.get("reactDirective");var mlSelectIntervalService=$injector.get("mlSelectIntervalService");return reactDirective(_select_interval.SelectInterval,undefined,{restrict:"E"},{mlSelectIntervalService:mlSelectIntervalService})})},242:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mlChartTooltipService=undefined;var _jquery=__webpack_require__(17);var _jquery2=_interopRequireDefault(_jquery);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var doc=document.documentElement;var FADE_TIMEOUT_MS=200;var mlChartTooltipService=exports.mlChartTooltipService={element:null,fadeTimeout:null,visible:false};mlChartTooltipService.show=function(contents,target){var offset=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{x:0,y:0};if(this.element===null||typeof target==="undefined"){return}this.visible=true;if(this.fadeTimeout!==null){clearTimeout(this.fadeTimeout)}this.element.html(contents);var navOffset=(0,_jquery2.default)(".kbnGlobalNav").width();var contentWidth=(0,_jquery2.default)("body").width()-navOffset-10;var tooltipWidth=this.element.width();var scrollTop=(window.pageYOffset||doc.scrollTop)-(doc.clientTop||0);var pos=target.getBoundingClientRect();var x=pos.left+offset.x+4-navOffset;var y=pos.top+offset.y+scrollTop;if(x+tooltipWidth>contentWidth){this.element.css({left:x-(tooltipWidth+offset.x+22),top:y-28})}else{this.element.css({left:x,top:y-28})}this.element.css({opacity:"0.9",display:"block"})};mlChartTooltipService.hide=function(){var _this=this;if(this.element===null){return}this.visible=false;this.element.css({opacity:"0"});this.fadeTimeout=setTimeout(function(){if(_this.visible===false){_this.element.css("display","none")}_this.fadeTimeout=null},FADE_TIMEOUT_MS)}},2420:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SelectInterval=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var OPTIONS=[{value:"auto",text:"Auto"},{value:"hour",text:"1 hour"},{value:"day",text:"1 day"},{value:"second",text:"Show all"}];function optionValueToInterval(value){var option=OPTIONS.find(function(opt){return opt.value===value});var interval=OPTIONS[0];if(option!==undefined){interval={display:option.text,val:option.value}}return interval}var SelectInterval=function(_Component){_inherits(SelectInterval,_Component);function SelectInterval(props){_classCallCheck(this,SelectInterval);var _this=_possibleConstructorReturn(this,(SelectInterval.__proto__||Object.getPrototypeOf(SelectInterval)).call(this,props));_initialiseProps.call(_this);_this.mlSelectIntervalService=_this.props.mlSelectIntervalService;var intervalState=_this.mlSelectIntervalService.state.get("interval");var intervalValue=_lodash2.default.get(intervalState,"val","auto");var interval=optionValueToInterval(intervalValue);_this.mlSelectIntervalService.state.set("interval",interval);_this.state={value:interval.val};return _this}_createClass(SelectInterval,[{key:"render",value:function render(){return _react2.default.createElement(_eui.EuiSelect,{options:OPTIONS,className:"ml-select-interval",value:this.state.value,onChange:this.onChange})}}]);return SelectInterval}(_react.Component);var _initialiseProps=function _initialiseProps(){var _this2=this;this.onChange=function(e){_this2.setState({value:e.target.value});var interval=optionValueToInterval(e.target.value);_this2.mlSelectIntervalService.state.set("interval",interval).changed()}};exports.SelectInterval=SelectInterval},2421:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2422)},2422:function(module,exports,__webpack_require__){"use strict";__webpack_require__(53);var _state_factory=__webpack_require__(399);var _modules=__webpack_require__(4);var _select_severity=__webpack_require__(633);var _module=_modules.uiModules.get("apps/ml",["react"]);_module.service("mlSelectSeverityService",function(Private){var stateFactory=Private(_state_factory.stateFactoryProvider);this.state=stateFactory("mlSelectSeverity",{threshold:{display:"warning",val:0}})}).directive("mlSelectSeverity",function($injector){var reactDirective=$injector.get("reactDirective");var mlSelectSeverityService=$injector.get("mlSelectSeverityService");return reactDirective(_select_severity.SelectSeverity,undefined,{restrict:"E"},{mlSelectSeverityService:mlSelectSeverityService})})},2423:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2424)},2424:function(module,exports,__webpack_require__){"use strict";__webpack_require__(53);var _modules=__webpack_require__(4);var _influencers_list=__webpack_require__(2425);var _module=_modules.uiModules.get("apps/ml",["react"]);_module.directive("mlInfluencersList",function($injector){var reactDirective=$injector.get("reactDirective");return reactDirective(_influencers_list.InfluencersList,undefined,{restrict:"E"})})},2425:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.InfluencersList=InfluencersList;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _abbreviate_whole_number=__webpack_require__(2426);var _anomaly_utils=__webpack_require__(256);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getTooltipContent(maxScoreLabel,totalScoreLabel){return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement("p",null,"Maximum anomaly score: ",maxScoreLabel),_react2.default.createElement("p",null,"Total anomaly score: ",totalScoreLabel))}function Influencer(_ref){var influencerFieldName=_ref.influencerFieldName,valueData=_ref.valueData;var maxScorePrecise=valueData.maxAnomalyScore;var maxScore=parseInt(maxScorePrecise);var maxScoreLabel=maxScore!==0?maxScore:"< 1";var severity=(0,_anomaly_utils.getSeverity)(maxScore);var totalScore=parseInt(valueData.sumAnomalyScore);var totalScoreLabel=totalScore!==0?totalScore:"< 1";var barScore=maxScore!==0?maxScore:1;var barStyle={width:barScore+"%"};var tooltipContent=getTooltipContent(maxScoreLabel,totalScoreLabel);return _react2.default.createElement("div",null,_react2.default.createElement("div",{className:"field-label"},influencerFieldName!=="mlcategory"?_react2.default.createElement("div",{className:"field-value"},valueData.influencerFieldValue):_react2.default.createElement("div",{className:"field-value"},"mlcategory ",valueData.influencerFieldValue)),_react2.default.createElement("div",{className:"progress "+severity,value:"{valueData.maxAnomalyScore}",max:"100"},_react2.default.createElement("div",{className:"progress-bar-holder"},_react2.default.createElement("div",{className:"progress-bar",style:barStyle})),_react2.default.createElement("div",{className:"score-label"},_react2.default.createElement(_eui.EuiToolTip,{position:"right",className:"ml-influencers-list-tooltip",title:influencerFieldName+": "+valueData.influencerFieldValue,content:tooltipContent},_react2.default.createElement("span",null,maxScoreLabel)))),_react2.default.createElement("div",{className:"total-score-label"},_react2.default.createElement(_eui.EuiToolTip,{position:"right",className:"ml-influencers-list-tooltip",title:influencerFieldName+": "+valueData.influencerFieldValue,content:tooltipContent},_react2.default.createElement("span",null,totalScore>0?(0,_abbreviate_whole_number.abbreviateWholeNumber)(totalScore,4):totalScoreLabel))))}Influencer.propTypes={influencerFieldName:_propTypes2.default.string.isRequired,valueData:_propTypes2.default.object.isRequired};function InfluencersByName(_ref2){var influencerFieldName=_ref2.influencerFieldName,fieldValues=_ref2.fieldValues;var influencerValues=fieldValues.map(function(valueData){return _react2.default.createElement(Influencer,{key:valueData.influencerFieldValue,influencerFieldName:influencerFieldName,valueData:valueData})});return _react2.default.createElement(_react2.default.Fragment,{key:influencerFieldName},_react2.default.createElement(_eui.EuiTitle,{size:"xs"},_react2.default.createElement("h4",null,influencerFieldName)),_react2.default.createElement(_eui.EuiSpacer,{size:"xs"}),influencerValues)}InfluencersByName.propTypes={influencerFieldName:_propTypes2.default.string.isRequired,fieldValues:_propTypes2.default.array.isRequired};function InfluencersList(_ref3){var influencers=_ref3.influencers;if(influencers===undefined||Object.keys(influencers).length===0){return _react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceAround"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiSpacer,{size:"xxl"}),_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("h4",null,"No influencers found"))))}var influencersByName=Object.keys(influencers).map(function(influencerFieldName){return _react2.default.createElement(InfluencersByName,{key:influencerFieldName,influencerFieldName:influencerFieldName,fieldValues:influencers[influencerFieldName]})});return _react2.default.createElement("div",{className:"ml-influencers-list"},influencersByName)}InfluencersList.propTypes={influencers:_propTypes2.default.object}},2426:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.abbreviateWholeNumber=abbreviateWholeNumber;var _numeral=__webpack_require__(212);var _numeral2=_interopRequireDefault(_numeral);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function abbreviateWholeNumber(value,maxDigits){var maxNumDigits=maxDigits!==undefined?maxDigits:3;if(Math.abs(value)<Math.pow(10,maxNumDigits)){return value}else{return(0,_numeral2.default)(value).format("0a")}}},2427:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _jquery=__webpack_require__(17);var _jquery2=_interopRequireDefault(_jquery);var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _d=__webpack_require__(20);var _d2=_interopRequireDefault(_d);var _job_select_list=__webpack_require__(2428);var _job_select_list2=_interopRequireDefault(_job_select_list);var _job_utils=__webpack_require__(34);var _job_service=__webpack_require__(23);var _job_select_service=__webpack_require__(408);var _timefilter=__webpack_require__(16);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlJobSelectList",function(Private){return{restrict:"AE",replace:true,transclude:true,template:_job_select_list2.default,controller:function controller($scope){var mlJobSelectService=Private(_job_select_service.JobSelectServiceProvider);$scope.jobs=[];$scope.groups=[];$scope.homelessJobs=[];$scope.singleSelection=false;$scope.timeSeriesOnly=false;$scope.noJobsCreated=undefined;$scope.applyTimeRange=mlJobSelectService.jobSelectListState.applyTimeRange;$scope.urlSelectedIds={};$scope.selected={};$scope.allGroupsSelected=false;$scope.allJobsSelected=false;$scope.selectedJobRadio="";$scope.selectedCount=0;_job_service.mlJobService.loadJobs().then(function(resp){if(resp.jobs.length>0){$scope.noJobsCreated=false;var jobs=[];resp.jobs.forEach(function(job){if(job.groups&&job.groups.length){job.groups.forEach(function(group){jobs.push(createJob(group+"."+job.job_id,group,job))})}else{jobs.push(createJob(job.job_id,null,job))}});normalizeTimes(jobs);$scope.jobs=jobs;var _createGroups=createGroups($scope.jobs),groups=_createGroups.groups,homeless=_createGroups.homeless;$scope.groups=groups;$scope.homelessJobs=homeless;$scope.selected={groups:[],jobs:[]};var jobCount=resp.jobs.reduce(function(sum,job){return sum+(job.groups===undefined?1:job.groups.length)},0);var selectAll=jobCount===$scope.urlSelectedIds.jobs.length;groups.forEach(function(group){$scope.selected.groups.push({id:group.id,selected:group.selected,selectable:group.selectable,timeRange:group.timeRange,isGroup:true})});jobs.forEach(function(job){if($scope.selected.jobs.find(function(j){return j.id===job.name})===undefined){$scope.selected.jobs.push({id:job.name,selected:selectAll||job.selected,disabled:job.disabled,timeRange:job.timeRange,running:job.running,isGroup:false})}});$scope.allJobsSelected=areAllJobsSelected();$scope.allGroupsSelected=areAllGroupsSelected();createSelectedCount();if($scope.singleSelection===true){$scope.jobs.forEach(function(j){if(j.selected){$scope.selectedJobRadio=j.name}})}}else{$scope.noJobsCreated=true}$scope.$applyAsync()}).catch(function(resp){console.log("mlJobSelectList controller - error getting job info from ES:",resp)});function createJob(jobId,groupId,job){return{id:jobId,name:job.job_id,group:groupId,isGroup:false,selected:_lodash2.default.includes($scope.urlSelectedIds.jobs,job.job_id),disabled:!($scope.timeSeriesOnly===false||(0,_job_utils.isTimeSeriesViewJob)(job)===true),running:job.datafeed_config&&job.datafeed_config.state==="started",timeRange:{to:job.data_counts.latest_record_timestamp,from:job.data_counts.earliest_record_timestamp,fromPx:0,toPx:0,widthPx:0,label:""}}}function createGroups(jobsIn){var jobGroups={};var homeless=[];jobsIn.forEach(function(job){if(job.group!==null){if(jobGroups[job.group]===undefined){jobGroups[job.group]=[job]}else{jobGroups[job.group].push(job)}}else{homeless.push(job)}});var groups=_lodash2.default.map(jobGroups,function(jobs,id){var group={id:id,selected:false,selectable:true,expanded:false,isGroup:true,jobs:jobs};if($scope.singleSelection===false){group.selected=_lodash2.default.includes($scope.urlSelectedIds.groups,id)}var timeRange={to:null,toMoment:null,from:null,fromMoment:null,fromPx:null,toPx:null,widthPx:null};jobs.forEach(function(job){job.group=group;if(timeRange.to===null||job.timeRange.to>timeRange.to){timeRange.to=job.timeRange.to;timeRange.toMoment=job.timeRange.toMoment}if(timeRange.from===null||job.timeRange.from<timeRange.from){timeRange.from=job.timeRange.from;timeRange.fromMoment=job.timeRange.fromMoment}if(timeRange.toPx===null||job.timeRange.toPx>timeRange.toPx){timeRange.toPx=job.timeRange.toPx}if(timeRange.fromPx===null||job.timeRange.fromPx<timeRange.fromPx){timeRange.fromPx=job.timeRange.fromPx}});timeRange.widthPx=timeRange.toPx-timeRange.fromPx;timeRange.toMoment=(0,_moment2.default)(timeRange.to);timeRange.fromMoment=(0,_moment2.default)(timeRange.from);var fromString=timeRange.fromMoment.format("MMM Do YYYY, HH:mm");var toString=timeRange.toMoment.format("MMM Do YYYY, HH:mm");timeRange.label=fromString+" to "+toString;group.timeRange=timeRange;return group});return{groups:groups,homeless:homeless}}$scope.apply=function(){var selectedJobs=[];if($scope.singleSelection){selectedJobs.push.apply(selectedJobs,_toConsumableArray($scope.selected.jobs.filter(function(j){return j.id===$scope.selectedJobRadio})))}else{selectedJobs.push.apply(selectedJobs,_toConsumableArray($scope.selected.jobs.filter(function(j){return j.selected})));selectedJobs.push.apply(selectedJobs,_toConsumableArray($scope.selected.groups.filter(function(g){return g.selected})))}if(areAllJobsSelected()){mlJobSelectService.setJobIds(["*"])}else{var jobIds=selectedJobs.map(function(j){return j.isGroup?j.id+".*":j.id});mlJobSelectService.setJobIds(jobIds)}if($scope.applyTimeRange){var times=[];selectedJobs.forEach(function(job){if(job.timeRange.from!==undefined){times.push(job.timeRange.from)}if(job.timeRange.to!==undefined){times.push(job.timeRange.to)}});if(times.length){var min=_lodash2.default.min(times);var max=_lodash2.default.max(times);_timefilter.timefilter.setTime({from:(0,_moment2.default)(min).toISOString(),to:(0,_moment2.default)(max).toISOString()})}}mlJobSelectService.jobSelectListState.applyTimeRange=$scope.applyTimeRange;$scope.closePopover()};$scope.toggleSelection=function(){$scope.allJobsSelected=areAllJobsSelected();$scope.allGroupsSelected=areAllGroupsSelected();createSelectedCount()};$scope.toggleAllJobsSelection=function(){var allJobsSelected=areAllJobsSelected();$scope.allJobsSelected=!allJobsSelected;$scope.selected.jobs.forEach(function(job){job.selected=$scope.allJobsSelected});createSelectedCount()};$scope.toggleGroupSelection=function(){$scope.allGroupsSelected=areAllGroupsSelected();createSelectedCount()};$scope.toggleAllGroupsSelection=function(){var allGroupsSelected=areAllGroupsSelected();$scope.allGroupsSelected=!allGroupsSelected;$scope.selected.groups.forEach(function(group){group.selected=$scope.allGroupsSelected});createSelectedCount()};function areAllJobsSelected(){var allSelected=true;$scope.selected.jobs.forEach(function(job){if(job.selected===false){allSelected=false}});return allSelected}function areAllGroupsSelected(){var allSelected=true;$scope.selected.groups.forEach(function(group){if(group.selected===false){allSelected=false}});return allSelected}function createSelectedCount(){$scope.selectedCount=0;$scope.selected.jobs.forEach(function(job){if(job.selected){$scope.selectedCount++}});$scope.selected.groups.forEach(function(group){if(group.selected){$scope.selectedCount++}})}function normalizeTimes(jobs){var min=_lodash2.default.min(jobs,function(job){return+job.timeRange.from});var max=_lodash2.default.max(jobs,function(job){return+job.timeRange.to});var gantScale=_d2.default.scale.linear().domain([min.timeRange.from,max.timeRange.to]).range([1,299]);jobs.forEach(function(job){if(job.timeRange.to!==undefined&&job.timeRange.from!==undefined){job.timeRange.fromPx=gantScale(job.timeRange.from);job.timeRange.toPx=gantScale(job.timeRange.to);job.timeRange.widthPx=job.timeRange.toPx-job.timeRange.fromPx;job.timeRange.toMoment=(0,_moment2.default)(job.timeRange.to);job.timeRange.fromMoment=(0,_moment2.default)(job.timeRange.from);var fromString=job.timeRange.fromMoment.format("MMM Do YYYY, HH:mm");var _toString=job.timeRange.toMoment.format("MMM Do YYYY, HH:mm");job.timeRange.label=fromString+" to "+_toString}})}$scope.useTimeRange=function(job){_timefilter.timefilter.setTime({from:job.timeRange.fromMoment.toISOString(),to:job.timeRange.toMoment.toISOString()})}},link:function link(scope,element,attrs){var mlJobSelectService=Private(_job_select_service.JobSelectServiceProvider);scope.timeSeriesOnly=false;if(attrs.timeseriesonly==="true"){scope.timeSeriesOnly=true}if(attrs.singleSelection==="true"){scope.singleSelection=true}scope.urlSelectedIds={groups:[].concat(_toConsumableArray(mlJobSelectService.groupIds)),jobs:[].concat(_toConsumableArray(mlJobSelectService.jobIdsWithGroup))};(0,_jquery2.default)(".ml-select-list",element).focus()}}})},2428:function(module,exports){module.exports='<div class=\'ml-job-selector\'>\n  <div class="header">\n    Job Selection\n  </div>\n\n  <ml-loading-indicator\n    label="Loading jobs"\n    is-loading="noJobsCreated===undefined"\n  />\n  <div class="select-list" ng-show=\'noJobsCreated!==undefined\'>\n    <div ng-if="groups.length && singleSelection !== true">\n      <div class="list-section-title">\n        <input\n          ng-if="singleSelection !== true"\n          type="checkbox"\n          ng-checked="allGroupsSelected"\n          aria-label="Select all groups checkbox. Total count {{selected.groups.length}}."\n          ng-click="toggleAllGroupsSelection()" />\n        Groups\n      </div>\n      <div class="list-section">\n        <div class=\'group\' ng-repeat="group in selected.groups">\n          <div class=\'group-title job-row\'>\n            <div class="job-row-inner">\n              <label class="kuiFormLabel">\n                <div >\n                  <input\n                    aria-label="Group ID {{group.id}}"\n                    ng-if="singleSelection !== true && group.selectable === true" type="checkbox"\n                    ng-model="group.selected"\n                    ng-click="toggleGroupSelection()" />\n                  {{group.id}}\n                </div>\n                <div ng-if="group.selectable !== false">\n                  <div class=\'gant-back-edge\'>\n                    <div></div>\n                  </div>\n                  <div\n                    class=\'gant-bar\'\n                    ng-class="{\'disabled-job\': job.disabled, \'gant-bar-running\': job.running}"\n                    tooltip=\'{{group.timeRange.label}}\'\n                    tooltip-placement="bottom"\n                    tooltip-append-to-body="true"\n                    ng-attr-style=\'margin-left:{{group.timeRange.fromPx}}px; width: {{group.timeRange.widthPx}}px;\'>\n                  </div>\n                </div>\n              </label>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div class="list-section-title" ng-if="singleSelection !== true">\n      <input type="checkbox"\n        ng-checked="allJobsSelected"\n        aria-label="Select all jobs checkbox. Total count {{selected.jobs.length}}."\n        ng-click="toggleAllJobsSelection()" />\n      Jobs\n    </div>\n    <div class="list-section" ng-class="{\'list-section-single\': singleSelection}">\n      <div class=\'job-row\' ng-repeat="job in selected.jobs">\n        <div class=\'job-row-inner\'>\n          <label class="kuiFormLabel">\n            <div>\n              <span>\n                <input ng-if="singleSelection !== true" type="checkbox"\n                  ng-model="job.selected"\n                  ng-disabled=\'job.disabled\'\n                  ng-click="toggleSelection()" />\n                <input ng-if="singleSelection === true" type="radio"\n                  name="job-group"\n                  value="{{job.id}}"\n                  ng-model="$parent.$parent.selectedJobRadio"\n                  ng-disabled=\'job.disabled\' />\n                <span ng-class="{\'disabled-job\': job.disabled}" aria-label="Job ID {{job.id}}">{{job.id}}</span>\n              </span>\n            </div>\n            <div>\n              <div class=\'gant-back-edge\' >\n                <div ></div>\n              </div>\n              <div\n                class=\'gant-bar\'\n                aria-label="time range {{job.timeRange.label}}"\n                ng-class="{\'disabled-job\': job.disabled, \'gant-bar-running\': job.running}"\n                tooltip=\'{{job.timeRange.label}}\'\n                tooltip-placement="bottom"\n                tooltip-append-to-body="true"\n                ng-attr-style=\'margin-left:{{job.timeRange.fromPx}}px; width: {{job.timeRange.widthPx}}px;\'>\n\n              </div>\n            </div>\n          </label>\n        </div>\n      </div>\n    </div>\n  </div>\n\n\n  <div class=\'footer\'>\n    <button\n      ng-click="apply()"\n      class="kuiButton kuiButton--primary"\n      aria-label="Apply"\n      ng-disabled="selectedCount===0"\n      >\n      Apply\n    </button>\n    <button ng-click="closePopover()" class="kuiButton kuiButton--primary" aria-label="Cancel">Cancel</button>\n  </div>\n\n  <div class=\'apply-time-range\'>\n    <label class="kuiFormLabel">\n    <input type="checkbox"\n      ng-model="applyTimeRange"/>\n      Also apply time range\n  </label>\n  </div>\n\n</div>\n'},2429:function(module,exports,__webpack_require__){"use strict";var _job_select_button=__webpack_require__(2430);var _job_select_button2=_interopRequireDefault(_job_select_button);__webpack_require__(918);var _modules=__webpack_require__(4);var _job_select_service=__webpack_require__(408);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("jobSelectButton",function(Private){var mlJobSelectService=Private(_job_select_service.JobSelectServiceProvider);function link(scope){scope.selectJobBtnJobIdLabel="";scope.unsafeHtml="";scope.description=scope.singleSelection?mlJobSelectService.singleJobDescription:mlJobSelectService.description;scope.createMenu=function(){var txt="<ml-job-select-list ";if(scope.timeseriesonly){txt+='timeseriesonly="true" '}if(scope.singleSelection){txt+='single-selection="true" '}txt+="></ml-job-select-list>";scope.unsafeHtml=txt}}return{scope:{timeseriesonly:"=",singleSelection:"="},link:link,replace:true,template:_job_select_button2.default}})},2430:function(module,exports){module.exports='<div style=\'display: flex;\' class="ml-job-select-btn-container">\n  <div class="ml-job-select-btn-label">Job</div>\n  <div style="flex:0 0 auto;">\n    <div  popover-placement="bottom"\n          popover-placement="bottom"\n          popover-html-unsafe="{{unsafeHtml}}"\n          popover-append-to-body="false"\n          popover-trigger="click"\n          class="ml-job-select-btn"\n          tooltip="{{description.txt}} selected"\n          aria-label="Job selection menu"\n          ng-click=\'createMenu()\'\n          kbn-accessible-click>\n    <span class="ml-job-select-btn-text">{{description.txt}}</span>\n    <span class="caret"></span>\n  </div>\n  </div>\n</div>\n'},2431:function(module,exports){module.exports='<ml-nav-menu name="explorer"></ml-nav-menu>\n<ml-chart-tooltip></ml-chart-tooltip>\n<div class="ml-explorer" ng-controller="MlExplorerController">\n  <navbar ng-show="jobs.length > 0 && chrome.getVisible()">\n    <job-select-button></job-select-button>\n  </navbar>\n\n  <filter-bar\n    ng-show="queryFilters.length"\n    state="appState">\n  </filter-bar>\n\n  <ml-loading-indicator\n    label="Loading"\n    is-loading="loading === true"\n  />\n\n  <div class="no-results-container" ng-if="jobs.length === 0 && loading === false">\n    <div class="no-results euiText">\n      <div><i class="fa fa-exclamation-triangle" ></i>No jobs found</div>\n      <div><a href="ml#/jobs">Create new job</a></div>\n    </div>\n  </div>\n\n  <div class="no-results-container" ng-show="jobs.length > 0 && loading === false && hasResults === false">\n    <div class="no-results euiText">\n      <div><i class="fa fa-info-circle" ></i>No results found</div>\n      <div>Try widening the time selection or moving further back in time</div>\n    </div>\n  </div>\n\n  <div ng-if="jobs.length > 0 && loading === false && hasResults === true">\n    <div class="results-container">\n\n      <div ng-if="noInfluencersConfigured === true" class="no-influencers-warning">\n        <i aria-hidden="true" class="fa fa-info-circle" tooltip-placement="right" tooltip-append-to-body="true"\n          tooltip-html-unsafe="The Top Influencers list is hidden because no influencers have been configured for the selected jobs." ></i>\n      </div>\n\n      <div ng-if="noInfluencersConfigured === false" class="column col-xs-2 euiText">\n        <span class="panel-title">\n          Top Influencers\n        </span>\n        <ml-influencers-list\n          influencers="influencers"\n        />\n      </div>\n\n      <div class="column" ng-class="noInfluencersConfigured === true ? \'col-xs-12\' : \'col-xs-10\'">\n        <span class="panel-title euiText">\n          Anomaly timeline\n        </span>\n        <div\n          class="ml-explorer-swimlane euiText"\n          ng-mouseenter="setSwimlaneSelectActive(true)"\n          ng-mouseleave="setSwimlaneSelectActive(false)"\n        >\n          <ml-explorer-swimlane swimlane-type="overall" />\n        </div>\n\n        <div ng-if="viewBySwimlaneOptions.length > 0">\n          <div class="ml-controls">\n            <label for="selectViewBy" class="kuiLabel">View by:</label>\n            <div class="kuiButtonGroup" dropdown>\n              <button id="selectViewBy" type="button" class="form-control dropdown-toggle" dropdown-toggle ng-disabled="disabled">\n                <span>{{swimlaneViewByFieldName}}</span> <span class="caret"></span>\n              </button>\n              <ul class="dropdown-menu" role="menu">\n                <li ng-repeat="swimlaneOption in viewBySwimlaneOptions">\n                  <a href="" ng-click="setSwimlaneViewBy(swimlaneOption)">{{swimlaneOption}}</a>\n                </li>\n              </ul>\n            </div>\n\n            <ml-select-limit />\n\n            <span ng-if="viewByLoadedForTimeFormatted" class="panel-sub-title">\n              (Sorted by max anomaly score for {{viewByLoadedForTimeFormatted}})\n            </span>\n            <span ng-if="!viewByLoadedForTimeFormatted" class="panel-sub-title">\n              (Sorted by max anomaly score)\n            </span>\n          </div>\n\n          <div\n            class="ml-explorer-swimlane euiText"\n            ng-mouseenter="setSwimlaneSelectActive(true)"\n            ng-mouseleave="setSwimlaneSelectActive(false)"\n          >\n            <ml-explorer-swimlane swimlane-type="viewBy" />\n          </div>\n\n          <div ng-if="!showViewBySwimlane" class="text-center visError euiText">\n            <div class="item top"></div>\n            <div class="item">\n              <h4 class="euiTitle euiTitle--small">No {{swimlaneViewByFieldName}} influencers found</h4>\n            </div>\n            <div class="item bottom"></div>\n          </div>\n\n        </div>\n\n        <div ng-show="annotationsData.length > 0">\n          <span class="panel-title euiText">\n            Annotations\n          </span>\n    \n          <ml-annotation-table\n            annotations="annotationsData"\n            drill-down="true"\n            number-badge="false"\n          />\n  \n          <br /><br />\n        </div>\n  \n        <span class="panel-title euiText">\n          Anomalies\n        </span>\n\n        <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--directionRow euiFlexGroup--responsive ml-anomalies-controls">\n          <div class="euiFlexItem euiFlexItem--flexGrowZero" style="width:170px">\n            <div class="euiFormRow" id="select_severity_control">\n              <label class="euiFormLabel" for="select_severity">Severity threshold</label>\n              <div class="euiFormControlLayout">\n                <ml-select-severity id="select_severity" />\n              </div>\n            </div>\n          </div>\n          <div class="euiFlexItem euiFlexItem--flexGrowZero" style="width:170px">\n            <div class="euiFormRow" id="select_interval_control">\n              <label class="euiFormLabel" for="select_interval">Interval</label>\n              <div class="euiFormControlLayout">\n                <ml-select-interval id="select_interval" />\n              </div>\n            </div>\n          </div>\n          <div class="euiFlexItem euiFlexItem--flexGrowZero" ng-show="anomalyChartRecords.length > 0">\n            <div class="euiFormRow" id="show_charts_checkbox_control">\n              <div class="euiFormControlLayout">\n                <ml-checkbox-show-charts id="show_charts_checkbox" />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class="euiSpacer euiSpacer--m"></div>\n\n        <div class="euiText explorer-charts">\n          <ml-explorer-charts-container />\n        </div>\n\n        <ml-anomalies-table\n          table-data="tableData"\n        />\n\n      </div>\n\n    </div>\n  </div>\n\n</div>\n'},2432:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _explorer_swimlane=__webpack_require__(2433);var _modules=__webpack_require__(4);var _explorer_dashboard_service=__webpack_require__(409);var _explorer_constants=__webpack_require__(273);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlExplorerSwimlane",function(){function link(scope,element){function swimlaneDataChangeListener(props){if(props.swimlaneType!==scope.swimlaneType||props.swimlaneData===undefined||props.swimlaneData.earliest===undefined||props.swimlaneData.latest===undefined){return}if(scope.swimlaneType===_explorer_constants.SWIMLANE_TYPE.VIEW_BY&&props.showViewBySwimlane===false){return}_reactDom2.default.render(_react2.default.createElement(_explorer_swimlane.ExplorerSwimlane,props),element[0])}_explorer_dashboard_service.mlExplorerDashboardService.swimlaneDataChange.watch(swimlaneDataChangeListener);element.on("$destroy",function(){_explorer_dashboard_service.mlExplorerDashboardService.swimlaneDataChange.unwatch(swimlaneDataChangeListener);_reactDom2.default.unmountComponentAtNode(element[0]);scope.$destroy()})}return{scope:{swimlaneType:"@"},link:link}})},2433:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ExplorerSwimlane=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _d=__webpack_require__(20);var _d2=_interopRequireDefault(_d);var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _date_utils=__webpack_require__(221);var _chart_utils=__webpack_require__(197);var _anomaly_utils=__webpack_require__(256);var _string_utils=__webpack_require__(38);var _chart_tooltip_service=__webpack_require__(242);var _explorer_dashboard_service=__webpack_require__(409);var _explorer_constants=__webpack_require__(273);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ExplorerSwimlane=exports.ExplorerSwimlane=function(_React$Component){_inherits(ExplorerSwimlane,_React$Component);function ExplorerSwimlane(){var _ref;var _temp,_this,_ret;_classCallCheck(this,ExplorerSwimlane);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=ExplorerSwimlane.__proto__||Object.getPrototypeOf(ExplorerSwimlane)).call.apply(_ref,[this].concat(args))),_this),_this.cellMouseoverActive=true,_this.boundDragSelectListener=null,_this.previousSelectedData=null,_temp),_possibleConstructorReturn(_this,_ret)}_createClass(ExplorerSwimlane,[{key:"componentWillUnmount",value:function componentWillUnmount(){_explorer_dashboard_service.mlExplorerDashboardService.dragSelect.unwatch(this.boundDragSelectListener);var element=_d2.default.select(this.rootNode);element.html("")}},{key:"componentDidMount",value:function componentDidMount(){var element=_d2.default.select(this.rootNode.parentNode);if(!_explorer_dashboard_service.mlExplorerDashboardService.allowCellRangeSelection){element.classed("ml-hide-range-selection",true)}this.boundDragSelectListener=this.dragSelectListener.bind(this);_explorer_dashboard_service.mlExplorerDashboardService.dragSelect.watch(this.boundDragSelectListener);this.renderSwimlane()}},{key:"componentDidUpdate",value:function componentDidUpdate(){this.renderSwimlane()}},{key:"dragSelectListener",value:function dragSelectListener(_ref2){var action=_ref2.action,_ref2$elements=_ref2.elements,elements=_ref2$elements===undefined?[]:_ref2$elements;var element=_d2.default.select(this.rootNode.parentNode);var swimlaneType=this.props.swimlaneType;if(action===_explorer_constants.DRAG_SELECT_ACTION.NEW_SELECTION&&elements.length>0){var firstCellData=_d2.default.select(elements[0]).node().__clickData__;if(typeof firstCellData!=="undefined"&&swimlaneType===firstCellData.swimlaneType){var selectedData=elements.reduce(function(d,e){var cellData=_d2.default.select(e).node().__clickData__;d.bucketScore=Math.max(d.bucketScore,cellData.bucketScore);d.laneLabels.push(cellData.laneLabel);d.times.push(cellData.time);return d},{bucketScore:0,laneLabels:[],times:[]});selectedData.laneLabels=_lodash2.default.uniq(selectedData.laneLabels);selectedData.times=_lodash2.default.uniq(selectedData.times);if(_lodash2.default.isEqual(selectedData,this.previousSelectedData)===false){this.selectCell(elements,selectedData);this.previousSelectedData=selectedData}}this.cellMouseoverActive=true}else if(action===_explorer_constants.DRAG_SELECT_ACTION.ELEMENT_SELECT){element.classed("ml-dragselect-dragging",true);return}else if(action===_explorer_constants.DRAG_SELECT_ACTION.DRAG_START){this.cellMouseoverActive=false;return}this.previousSelectedData=null;element.classed("ml-dragselect-dragging",false);elements.map(function(e){return _d2.default.select(e).classed("ds-selected",false)})}},{key:"selectCell",value:function selectCell(cellsToSelect,_ref3){var laneLabels=_ref3.laneLabels,bucketScore=_ref3.bucketScore,times=_ref3.times;var _props=this.props,selection=_props.selection,swimlaneData=_props.swimlaneData,swimlaneType=_props.swimlaneType;var triggerNewSelection=false;if(cellsToSelect.length>1||bucketScore>0){triggerNewSelection=true}var oldSelection={selectedType:selection.selectedType,selectedLanes:selection.selectedLanes,selectedTimes:selection.selectedTimes};var newSelection={selectedType:swimlaneType,selectedLanes:laneLabels,selectedTimes:_d2.default.extent(times)};if(_lodash2.default.isEqual(oldSelection,newSelection)){triggerNewSelection=false}if(triggerNewSelection===false){_explorer_dashboard_service.mlExplorerDashboardService.swimlaneCellClick.changed({});return}var cellData={fieldName:swimlaneData.fieldName,lanes:laneLabels,times:_d2.default.extent(times),type:swimlaneType};_explorer_dashboard_service.mlExplorerDashboardService.swimlaneCellClick.changed(cellData)}},{key:"highlightSelection",value:function highlightSelection(cellsToSelect,laneLabels,times){var swimlaneType=this.props.swimlaneType;var wrapper=_d2.default.selectAll(".ml-explorer-swimlane");wrapper.selectAll(".lane-label").classed("lane-label-masked",true);wrapper.selectAll(".sl-cell-inner,.sl-cell-inner-dragselect").classed("sl-cell-inner-masked",true);wrapper.selectAll(".sl-cell-inner.sl-cell-inner-selected,.sl-cell-inner-dragselect.sl-cell-inner-selected").classed("sl-cell-inner-selected",false);_d2.default.selectAll(cellsToSelect).selectAll(".sl-cell-inner,.sl-cell-inner-dragselect").classed("sl-cell-inner-masked",false).classed("sl-cell-inner-selected",true);var rootParent=_d2.default.select(this.rootNode.parentNode);rootParent.selectAll(".lane-label").classed("lane-label-masked",function(){return laneLabels.indexOf(_d2.default.select(this).text())===-1});if(swimlaneType==="viewBy"){var overallSwimlane=_d2.default.select('ml-explorer-swimlane[swimlane-type="overall"]');times.forEach(function(time){var overallCell=overallSwimlane.selectAll('div[data-time="'+time+'"]').selectAll(".sl-cell-inner,.sl-cell-inner-dragselect");overallCell.classed("sl-cell-inner-selected",true)})}}},{key:"clearSelection",value:function clearSelection(){var wrapper=_d2.default.selectAll(".ml-explorer-swimlane");wrapper.selectAll(".lane-label").classed("lane-label-masked",false);wrapper.selectAll(".sl-cell-inner").classed("sl-cell-inner-masked",false);wrapper.selectAll(".sl-cell-inner.sl-cell-inner-selected").classed("sl-cell-inner-selected",false);wrapper.selectAll(".sl-cell-inner-dragselect.sl-cell-inner-selected").classed("sl-cell-inner-selected",false);wrapper.selectAll(".ds-selected").classed("sl-cell-inner-selected",false)}},{key:"renderSwimlane",value:function renderSwimlane(){var element=_d2.default.select(this.rootNode.parentNode);var cellMouseoverActive=this.cellMouseoverActive;var _props2=this.props,chartWidth=_props2.chartWidth,MlTimeBuckets=_props2.MlTimeBuckets,swimlaneData=_props2.swimlaneData,swimlaneType=_props2.swimlaneType,selection=_props2.selection;var lanes=swimlaneData.laneLabels,startTime=swimlaneData.earliest,endTime=swimlaneData.latest,stepSecs=swimlaneData.interval,points=swimlaneData.points;function colorScore(value){return(0,_anomaly_utils.getSeverityColor)(value)}var numBuckets=parseInt((endTime-startTime)/stepSecs);var cellHeight=30;var height=(lanes.length+1)*cellHeight-10;var laneLabelWidth=170;element.style("height",height+20+"px");var swimlanes=element.select(".ml-swimlanes");swimlanes.html("");var cellWidth=Math.floor(chartWidth/numBuckets);var xAxisWidth=cellWidth*numBuckets;var xAxisScale=_d2.default.time.scale().domain([new Date(startTime*1e3),new Date(endTime*1e3)]).range([0,xAxisWidth]);var timeBuckets=new MlTimeBuckets;timeBuckets.setInterval(stepSecs+"s");var xAxisTickFormat=timeBuckets.getScaledDateFormat();function cellMouseOverFactory(time,i){return function(lane){var bucketScore=getBucketScore(lane,time);if(bucketScore!==0){cellMouseover(this,lane,bucketScore,i,time)}}}function cellMouseover(target,laneLabel,bucketScore,index,time){if(bucketScore===undefined||cellMouseoverActive===false){return}var displayScore=bucketScore>1?parseInt(bucketScore):"< 1";var formattedDate=(0,_date_utils.formatHumanReadableDateTime)(time*1e3);var contents=formattedDate+"<br/><hr/>";if(swimlaneData.fieldName!==undefined){contents+=(0,_string_utils.mlEscape)(swimlaneData.fieldName)+": "+(0,_string_utils.mlEscape)(laneLabel)+"<br/><hr/>"}contents+="Max anomaly score: "+displayScore;var offsets=target.className==="sl-cell-inner"?{x:0,y:0}:{x:2,y:1};_chart_tooltip_service.mlChartTooltipService.show(contents,target,{x:target.offsetWidth-offsets.x,y:10+offsets.y})}function cellMouseleave(){_chart_tooltip_service.mlChartTooltipService.hide()}var d3Lanes=swimlanes.selectAll(".lane").data(lanes);var d3LanesEnter=d3Lanes.enter().append("div").classed("lane",true);d3LanesEnter.append("div").classed("lane-label",true).style("width",laneLabelWidth+"px").html(function(label){return(0,_string_utils.mlEscape)(label)}).on("click",function(){if(typeof selection.selectedLanes!=="undefined"){_explorer_dashboard_service.mlExplorerDashboardService.swimlaneCellClick.changed({})}}).each(function(){if(swimlaneData.fieldName!==undefined){_d2.default.select(this).attr("tooltip-html-unsafe",function(label){return(0,_string_utils.mlEscape)(swimlaneData.fieldName)+": "+(0,_string_utils.mlEscape)(label)}).attr("tooltip-placement","right").attr("aria-label",function(label){return(0,_string_utils.mlEscape)(swimlaneData.fieldName)+": "+(0,_string_utils.mlEscape)(label)})}});var cellsContainer=d3LanesEnter.append("div").classed("cells-container",true);function getBucketScore(lane,time){var bucketScore=0;var point=points.find(function(p){return p.value>0&&p.laneLabel===lane&&p.time===time});if(typeof point!=="undefined"){bucketScore=point.value}return bucketScore}var time=startTime;Array(numBuckets||0).fill(null).forEach(function(v,i){var cell=cellsContainer.append("div").classed("sl-cell",true).style("width",cellWidth+"px").attr("data-lane-label",function(label){return(0,_string_utils.mlEscape)(label)}).attr("data-time",time).attr("data-bucket-score",function(lane){return getBucketScore(lane,time)}).on("mouseover",cellMouseOverFactory(time,i)).on("mouseleave",cellMouseleave).each(function(laneLabel){this.__clickData__={bucketScore:getBucketScore(laneLabel,time),laneLabel:laneLabel,swimlaneType:swimlaneType,time:time}});cell.append("div").each(function(lane){var el=_d2.default.select(this);var color="none";var bucketScore=0;var point=points.find(function(p){return p.value>0&&p.laneLabel===lane&&p.time===time});if(typeof point!=="undefined"){bucketScore=point.value;color=colorScore(bucketScore);el.classed("sl-cell-inner",true).style("background-color",color)}else{el.classed("sl-cell-inner-dragselect",true)}});time+=stepSecs});var laneTimes=swimlanes.selectAll(".time-tick-labels").data(["x-axis"]).enter().append("div").classed("time-tick-labels",true);var svgHeight=25;var svg=laneTimes.append("svg").attr("width",chartWidth).attr("height",svgHeight);var xAxis=_d2.default.svg.axis().scale(xAxisScale).ticks((0,_chart_utils.numTicksForDateFormat)(chartWidth,xAxisTickFormat)).tickFormat(function(tick){return(0,_moment2.default)(tick).format(xAxisTickFormat)});var gAxis=svg.append("g").attr("class","x axis").call(xAxis);var overlapCheck=0;gAxis.selectAll("g.tick").each(function(){var tick=_d2.default.select(this);var xTransform=_d2.default.transform(tick.attr("transform")).translate[0];var tickWidth=tick.select("text").node().getBBox().width;var xMinOffset=xTransform-tickWidth/2;var xMaxOffset=xTransform+tickWidth/2;if(xMinOffset<overlapCheck){tick.remove()}else{overlapCheck=xTransform+tickWidth/2}if(xMaxOffset>chartWidth){tick.remove()}});_explorer_dashboard_service.mlExplorerDashboardService.swimlaneRenderDone.changed();var selectionState=selection;var selectedType=_lodash2.default.get(selectionState,"selectedType",undefined);var viewBy=_lodash2.default.get(selectionState,"viewBy","");if(swimlaneType!==selectedType&&selectedType!==undefined){element.selectAll(".lane-label").classed("lane-label-masked",true);element.selectAll(".sl-cell-inner").classed("sl-cell-inner-masked",true)}if(swimlaneType!==selectedType||swimlaneData.fieldName!==undefined&&swimlaneData.fieldName!==viewBy){return}var cellsToSelect=[];var selectedLanes=_lodash2.default.get(selectionState,"selectedLanes",[]);var selectedTimes=_lodash2.default.get(selectionState,"selectedTimes",[]);var selectedTimeExtent=_d2.default.extent(selectedTimes);selectedLanes.forEach(function(selectedLane){if(lanes.indexOf(selectedLane)>-1&&selectedTimeExtent[0]>=startTime&&selectedTimeExtent[1]<=endTime){var swimlaneElements=element.select(".ml-swimlanes");var laneCells=swimlaneElements.selectAll('div[data-lane-label="'+(0,_string_utils.mlEscape)(selectedLane)+'"]');laneCells.each(function(){var cell=_d2.default.select(this);var cellTime=cell.attr("data-time");if(cellTime>=selectedTimeExtent[0]&&cellTime<=selectedTimeExtent[1]){cellsToSelect.push(cell.node())}})}});var selectedMaxBucketScore=cellsToSelect.reduce(function(maxBucketScore,cell){return Math.max(maxBucketScore,+_d2.default.select(cell).attr("data-bucket-score")||0)},0);if(cellsToSelect.length>1||selectedMaxBucketScore>0){this.highlightSelection(cellsToSelect,selectedLanes,selectedTimes)}else{this.clearSelection()}}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(){return true}},{key:"setRef",value:function setRef(componentNode){this.rootNode=componentNode}},{key:"render",value:function render(){return _react2.default.createElement("div",{className:"ml-swimlanes",ref:this.setRef.bind(this)})}}]);return ExplorerSwimlane}(_react2.default.Component);ExplorerSwimlane.propTypes={chartWidth:_propTypes2.default.number.isRequired,MlTimeBuckets:_propTypes2.default.func.isRequired,swimlaneData:_propTypes2.default.shape({laneLabels:_propTypes2.default.array.isRequired}).isRequired,swimlaneType:_propTypes2.default.string.isRequired,selection:_propTypes2.default.object}},2434:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2435);__webpack_require__(474)},2435:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _jquery=__webpack_require__(17);var _jquery2=_interopRequireDefault(_jquery);var _explorer_charts_container=__webpack_require__(2436);var _explorer_charts_container_service=__webpack_require__(2443);var _chart_tooltip_service=__webpack_require__(242);var _explorer_dashboard_service=__webpack_require__(409);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlExplorerChartsContainer",function(mlSelectSeverityService){function link(scope,element){var anomalyDataChangeListener=(0,_explorer_charts_container_service.explorerChartsContainerServiceFactory)(mlSelectSeverityService,updateComponent,(0,_jquery2.default)(".explorer-charts"));_explorer_dashboard_service.mlExplorerDashboardService.anomalyDataChange.watch(anomalyDataChangeListener);scope.$on("$destroy",function(){_explorer_dashboard_service.mlExplorerDashboardService.anomalyDataChange.unwatch(anomalyDataChangeListener)});(0,_jquery2.default)(".ml-explorer-charts-tooltip").remove();(0,_jquery2.default)("body").append('<div class="ml-explorer-tooltip ml-explorer-charts-tooltip" style="opacity:0; display: none;">');element.on("$destroy",function(){scope.$destroy()});function updateComponent(data){var props={chartsPerRow:data.chartsPerRow,seriesToPlot:data.seriesToPlot,tooManyBuckets:!!data.tooManyBuckets,mlSelectSeverityService:mlSelectSeverityService,mlChartTooltipService:_chart_tooltip_service.mlChartTooltipService};_reactDom2.default.render(_react2.default.createElement(_explorer_charts_container.ExplorerChartsContainer,props),element[0])}_explorer_dashboard_service.mlExplorerDashboardService.chartsInitDone.changed()}return{restrict:"E",replace:false,scope:false,link:link}})},2436:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.ExplorerChartsContainer=ExplorerChartsContainer;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _chart_utils=__webpack_require__(197);var _explorer_chart_distribution=__webpack_require__(2437);var _explorer_chart_single_metric=__webpack_require__(2438);var _explorer_chart_label=__webpack_require__(2439);var _explorer_constants=__webpack_require__(273);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var textTooManyBuckets="This selection contains too many buckets to be displayed.\n The dashboard is best viewed over a shorter time range.";var textViewButton="Open in Single Metric Viewer";function getChartId(series){var jobId=series.jobId,detectorLabel=series.detectorLabel,entityFields=series.entityFields;var entities=entityFields.map(function(ef){return ef.fieldName+"/"+ef.fieldValue}).join(",");var id=jobId+"_"+detectorLabel+"_"+entities;return id}function ExplorerChartContainer(_ref){var series=_ref.series,tooManyBuckets=_ref.tooManyBuckets,mlSelectSeverityService=_ref.mlSelectSeverityService,wrapLabel=_ref.wrapLabel;var detectorLabel=series.detectorLabel,entityFields=series.entityFields;var chartType=(0,_chart_utils.getChartType)(series);var DetectorLabel=_react2.default.createElement(_react2.default.Fragment,null,detectorLabel);if(chartType===_explorer_constants.CHART_TYPE.EVENT_DISTRIBUTION){var byField=series.entityFields.find(function(d){return d.fieldType==="by"});if(typeof byField!=="undefined"){DetectorLabel=_react2.default.createElement(_react2.default.Fragment,null,detectorLabel,_react2.default.createElement("br",null),'y-axis event distribution split by "',byField.fieldName,'"');wrapLabel=true}}return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceBetween"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_explorer_chart_label.ExplorerChartLabel,{detectorLabel:DetectorLabel,entityFields:entityFields,infoTooltip:_extends({},series.infoTooltip,{chartType:chartType}),wrapLabel:wrapLabel})),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement("div",{className:"ml-explorer-chart-icons"},tooManyBuckets&&_react2.default.createElement("span",{className:"ml-explorer-chart-icon"},_react2.default.createElement(_eui.EuiIconTip,{content:textTooManyBuckets,position:"top",size:"s",type:"alert",color:"warning"})),_react2.default.createElement(_eui.EuiToolTip,{position:"top",content:textViewButton},_react2.default.createElement(_eui.EuiButtonEmpty,{iconSide:"right",iconType:"popout",size:"xs",onClick:function onClick(){return window.open((0,_chart_utils.getExploreSeriesLink)(series),"_blank")}},"View"))))),function(){if(chartType===_explorer_constants.CHART_TYPE.EVENT_DISTRIBUTION||chartType===_explorer_constants.CHART_TYPE.POPULATION_DISTRIBUTION){return _react2.default.createElement(_explorer_chart_distribution.ExplorerChartDistribution,{tooManyBuckets:tooManyBuckets,seriesConfig:series,mlSelectSeverityService:mlSelectSeverityService})}return _react2.default.createElement(_explorer_chart_single_metric.ExplorerChartSingleMetric,{tooManyBuckets:tooManyBuckets,seriesConfig:series,mlSelectSeverityService:mlSelectSeverityService})}())}function ExplorerChartsContainer(_ref2){var chartsPerRow=_ref2.chartsPerRow,seriesToPlot=_ref2.seriesToPlot,tooManyBuckets=_ref2.tooManyBuckets,mlSelectSeverityService=_ref2.mlSelectSeverityService;var chartsWidth=chartsPerRow===1?"calc(100% - 20px)":"auto";var chartsColumns=chartsPerRow===1?0:chartsPerRow;var wrapLabel=seriesToPlot.some(function(series){return(0,_chart_utils.isLabelLengthAboveThreshold)(series)});return _react2.default.createElement(_eui.EuiFlexGrid,{columns:chartsColumns},seriesToPlot.length>0&&seriesToPlot.map(function(series){return _react2.default.createElement(_eui.EuiFlexItem,{key:getChartId(series),className:"ml-explorer-chart-container",style:{minWidth:chartsWidth}},_react2.default.createElement(ExplorerChartContainer,{series:series,tooManyBuckets:tooManyBuckets,mlSelectSeverityService:mlSelectSeverityService,wrapLabel:wrapLabel}))}))}ExplorerChartsContainer.propTypes={seriesToPlot:_propTypes2.default.array.isRequired,tooManyBuckets:_propTypes2.default.bool.isRequired,mlSelectSeverityService:_propTypes2.default.object.isRequired,mlChartTooltipService:_propTypes2.default.object.isRequired}},2437:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ExplorerChartDistribution=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _d=__webpack_require__(20);var _d2=_interopRequireDefault(_d);var _jquery=__webpack_require__(17);var _jquery2=_interopRequireDefault(_jquery);var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _date_utils=__webpack_require__(221);var _format_value=__webpack_require__(299);var _anomaly_utils=__webpack_require__(256);var _chart_utils=__webpack_require__(197);var _time_buckets=__webpack_require__(218);var _loading_indicator=__webpack_require__(1015);var _string_utils=__webpack_require__(38);var _field_format_service=__webpack_require__(209);var _chart_tooltip_service=__webpack_require__(242);var _explorer_constants=__webpack_require__(273);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CONTENT_WRAPPER_HEIGHT=215;var Y_AXIS_LABEL_THRESHOLD=10;var ExplorerChartDistribution=exports.ExplorerChartDistribution=function(_React$Component){_inherits(ExplorerChartDistribution,_React$Component);function ExplorerChartDistribution(){_classCallCheck(this,ExplorerChartDistribution);return _possibleConstructorReturn(this,(ExplorerChartDistribution.__proto__||Object.getPrototypeOf(ExplorerChartDistribution)).apply(this,arguments))}_createClass(ExplorerChartDistribution,[{key:"componentDidMount",value:function componentDidMount(){this.renderChart()}},{key:"componentDidUpdate",value:function componentDidUpdate(){this.renderChart()}},{key:"renderChart",value:function renderChart(){var _props=this.props,tooManyBuckets=_props.tooManyBuckets,mlSelectSeverityService=_props.mlSelectSeverityService;var element=this.rootNode;var config=this.props.seriesConfig;if(typeof config==="undefined"||Array.isArray(config.chartData)===false){return}var fieldFormat=_field_format_service.mlFieldFormatService.getFieldFormat(config.jobId,config.detectorIndex);var vizWidth=0;var chartHeight=170;var LINE_CHART_ANOMALY_RADIUS=7;var SCHEDULED_EVENT_MARKER_HEIGHT=5;var chartType=(0,_chart_utils.getChartType)(config);var margin={top:10,right:0,bottom:30,left:0};if(chartType===_explorer_constants.CHART_TYPE.POPULATION_DISTRIBUTION){margin.left=60}var lineChartXScale=null;var lineChartYScale=null;var lineChartGroup=void 0;var lineChartValuesLine=null;var CHART_Y_ATTRIBUTE=chartType===_explorer_constants.CHART_TYPE.EVENT_DISTRIBUTION?"entity":"value";var highlight=config.chartData.find(function(d){return d.anomalyScore!==undefined});highlight=highlight&&highlight.entity;var filteredChartData=init(config);drawRareChart(filteredChartData);function init(_ref){var chartData=_ref.chartData;var $el=(0,_jquery2.default)(".ml-explorer-chart");var chartElement=_d2.default.select(element).select(".content-wrapper");chartElement.select("svg").remove();var svgWidth=$el.width();var svgHeight=chartHeight+margin.top+margin.bottom;var svg=chartElement.append("svg").classed("ml-explorer-chart-svg",true).attr("width",svgWidth).attr("height",svgHeight);var categoryLimit=30;var scaleCategories=_d2.default.nest().key(function(d){return d.entity}).entries(chartData).sort(function(a,b){return b.values.length-a.values.length}).filter(function(d,i){if(chartType===_explorer_constants.CHART_TYPE.EVENT_DISTRIBUTION){return i<categoryLimit||d.key===highlight}return true}).map(function(d){return d.key});chartData=chartData.filter(function(d){return scaleCategories.includes(d.entity)});if(chartType===_explorer_constants.CHART_TYPE.POPULATION_DISTRIBUTION){var focusData=chartData.filter(function(d){return d.entity===highlight}).map(function(d){return d.value});var focusExtent=_d2.default.extent(focusData);chartData=chartData.filter(function(d){return d.value<=focusExtent[1]});lineChartYScale=_d2.default.scale.linear().range([chartHeight,0]).domain([0,focusExtent[1]]).nice()}else if(chartType===_explorer_constants.CHART_TYPE.EVENT_DISTRIBUTION){var rowMargin=5;lineChartYScale=_d2.default.scale.ordinal().rangePoints([rowMargin,chartHeight-rowMargin]).domain(scaleCategories)}else{throw"chartType '"+chartType+"' not supported"}var yAxis=_d2.default.svg.axis().scale(lineChartYScale).orient("left").innerTickSize(0).outerTickSize(0).tickPadding(10);var maxYAxisLabelWidth=0;var tempLabelText=svg.append("g").attr("class","temp-axis-label tick");var tempLabelTextData=chartType===_explorer_constants.CHART_TYPE.POPULATION_DISTRIBUTION?lineChartYScale.ticks():scaleCategories;tempLabelText.selectAll("text.temp.axis").data(tempLabelTextData).enter().append("text").text(function(d){if(fieldFormat!==undefined){return fieldFormat.convert(d,"text")}else{if(chartType===_explorer_constants.CHART_TYPE.POPULATION_DISTRIBUTION){return lineChartYScale.tickFormat()(d)}return d}}).each(function(){maxYAxisLabelWidth=Math.max(this.getBBox().width+yAxis.tickPadding(),maxYAxisLabelWidth)}).remove();_d2.default.select(".temp-axis-label").remove();if(chartType===_explorer_constants.CHART_TYPE.POPULATION_DISTRIBUTION||chartType===_explorer_constants.CHART_TYPE.EVENT_DISTRIBUTION&&scaleCategories.length<=Y_AXIS_LABEL_THRESHOLD){margin.left=Math.max(maxYAxisLabelWidth,40)}vizWidth=svgWidth-margin.left-margin.right;lineChartXScale=_d2.default.time.scale().range([0,vizWidth]).domain([config.plotEarliest,config.plotLatest]);lineChartValuesLine=_d2.default.svg.line().x(function(d){return lineChartXScale(d.date)}).y(function(d){return lineChartYScale(d[CHART_Y_ATTRIBUTE])}).defined(function(d){return d.value!==null});lineChartGroup=svg.append("g").attr("class","line-chart").attr("transform","translate("+margin.left+","+margin.top+")");return chartData}function drawRareChart(data){lineChartGroup.append("rect").attr("x",0).attr("y",0).attr("height",chartHeight).attr("width",vizWidth).style("stroke","#cccccc").style("fill","none").style("stroke-width",1);drawRareChartAxes();drawRareChartHighlightedSpan();drawRareChartDots(data,lineChartGroup,lineChartValuesLine);drawRareChartMarkers(data)}function drawRareChartAxes(){var timeBuckets=new _time_buckets.TimeBuckets;var bounds={min:(0,_moment2.default)(config.plotEarliest),max:(0,_moment2.default)(config.plotLatest)};timeBuckets.setBounds(bounds);timeBuckets.setInterval("auto");var xAxisTickFormat=timeBuckets.getScaledDateFormat();var tickValuesStart=Math.max(config.selectedEarliest,config.plotEarliest);var interval=config.selectedLatest-config.selectedEarliest+1;var tickValues=(0,_chart_utils.getTickValues)(tickValuesStart,interval,config.plotEarliest,config.plotLatest);var xAxis=_d2.default.svg.axis().scale(lineChartXScale).orient("bottom").innerTickSize(-chartHeight).outerTickSize(0).tickPadding(10).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)});if(tooManyBuckets===false){xAxis.tickValues(tickValues)}else{xAxis.ticks((0,_chart_utils.numTicksForDateFormat)(vizWidth,xAxisTickFormat))}var yAxis=_d2.default.svg.axis().scale(lineChartYScale).orient("left").innerTickSize(0).outerTickSize(0).tickPadding(10);if(fieldFormat!==undefined){yAxis.tickFormat(function(d){return fieldFormat.convert(d,"text")})}var axes=lineChartGroup.append("g");var gAxis=axes.append("g").attr("class","x axis").attr("transform","translate(0,"+chartHeight+")").call(xAxis);axes.append("g").attr("class","y axis").call(yAxis);if(chartType===_explorer_constants.CHART_TYPE.EVENT_DISTRIBUTION){axes.select(".y").selectAll("text").each(function(d){_d2.default.select(this).classed("ml-explorer-chart-axis-emphasis",d===highlight)})}if(tooManyBuckets===false){(0,_chart_utils.removeLabelOverlap)(gAxis,tickValuesStart,interval,vizWidth)}}function drawRareChartDots(dotsData,rareChartGroup,rareChartValuesLine){var radius=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1.5;var dotGroup=rareChartGroup.select(".values-dots").empty()?rareChartGroup.append("g").classed("values-dots",true):rareChartGroup.select(".values-dots");var dots=dotGroup.selectAll("circle").data(dotsData);dots.enter().append("circle").classed("values-dots-circle",true).classed("values-dots-circle-blur",function(d){return d.entity!==highlight}).attr("r",function(d){return d.entity===highlight?radius*1.5:radius});dots.attr("cx",rareChartValuesLine.x()).attr("cy",rareChartValuesLine.y());dots.exit().remove()}function drawRareChartHighlightedSpan(){var rectStart=Math.max(config.selectedEarliest,config.plotEarliest);var rectEnd=Math.min(config.selectedLatest,config.plotLatest);var rectWidth=lineChartXScale(rectEnd)-lineChartXScale(rectStart);lineChartGroup.append("rect").attr("class","selected-interval").attr("x",lineChartXScale(new Date(rectStart))+2).attr("y",2).attr("rx",3).attr("ry",3).attr("width",rectWidth-4).attr("height",chartHeight-4)}function drawRareChartMarkers(data){var dots=lineChartGroup.append("g").attr("class","chart-markers").selectAll(".metric-value").data(data.filter(function(d){return d.value!==null}));dots.exit().remove();dots.enter().append("circle").attr("r",LINE_CHART_ANOMALY_RADIUS).on("mouseover",function(d){showLineChartTooltip(d,this)}).on("mouseout",function(){return _chart_tooltip_service.mlChartTooltipService.hide()});var threshold=mlSelectSeverityService.state.get("threshold");dots.attr("cx",function(d){return lineChartXScale(d.date)}).attr("cy",function(d){return lineChartYScale(d[CHART_Y_ATTRIBUTE])}).attr("class",function(d){var markerClass="metric-value";if(_lodash2.default.has(d,"anomalyScore")&&Number(d.anomalyScore)>=threshold.val){markerClass+=" anomaly-marker ";markerClass+=(0,_anomaly_utils.getSeverityWithLow)(d.anomalyScore)}return markerClass});var scheduledEventMarkers=lineChartGroup.select(".chart-markers").selectAll(".scheduled-event-marker").data(data.filter(function(d){return d.scheduledEvents!==undefined}));scheduledEventMarkers.exit().remove();scheduledEventMarkers.enter().append("rect").attr("width",LINE_CHART_ANOMALY_RADIUS*2).attr("height",SCHEDULED_EVENT_MARKER_HEIGHT).attr("class","scheduled-event-marker").attr("rx",1).attr("ry",1);scheduledEventMarkers.attr("x",function(d){return lineChartXScale(d.date)-LINE_CHART_ANOMALY_RADIUS}).attr("y",function(d){return lineChartYScale(d[CHART_Y_ATTRIBUTE])-SCHEDULED_EVENT_MARKER_HEIGHT/2})}function showLineChartTooltip(marker,circle){var formattedDate=(0,_date_utils.formatHumanReadableDateTime)(marker.date);var contents=formattedDate+"<br/><hr/>";if(_lodash2.default.has(marker,"entity")){contents+="<div>"+marker.entity+"</div>"}if(_lodash2.default.has(marker,"anomalyScore")){var score=parseInt(marker.anomalyScore);var displayScore=score>0?score:"< 1";contents+="anomaly score: "+displayScore;if(chartType!==_explorer_constants.CHART_TYPE.EVENT_DISTRIBUTION){contents+="<br/>value: "+(0,_format_value.formatValue)(marker.value,config.functionDescription,fieldFormat);if(typeof marker.numberOfCauses==="undefined"||marker.numberOfCauses===1){contents+="<br/>typical: "+(0,_format_value.formatValue)(marker.typical,config.functionDescription,fieldFormat)}if(typeof marker.byFieldName!=="undefined"&&_lodash2.default.has(marker,"numberOfCauses")){var numberOfCauses=marker.numberOfCauses;var byFieldName=(0,_string_utils.mlEscape)(marker.byFieldName);if(numberOfCauses===1){contents+="<br/> 1 unusual "+byFieldName+" value"}else if(numberOfCauses<10){contents+="<br/> "+numberOfCauses+" unusual "+byFieldName+" values"}else{contents+="<br/> "+numberOfCauses+"+ unusual "+byFieldName+" values"}}}}else if(chartType!==_explorer_constants.CHART_TYPE.EVENT_DISTRIBUTION){contents+="value: "+(0,_format_value.formatValue)(marker.value,config.functionDescription,fieldFormat)}if(_lodash2.default.has(marker,"scheduledEvents")){contents+="<div><hr/>Scheduled events:<br/>"+marker.scheduledEvents.map(_string_utils.mlEscape).join("<br/>")+"</div>"}_chart_tooltip_service.mlChartTooltipService.show(contents,circle,{x:LINE_CHART_ANOMALY_RADIUS*2,y:0})}}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(){return true}},{key:"setRef",value:function setRef(componentNode){this.rootNode=componentNode}},{key:"render",value:function render(){var seriesConfig=this.props.seriesConfig;if(typeof seriesConfig==="undefined"){return null}var isLoading=seriesConfig.loading;return _react2.default.createElement("div",{className:"ml-explorer-chart",ref:this.setRef.bind(this)},isLoading&&_react2.default.createElement(_loading_indicator.LoadingIndicator,{height:CONTENT_WRAPPER_HEIGHT}),!isLoading&&_react2.default.createElement("div",{className:"content-wrapper"}))}}]);return ExplorerChartDistribution}(_react2.default.Component);ExplorerChartDistribution.propTypes={seriesConfig:_propTypes2.default.object,mlSelectSeverityService:_propTypes2.default.object.isRequired}},2438:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ExplorerChartSingleMetric=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _d=__webpack_require__(20);var _d2=_interopRequireDefault(_d);var _jquery=__webpack_require__(17);var _jquery2=_interopRequireDefault(_jquery);var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _date_utils=__webpack_require__(221);var _format_value=__webpack_require__(299);var _anomaly_utils=__webpack_require__(256);var _chart_utils=__webpack_require__(197);var _time_buckets=__webpack_require__(218);var _loading_indicator=__webpack_require__(1015);var _string_utils=__webpack_require__(38);var _field_format_service=__webpack_require__(209);var _chart_tooltip_service=__webpack_require__(242);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CONTENT_WRAPPER_HEIGHT=215;var CONTENT_WRAPPER_CLASS="ml-explorer-chart-content-wrapper";var ExplorerChartSingleMetric=exports.ExplorerChartSingleMetric=function(_React$Component){_inherits(ExplorerChartSingleMetric,_React$Component);function ExplorerChartSingleMetric(){_classCallCheck(this,ExplorerChartSingleMetric);return _possibleConstructorReturn(this,(ExplorerChartSingleMetric.__proto__||Object.getPrototypeOf(ExplorerChartSingleMetric)).apply(this,arguments))}_createClass(ExplorerChartSingleMetric,[{key:"componentDidMount",value:function componentDidMount(){this.renderChart()}},{key:"componentDidUpdate",value:function componentDidUpdate(){this.renderChart()}},{key:"renderChart",value:function renderChart(){var _props=this.props,tooManyBuckets=_props.tooManyBuckets,mlSelectSeverityService=_props.mlSelectSeverityService;var element=this.rootNode;var config=this.props.seriesConfig;if(typeof config==="undefined"||Array.isArray(config.chartData)===false){return}var fieldFormat=_field_format_service.mlFieldFormatService.getFieldFormat(config.jobId,config.detectorIndex);var vizWidth=0;var chartHeight=170;var margin={top:10,right:0,bottom:30,left:60};var lineChartXScale=null;var lineChartYScale=null;var lineChartGroup=void 0;var lineChartValuesLine=null;init(config.chartLimits);drawLineChart(config.chartData);function init(chartLimits){var $el=(0,_jquery2.default)(".ml-explorer-chart");var chartElement=_d2.default.select(element).select("."+CONTENT_WRAPPER_CLASS);chartElement.select("svg").remove();var svgWidth=$el.width();var svgHeight=chartHeight+margin.top+margin.bottom;var svg=chartElement.append("svg").classed("ml-explorer-chart-svg",true).attr("width",svgWidth).attr("height",svgHeight);lineChartYScale=_d2.default.scale.linear().range([chartHeight,0]).domain([chartLimits.min,chartLimits.max]).nice();var yAxis=_d2.default.svg.axis().scale(lineChartYScale).orient("left").innerTickSize(0).outerTickSize(0).tickPadding(10);var maxYAxisLabelWidth=0;var tempLabelText=svg.append("g").attr("class","temp-axis-label tick");tempLabelText.selectAll("text.temp.axis").data(lineChartYScale.ticks()).enter().append("text").text(function(d){if(fieldFormat!==undefined){return fieldFormat.convert(d,"text")}else{return lineChartYScale.tickFormat()(d)}}).each(function(){maxYAxisLabelWidth=Math.max(this.getBBox().width+yAxis.tickPadding(),maxYAxisLabelWidth)}).remove();_d2.default.select(".temp-axis-label").remove();margin.left=Math.max(maxYAxisLabelWidth,40);vizWidth=svgWidth-margin.left-margin.right;lineChartXScale=_d2.default.time.scale().range([0,vizWidth]).domain([config.plotEarliest,config.plotLatest]);lineChartValuesLine=_d2.default.svg.line().x(function(d){return lineChartXScale(d.date)}).y(function(d){return lineChartYScale(d.value)}).defined(function(d){return d.value!==null});lineChartGroup=svg.append("g").attr("class","line-chart").attr("transform","translate("+margin.left+","+margin.top+")")}function drawLineChart(data){lineChartGroup.append("rect").attr("x",0).attr("y",0).attr("height",chartHeight).attr("width",vizWidth).style("stroke","#cccccc").style("fill","none").style("stroke-width",1);drawLineChartAxes();drawLineChartHighlightedSpan();drawLineChartPaths(data);(0,_chart_utils.drawLineChartDots)(data,lineChartGroup,lineChartValuesLine);drawLineChartMarkers(data)}function drawLineChartAxes(){var timeBuckets=new _time_buckets.TimeBuckets;var bounds={min:(0,_moment2.default)(config.plotEarliest),max:(0,_moment2.default)(config.plotLatest)};timeBuckets.setBounds(bounds);timeBuckets.setInterval("auto");var xAxisTickFormat=timeBuckets.getScaledDateFormat();var tickValuesStart=Math.max(config.selectedEarliest,config.plotEarliest);var interval=config.selectedLatest-config.selectedEarliest+1;var tickValues=(0,_chart_utils.getTickValues)(tickValuesStart,interval,config.plotEarliest,config.plotLatest);var xAxis=_d2.default.svg.axis().scale(lineChartXScale).orient("bottom").innerTickSize(-chartHeight).outerTickSize(0).tickPadding(10).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)});if(tooManyBuckets===false){xAxis.tickValues(tickValues)}else{xAxis.ticks((0,_chart_utils.numTicksForDateFormat)(vizWidth,xAxisTickFormat))}var yAxis=_d2.default.svg.axis().scale(lineChartYScale).orient("left").innerTickSize(0).outerTickSize(0).tickPadding(10);if(fieldFormat!==undefined){yAxis.tickFormat(function(d){return fieldFormat.convert(d,"text")})}var axes=lineChartGroup.append("g");var gAxis=axes.append("g").attr("class","x axis").attr("transform","translate(0,"+chartHeight+")").call(xAxis);axes.append("g").attr("class","y axis").call(yAxis);if(tooManyBuckets===false){(0,_chart_utils.removeLabelOverlap)(gAxis,tickValuesStart,interval,vizWidth)}}function drawLineChartHighlightedSpan(){var rectStart=Math.max(config.selectedEarliest,config.plotEarliest);var rectEnd=Math.min(config.selectedLatest,config.plotLatest);var rectWidth=lineChartXScale(rectEnd)-lineChartXScale(rectStart);lineChartGroup.append("rect").attr("class","selected-interval").attr("x",lineChartXScale(new Date(rectStart))+2).attr("y",2).attr("rx",3).attr("ry",3).attr("width",rectWidth-4).attr("height",chartHeight-4)}function drawLineChartPaths(data){lineChartGroup.append("path").attr("class","values-line").attr("d",lineChartValuesLine(data))}function drawLineChartMarkers(data){var dots=lineChartGroup.append("g").attr("class","chart-markers").selectAll(".metric-value").data(data.filter(function(d){return d.value!==null&&!(0,_chart_utils.showMultiBucketAnomalyMarker)(d)}));dots.exit().remove();dots.enter().append("circle").attr("r",_chart_utils.LINE_CHART_ANOMALY_RADIUS).on("mouseover",function(d){showLineChartTooltip(d,this)}).on("mouseout",function(){return _chart_tooltip_service.mlChartTooltipService.hide()});var threshold=mlSelectSeverityService.state.get("threshold");dots.attr("cx",function(d){return lineChartXScale(d.date)}).attr("cy",function(d){return lineChartYScale(d.value)}).attr("class",function(d){var markerClass="metric-value";if(_lodash2.default.has(d,"anomalyScore")&&Number(d.anomalyScore)>=threshold.val){markerClass+=" anomaly-marker "+(0,_anomaly_utils.getSeverityWithLow)(d.anomalyScore)}return markerClass});var multiBucketMarkers=lineChartGroup.select(".chart-markers").selectAll(".multi-bucket").data(data.filter(function(d){return d.anomalyScore!==null&&(0,_chart_utils.showMultiBucketAnomalyMarker)(d)===true}));multiBucketMarkers.exit().remove();multiBucketMarkers.enter().append("path").attr("d",_d2.default.svg.symbol().size(_chart_utils.MULTI_BUCKET_SYMBOL_SIZE).type("cross")).attr("transform",function(d){return"translate("+lineChartXScale(d.date)+", "+lineChartYScale(d.value)+")"}).attr("class",function(d){return"anomaly-marker multi-bucket "+(0,_anomaly_utils.getSeverityWithLow)(d.anomalyScore)}).on("mouseover",function(d){showLineChartTooltip(d,this)}).on("mouseout",function(){return _chart_tooltip_service.mlChartTooltipService.hide()});var scheduledEventMarkers=lineChartGroup.select(".chart-markers").selectAll(".scheduled-event-marker").data(data.filter(function(d){return d.scheduledEvents!==undefined}));scheduledEventMarkers.exit().remove();scheduledEventMarkers.enter().append("rect").attr("width",_chart_utils.LINE_CHART_ANOMALY_RADIUS*2).attr("height",_chart_utils.SCHEDULED_EVENT_SYMBOL_HEIGHT).attr("class","scheduled-event-marker").attr("rx",1).attr("ry",1);scheduledEventMarkers.attr("x",function(d){return lineChartXScale(d.date)-_chart_utils.LINE_CHART_ANOMALY_RADIUS}).attr("y",function(d){return lineChartYScale(d.value)-_chart_utils.SCHEDULED_EVENT_SYMBOL_HEIGHT/2})}function showLineChartTooltip(marker,circle){var formattedDate=(0,_date_utils.formatHumanReadableDateTime)(marker.date);var contents=formattedDate+"<br/><hr/>";if(_lodash2.default.has(marker,"anomalyScore")){var score=parseInt(marker.anomalyScore);var displayScore=score>0?score:"< 1";contents+="anomaly score: "+displayScore;if((0,_chart_utils.showMultiBucketAnomalyTooltip)(marker)===true){contents+="<br/>multi-bucket impact: "+(0,_anomaly_utils.getMultiBucketImpactLabel)(marker.multiBucketImpact)}if(_lodash2.default.has(marker,"actual")&&config.functionDescription!=="rare"){contents+="<br/>actual: "+(0,_format_value.formatValue)(marker.actual,config.functionDescription,fieldFormat);contents+="<br/>typical: "+(0,_format_value.formatValue)(marker.typical,config.functionDescription,fieldFormat)}else{contents+="<br/>value: "+(0,_format_value.formatValue)(marker.value,config.functionDescription,fieldFormat);if(_lodash2.default.has(marker,"byFieldName")&&_lodash2.default.has(marker,"numberOfCauses")){var numberOfCauses=marker.numberOfCauses;var byFieldName=(0,_string_utils.mlEscape)(marker.byFieldName);if(numberOfCauses===1){contents+="<br/> 1 unusual "+byFieldName+" value"}else if(numberOfCauses<10){contents+="<br/> "+numberOfCauses+" unusual "+byFieldName+" values"}else{contents+="<br/> "+numberOfCauses+"+ unusual "+byFieldName+" values"}}}}else{contents+="value: "+(0,_format_value.formatValue)(marker.value,config.functionDescription,fieldFormat)}if(_lodash2.default.has(marker,"scheduledEvents")){contents+="<br/><hr/>Scheduled events:<br/>"+marker.scheduledEvents.map(_string_utils.mlEscape).join("<br/>")}_chart_tooltip_service.mlChartTooltipService.show(contents,circle,{x:_chart_utils.LINE_CHART_ANOMALY_RADIUS*2,y:0})}}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(){return true}},{key:"setRef",value:function setRef(componentNode){this.rootNode=componentNode}},{key:"render",value:function render(){var seriesConfig=this.props.seriesConfig;if(typeof seriesConfig==="undefined"){return null}var isLoading=seriesConfig.loading;return _react2.default.createElement("div",{className:"ml-explorer-chart",ref:this.setRef.bind(this)},isLoading&&_react2.default.createElement(_loading_indicator.LoadingIndicator,{height:CONTENT_WRAPPER_HEIGHT}),!isLoading&&_react2.default.createElement("div",{className:CONTENT_WRAPPER_CLASS}))}}]);return ExplorerChartSingleMetric}(_react2.default.Component);ExplorerChartSingleMetric.propTypes={tooManyBuckets:_propTypes2.default.bool,seriesConfig:_propTypes2.default.object,mlSelectSeverityService:_propTypes2.default.object.isRequired}},2439:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _explorer_chart_label=__webpack_require__(2440);Object.keys(_explorer_chart_label).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _explorer_chart_label[key]}})})},2440:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ExplorerChartLabel=ExplorerChartLabel;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _explorer_chart_label_badge=__webpack_require__(2441);var _explorer_chart_info_tooltip=__webpack_require__(2442);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ExplorerChartLabel(_ref){var detectorLabel=_ref.detectorLabel,entityFields=_ref.entityFields,infoTooltip=_ref.infoTooltip,_ref$wrapLabel=_ref.wrapLabel,wrapLabel=_ref$wrapLabel===undefined?false:_ref$wrapLabel;var labelSeparator=wrapLabel===true||entityFields.length===0||detectorLabel.length===0?_react2.default.createElement(_react2.default.Fragment,null," "):_react2.default.createElement(_react2.default.Fragment,null," – ");var entityFieldBadges=entityFields.map(function(entity){return _react2.default.createElement(_explorer_chart_label_badge.ExplorerChartLabelBadge,{entity:entity,key:entity.fieldName+" "+entity.fieldValue})});var infoIcon=_react2.default.createElement("span",{className:"ml-explorer-chart-info-icon"},_react2.default.createElement(_eui.EuiIconTip,{className:"ml-explorer-chart-eui-icon-tip",content:_react2.default.createElement(_explorer_chart_info_tooltip.ExplorerChartInfoTooltip,infoTooltip),position:"top",size:"s"}));return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement("span",{className:"ml-explorer-chart-label"},_react2.default.createElement("span",{className:"ml-explorer-chart-label-detector"},detectorLabel,labelSeparator),wrapLabel&&infoIcon,!wrapLabel&&_react2.default.createElement(_react2.default.Fragment,null,entityFieldBadges," ",infoIcon)),wrapLabel&&_react2.default.createElement("span",{className:"ml-explorer-chart-label-badges"},entityFieldBadges))}ExplorerChartLabel.propTypes={detectorLabel:_propTypes2.default.object.isRequired,entityFields:_propTypes2.default.arrayOf(_explorer_chart_label_badge.ExplorerChartLabelBadge.propTypes.entity),infoTooltip:_propTypes2.default.object.isRequired,wrapLabel:_propTypes2.default.bool}},2441:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ExplorerChartLabelBadge=ExplorerChartLabelBadge;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ExplorerChartLabelBadge(_ref){var entity=_ref.entity;return _react2.default.createElement("span",{className:"ml-explorer-chart-label-badge"},_react2.default.createElement(_eui.EuiBadge,{color:"hollow",className:"ml-reset-font-weight"},entity.fieldName," ",_react2.default.createElement("strong",null,entity.fieldValue)))}ExplorerChartLabelBadge.propTypes={entity:_propTypes2.default.shape({fieldName:_propTypes2.default.string.isRequired,fieldValue:_propTypes2.default.string.isRequired})}},2442:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _CHART_DESCRIPTION;exports.ExplorerChartInfoTooltip=ExplorerChartInfoTooltip;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _explorer_constants=__webpack_require__(273);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var CHART_DESCRIPTION=(_CHART_DESCRIPTION={},_defineProperty(_CHART_DESCRIPTION,_explorer_constants.CHART_TYPE.EVENT_DISTRIBUTION,"The gray dots depict the distribution of occurrences over time for a sample of by_field_values with more frequent event types at the top and rarer ones at the bottom."),_defineProperty(_CHART_DESCRIPTION,_explorer_constants.CHART_TYPE.POPULATION_DISTRIBUTION,"The gray dots depict the distribution of values over time for a sample of over_field_values."),_CHART_DESCRIPTION);function TooltipDefinitionList(_ref){var toolTipData=_ref.toolTipData;return _react2.default.createElement("dl",{className:"mlDescriptionList"},toolTipData.map(function(_ref2){var title=_ref2.title,description=_ref2.description;return _react2.default.createElement(_react2.default.Fragment,{key:title+" "+description},_react2.default.createElement("dt",{className:"mlDescriptionList__title"},title),_react2.default.createElement("dd",{className:"mlDescriptionList__description"},description))}))}function ExplorerChartInfoTooltip(_ref3){var jobId=_ref3.jobId,aggregationInterval=_ref3.aggregationInterval,chartFunction=_ref3.chartFunction,chartType=_ref3.chartType,_ref3$entityFields=_ref3.entityFields,entityFields=_ref3$entityFields===undefined?[]:_ref3$entityFields;var chartDescription=CHART_DESCRIPTION[chartType];var toolTipData=[{title:"job ID",description:jobId},{title:"aggregation interval",description:aggregationInterval},{title:"chart function",description:chartFunction}];entityFields.forEach(function(entityField){toolTipData.push({title:entityField.fieldName,description:entityField.fieldValue})});return _react2.default.createElement("div",{className:"ml-explorer-chart-info-tooltip"},_react2.default.createElement(TooltipDefinitionList,{toolTipData:toolTipData}),chartDescription&&_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement("div",{className:"ml-explorer-chart-description"},chartDescription)))}ExplorerChartInfoTooltip.propTypes={jobId:_propTypes2.default.string.isRequired,aggregationInterval:_propTypes2.default.string,chartFunction:_propTypes2.default.string,entityFields:_propTypes2.default.array}},2443:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.explorerChartsContainerServiceFactory=explorerChartsContainerServiceFactory;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _explorer_chart_config_builder=__webpack_require__(2444);var _chart_utils=__webpack_require__(197);var _job_utils=__webpack_require__(34);var _results_service=__webpack_require__(338);var _job_service=__webpack_require__(23);var _explorer_constants=__webpack_require__(273);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function explorerChartsContainerServiceFactory(mlSelectSeverityService,callback,$chartContainer){var FUNCTION_DESCRIPTIONS_TO_PLOT=["mean","min","max","sum","count","distinct_count","median","rare"];var CHART_MAX_POINTS=500;var ANOMALIES_MAX_RESULTS=500;var MAX_SCHEDULED_EVENTS=10;var ML_TIME_FIELD_NAME="timestamp";var USE_OVERALL_CHART_LIMITS=false;var MAX_CHARTS_PER_ROW=4;function getDefaultData(){return{seriesToPlot:[],tooManyBuckets:false,timeFieldName:"timestamp"}}callback(getDefaultData());var requestCount=0;var anomalyDataChangeListener=function anomalyDataChangeListener(anomalyRecords,earliestMs,latestMs){var newRequestCount=++requestCount;requestCount=newRequestCount;var data=getDefaultData();var threshold=mlSelectSeverityService.state.get("threshold");var filteredRecords=anomalyRecords.filter(function(record){return Number(record.record_score)>=threshold.val});var allSeriesRecords=processRecordsForDisplay(filteredRecords);var chartsContainerWidth=Math.floor($chartContainer.width());var chartsPerRow=Math.min(Math.max(Math.floor(chartsContainerWidth/550),1),MAX_CHARTS_PER_ROW);if(allSeriesRecords.length===1){chartsPerRow=1}data.chartsPerRow=chartsPerRow;var maxSeriesToPlot=Math.max(chartsPerRow*2,6);var recordsToPlot=allSeriesRecords.slice(0,maxSeriesToPlot);var seriesConfigs=recordsToPlot.map(_explorer_chart_config_builder.buildConfig);data.tooManyBuckets=false;var chartWidth=Math.floor(chartsContainerWidth/chartsPerRow);var _calculateChartRange=calculateChartRange(seriesConfigs,earliestMs,latestMs,chartWidth,recordsToPlot,data.timeFieldName),chartRange=_calculateChartRange.chartRange,tooManyBuckets=_calculateChartRange.tooManyBuckets;data.tooManyBuckets=tooManyBuckets;data.seriesToPlot=seriesConfigs.map(function(config){return _extends({},config,{loading:true,chartData:null})});callback(data);function getMetricData(config,range){var datafeedQuery=_lodash2.default.get(config,"datafeedConfig.query",null);return _results_service.mlResultsService.getMetricData(config.datafeedConfig.indices,config.datafeedConfig.types,config.entityFields,datafeedQuery,config.metricFunction,config.metricFieldName,config.timeField,range.min,range.max,config.interval)}function getRecordsForCriteria(config,range){var criteria=[];criteria.push({fieldName:"detector_index",fieldValue:config.detectorIndex});criteria=criteria.concat(config.entityFields);return _results_service.mlResultsService.getRecordsForCriteria([config.jobId],criteria,0,range.min,range.max,ANOMALIES_MAX_RESULTS)}function getScheduledEvents(config,range){return _results_service.mlResultsService.getScheduledEventsByBucket([config.jobId],range.min,range.max,config.interval,1,MAX_SCHEDULED_EVENTS)}function getEventDistribution(config,range){var chartType=(0,_chart_utils.getChartType)(config);var splitField=void 0;var filterField=null;if(chartType===_explorer_constants.CHART_TYPE.EVENT_DISTRIBUTION){splitField=config.entityFields.find(function(f){return f.fieldType==="by"});filterField=config.entityFields.find(function(f){return f.fieldType==="partition"})}else if(chartType===_explorer_constants.CHART_TYPE.POPULATION_DISTRIBUTION){splitField=config.entityFields.find(function(f){return f.fieldType==="over"});filterField=config.entityFields.find(function(f){return f.fieldType==="partition"})}var datafeedQuery=_lodash2.default.get(config,"datafeedConfig.query",null);return _results_service.mlResultsService.getEventDistributionData(config.datafeedConfig.indices,config.datafeedConfig.types,splitField,filterField,datafeedQuery,config.metricFunction,config.metricFieldName,config.timeField,range.min,range.max,config.interval)}var seriesPromises=seriesConfigs.map(function(seriesConfig){return Promise.all([getMetricData(seriesConfig,chartRange),getRecordsForCriteria(seriesConfig,chartRange),getScheduledEvents(seriesConfig,chartRange),getEventDistribution(seriesConfig,chartRange)])});function processChartData(response,seriesIndex){var metricData=response[0].results;var records=response[1].records;var jobId=seriesConfigs[seriesIndex].jobId;var scheduledEvents=response[2].events[jobId];var eventDistribution=response[3];var chartType=(0,_chart_utils.getChartType)(seriesConfigs[seriesIndex]);if(metricData===undefined||_lodash2.default.keys(metricData).length===0){return[]}var chartData=void 0;if(eventDistribution.length>0&&records.length>0){var filterField=records[0].by_field_value||records[0].over_field_value;chartData=eventDistribution.filter(function(d){return d.entity!==filterField});_lodash2.default.map(metricData,function(value,time){if(chartType===_explorer_constants.CHART_TYPE.EVENT_DISTRIBUTION&&value>0||chartType!==_explorer_constants.CHART_TYPE.EVENT_DISTRIBUTION&&value!==null){chartData.push({date:+time,value:value,entity:filterField})}})}else{chartData=_lodash2.default.map(metricData,function(value,time){return{date:+time,value:value}})}var chartDataForPointSearch=getChartDataForPointSearch(chartData,records[0],chartType);_lodash2.default.each(records,function(record){var recordTime=record[ML_TIME_FIELD_NAME];var chartPoint=findNearestChartPointToTime(chartDataForPointSearch,recordTime);if(chartPoint===undefined){var lastChartPoint=chartData[chartData.length-1];var lastChartPointScore=lastChartPoint.anomalyScore||0;if(record.record_score>lastChartPointScore){chartPoint=lastChartPoint}}if(chartPoint!==undefined){chartPoint.anomalyScore=record.record_score;if(record.actual!==undefined){chartPoint.actual=record.actual;chartPoint.typical=record.typical}else{var causes=_lodash2.default.get(record,"causes",[]);if(causes.length>0){chartPoint.byFieldName=record.by_field_name;chartPoint.numberOfCauses=causes.length;if(causes.length===1){var cause=_lodash2.default.first(record.causes);chartPoint.actual=cause.actual;chartPoint.typical=cause.typical}}}if(record.multi_bucket_impact!==undefined){chartPoint.multiBucketImpact=record.multi_bucket_impact}}});if(scheduledEvents!==undefined){_lodash2.default.each(scheduledEvents,function(events,time){var chartPoint=findNearestChartPointToTime(chartDataForPointSearch,Number(time));if(chartPoint!==undefined){chartPoint.scheduledEvents=events}})}return chartData}function getChartDataForPointSearch(chartData,record,chartType){if(chartType===_explorer_constants.CHART_TYPE.EVENT_DISTRIBUTION||chartType===_explorer_constants.CHART_TYPE.POPULATION_DISTRIBUTION){return chartData.filter(function(d){return d.entity===(record&&(record.by_field_value||record.over_field_value))})}return chartData}function findNearestChartPointToTime(chartData,time){var chartPoint=void 0;for(var i=0;i<chartData.length;i++){if(chartData[i].date===time){chartPoint=chartData[i];break}}if(chartPoint===undefined){var foundItem=void 0;for(var _i=0;_i<chartData.length;_i++){var itemTime=chartData[_i].date;if(itemTime>time&&_i>0){var item=chartData[_i];var previousItem=_i>0?chartData[_i-1]:null;var diff1=Math.abs(time-previousItem.date);var diff2=Math.abs(time-itemTime);if(previousItem===null||diff1>diff2){foundItem=item}else{foundItem=previousItem}break}}chartPoint=foundItem}return chartPoint}Promise.all(seriesPromises).then(function(response){if(newRequestCount<requestCount){return}var processedData=response.map(processChartData);var allDataPoints=_lodash2.default.reduce(processedData,function(datapoints,series){_lodash2.default.each(series,function(d){return datapoints.push(d)});return datapoints},[]);var overallChartLimits=(0,_chart_utils.chartLimits)(allDataPoints);data.seriesToPlot=response.map(function(d,i){return _extends({},seriesConfigs[i],{loading:false,chartData:processedData[i],plotEarliest:chartRange.min,plotLatest:chartRange.max,selectedEarliest:earliestMs,selectedLatest:latestMs,chartLimits:USE_OVERALL_CHART_LIMITS?overallChartLimits:(0,_chart_utils.chartLimits)(processedData[i])})});callback(data)}).catch(function(error){console.error(error)})};function processRecordsForDisplay(anomalyRecords){if(anomalyRecords.length===0){return[]}var aggregatedData={};_lodash2.default.each(anomalyRecords,function(record){var job=_job_service.mlJobService.getJob(record.job_id);if((0,_job_utils.isTimeSeriesViewDetector)(job,record.detector_index)===false||FUNCTION_DESCRIPTIONS_TO_PLOT.includes(record.function_description)===false){return}var jobId=record.job_id;if(aggregatedData[jobId]===undefined){aggregatedData[jobId]={}}var detectorsForJob=aggregatedData[jobId];var detectorIndex=record.detector_index;if(detectorsForJob[detectorIndex]===undefined){detectorsForJob[detectorIndex]={}}var firstFieldName=record.partition_field_name||record.by_field_name||record.over_field_name;var firstFieldValue=record.partition_field_value||record.by_field_value||record.over_field_value;if(firstFieldName!==undefined){var groupsForDetector=detectorsForJob[detectorIndex];if(groupsForDetector[firstFieldName]===undefined){groupsForDetector[firstFieldName]={}}var valuesForGroup=groupsForDetector[firstFieldName];if(valuesForGroup[firstFieldValue]===undefined){valuesForGroup[firstFieldValue]={}}var dataForGroupValue=valuesForGroup[firstFieldValue];var isSecondSplit=false;if(record.partition_field_name!==undefined){var splitFieldName=record.over_field_name||record.by_field_name;if(splitFieldName!==undefined){isSecondSplit=true}}if(isSecondSplit===false){if(dataForGroupValue.maxScoreRecord===undefined){dataForGroupValue.maxScore=record.record_score;dataForGroupValue.maxScoreRecord=record}else{if(record.record_score>dataForGroupValue.maxScore){dataForGroupValue.maxScore=record.record_score;dataForGroupValue.maxScoreRecord=record}}}else{var secondFieldName=record.over_field_name||record.by_field_name;var secondFieldValue=record.over_field_value||record.by_field_value;if(dataForGroupValue[secondFieldName]===undefined){dataForGroupValue[secondFieldName]={}}var splitsForGroup=dataForGroupValue[secondFieldName];if(splitsForGroup[secondFieldValue]===undefined){splitsForGroup[secondFieldValue]={}}var dataForSplitValue=splitsForGroup[secondFieldValue];if(dataForSplitValue.maxScoreRecord===undefined){dataForSplitValue.maxScore=record.record_score;dataForSplitValue.maxScoreRecord=record}else{if(record.record_score>dataForSplitValue.maxScore){dataForSplitValue.maxScore=record.record_score;dataForSplitValue.maxScoreRecord=record}}}}else{var dataForDetector=detectorsForJob[detectorIndex];if(dataForDetector.maxScoreRecord===undefined){dataForDetector.maxScore=record.record_score;dataForDetector.maxScoreRecord=record}else{if(record.record_score>dataForDetector.maxScore){dataForDetector.maxScore=record.record_score;dataForDetector.maxScoreRecord=record}}}});console.log("explorer charts aggregatedData is:",aggregatedData);var recordsForSeries=[];_lodash2.default.each(aggregatedData,function(detectorsForJob){_lodash2.default.each(detectorsForJob,function(groupsForDetector){if(groupsForDetector.maxScoreRecord!==undefined){recordsForSeries.push(groupsForDetector.maxScoreRecord)}else{_lodash2.default.each(groupsForDetector,function(valuesForGroup){_lodash2.default.each(valuesForGroup,function(dataForGroupValue){if(dataForGroupValue.maxScoreRecord!==undefined){recordsForSeries.push(dataForGroupValue.maxScoreRecord)}else{_lodash2.default.each(dataForGroupValue,function(splitsForGroup){_lodash2.default.each(splitsForGroup,function(dataForSplitValue){recordsForSeries.push(dataForSplitValue.maxScoreRecord)})})}})})}})});recordsForSeries=_lodash2.default.sortBy(recordsForSeries,"record_score").reverse();return recordsForSeries}function calculateChartRange(seriesConfigs,earliestMs,latestMs,chartWidth,recordsToPlot,timeFieldName){var tooManyBuckets=false;var midpointMs=Math.ceil((earliestMs+latestMs)/2);var maxBucketSpanMs=Math.max.apply(null,_lodash2.default.pluck(seriesConfigs,"bucketSpanSeconds"))*1e3;var pointsToPlotFullSelection=Math.ceil((latestMs-earliestMs)/maxBucketSpanMs);var optimumPointSpacing=5;var optimumNumPoints=chartWidth/optimumPointSpacing;var plotPoints=Math.max(optimumNumPoints,pointsToPlotFullSelection);var halfPoints=Math.ceil(plotPoints/2);var chartRange={min:midpointMs-halfPoints*maxBucketSpanMs,max:midpointMs+halfPoints*maxBucketSpanMs};if(plotPoints>CHART_MAX_POINTS){tooManyBuckets=true;var maxTimeSpan=maxBucketSpanMs*CHART_MAX_POINTS;var minMs=recordsToPlot[0][timeFieldName];var maxMs=recordsToPlot[0][timeFieldName];_lodash2.default.each(recordsToPlot,function(record){var diffMs=maxMs-minMs;if(diffMs<maxTimeSpan){var recordTime=record[timeFieldName];if(recordTime<minMs){if(maxMs-recordTime<=maxTimeSpan){minMs=recordTime}}if(recordTime>maxMs){if(recordTime-minMs<=maxTimeSpan){maxMs=recordTime}}}});if(maxMs-minMs<maxTimeSpan){minMs=Math.max(earliestMs,minMs-maxTimeSpan);maxMs=Math.min(latestMs,maxMs+maxTimeSpan)}chartRange={min:minMs,max:maxMs}}return{chartRange:chartRange,tooManyBuckets:tooManyBuckets}}return anomalyDataChangeListener}},2444:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.buildConfig=buildConfig;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _parse_interval=__webpack_require__(196);var _chart_config_builder=__webpack_require__(1016);var _string_utils=__webpack_require__(38);var _job_service=__webpack_require__(23);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function buildConfig(record){var job=_job_service.mlJobService.getJob(record.job_id);var detectorIndex=record.detector_index;var config=(0,_chart_config_builder.buildConfigFromDetector)(job,detectorIndex);config.functionDescription=record.function_description;config.bucketSpanSeconds=(0,_parse_interval.parseInterval)(job.analysis_config.bucket_span).asSeconds();config.detectorLabel=record.function;if(_lodash2.default.has(_job_service.mlJobService.detectorsByJob,record.job_id)&&detectorIndex<_job_service.mlJobService.detectorsByJob[record.job_id].length){config.detectorLabel=_job_service.mlJobService.detectorsByJob[record.job_id][detectorIndex].detector_description}else{if(record.field_name!==undefined){config.detectorLabel+=" "+config.fieldName}}if(record.field_name!==undefined){config.fieldName=record.field_name;config.metricFieldName=record.field_name}config.entityFields=[];if(_lodash2.default.has(record,"partition_field_name")){config.entityFields.push({fieldName:record.partition_field_name,fieldValue:record.partition_field_value,fieldType:"partition"})}if(_lodash2.default.has(record,"over_field_name")){config.entityFields.push({fieldName:record.over_field_name,fieldValue:record.over_field_value,fieldType:"over"})}if(_lodash2.default.has(record,"by_field_name")&&!_lodash2.default.has(record,"over_field_name")){config.entityFields.push({fieldName:record.by_field_name,fieldValue:record.by_field_value,fieldType:"by"})}var functionLabel=config.metricFunction;if(config.metricFieldName!==undefined){functionLabel+=" "+(0,_string_utils.mlEscape)(config.metricFieldName)}config.infoTooltip={jobId:record.job_id,aggregationInterval:config.interval,chartFunction:functionLabel,entityFields:config.entityFields.map(function(f){return{fieldName:(0,_string_utils.mlEscape)(f.fieldName),fieldValue:(0,_string_utils.mlEscape)(f.fieldValue)}})};return config}},2445:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2446)},2446:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _state_factory=__webpack_require__(399);var _select_limit=__webpack_require__(2447);var _select_limit2=_interopRequireDefault(_select_limit);__webpack_require__(1013);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.service("mlSelectLimitService",function(Private){var stateFactory=Private(_state_factory.stateFactoryProvider);this.state=stateFactory("mlSelectLimit",{limit:{display:"10",val:10}})}).directive("mlSelectLimit",function(mlSelectLimitService){return{restrict:"E",template:_select_limit2.default,link:function link(scope,element){scope.limitOptions=[{display:"5",val:5},{display:"10",val:10},{display:"25",val:25},{display:"50",val:50}];var limitState=mlSelectLimitService.state.get("limit");var limitValue=_lodash2.default.get(limitState,"val",0);var limitOption=scope.limitOptions.find(function(d){return d.val===limitValue});if(limitOption===undefined){limitOption=scope.limitOptions.find(function(d){return d.val===10})}scope.limit=limitOption;mlSelectLimitService.state.set("limit",scope.limit);scope.setLimit=function(limit){if(!_lodash2.default.isEqual(scope.limit,limit)){scope.limit=limit;mlSelectLimitService.state.set("limit",scope.limit).changed()}};function setLimit(){scope.setLimit(mlSelectLimitService.state.get("limit"))}mlSelectLimitService.state.watch(setLimit);element.on("$destroy",function(){mlSelectLimitService.state.unwatch(setLimit);scope.$destroy()})}}})},2447:function(module,exports){module.exports='<ml-controls-select\n  identifier="Limit"\n  label="Limit"\n  narrow-style="true"\n  options="limitOptions"\n  selected="limit"\n  show-icons="false"\n  update-fn="setLimit"\n/>\n'},2448:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2449);__webpack_require__(2459);__webpack_require__(2469);__webpack_require__(1020);__webpack_require__(641);__webpack_require__(474)},2449:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2450)},2450:function(module,exports,__webpack_require__){"use strict";__webpack_require__(53);var _timefilter=__webpack_require__(16);var _modules=__webpack_require__(4);var _forecasting_modal=__webpack_require__(2451);var _module=_modules.uiModules.get("apps/ml",["react"]);_module.directive("mlForecastingModal",function($injector){var reactDirective=$injector.get("reactDirective");return reactDirective(_forecasting_modal.ForecastingModal,undefined,{restrict:"E"},{timefilter:_timefilter.timefilter})})},2451:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ForecastingModal=undefined;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _states=__webpack_require__(401);var _message_levels=__webpack_require__(1017);var _job_utils=__webpack_require__(34);var _parse_interval=__webpack_require__(219);var _modal=__webpack_require__(2452);var _progress_states=__webpack_require__(642);var _ml_api_service=__webpack_require__(22);var _job_service=__webpack_require__(23);var _forecast_service=__webpack_require__(630);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var FORECAST_JOB_MIN_VERSION="6.1.0";var FORECASTS_VIEW_MAX=5;var FORECAST_DURATION_MAX_MS=48384e5;var WARN_NUM_PARTITIONS=100;var FORECAST_STATS_POLL_FREQUENCY=250;var WARN_NO_PROGRESS_MS=12e4;function getDefaultState(){return{isModalVisible:false,previousForecasts:[],isForecastRequested:false,forecastProgress:_progress_states.PROGRESS_STATES.UNSET,jobOpeningState:_progress_states.PROGRESS_STATES.UNSET,jobClosingState:_progress_states.PROGRESS_STATES.UNSET,newForecastDuration:"1d",isNewForecastDurationValid:true,newForecastDurationErrors:[],messages:[]}}var ForecastingModal=function(_Component){_inherits(ForecastingModal,_Component);function ForecastingModal(props){_classCallCheck(this,ForecastingModal);var _this=_possibleConstructorReturn(this,(ForecastingModal.__proto__||Object.getPrototypeOf(ForecastingModal)).call(this,props));_this.addMessage=function(message,status){var clearFirst=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var msg={message:message,status:status};_this.setState(function(prevState){return{messages:clearFirst?[msg]:[].concat(_toConsumableArray(prevState.messages),[msg])}})};_this.viewForecast=function(forecastId){_this.props.loadForForecastId(forecastId);_this.closeModal()};_this.onNewForecastDurationChange=function(event){var newForecastDurationErrors=[];var isNewForecastDurationValid=true;var duration=(0,_parse_interval.parseInterval)(event.target.value);if(duration===null){isNewForecastDurationValid=false;newForecastDurationErrors.push("Invalid duration format")}else if(duration.asMilliseconds()>FORECAST_DURATION_MAX_MS){isNewForecastDurationValid=false;newForecastDurationErrors.push("Forecast duration must not be greater than 8 weeks")}else if(duration.asMilliseconds()===0){isNewForecastDurationValid=false;newForecastDurationErrors.push("Forecast duration must not be zero")}_this.setState({newForecastDuration:event.target.value,isNewForecastDurationValid:isNewForecastDurationValid,newForecastDurationErrors:newForecastDurationErrors})};_this.checkJobStateAndRunForecast=function(){_this.setState({isForecastRequested:true,messages:[]});if(_this.props.job.state===_states.JOB_STATE.CLOSED){_this.openJobAndRunForecast()}else{_this.runForecast(false)}};_this.openJobAndRunForecast=function(){_this.setState({jobOpeningState:_progress_states.PROGRESS_STATES.WAITING});_job_service.mlJobService.openJob(_this.props.job.job_id).then(function(){_this.setState({jobOpeningState:_progress_states.PROGRESS_STATES.DONE});_this.runForecast(true)}).catch(function(resp){console.log("Time series forecast modal - could not open job:",resp);_this.addMessage("Error opening job before running forecast",_message_levels.MESSAGE_LEVEL.ERROR);_this.setState({jobOpeningState:_progress_states.PROGRESS_STATES.ERROR})})};_this.runForecastErrorHandler=function(resp){_this.setState({forecastProgress:_progress_states.PROGRESS_STATES.ERROR});console.log("Time series forecast modal - error running forecast:",resp);if(resp&&resp.message){_this.addMessage(resp.message,_message_levels.MESSAGE_LEVEL.ERROR,true)}else{_this.addMessage("Unexpected response from running forecast. The request may have failed.",_message_levels.MESSAGE_LEVEL.ERROR,true)}};_this.runForecast=function(closeJobAfterRunning){_this.setState({forecastProgress:0});var durationInSeconds=(0,_parse_interval.parseInterval)(_this.state.newForecastDuration).asSeconds();_forecast_service.mlForecastService.runForecast(_this.props.job.job_id,durationInSeconds+"s").then(function(resp){if(resp.forecast_id!==undefined){_this.waitForForecastResults(resp.forecast_id,closeJobAfterRunning)}else{_this.runForecastErrorHandler(resp)}}).catch(_this.runForecastErrorHandler)};_this.waitForForecastResults=function(forecastId,closeJobAfterRunning){var previousProgress=0;var noProgressMs=0;_this.forecastChecker=setInterval(function(){_forecast_service.mlForecastService.getForecastRequestStats(_this.props.job,forecastId).then(function(resp){var progress=_lodash2.default.get(resp,["stats","forecast_progress"],previousProgress);var status=_lodash2.default.get(resp,["stats","forecast_status"]);_this.setState({forecastProgress:Math.round(100*progress)});var messages=_lodash2.default.get(resp,["stats","forecast_messages"],[]);messages=messages.map(function(message){return{message:message,status:_message_levels.MESSAGE_LEVEL.WARNING}});_this.setState({messages:messages});if(status===_states.FORECAST_REQUEST_STATE.FINISHED){clearInterval(_this.forecastChecker);if(closeJobAfterRunning===true){_this.setState({jobClosingState:_progress_states.PROGRESS_STATES.WAITING});_job_service.mlJobService.closeJob(_this.props.job.job_id).then(function(){_this.setState({jobClosingState:_progress_states.PROGRESS_STATES.DONE});_this.props.loadForForecastId(forecastId);_this.closeAfterRunningForecast()}).catch(function(response){console.log("Time series forecast modal - could not close job:",response);_this.addMessage("Error closing job after running forecast",_message_levels.MESSAGE_LEVEL.ERROR);_this.setState({jobClosingState:_progress_states.PROGRESS_STATES.ERROR});_this.props.loadForForecastId(forecastId)})}else{_this.props.loadForForecastId(forecastId);_this.closeAfterRunningForecast()}}else{if(progress===previousProgress){noProgressMs+=FORECAST_STATS_POLL_FREQUENCY;if(noProgressMs>WARN_NO_PROGRESS_MS){console.log("Forecast request has not progressed for "+WARN_NO_PROGRESS_MS+"ms. Cancelling check.");_this.addMessage("No progress reported for the new forecast for "+WARN_NO_PROGRESS_MS+"ms. "+"An error may have occurred whilst running the forecast.",_message_levels.MESSAGE_LEVEL.ERROR);_this.props.loadForForecastId(forecastId);_this.setState({forecastProgress:_progress_states.PROGRESS_STATES.ERROR});clearInterval(_this.forecastChecker)}}else{previousProgress=progress}}}).catch(function(resp){console.log("Time series forecast modal - error loading stats of forecast from elasticsearch:",resp);_this.addMessage("Error loading stats of running forecast.",_message_levels.MESSAGE_LEVEL.ERROR);_this.setState({forecastProgress:_progress_states.PROGRESS_STATES.ERROR});clearInterval(_this.forecastChecker)})},FORECAST_STATS_POLL_FREQUENCY)};_this.openModal=function(){var job=_this.props.job;if((typeof job==="undefined"?"undefined":_typeof(job))==="object"){var bounds=_this.props.timefilter.getActiveBounds();var statusFinishedQuery={term:{forecast_status:_states.FORECAST_REQUEST_STATE.FINISHED}};_forecast_service.mlForecastService.getForecastsSummary(job,statusFinishedQuery,bounds.min.valueOf(),FORECASTS_VIEW_MAX).then(function(resp){_this.setState({previousForecasts:resp.forecasts})}).catch(function(resp){console.log("Time series forecast modal - error obtaining forecasts summary:",resp);_this.addMessage("Error obtaining list of previous forecasts",_message_levels.MESSAGE_LEVEL.ERROR)});var entityFieldNames=_this.props.entities.map(function(entity){return entity.fieldName});if(entityFieldNames.length>0){_ml_api_service.ml.getCardinalityOfFields({index:job.datafeed_config.indices,types:job.datafeed_config.types,fieldNames:entityFieldNames,query:job.datafeed_config.query,timeFieldName:job.data_description.time_field,earliestMs:job.data_counts.earliest_record_timestamp,latestMs:job.data_counts.latest_record_timestamp}).then(function(results){var numPartitions=1;Object.values(results).forEach(function(cardinality){numPartitions=numPartitions*cardinality});if(numPartitions>WARN_NUM_PARTITIONS){_this.addMessage("Note that this data contains more than "+WARN_NUM_PARTITIONS+" "+"partitions so running a forecast may take a long time and consume a high amount of resource",_message_levels.MESSAGE_LEVEL.WARNING)}}).catch(function(resp){console.log("Time series forecast modal - error obtaining cardinality of fields:",resp)})}_this.setState({isModalVisible:true})}};_this.closeAfterRunningForecast=function(){if(_this.state.messages.length===0){setTimeout(function(){_this.closeModal()},1e3)}};_this.closeModal=function(){if(_this.forecastChecker!==null){clearInterval(_this.forecastChecker)}_this.setState(getDefaultState())};_this.state=getDefaultState();_this.forecastChecker=null;return _this}_createClass(ForecastingModal,[{key:"render",value:function render(){var isForecastingDisabled=false;var forecastingDisabledMessage=null;var job=this.props.job;if(job!==undefined){var detector=job.analysis_config.detectors[this.props.detectorIndex];var overFieldName=detector.over_field_name;if(overFieldName!==undefined){isForecastingDisabled=true;forecastingDisabledMessage="Forecasting is not available for population detectors with an over field"}else if((0,_job_utils.isJobVersionGte)(job,FORECAST_JOB_MIN_VERSION)===false){isForecastingDisabled=true;forecastingDisabledMessage="Forecasting is only available for jobs created in version "+(FORECAST_JOB_MIN_VERSION+" or later")}}var forecastButton=_react2.default.createElement(_eui.EuiButton,{onClick:this.openModal,size:"s",isDisabled:isForecastingDisabled,fill:true},"Forecast");return _react2.default.createElement("div",null,isForecastingDisabled?_react2.default.createElement(_eui.EuiToolTip,{position:"left",content:forecastingDisabledMessage},forecastButton):forecastButton,this.state.isModalVisible&&_react2.default.createElement(_modal.Modal,{job:this.props.job,forecasts:this.state.previousForecasts,close:this.closeModal,viewForecast:this.viewForecast,runForecast:this.checkJobStateAndRunForecast,newForecastDuration:this.state.newForecastDuration,onNewForecastDurationChange:this.onNewForecastDurationChange,isNewForecastDurationValid:this.state.isNewForecastDurationValid,newForecastDurationErrors:this.state.newForecastDurationErrors,isForecastRequested:this.state.isForecastRequested,forecastProgress:this.state.forecastProgress,jobOpeningState:this.state.jobOpeningState,jobClosingState:this.state.jobClosingState,messages:this.state.messages}))}}]);return ForecastingModal}(_react.Component);ForecastingModal.propTypes={isDisabled:_propTypes2.default.bool,job:_propTypes2.default.object,detectorIndex:_propTypes2.default.number,entities:_propTypes2.default.array,loadForForecastId:_propTypes2.default.func,timefilter:_propTypes2.default.object};exports.ForecastingModal=ForecastingModal},2452:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Modal=Modal;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _message_call_out=__webpack_require__(2453);var _forecasts_list=__webpack_require__(2455);var _run_controls=__webpack_require__(2456);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function Modal(props){return _react2.default.createElement(_eui.EuiOverlayMask,null,_react2.default.createElement(_eui.EuiModal,{onClose:props.close,className:"forecast-modal"},_react2.default.createElement(_eui.EuiModalHeader,null,_react2.default.createElement(_eui.EuiModalHeaderTitle,null,"Forecasting")),_react2.default.createElement(_eui.EuiModalBody,null,props.messages.map(function(message,i){return _react2.default.createElement(_react2.default.Fragment,{key:i},_react2.default.createElement(_message_call_out.MessageCallOut,message),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}))}),props.forecasts.length>0&&_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_forecasts_list.ForecastsList,{forecasts:props.forecasts,viewForecast:props.viewForecast}),_react2.default.createElement(_eui.EuiSpacer,null)),_react2.default.createElement(_run_controls.RunControls,props)),_react2.default.createElement(_eui.EuiModalFooter,null,_react2.default.createElement(_eui.EuiButtonEmpty,{onClick:props.close,size:"s"},"Close"))))}Modal.propType={job:_propTypes2.default.object,forecasts:_propTypes2.default.array,close:_propTypes2.default.func.isRequired,viewForecast:_propTypes2.default.func.isRequired,runForecast:_propTypes2.default.func.isRequired,newForecastDuration:_propTypes2.default.string,isNewForecastDurationValid:_propTypes2.default.bool,newForecastDurationErrors:_propTypes2.default.array,onNewForecastDurationChange:_propTypes2.default.func.isRequired,isForecastRequested:_propTypes2.default.bool,forecastProgress:_propTypes2.default.number,jobOpeningState:_propTypes2.default.number,jobClosingState:_propTypes2.default.number,messages:_propTypes2.default.array}},2453:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _message_call_out=__webpack_require__(2454);Object.defineProperty(exports,"MessageCallOut",{enumerable:true,get:function get(){return _message_call_out.MessageCallOut}})},2454:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.MessageCallOut=MessageCallOut;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _eui=__webpack_require__(2);var _message_levels=__webpack_require__(1017);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function getCallOutAttributes(message,status){switch(status){case _message_levels.MESSAGE_LEVEL.ERROR:return{title:message,iconType:"cross",color:"danger"};case _message_levels.MESSAGE_LEVEL.WARNING:return{title:message,iconType:"alert",color:"warning"};case _message_levels.MESSAGE_LEVEL.SUCCESS:return{title:message,iconType:"check",color:"success"};case _message_levels.MESSAGE_LEVEL.INFO:return{title:message,iconType:"iInCircle",color:"primary"}}}function MessageCallOut(_ref){var message=_ref.message,status=_ref.status,rest=_objectWithoutProperties(_ref,["message","status"]);return _react2.default.createElement(_eui.EuiCallOut,_extends({size:"s"},getCallOutAttributes(message,status),rest))}MessageCallOut.propTypes={message:_propTypes2.default.string,status:_propTypes2.default.oneOf([_message_levels.MESSAGE_LEVEL.ERROR,_message_levels.MESSAGE_LEVEL.WARNING,_message_levels.MESSAGE_LEVEL.SUCCESS,_message_levels.MESSAGE_LEVEL.INFO])}},2455:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ForecastsList=ForecastsList;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _date_utils=__webpack_require__(221);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getColumns(viewForecast){return[{field:"forecast_create_timestamp",name:"Created",dataType:"date",render:function render(date){return(0,_date_utils.formatHumanReadableDateTimeSeconds)(date)},sortable:true},{field:"forecast_start_timestamp",name:"From",dataType:"date",render:function render(date){return(0,_date_utils.formatHumanReadableDateTimeSeconds)(date)},sortable:true},{field:"forecast_end_timestamp",name:"To",dataType:"date",render:function render(date){return(0,_date_utils.formatHumanReadableDateTimeSeconds)(date)},sortable:true},{name:"View",render:function render(forecast){return _react2.default.createElement(_eui.EuiButton,{className:"view-forecast-btn",onClick:function onClick(){return viewForecast(forecast.forecast_id)}},_react2.default.createElement("i",{"aria-hidden":"true",className:"fa fa-line-chart"}))}}]}function ForecastsList(_ref){var forecasts=_ref.forecasts,viewForecast=_ref.viewForecast;return _react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("h3",{"aria-describedby":"ml_aria_description_forecasting_modal_view_list",style:{display:"inline",paddingRight:"5px"}},"Previous forecasts"),_react2.default.createElement(_eui.EuiToolTip,{position:"right",content:"Lists a maximum of five of the most recently run forecasts."},_react2.default.createElement(_eui.EuiIcon,{type:"questionInCircle",size:"s"})),_react2.default.createElement(_eui.EuiInMemoryTable,{items:forecasts,columns:getColumns(viewForecast),pagination:false}))}ForecastsList.propType={forecasts:_propTypes2.default.array,viewForecast:_propTypes2.default.func.isRequired}},2456:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.RunControls=RunControls;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _states=__webpack_require__(401);var _forecast_progress=__webpack_require__(2457);var _check_ml_nodes=__webpack_require__(47);var _check_privilege=__webpack_require__(32);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getRunInputDisabledState(job,isForecastRequested){if((0,_check_ml_nodes.mlNodesAvailable)()===false){return{isDisabled:true,isDisabledToolTipText:"There are no ML nodes available."}}if((0,_check_privilege.checkPermission)("canForecastJob")===false){return{isDisabled:true,isDisabledToolTipText:(0,_check_privilege.createPermissionFailureMessage)("canForecastJob")}}if(job.state!==_states.JOB_STATE.OPENED&&job.state!==_states.JOB_STATE.CLOSED){return{isDisabled:true,isDisabledToolTipText:"Forecasts cannot be run on "+job.state+" jobs"}}return{isDisabled:isForecastRequested}}function RunControls(_ref){var job=_ref.job,newForecastDuration=_ref.newForecastDuration,isNewForecastDurationValid=_ref.isNewForecastDurationValid,newForecastDurationErrors=_ref.newForecastDurationErrors,onNewForecastDurationChange=_ref.onNewForecastDurationChange,runForecast=_ref.runForecast,isForecastRequested=_ref.isForecastRequested,forecastProgress=_ref.forecastProgress,jobOpeningState=_ref.jobOpeningState,jobClosingState=_ref.jobClosingState;var disabledState=getRunInputDisabledState(job,isForecastRequested);var durationInput=_react2.default.createElement(_eui.EuiFieldText,{name:"forecastDuration",value:newForecastDuration,disabled:disabledState.isDisabled,isInvalid:!isNewForecastDurationValid,onChange:onNewForecastDurationChange,fullWidth:true});var runButton=_react2.default.createElement(_eui.EuiButton,{onClick:runForecast,isDisabled:disabledState.isDisabled||!isNewForecastDurationValid},"Run");return _react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("h3",null,"Run a new forecast")),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_eui.EuiForm,null,_react2.default.createElement(_eui.EuiFlexGroup,null,_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiFormRow,{label:"Duration",fullWidth:true,isInvalid:!isNewForecastDurationValid,error:newForecastDurationErrors,helpText:"Length of forecast, up to a maximum of 8 weeks. "+"Use s for seconds, m for minutes, h for hours, d for days, w for weeks."},disabledState.isDisabledToolTipText===undefined?durationInput:_react2.default.createElement(_eui.EuiToolTip,{position:"right",content:disabledState.isDisabledToolTipText},durationInput))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiFormRow,{hasEmptyLabelSpace:true},disabledState.isDisabledToolTipText===undefined?runButton:_react2.default.createElement(_eui.EuiToolTip,{position:"left",content:disabledState.isDisabledToolTipText},runButton))))),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),isForecastRequested===true&&_react2.default.createElement(_forecast_progress.ForecastProgress,{forecastProgress:forecastProgress,jobOpeningState:jobOpeningState,jobClosingState:jobClosingState}))}RunControls.propType={job:_propTypes2.default.object,newForecastDuration:_propTypes2.default.string,isNewForecastDurationValid:_propTypes2.default.bool,newForecastDurationErrors:_propTypes2.default.array,onNewForecastDurationChange:_propTypes2.default.func.isRequired,runForecast:_propTypes2.default.func.isRequired,isForecastRequested:_propTypes2.default.bool,forecastProgress:_propTypes2.default.number,jobOpeningState:_propTypes2.default.number,jobClosingState:_propTypes2.default.number}},2457:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ForecastProgress=ForecastProgress;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _progress_icon=__webpack_require__(2458);var _progress_states=__webpack_require__(642);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ForecastProgress(_ref){var forecastProgress=_ref.forecastProgress,jobOpeningState=_ref.jobOpeningState,jobClosingState=_ref.jobClosingState;return _react2.default.createElement("div",null,jobOpeningState!==_progress_states.PROGRESS_STATES.UNSET&&_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiText,{size:"xs"},_react2.default.createElement("h3",null,"Opening job..."))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_progress_icon.ProgressIcon,{state:jobOpeningState}))),_react2.default.createElement(_eui.EuiSpacer,{size:"s"})),forecastProgress!==_progress_states.PROGRESS_STATES.UNSET&&_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiText,{size:"xs"},_react2.default.createElement("h3",null,"Running forecast..."))),forecastProgress>=0&&_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiToolTip,{position:"top",content:forecastProgress+"%"},_react2.default.createElement(_eui.EuiProgress,{size:"l",value:forecastProgress,max:100}))),forecastProgress===_progress_states.PROGRESS_STATES.ERROR&&_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_progress_icon.ProgressIcon,{state:_progress_states.PROGRESS_STATES.ERROR}))),_react2.default.createElement(_eui.EuiSpacer,{size:"s"})),jobClosingState!==_progress_states.PROGRESS_STATES.UNSET&&_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiText,{size:"xs"},_react2.default.createElement("h3",null,"Closing job..."))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_progress_icon.ProgressIcon,{state:jobClosingState})))))}ForecastProgress.propType={forecastProgress:_propTypes2.default.number,jobOpeningState:_propTypes2.default.number,jobClosingState:_propTypes2.default.number}},2458:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ProgressIcon=ProgressIcon;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _progress_states=__webpack_require__(642);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ProgressIcon(_ref){var state=_ref.state;if(state===_progress_states.PROGRESS_STATES.WAITING){return _react2.default.createElement(_eui.EuiLoadingSpinner,{size:"m"})}else if(state===_progress_states.PROGRESS_STATES.DONE){return _react2.default.createElement(_eui.EuiIcon,{type:"check",size:"m",color:"primary"})}else if(state===_progress_states.PROGRESS_STATES.ERROR){return _react2.default.createElement(_eui.EuiIcon,{type:"cross",size:"m",color:"danger"})}}ProgressIcon.propTypes={state:_propTypes2.default.number}},2459:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _timeseries_chart=__webpack_require__(2460);var _angular=__webpack_require__(21);var _angular2=_interopRequireDefault(_angular);var _timefilter=__webpack_require__(16);var _notify=__webpack_require__(10);var _resize_checker=__webpack_require__(643);var _modules=__webpack_require__(4);var _ml_api_service=__webpack_require__(22);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");var mlAnnotationsEnabled=_chrome2.default.getInjected("mlAnnotationsEnabled",false);_module.directive("mlTimeseriesChart",function($timeout){function link(scope,element){var svgWidth=_angular2.default.element(".results-container").width();function contextChartSelected(selection){scope.$root.$broadcast("contextChartSelected",selection)}function renderReactComponent(){var renderFocusChartOnly=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;svgWidth=Math.max(_angular2.default.element(".results-container").width(),0);var props={indexAnnotation:_ml_api_service.ml.annotations.indexAnnotation,autoZoomDuration:scope.autoZoomDuration,contextAggregationInterval:scope.contextAggregationInterval,contextChartData:scope.contextChartData,contextForecastData:scope.contextForecastData,contextChartSelected:contextChartSelected,deleteAnnotation:_ml_api_service.ml.annotations.deleteAnnotation,detectorIndex:scope.detectorIndex,focusAnnotationData:scope.focusAnnotationData,focusChartData:scope.focusChartData,focusForecastData:scope.focusForecastData,focusAggregationInterval:scope.focusAggregationInterval,modelPlotEnabled:scope.modelPlotEnabled,refresh:scope.refresh,renderFocusChartOnly:renderFocusChartOnly,selectedJob:scope.selectedJob,showAnnotations:scope.showAnnotations,showForecast:scope.showForecast,showModelBounds:scope.showModelBounds,svgWidth:svgWidth,swimlaneData:scope.swimlaneData,timefilter:_timefilter.timefilter,toastNotifications:_notify.toastNotifications,zoomFrom:scope.zoomFrom,zoomTo:scope.zoomTo};_reactDom2.default.render(_react2.default.createElement(_timeseries_chart.TimeseriesChart,props),element[0])}renderReactComponent();scope.$on("render",function(){$timeout(function(){renderReactComponent()})});function renderFocusChart(){renderReactComponent(true)}scope.$watchCollection("focusForecastData",renderFocusChart);scope.$watchCollection("focusChartData",renderFocusChart);scope.$watchGroup(["showModelBounds","showForecast"],renderFocusChart);if(mlAnnotationsEnabled){scope.$watchCollection("focusAnnotationData",renderFocusChart);scope.$watch("showAnnotations",renderFocusChart)}var resizeChecker=new _resize_checker.ResizeChecker(_angular2.default.element(".ml-timeseries-chart"));resizeChecker.on("resize",function(){scope.$evalAsync(function(){renderReactComponent()})});element.on("$destroy",function(){resizeChecker.destroy();_reactDom2.default.unmountComponentAtNode(element[0]);scope.$destroy()})}return{scope:{selectedJob:"=",detectorIndex:"=",modelPlotEnabled:"=",contextChartData:"=",contextForecastData:"=",contextChartAnomalyData:"=",focusChartData:"=",swimlaneData:"=",focusAnnotationData:"=",focusForecastData:"=",contextAggregationInterval:"=",focusAggregationInterval:"=",zoomFrom:"=",zoomTo:"=",autoZoomDuration:"=",refresh:"=",showAnnotations:"=",showModelBounds:"=",showForecast:"="},link:link}})},2460:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TimeseriesChart=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _d=__webpack_require__(20);var _d2=_interopRequireDefault(_d);var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _anomaly_utils=__webpack_require__(256);var _annotation_flyout=__webpack_require__(2461);var _delete_annotation_modal=__webpack_require__(2463);var _format_value=__webpack_require__(299);var _chart_utils=__webpack_require__(197);var _date_utils=__webpack_require__(221);var _time_buckets=__webpack_require__(218);var _table_service=__webpack_require__(628);var _context_chart_mask=__webpack_require__(2464);var _timeseriesexplorer_utils=__webpack_require__(1018);var _string_utils=__webpack_require__(38);var _field_format_service=__webpack_require__(209);var _chart_tooltip_service=__webpack_require__(242);var _timeseries_chart_annotations=__webpack_require__(2466);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var mlAnnotationsEnabled=_chrome2.default.getInjected("mlAnnotationsEnabled",false);var focusZoomPanelHeight=25;var focusChartHeight=310;var focusHeight=focusZoomPanelHeight+focusChartHeight;var contextChartHeight=60;var contextChartLineTopMargin=3;var chartSpacing=25;var swimlaneHeight=30;var margin={top:20,right:10,bottom:15,left:40};var ZOOM_INTERVAL_OPTIONS=[{duration:_moment2.default.duration(1,"h"),label:"1h"},{duration:_moment2.default.duration(12,"h"),label:"12h"},{duration:_moment2.default.duration(1,"d"),label:"1d"},{duration:_moment2.default.duration(1,"w"),label:"1w"},{duration:_moment2.default.duration(2,"w"),label:"2w"},{duration:_moment2.default.duration(1,"M"),label:"1M"}];var anomalyColorScale=_d2.default.scale.threshold().domain([3,25,50,75,100]).range(["#d2e9f7","#8bc8fb","#ffdd00","#ff7e00","#fe5050"]);var anomalyGrayScale=_d2.default.scale.threshold().domain([3,25,50,75,100]).range(["#dce7ed","#b0c5d6","#b1a34e","#b17f4e","#c88686"]);function getSvgHeight(){return focusHeight+contextChartHeight+swimlaneHeight+chartSpacing+margin.top+margin.bottom}var TimeseriesChart=exports.TimeseriesChart=function(_React$Component){_inherits(TimeseriesChart,_React$Component);function TimeseriesChart(props){var _this2=this;_classCallCheck(this,TimeseriesChart);var _this=_possibleConstructorReturn(this,(TimeseriesChart.__proto__||Object.getPrototypeOf(TimeseriesChart)).call(this,props));_this.closeDeleteModal=function(){_this.setState({isDeleteModalVisible:false})};_this.closeFlyout=function(){var chartElement=_d2.default.select(_this.rootNode);chartElement.select("g.mlAnnotationBrush").call(_this.annotateBrush.extent([0,0]));_this.setState({isFlyoutVisible:false,annotation:{}})};_this.showFlyout=function(annotation){_this.setState({isFlyoutVisible:true,annotation:annotation})};_this.handleAnnotationChange=function(e){var annotation=e.target.value;_this.setState(function(state){state.annotation.annotation=annotation;return state})};_this.deleteAnnotation=function(){_this.setState({isDeleteModalVisible:true})};_this.deleteAnnotationConfirmation=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var _this$props,deleteAnnotation,refresh,toastNotifications,annotation;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this$props=_this.props,deleteAnnotation=_this$props.deleteAnnotation,refresh=_this$props.refresh,toastNotifications=_this$props.toastNotifications;annotation=_this.state.annotation;_context.prev=2;_context.next=5;return deleteAnnotation(annotation._id);case 5:toastNotifications.addSuccess("Deleted annotation for job with ID "+annotation.job_id+".");_context.next=11;break;case 8:_context.prev=8;_context.t0=_context["catch"](2);toastNotifications.addDanger("An error occurred deleting the annotation for job with ID "+annotation.job_id+": "+JSON.stringify(_context.t0));case 11:_this.closeDeleteModal();_this.closeFlyout();refresh();case 14:case"end":return _context.stop()}}},_callee,_this2,[[2,8]])}));_this.indexAnnotation=function(annotation){var _this$props2=_this.props,indexAnnotation=_this$props2.indexAnnotation,refresh=_this$props2.refresh,toastNotifications=_this$props2.toastNotifications;_this.closeFlyout();indexAnnotation(annotation).then(function(){refresh();var action=typeof annotation._id==="undefined"?"Added an":"Updated";if(typeof annotation._id==="undefined"){toastNotifications.addSuccess(action+" annotation for job with ID "+annotation.job_id+".")}else{toastNotifications.addSuccess(action+" annotation for job with ID "+annotation.job_id+".")}}).catch(function(resp){var action=typeof annotation._id==="undefined"?"creating":"updating";toastNotifications.addDanger("An error occurred "+action+" the annotation for job with ID "+annotation.job_id+": "+JSON.stringify(resp))})};_this.state={annotation:{},isFlyoutVisible:false,isDeleteModalVisible:false};return _this}_createClass(TimeseriesChart,[{key:"componentWillUnmount",value:function componentWillUnmount(){var element=_d2.default.select(this.rootNode);element.html("");_table_service.mlTableService.rowMouseenter.unwatch(this.tableRecordMousenterListener);_table_service.mlTableService.rowMouseleave.unwatch(this.tableRecordMouseleaveListener)}},{key:"componentDidMount",value:function componentDidMount(){var svgWidth=this.props.svgWidth;this.vizWidth=svgWidth-margin.left-margin.right;var vizWidth=this.vizWidth;this.focusXScale=_d2.default.time.scale().range([0,vizWidth]);this.focusYScale=_d2.default.scale.linear().range([focusHeight,focusZoomPanelHeight]);var focusXScale=this.focusXScale;var focusYScale=this.focusYScale;this.focusXAxis=_d2.default.svg.axis().scale(focusXScale).orient("bottom").innerTickSize(-focusChartHeight).outerTickSize(0).tickPadding(10);this.focusYAxis=_d2.default.svg.axis().scale(focusYScale).orient("left").innerTickSize(-vizWidth).outerTickSize(0).tickPadding(10);this.focusValuesLine=_d2.default.svg.line().x(function(d){return focusXScale(d.date)}).y(function(d){return focusYScale(d.value)}).defined(function(d){return d.value!==null});this.focusBoundedArea=_d2.default.svg.area().x(function(d){return focusXScale(d.date)||1}).y0(function(d){return focusYScale(d.upper)}).y1(function(d){return focusYScale(d.lower)}).defined(function(d){return d.lower!==null&&d.upper!==null});this.contextXScale=_d2.default.time.scale().range([0,vizWidth]);this.contextYScale=_d2.default.scale.linear().range([contextChartHeight,contextChartLineTopMargin]);this.fieldFormat=undefined;if(mlAnnotationsEnabled){this.annotateBrush=_timeseries_chart_annotations.getAnnotationBrush.call(this)}this.brush=_d2.default.svg.brush();this.mask=undefined;var highlightFocusChartAnomaly=this.highlightFocusChartAnomaly.bind(this);var boundHighlightFocusChartAnnotation=_timeseries_chart_annotations.highlightFocusChartAnnotation.bind(this);this.tableRecordMousenterListener=function(record){var type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"anomaly";if(type==="anomaly"){highlightFocusChartAnomaly(record)}else if(type==="annotation"){boundHighlightFocusChartAnnotation(record)}};var unhighlightFocusChartAnomaly=this.unhighlightFocusChartAnomaly.bind(this);var boundUnhighlightFocusChartAnnotation=_timeseries_chart_annotations.unhighlightFocusChartAnnotation.bind(this);this.tableRecordMouseleaveListener=function(record){var type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"anomaly";if(type==="anomaly"){unhighlightFocusChartAnomaly(record)}else{boundUnhighlightFocusChartAnnotation(record)}};_table_service.mlTableService.rowMouseenter.watch(this.tableRecordMousenterListener);_table_service.mlTableService.rowMouseleave.watch(this.tableRecordMouseleaveListener);this.renderChart();this.drawContextChartSelection();this.renderFocusChart()}},{key:"componentDidUpdate",value:function componentDidUpdate(){if(this.props.renderFocusChartOnly===false){this.renderChart();this.drawContextChartSelection()}this.renderFocusChart()}},{key:"renderChart",value:function renderChart(){var _props=this.props,contextChartData=_props.contextChartData,contextForecastData=_props.contextForecastData,detectorIndex=_props.detectorIndex,modelPlotEnabled=_props.modelPlotEnabled,selectedJob=_props.selectedJob,svgWidth=_props.svgWidth;var createFocusChart=this.createFocusChart.bind(this);var drawContextElements=this.drawContextElements.bind(this);var focusXScale=this.focusXScale;var focusYAxis=this.focusYAxis;var focusYScale=this.focusYScale;var svgHeight=getSvgHeight();var chartElement=_d2.default.select(this.rootNode);chartElement.selectAll("*").remove();if(typeof selectedJob!=="undefined"){this.fieldFormat=_field_format_service.mlFieldFormatService.getFieldFormat(selectedJob.job_id,detectorIndex)}else{return}if(contextChartData===undefined){return}var fieldFormat=this.fieldFormat;var svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight);var contextDataMin=void 0;var contextDataMax=void 0;if(modelPlotEnabled===true||contextForecastData!==undefined&&contextForecastData.length>0){var combinedData=contextForecastData===undefined?contextChartData:contextChartData.concat(contextForecastData);contextDataMin=_d2.default.min(combinedData,function(d){return Math.min(d.value,d.lower)});contextDataMax=_d2.default.max(combinedData,function(d){return Math.max(d.value,d.upper)})}else{contextDataMin=_d2.default.min(contextChartData,function(d){return d.value});contextDataMax=_d2.default.max(contextChartData,function(d){return d.value})}var ceiledMax=contextDataMax>0?Math.pow(10,Math.ceil(Math.log10(Math.abs(contextDataMax)))):contextDataMax;var flooredMin=contextDataMin>=0?contextDataMin:-1*Math.pow(10,Math.ceil(Math.log10(Math.abs(contextDataMin))));focusYScale.domain([flooredMin,ceiledMax]);var maxYAxisLabelWidth=0;var tempLabelText=svg.append("g").attr("class","temp-axis-label tick");tempLabelText.selectAll("text.temp.axis").data(focusYScale.ticks()).enter().append("text").text(function(d){if(fieldFormat!==undefined){return fieldFormat.convert(d,"text")}else{return focusYScale.tickFormat()(d)}}).each(function(){maxYAxisLabelWidth=Math.max(this.getBBox().width+focusYAxis.tickPadding(),maxYAxisLabelWidth)}).remove();_d2.default.select(".temp-axis-label").remove();margin.left=Math.max(maxYAxisLabelWidth,40);this.vizWidth=Math.max(svgWidth-margin.left-margin.right,0);focusXScale.range([0,this.vizWidth]);focusYAxis.innerTickSize(-this.vizWidth);var focus=svg.append("g").attr("class","focus-chart").attr("transform","translate("+margin.left+","+margin.top+")");var context=svg.append("g").attr("class","context-chart").attr("transform","translate("+margin.left+","+(focusHeight+margin.top+chartSpacing)+")");if(mlAnnotationsEnabled){var annotationsMask=svg.append("defs").append("mask").attr("id",_timeseries_chart_annotations.ANNOTATION_MASK_ID);annotationsMask.append("rect").attr("x",0).attr("y",0).attr("width",this.vizWidth).attr("height",focusHeight).style("fill","white")}createFocusChart(focus,this.vizWidth,focusHeight);drawContextElements(context,this.vizWidth,contextChartHeight,swimlaneHeight)}},{key:"drawContextChartSelection",value:function drawContextChartSelection(){var _props2=this.props,contextChartData=_props2.contextChartData,contextChartSelected=_props2.contextChartSelected,contextForecastData=_props2.contextForecastData,zoomFrom=_props2.zoomFrom,zoomTo=_props2.zoomTo;if(contextChartData===undefined){return}var setContextBrushExtent=this.setContextBrushExtent.bind(this);var focusLoadFrom=void 0;var focusLoadTo=void 0;var contextXMin=this.contextXScale.domain()[0].getTime();var contextXMax=this.contextXScale.domain()[1].getTime();var combinedData=contextChartData;if(contextForecastData!==undefined){combinedData=combinedData.concat(contextForecastData)}if(zoomFrom){focusLoadFrom=zoomFrom.getTime()}else{focusLoadFrom=_lodash2.default.reduce(combinedData,function(memo,point){return Math.min(memo,point.date.getTime())},new Date(2099,12,31).getTime())}focusLoadFrom=Math.max(focusLoadFrom,contextXMin);if(zoomTo){focusLoadTo=zoomTo.getTime()}else{focusLoadTo=_lodash2.default.reduce(combinedData,function(memo,point){return Math.max(memo,point.date.getTime())},0)}focusLoadTo=Math.min(focusLoadTo,contextXMax);if(focusLoadFrom!==contextXMin||focusLoadTo!==contextXMax){setContextBrushExtent(new Date(focusLoadFrom),new Date(focusLoadTo),true)}else{this.setBrushVisibility(false);var selectedBounds=this.contextXScale.domain();this.selectedBounds={min:(0,_moment2.default)(new Date(selectedBounds[0])),max:(0,_moment2.default)(selectedBounds[1])};contextChartSelected({from:selectedBounds[0],to:selectedBounds[1]})}}},{key:"createFocusChart",value:function createFocusChart(fcsGroup,fcsWidth,fcsHeight){var contextForecastData=this.props.contextForecastData;var zoomGroup=fcsGroup.append("g").attr("class","focus-zoom");zoomGroup.append("rect").attr("x",0).attr("y",0).attr("width",fcsWidth).attr("height",focusZoomPanelHeight).attr("class","chart-border");this.createZoomInfoElements(zoomGroup,fcsWidth);if(mlAnnotationsEnabled){var annotateBrush=this.annotateBrush.bind(this);fcsGroup.append("g").attr("class","mlAnnotationBrush").call(annotateBrush).selectAll("rect").attr("x",0).attr("y",focusZoomPanelHeight).attr("height",focusChartHeight);fcsGroup.append("g").classed("mlAnnotations",true)}fcsGroup.append("rect").attr("x",0).attr("y",focusZoomPanelHeight).attr("width",fcsWidth).attr("height",focusChartHeight).attr("class","chart-border");var xAxisBg=fcsGroup.append("g").attr("class","x-axis-background");xAxisBg.append("rect").attr("x",0).attr("y",fcsHeight).attr("width",fcsWidth).attr("height",chartSpacing);xAxisBg.append("line").attr("x1",0).attr("y1",fcsHeight).attr("x2",0).attr("y2",fcsHeight+chartSpacing);xAxisBg.append("line").attr("x1",fcsWidth).attr("y1",fcsHeight).attr("x2",fcsWidth).attr("y2",fcsHeight+chartSpacing);xAxisBg.append("line").attr("x1",0).attr("y1",fcsHeight+chartSpacing).attr("x2",fcsWidth).attr("y2",fcsHeight+chartSpacing);var axes=fcsGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0,"+fcsHeight+")");axes.append("g").attr("class","y axis");fcsGroup.append("path").attr("class","area bounds");fcsGroup.append("path").attr("class","values-line");fcsGroup.append("g").attr("class","focus-chart-markers");if(contextForecastData){fcsGroup.append("path").attr("class","area forecast");fcsGroup.append("path").attr("class","values-line forecast");fcsGroup.append("g").attr("class","focus-chart-markers forecast")}fcsGroup.append("rect").attr("x",0).attr("y",0).attr("width",fcsWidth).attr("height",fcsHeight+24).attr("class","chart-border chart-border-highlight")}},{key:"renderFocusChart",value:function renderFocusChart(){var _this3=this;var _props3=this.props,focusAggregationInterval=_props3.focusAggregationInterval,focusAnnotationData=_props3.focusAnnotationData,focusChartData=_props3.focusChartData,focusForecastData=_props3.focusForecastData,modelPlotEnabled=_props3.modelPlotEnabled,selectedJob=_props3.selectedJob,showAnnotations=_props3.showAnnotations,showForecast=_props3.showForecast,showModelBounds=_props3.showModelBounds;if(focusChartData===undefined){return}var data=focusChartData;var contextYScale=this.contextYScale;var showFlyout=this.showFlyout.bind(this);var showFocusChartTooltip=this.showFocusChartTooltip.bind(this);var focusChart=_d2.default.select(".focus-chart");var focusAggInt=focusAggregationInterval.expression;var bucketSpan=selectedJob.analysis_config.bucket_span;var chartElement=_d2.default.select(this.rootNode);chartElement.select(".zoom-aggregation-interval").text("(aggregation interval: "+focusAggInt+", bucket span: "+bucketSpan+")");var bounds=this.selectedBounds;if(typeof bounds==="undefined"){return}var aggMs=focusAggregationInterval.asMilliseconds();var earliest=(0,_moment2.default)(Math.floor(bounds.min.valueOf()/aggMs)*aggMs);var latest=(0,_moment2.default)(Math.ceil(bounds.max.valueOf()/aggMs)*aggMs);this.focusXScale.domain([earliest.toDate(),latest.toDate()]);if(focusChartData.length>0||focusForecastData!==undefined&&focusForecastData.length>0){if(this.fieldFormat!==undefined){this.focusYAxis.tickFormat(function(d){return _this3.fieldFormat.convert(d,"text")})}else{this.focusYAxis.tickFormat(null)}var yMin=0;var yMax=0;var combinedData=data;if(focusForecastData!==undefined&&focusForecastData.length>0){combinedData=data.concat(focusForecastData)}yMin=_d2.default.min(combinedData,function(d){return d.lower!==undefined?Math.min(d.value,d.lower):d.value});yMax=_d2.default.max(combinedData,function(d){return d.upper!==undefined?Math.max(d.value,d.upper):d.value});if(yMax===yMin){if(this.contextYScale.domain()[0]!==contextYScale.domain()[1]&&yMin>=contextYScale.domain()[0]&&yMax<=contextYScale.domain()[1]){yMin=contextYScale.domain()[0];yMax=contextYScale.domain()[1]}else{yMin-=yMin*.05;yMax+=yMax*.05}}if(mlAnnotationsEnabled&&focusAnnotationData&&focusAnnotationData.length>0){var levels=(0,_timeseries_chart_annotations.getAnnotationLevels)(focusAnnotationData);var maxLevel=_d2.default.max(Object.keys(levels).map(function(key){return levels[key]}));yMax=yMax*(1+(maxLevel+1)/5)}this.focusYScale.domain([yMin,yMax])}else{this.focusYScale.domain([0,10]);this.focusYAxis.tickFormat("")}var timeBuckets=new _time_buckets.TimeBuckets;timeBuckets.setInterval("auto");timeBuckets.setBounds(bounds);var xAxisTickFormat=timeBuckets.getScaledDateFormat();focusChart.select(".x.axis").call(this.focusXAxis.ticks((0,_chart_utils.numTicksForDateFormat)(this.vizWidth),xAxisTickFormat).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)}));focusChart.select(".y.axis").call(this.focusYAxis);(0,_chart_utils.filterAxisLabels)(focusChart.select(".x.axis"),this.vizWidth);if(modelPlotEnabled===true){focusChart.select(".area.bounds").attr("d",this.focusBoundedArea(data)).classed("hidden",!showModelBounds)}if(mlAnnotationsEnabled){(0,_timeseries_chart_annotations.renderAnnotations)(focusChart,focusAnnotationData,focusZoomPanelHeight,focusChartHeight,this.focusXScale,showAnnotations,showFocusChartTooltip,showFlyout);focusChart.select(".mlAnnotationBrush").style("pointer-events",showAnnotations?"all":"none")}focusChart.select(".values-line").attr("d",this.focusValuesLine(data));(0,_chart_utils.drawLineChartDots)(data,focusChart,this.focusValuesLine);var dots=_d2.default.select(".focus-chart-markers").selectAll(".metric-value").data(data.filter(function(d){return d.value!==null&&!(0,_chart_utils.showMultiBucketAnomalyMarker)(d)}));dots.exit().remove();dots.enter().append("circle").attr("r",_chart_utils.LINE_CHART_ANOMALY_RADIUS).on("mouseover",function(d){showFocusChartTooltip(d,this)}).on("mouseout",function(){return _chart_tooltip_service.mlChartTooltipService.hide()});dots.attr("cx",function(d){return _this3.focusXScale(d.date)}).attr("cy",function(d){return _this3.focusYScale(d.value)}).attr("class",function(d){var markerClass="metric-value";if(_lodash2.default.has(d,"anomalyScore")){markerClass+=" anomaly-marker "+(0,_anomaly_utils.getSeverityWithLow)(d.anomalyScore)}return markerClass});var multiBucketMarkers=_d2.default.select(".focus-chart-markers").selectAll(".multi-bucket").data(data.filter(function(d){return d.anomalyScore!==null&&(0,_chart_utils.showMultiBucketAnomalyMarker)(d)===true}));multiBucketMarkers.exit().remove();multiBucketMarkers.enter().append("path").attr("d",_d2.default.svg.symbol().size(_chart_utils.MULTI_BUCKET_SYMBOL_SIZE).type("cross")).on("mouseover",function(d){showFocusChartTooltip(d,this)}).on("mouseout",function(){return _chart_tooltip_service.mlChartTooltipService.hide()});multiBucketMarkers.attr("transform",function(d){return"translate("+_this3.focusXScale(d.date)+", "+_this3.focusYScale(d.value)+")"}).attr("class",function(d){return"anomaly-marker multi-bucket "+(0,_anomaly_utils.getSeverityWithLow)(d.anomalyScore)});var scheduledEventMarkers=_d2.default.select(".focus-chart-markers").selectAll(".scheduled-event-marker").data(data.filter(function(d){return d.scheduledEvents!==undefined}));scheduledEventMarkers.exit().remove();scheduledEventMarkers.enter().append("rect").attr("width",_chart_utils.LINE_CHART_ANOMALY_RADIUS*2).attr("height",_chart_utils.SCHEDULED_EVENT_SYMBOL_HEIGHT).attr("class","scheduled-event-marker").attr("rx",1).attr("ry",1);scheduledEventMarkers.attr("x",function(d){return _this3.focusXScale(d.date)-_chart_utils.LINE_CHART_ANOMALY_RADIUS}).attr("y",function(d){return _this3.focusYScale(d.value)-3});if(focusForecastData!==undefined){focusChart.select(".area.forecast").attr("d",this.focusBoundedArea(focusForecastData)).classed("hidden",!showForecast);focusChart.select(".values-line.forecast").attr("d",this.focusValuesLine(focusForecastData)).classed("hidden",!showForecast);var forecastDots=_d2.default.select(".focus-chart-markers.forecast").selectAll(".metric-value").data(focusForecastData);forecastDots.exit().remove();forecastDots.enter().append("circle").attr("r",_chart_utils.LINE_CHART_ANOMALY_RADIUS).on("mouseover",function(d){showFocusChartTooltip(d,this)}).on("mouseout",function(){return _chart_tooltip_service.mlChartTooltipService.hide()});forecastDots.attr("cx",function(d){return _this3.focusXScale(d.date)}).attr("cy",function(d){return _this3.focusYScale(d.value)}).attr("class","metric-value").classed("hidden",!showForecast)}}},{key:"createZoomInfoElements",value:function createZoomInfoElements(zoomGroup,fcsWidth){var _props4=this.props,autoZoomDuration=_props4.autoZoomDuration,modelPlotEnabled=_props4.modelPlotEnabled,timefilter=_props4.timefilter;var setZoomInterval=this.setZoomInterval.bind(this);var bounds=timefilter.getActiveBounds();var boundsSecs=bounds.max.unix()-bounds.min.unix();var minSecs=10/this.vizWidth*boundsSecs;var xPos=10;var zoomLabel=zoomGroup.append("text").attr("x",xPos).attr("y",17).attr("class","zoom-info-text").text("Zoom:");var zoomOptions=[{durationMs:autoZoomDuration,label:"auto"}];_lodash2.default.each(ZOOM_INTERVAL_OPTIONS,function(option){if(option.duration.asSeconds()>minSecs&&option.duration.asSeconds()<boundsSecs){zoomOptions.push({durationMs:option.duration.asMilliseconds(),label:option.label})}});xPos+=zoomLabel.node().getBBox().width+4;_lodash2.default.each(zoomOptions,function(option){var text=zoomGroup.append("a").attr("data-ms",option.durationMs).attr("href","").append("text").attr("x",xPos).attr("y",17).attr("class","zoom-info-text").text(option.label);xPos+=text.node().getBBox().width+4});zoomGroup.append("text").attr("x",xPos+6).attr("y",17).attr("class","zoom-info-text zoom-aggregation-interval").text("(aggregation interval: , bucket span: )");if(modelPlotEnabled===false){var modelPlotLabel=zoomGroup.append("text").attr("x",300).attr("y",17).attr("class","zoom-info-text").text("Model bounds are not available");modelPlotLabel.attr("x",fcsWidth-(modelPlotLabel.node().getBBox().width+10))}var chartElement=_d2.default.select(this.rootNode);chartElement.selectAll(".focus-zoom a").on("click",function(){_d2.default.event.preventDefault();setZoomInterval(_d2.default.select(this).attr("data-ms"))})}},{key:"drawContextElements",value:function drawContextElements(cxtGroup,cxtWidth,cxtChartHeight,swlHeight){var _this4=this;var _props5=this.props,contextChartData=_props5.contextChartData,contextForecastData=_props5.contextForecastData,modelPlotEnabled=_props5.modelPlotEnabled,timefilter=_props5.timefilter;var data=contextChartData;var calculateContextXAxisDomain=this.calculateContextXAxisDomain.bind(this);var drawContextBrush=this.drawContextBrush.bind(this);var drawSwimlane=this.drawSwimlane.bind(this);this.contextXScale=_d2.default.time.scale().range([0,cxtWidth]).domain(calculateContextXAxisDomain());var combinedData=contextForecastData===undefined?data:data.concat(contextForecastData);var valuesRange={min:Number.MAX_VALUE,max:Number.MIN_VALUE};_lodash2.default.each(combinedData,function(item){valuesRange.min=Math.min(item.value,valuesRange.min);valuesRange.max=Math.max(item.value,valuesRange.max)});var dataMin=valuesRange.min;var dataMax=valuesRange.max;var chartLimits={min:dataMin,max:dataMax};if(modelPlotEnabled===true||contextForecastData!==undefined&&contextForecastData.length>0){var boundsRange={min:Number.MAX_VALUE,max:Number.MIN_VALUE};_lodash2.default.each(combinedData,function(item){boundsRange.min=Math.min(item.lower,boundsRange.min);boundsRange.max=Math.max(item.upper,boundsRange.max)});dataMin=Math.min(dataMin,boundsRange.min);dataMax=Math.max(dataMax,boundsRange.max);if(valuesRange.max-valuesRange.min<.5*(dataMax-dataMin)){if(valuesRange.min>dataMin){chartLimits.min=valuesRange.min-.5*(valuesRange.max-valuesRange.min)}if(valuesRange.max<dataMax){chartLimits.max=valuesRange.max+.5*(valuesRange.max-valuesRange.min)}}}this.contextYScale=_d2.default.scale.linear().range([cxtChartHeight,contextChartLineTopMargin]).domain([chartLimits.min,chartLimits.max]);var borders=cxtGroup.append("g").attr("class","axis");borders.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",cxtChartHeight+swlHeight);borders.append("line").attr("x1",cxtWidth).attr("y1",0).attr("x2",cxtWidth).attr("y2",cxtChartHeight+swlHeight);var bounds=timefilter.getActiveBounds();var timeBuckets=new _time_buckets.TimeBuckets;timeBuckets.setInterval("auto");timeBuckets.setBounds(bounds);var xAxisTickFormat=timeBuckets.getScaledDateFormat();var xAxis=_d2.default.svg.axis().scale(this.contextXScale).orient("top").innerTickSize(-cxtChartHeight).outerTickSize(0).tickPadding(0).ticks((0,_chart_utils.numTicksForDateFormat)(cxtWidth,xAxisTickFormat)).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)});cxtGroup.datum(data);var contextBoundsArea=_d2.default.svg.area().x(function(d){return _this4.contextXScale(d.date)}).y0(function(d){return _this4.contextYScale(Math.min(chartLimits.max,Math.max(d.lower,chartLimits.min)))}).y1(function(d){return _this4.contextYScale(Math.max(chartLimits.min,Math.min(d.upper,chartLimits.max)))}).defined(function(d){return d.lower!==null&&d.upper!==null});if(modelPlotEnabled===true){cxtGroup.append("path").datum(data).attr("class","area context").attr("d",contextBoundsArea)}var contextValuesLine=_d2.default.svg.line().x(function(d){return _this4.contextXScale(d.date)}).y(function(d){return _this4.contextYScale(d.value)}).defined(function(d){return d.value!==null});cxtGroup.append("path").datum(data).attr("class","values-line").attr("d",contextValuesLine);(0,_chart_utils.drawLineChartDots)(data,cxtGroup,contextValuesLine,1);if(contextForecastData!==undefined){cxtGroup.append("path").datum(contextForecastData).attr("class","area forecast").attr("d",contextBoundsArea);cxtGroup.append("path").datum(contextForecastData).attr("class","values-line forecast").attr("d",contextValuesLine)}var swimlane=cxtGroup.append("g").attr("class","swimlane").attr("transform","translate(0,"+cxtChartHeight+")");drawSwimlane(swimlane,cxtWidth,swlHeight);this.mask=new _context_chart_mask.ContextChartMask(cxtGroup,contextChartData,modelPlotEnabled,swlHeight).x(this.contextXScale).y(this.contextYScale);cxtGroup.append("g").attr("class","x axis context-chart-axis").call(xAxis);cxtGroup.selectAll(".x.context-chart-axis text").attr("dy",cxtChartHeight-5);(0,_chart_utils.filterAxisLabels)(cxtGroup.selectAll(".x.context-chart-axis"),cxtWidth);drawContextBrush(cxtGroup)}},{key:"drawContextBrush",value:function drawContextBrush(contextGroup){var contextChartSelected=this.props.contextChartSelected;var brush=this.brush;var contextXScale=this.contextXScale;var setBrushVisibility=this.setBrushVisibility.bind(this);var mask=this.mask;brush.x(contextXScale).on("brush",brushing).on("brushend",brushed);contextGroup.append("g").attr("class","x brush").call(brush).selectAll("rect").attr("y",-1).attr("height",contextChartHeight+swimlaneHeight+1);contextGroup.selectAll(".w rect").attr("x",-10).attr("width",10);contextGroup.selectAll(".e rect").attr("x",0).attr("width",10);var topBorder=contextGroup.append("rect").attr("class","top-border").attr("y",-2).attr("height",contextChartLineTopMargin);var leftHandle=contextGroup.append("foreignObject").attr("width",10).attr("height",90).attr("class","brush-handle").html('<div class="brush-handle-inner brush-handle-inner-left"><i class="fa fa-caret-left"></i></div>');var rightHandle=contextGroup.append("foreignObject").attr("width",10).attr("height",90).attr("class","brush-handle").html('<div class="brush-handle-inner brush-handle-inner-right"><i class="fa fa-caret-right"></i></div>');setBrushVisibility(!brush.empty());function showBrush(show){if(show===true){var brushExtent=brush.extent();mask.reveal(brushExtent);leftHandle.attr("x",contextXScale(brushExtent[0])-10);rightHandle.attr("x",contextXScale(brushExtent[1])+0);topBorder.attr("x",contextXScale(brushExtent[0])+1);topBorder.attr("width",contextXScale(brushExtent[1])-contextXScale(brushExtent[0])-2)}setBrushVisibility(show)}function brushing(){var isEmpty=brush.empty();showBrush(!isEmpty)}var that=this;function brushed(){var isEmpty=brush.empty();showBrush(!isEmpty);var selectedBounds=isEmpty?contextXScale.domain():brush.extent();var selectionMin=selectedBounds[0].getTime();var selectionMax=selectedBounds[1].getTime();contextGroup.selectAll(".swimlane-cell").style("fill",function(d){var cellMs=d.date.getTime();if(cellMs<selectionMin||cellMs>selectionMax){return anomalyGrayScale(d.score)}else{return anomalyColorScale(d.score)}});that.selectedBounds={min:(0,_moment2.default)(selectionMin),max:(0,_moment2.default)(selectionMax)};contextChartSelected({from:selectedBounds[0],to:selectedBounds[1]})}}},{key:"setBrushVisibility",value:function setBrushVisibility(show){var mask=this.mask;if(mask!==undefined){var visibility=show?"visible":"hidden";mask.style("visibility",visibility);_d2.default.selectAll(".brush").style("visibility",visibility);var brushHandles=_d2.default.selectAll(".brush-handle-inner");brushHandles.style("visibility",visibility);var topBorder=_d2.default.selectAll(".top-border");topBorder.style("visibility",visibility);var border=_d2.default.selectAll(".chart-border-highlight");border.style("visibility",visibility)}}},{key:"drawSwimlane",value:function drawSwimlane(swlGroup,swlWidth,swlHeight){var _props6=this.props,contextAggregationInterval=_props6.contextAggregationInterval,swimlaneData=_props6.swimlaneData;var calculateContextXAxisDomain=this.calculateContextXAxisDomain.bind(this);var data=swimlaneData;if(typeof data==="undefined"){return}var xAxisDomain=calculateContextXAxisDomain();var x=_d2.default.time.scale().range([0,swlWidth]).domain(xAxisDomain);var y=_d2.default.scale.linear().range([swlHeight,0]).domain([0,swlHeight]);var xAxis=_d2.default.svg.axis().scale(x).orient("bottom").innerTickSize(-swlHeight).outerTickSize(0);var yAxis=_d2.default.svg.axis().scale(y).orient("left").tickValues(y.domain()).innerTickSize(-swlWidth).outerTickSize(0);var axes=swlGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0,"+swlHeight+")").call(xAxis);axes.append("g").attr("class","y axis").call(yAxis);var earliest=xAxisDomain[0].getTime();var latest=xAxisDomain[1].getTime();var swimlaneAggMs=contextAggregationInterval.asMilliseconds();var cellWidth=swlWidth/((latest-earliest)/swimlaneAggMs);if(cellWidth<1){cellWidth=1}var cells=swlGroup.append("g").attr("class","swimlane-cells").selectAll("rect").data(data);cells.enter().append("rect").attr("x",function(d){return x(d.date)}).attr("y",0).attr("rx",0).attr("ry",0).attr("class",function(d){return d.score>0?"swimlane-cell":"swimlane-cell-hidden"}).attr("width",cellWidth).attr("height",swlHeight).style("fill",function(d){return anomalyColorScale(d.score)})}},{key:"calculateContextXAxisDomain",value:function calculateContextXAxisDomain(){var _props7=this.props,contextAggregationInterval=_props7.contextAggregationInterval,swimlaneData=_props7.swimlaneData,timefilter=_props7.timefilter;var bounds=timefilter.getActiveBounds();var earliest=bounds.min.valueOf();if(swimlaneData!==undefined&&swimlaneData.length>0){earliest=Math.min(_lodash2.default.first(swimlaneData).date.getTime(),bounds.min.valueOf())}var contextAggMs=contextAggregationInterval.asMilliseconds();var earliestMs=Math.floor(earliest/contextAggMs)*contextAggMs;var latestMs=Math.ceil(bounds.max.valueOf()/contextAggMs)*contextAggMs;return[new Date(earliestMs),new Date(latestMs)]}},{key:"setContextBrushExtent",value:function setContextBrushExtent(from,to,fireEvent){var brush=this.brush;brush.extent([from,to]);brush(_d2.default.select(".brush"));if(fireEvent){brush.event(_d2.default.select(".brush"))}}},{key:"setZoomInterval",value:function setZoomInterval(ms){var _props8=this.props,timefilter=_props8.timefilter,zoomTo=_props8.zoomTo;var setContextBrushExtent=this.setContextBrushExtent.bind(this);var bounds=timefilter.getActiveBounds();var minBoundsMs=bounds.min.valueOf();var maxBoundsMs=bounds.max.valueOf();var millis=+ms;var to=zoomTo.getTime();var from=to-millis;if(from<minBoundsMs){from=minBoundsMs;to=Math.min(minBoundsMs+millis,maxBoundsMs)}setContextBrushExtent(new Date(from),new Date(to),true)}},{key:"showFocusChartTooltip",value:function showFocusChartTooltip(marker,circle){var modelPlotEnabled=this.props.modelPlotEnabled;var fieldFormat=this.fieldFormat;var formattedDate=(0,_date_utils.formatHumanReadableDateTimeSeconds)(marker.date);var contents=formattedDate+"<br/><hr/>";if(_lodash2.default.has(marker,"anomalyScore")){var score=parseInt(marker.anomalyScore);var displayScore=score>0?score:"< 1";contents+="anomaly score: "+displayScore+"<br/>";if((0,_chart_utils.showMultiBucketAnomalyTooltip)(marker)===true){contents+="multi-bucket impact: "+(0,_anomaly_utils.getMultiBucketImpactLabel)(marker.multiBucketImpact)+"<br/>"}if(modelPlotEnabled===false){if(_lodash2.default.has(marker,"actual")&&marker.function!=="rare"){contents+="actual: "+(0,_format_value.formatValue)(marker.actual,marker.function,fieldFormat);contents+="<br/>typical: "+(0,_format_value.formatValue)(marker.typical,marker.function,fieldFormat)}else{contents+="value: "+(0,_format_value.formatValue)(marker.value,marker.function,fieldFormat);if(_lodash2.default.has(marker,"byFieldName")&&_lodash2.default.has(marker,"numberOfCauses")){var numberOfCauses=marker.numberOfCauses;var byFieldName=(0,_string_utils.mlEscape)(marker.byFieldName);if(numberOfCauses<10){contents+="<br/> "+numberOfCauses+" unusual "+byFieldName+" values"}else{contents+="<br/> "+numberOfCauses+"+ unusual "+byFieldName+" values"}}}}else{contents+="value: "+(0,_format_value.formatValue)(marker.value,marker.function,fieldFormat);contents+="<br/>upper bounds: "+(0,_format_value.formatValue)(marker.upper,marker.function,fieldFormat);contents+="<br/>lower bounds: "+(0,_format_value.formatValue)(marker.lower,marker.function,fieldFormat)}}else{if(_lodash2.default.get(marker,"isForecast",false)===true){contents+="prediction: "+(0,_format_value.formatValue)(marker.value,marker.function,fieldFormat)}else{contents+="value: "+(0,_format_value.formatValue)(marker.value,marker.function,fieldFormat)}if(modelPlotEnabled===true){contents+="<br/>upper bounds: "+(0,_format_value.formatValue)(marker.upper,marker.function,fieldFormat);contents+="<br/>lower bounds: "+(0,_format_value.formatValue)(marker.lower,marker.function,fieldFormat)}}if(_lodash2.default.has(marker,"scheduledEvents")){contents+="<br/><hr/>Scheduled events:<br/>"+marker.scheduledEvents.map(_string_utils.mlEscape).join("<br/>")}if(mlAnnotationsEnabled&&_lodash2.default.has(marker,"annotation")){contents=(0,_string_utils.mlEscape)(marker.annotation);contents+="<br />"+(0,_moment2.default)(marker.timestamp).format("MMMM Do YYYY, HH:mm");if(typeof marker.end_timestamp!=="undefined"){contents+=" - "+(0,_moment2.default)(marker.end_timestamp).format("MMMM Do YYYY, HH:mm")}}_chart_tooltip_service.mlChartTooltipService.show(contents,circle,{x:_chart_utils.LINE_CHART_ANOMALY_RADIUS*2,y:0})}},{key:"highlightFocusChartAnomaly",value:function highlightFocusChartAnomaly(record){var focusChartData=this.props.focusChartData;var focusXScale=this.focusXScale;var focusYScale=this.focusYScale;var showFocusChartTooltip=this.showFocusChartTooltip.bind(this);var anomalyTime=record.source.timestamp;var markerToSelect=(0,_timeseriesexplorer_utils.findChartPointForAnomalyTime)(focusChartData,anomalyTime);if(markerToSelect!==undefined){var selectedMarker=_d2.default.select(".focus-chart-markers").selectAll(".focus-chart-highlighted-marker").data([markerToSelect]);if((0,_chart_utils.showMultiBucketAnomalyMarker)(markerToSelect)===true){selectedMarker.enter().append("path").attr("d",_d2.default.svg.symbol().size(_chart_utils.MULTI_BUCKET_SYMBOL_SIZE).type("cross")).attr("transform",function(d){return"translate("+focusXScale(d.date)+", "+focusYScale(d.value)+")"}).attr("class",function(d){return"anomaly-marker multi-bucket "+(0,_anomaly_utils.getSeverityWithLow)(d.anomalyScore)+" highlighted"})}else{selectedMarker.enter().append("circle").attr("r",_chart_utils.LINE_CHART_ANOMALY_RADIUS).attr("cx",function(d){return focusXScale(d.date)}).attr("cy",function(d){return focusYScale(d.value)}).attr("class",function(d){return"anomaly-marker metric-value "+(0,_anomaly_utils.getSeverityWithLow)(d.anomalyScore)+" highlighted"})}var chartElement=_d2.default.select(this.rootNode);var anomalyMarker=chartElement.selectAll(".focus-chart-markers .anomaly-marker.highlighted");if(anomalyMarker.length){showFocusChartTooltip(markerToSelect,anomalyMarker[0][0])}}}},{key:"unhighlightFocusChartAnomaly",value:function unhighlightFocusChartAnomaly(){_d2.default.select(".focus-chart-markers").selectAll(".anomaly-marker.highlighted").remove();_chart_tooltip_service.mlChartTooltipService.hide()}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(){return true}},{key:"setRef",value:function setRef(componentNode){this.rootNode=componentNode}},{key:"render",value:function render(){var _state=this.state,annotation=_state.annotation,isDeleteModalVisible=_state.isDeleteModalVisible,isFlyoutVisible=_state.isFlyoutVisible;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement("div",{className:"ml-timeseries-chart-react",ref:this.setRef.bind(this)}),mlAnnotationsEnabled&&isFlyoutVisible&&_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_annotation_flyout.AnnotationFlyout,{annotation:annotation,cancelAction:this.closeFlyout,controlFunc:this.handleAnnotationChange,deleteAction:this.deleteAnnotation,saveAction:this.indexAnnotation}),_react2.default.createElement(_delete_annotation_modal.DeleteAnnotationModal,{annotation:annotation,cancelAction:this.closeDeleteModal,deleteAction:this.deleteAnnotationConfirmation,isVisible:isDeleteModalVisible})))}}]);return TimeseriesChart}(_react2.default.Component);TimeseriesChart.propTypes={indexAnnotation:_propTypes2.default.func,autoZoomDuration:_propTypes2.default.number,contextAggregationInterval:_propTypes2.default.object,contextChartData:_propTypes2.default.array,contextForecastData:_propTypes2.default.array,contextChartSelected:_propTypes2.default.func.isRequired,deleteAnnotation:_propTypes2.default.func,detectorIndex:_propTypes2.default.string,focusAggregationInterval:_propTypes2.default.object,focusAnnotationData:_propTypes2.default.array,focusChartData:_propTypes2.default.array,focusForecastData:_propTypes2.default.array,modelPlotEnabled:_propTypes2.default.bool.isRequired,refresh:_propTypes2.default.func,renderFocusChartOnly:_propTypes2.default.bool.isRequired,selectedJob:_propTypes2.default.object,showForecast:_propTypes2.default.bool.isRequired,showModelBounds:_propTypes2.default.bool.isRequired,svgWidth:_propTypes2.default.number.isRequired,swimlaneData:_propTypes2.default.array,timefilter:_propTypes2.default.object.isRequired,toastNotifications:_propTypes2.default.object,zoomFrom:_propTypes2.default.object,zoomTo:_propTypes2.default.object}},2461:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=__webpack_require__(5);var react_1=tslib_1.__importDefault(__webpack_require__(0));var eui_1=__webpack_require__(2);var annotation_description_list_1=__webpack_require__(2462);exports.AnnotationFlyout=function(_ref){var annotation=_ref.annotation,cancelAction=_ref.cancelAction,controlFunc=_ref.controlFunc,deleteAction=_ref.deleteAction,saveAction=_ref.saveAction;var saveActionWrapper=function saveActionWrapper(){return saveAction(annotation)};var deleteActionWrapper=function deleteActionWrapper(){return deleteAction(annotation)};var isExistingAnnotation=typeof annotation._id!=="undefined";var titlePrefix=isExistingAnnotation?"Edit":"Add";return react_1.default.createElement(eui_1.EuiFlyout,{onClose:cancelAction,size:"s","aria-labelledby":"Add annotation"},react_1.default.createElement(eui_1.EuiFlyoutHeader,{hasBorder:true},react_1.default.createElement(eui_1.EuiTitle,{size:"s"},react_1.default.createElement("h2",{id:"mlAnnotationFlyoutTitle"},titlePrefix," annotation"))),react_1.default.createElement(eui_1.EuiFlyoutBody,null,react_1.default.createElement(annotation_description_list_1.AnnotationDescriptionList,{annotation:annotation}),react_1.default.createElement(eui_1.EuiSpacer,{size:"m"}),react_1.default.createElement(eui_1.EuiFormRow,{label:"Annotation text",fullWidth:true},react_1.default.createElement(eui_1.EuiTextArea,{fullWidth:true,isInvalid:annotation.annotation==="",onChange:controlFunc,placeholder:"...",value:annotation.annotation}))),react_1.default.createElement(eui_1.EuiFlyoutFooter,null,react_1.default.createElement(eui_1.EuiFlexGroup,{justifyContent:"spaceBetween"},react_1.default.createElement(eui_1.EuiFlexItem,{grow:false},react_1.default.createElement(eui_1.EuiButtonEmpty,{iconType:"cross",onClick:cancelAction,flush:"left"},"Cancel")),react_1.default.createElement(eui_1.EuiFlexItem,{grow:false},isExistingAnnotation&&react_1.default.createElement(eui_1.EuiButtonEmpty,{color:"danger",onClick:deleteActionWrapper},"Delete")),react_1.default.createElement(eui_1.EuiFlexItem,{grow:false},react_1.default.createElement(eui_1.EuiButton,{fill:true,isDisabled:annotation.annotation==="",onClick:saveActionWrapper},isExistingAnnotation?"Update":"Create")))))}},2462:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=__webpack_require__(5);var react_1=tslib_1.__importDefault(__webpack_require__(0));var eui_1=__webpack_require__(2);var date_utils_1=__webpack_require__(221);exports.AnnotationDescriptionList=function(_ref){var annotation=_ref.annotation;var listItems=[{title:"Job ID",description:annotation.job_id},{title:"Start",description:date_utils_1.formatHumanReadableDateTimeSeconds(annotation.timestamp)}];if(annotation.end_timestamp!==undefined){listItems.push({title:"End",description:date_utils_1.formatHumanReadableDateTimeSeconds(annotation.end_timestamp)})}if(annotation.create_time!==undefined&&annotation.modified_time!==undefined){listItems.push({title:"Created",description:date_utils_1.formatHumanReadableDateTimeSeconds(annotation.create_time)});listItems.push({title:"Created by",description:annotation.create_username});listItems.push({title:"Last modified",description:date_utils_1.formatHumanReadableDateTimeSeconds(annotation.modified_time)});listItems.push({title:"Modified by",description:annotation.modified_username})}return react_1.default.createElement(eui_1.EuiDescriptionList,{className:"ml-annotation-description-list",type:"column",listItems:listItems})}},2463:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DeleteAnnotationModal=DeleteAnnotationModal;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function DeleteAnnotationModal(_ref){var cancelAction=_ref.cancelAction,deleteAction=_ref.deleteAction,isVisible=_ref.isVisible;return _react2.default.createElement(_react2.default.Fragment,null,isVisible===true&&_react2.default.createElement(_eui.EuiOverlayMask,null,_react2.default.createElement(_eui.EuiConfirmModal,{title:"Delete this annotation?",onCancel:cancelAction,onConfirm:deleteAction,cancelButtonText:"Cancel",confirmButtonText:"Delete",buttonColor:"danger",defaultFocusedButton:_eui.EUI_MODAL_CONFIRM_BUTTON,className:"eui-textBreakWord"})))}DeleteAnnotationModal.propTypes={cancelAction:_propTypes2.default.func.isRequired,deleteAction:_propTypes2.default.func.isRequired,isVisible:_propTypes2.default.bool.isRequired}},2464:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _context_chart_mask=__webpack_require__(2465);Object.keys(_context_chart_mask).forEach(function(key){if(key==="default"||key==="__esModule")return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _context_chart_mask[key]}})})},2465:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ContextChartMask=ContextChartMask;var _d=__webpack_require__(20);var _d2=_interopRequireDefault(_d);var _chart_utils=__webpack_require__(197);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ContextChartMask(contextGroup,data,drawBounds,swimlaneHeight){this.contextGroup=contextGroup;this.data=data;this.drawBounds=drawBounds;this.swimlaneHeight=swimlaneHeight;this.mask=this.contextGroup.append("g").attr("class","mask");this.leftGroup=this.mask.append("g").attr("class","left-mask");this.rightGroup=this.mask.append("g").attr("class","right-mask");this.leftPolygon=this.leftGroup.append("polygon");this.rightPolygon=this.rightGroup.append("polygon");if(this.drawBounds===true){this.leftGroup.append("path").attr("class","left area bounds");this.rightGroup.append("path").attr("class","right area bounds")}this.leftGroup.append("path").attr("class","left values-line");this.rightGroup.append("path").attr("class","right values-line");this._x=null;this._y=null}ContextChartMask.prototype.style=function(prop,val){this.leftGroup.style(prop,val);this.rightGroup.style(prop,val);return this};ContextChartMask.prototype.x=function(f){if(f==null){return this._x}this._x=f;return this};ContextChartMask.prototype.y=function(f){if(f==null){return this._y}this._y=f;return this};ContextChartMask.prototype.redraw=function(){var yDomain=this._y.domain();var minY=yDomain[0];var maxY=yDomain[1];var xDomain=this._x.domain();var minX=xDomain[0];var maxX=xDomain[1];var that=this;var leftData=this.data.filter(function(d){return d.date<that.from});var rightData=this.data.filter(function(d){return d.date>that.to});if(this.drawBounds===true){var boundedArea=_d2.default.svg.area().x(function(d){return that._x(d.date)||1}).y0(function(d){return that._y(Math.min(maxY,Math.max(d.lower,minY)))}).y1(function(d){return that._y(Math.max(minY,Math.min(d.upper,maxY)))}).defined(function(d){return d.lower!==null&&d.upper!==null});this.leftGroup.select(".left.area.bounds").attr("d",boundedArea(leftData));this.rightGroup.select(".right.area.bounds").attr("d",boundedArea(rightData))}var valuesLine=_d2.default.svg.line().x(function(d){return that._x(d.date)}).y(function(d){return that._y(d.value)}).defined(function(d){return d.value!==null});this.leftGroup.select(".left.values-line").attr("d",valuesLine(leftData));(0,_chart_utils.drawLineChartDots)(leftData,this.leftGroup,valuesLine,1);this.rightGroup.select(".right.values-line").attr("d",valuesLine(rightData));(0,_chart_utils.drawLineChartDots)(rightData,this.rightGroup,valuesLine,1);var leftPoly={l:this._x(minX),t:this._y(minY)+this.swimlaneHeight,r:this._x(this.from),b:0};var rightPoly={l:this._x(this.to),t:this._y(minY)+this.swimlaneHeight,r:this._x(maxX),b:0};this.leftPolygon.attr("points",""+leftPoly.l+","+leftPoly.t+"  "+leftPoly.r+","+leftPoly.t+"  "+leftPoly.r+","+leftPoly.b+"  "+leftPoly.l+","+leftPoly.b);this.rightPolygon.attr("points",""+rightPoly.l+","+rightPoly.t+"  "+rightPoly.r+","+rightPoly.t+"  "+rightPoly.r+","+rightPoly.b+"  "+rightPoly.l+","+rightPoly.b);return this};ContextChartMask.prototype.reveal=function(extent){this.from=extent[0];this.to=extent[1];this.redraw();return this}},2466:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=__webpack_require__(5);var d3_1=tslib_1.__importDefault(__webpack_require__(20));var moment_1=tslib_1.__importDefault(__webpack_require__(13));var annotations_1=__webpack_require__(2467);var chart_tooltip_service_1=__webpack_require__(242);exports.ANNOTATION_MASK_ID="mlAnnotationMask";function getAnnotationBrush(){var focusXScale=this.focusXScale;var annotateBrush=d3_1.default.svg.brush().x(focusXScale).on("brushend",brushend.bind(this));function brushend(){var selectedJob=this.props.selectedJob;var extent=annotateBrush.extent();var timestamp=extent[0].getTime();var endTimestamp=extent[1].getTime();if(timestamp===endTimestamp){this.closeFlyout();return}var annotation={timestamp:timestamp,end_timestamp:endTimestamp,annotation:this.state.annotation.annotation||"",job_id:selectedJob.job_id,type:annotations_1.ANNOTATION_TYPE.ANNOTATION};this.showFlyout(annotation)}return annotateBrush}exports.getAnnotationBrush=getAnnotationBrush;function getAnnotationLevels(focusAnnotationData){var levels={};focusAnnotationData.forEach(function(d,i){if(d.key!==undefined){var longerAnnotations=focusAnnotationData.filter(function(d2,i2){return i2<i});levels[d.key]=longerAnnotations.reduce(function(level,d2){if(d.end_timestamp===undefined||d2.end_timestamp===undefined||d2.key===undefined){return level}if(d2.timestamp<d.timestamp&&d2.end_timestamp<d.timestamp||d2.timestamp>d.end_timestamp&&d2.end_timestamp>d.end_timestamp){return level}return levels[d2.key]+1},0)}});return levels}exports.getAnnotationLevels=getAnnotationLevels;var ANNOTATION_DEFAULT_LEVEL=1;var ANNOTATION_LEVEL_HEIGHT=28;var ANNOTATION_UPPER_RECT_MARGIN=0;var ANNOTATION_UPPER_TEXT_MARGIN=-7;var ANNOTATION_MIN_WIDTH=2;var ANNOTATION_RECT_BORDER_RADIUS=2;var ANNOTATION_TEXT_VERTICAL_OFFSET=26;var ANNOTATION_TEXT_RECT_VERTICAL_OFFSET=12;var ANNOTATION_TEXT_RECT_WIDTH=24;var ANNOTATION_TEXT_RECT_HEIGHT=20;function renderAnnotations(focusChart,focusAnnotationData,focusZoomPanelHeight,focusChartHeight,focusXScale,showAnnotations,showFocusChartTooltip,showFlyout){var upperRectMargin=ANNOTATION_UPPER_RECT_MARGIN;var upperTextMargin=ANNOTATION_UPPER_TEXT_MARGIN;var durations={};focusAnnotationData.forEach(function(d){if(d.key!==undefined){var duration=(d.end_timestamp||0)-d.timestamp;durations[d.key]=duration}});focusAnnotationData.sort(function(a,b){if(a.key===undefined||b.key===undefined){return 0}return durations[b.key]-durations[a.key]});var levelHeight=ANNOTATION_LEVEL_HEIGHT;var levels=getAnnotationLevels(focusAnnotationData);var annotations=focusChart.select(".mlAnnotations").selectAll("g.mlAnnotation").data(focusAnnotationData||[],function(d){return d._id||""});annotations.enter().append("g").classed("mlAnnotation",true);var rects=annotations.selectAll(".mlAnnotationRect").data(function(d){return[d]});rects.enter().append("rect").attr("rx",ANNOTATION_RECT_BORDER_RADIUS).attr("ry",ANNOTATION_RECT_BORDER_RADIUS).classed("mlAnnotationRect",true).attr("mask","url(#"+exports.ANNOTATION_MASK_ID+")").on("mouseover",function(d){showFocusChartTooltip(d,this)}).on("mouseout",function(){return chart_tooltip_service_1.mlChartTooltipService.hide()}).on("click",function(d){showFlyout(d)});rects.attr("x",function(d){var date=moment_1.default(d.timestamp);return focusXScale(date)}).attr("y",function(d){var level=d.key!==undefined?levels[d.key]:ANNOTATION_DEFAULT_LEVEL;return focusZoomPanelHeight+1+upperRectMargin+level*levelHeight}).attr("height",function(d){var level=d.key!==undefined?levels[d.key]:ANNOTATION_DEFAULT_LEVEL;return focusChartHeight-2-upperRectMargin-level*levelHeight}).attr("width",function(d){var s=focusXScale(moment_1.default(d.timestamp))+1;var e=typeof d.end_timestamp!=="undefined"?focusXScale(moment_1.default(d.end_timestamp))-1:s+ANNOTATION_MIN_WIDTH;var width=Math.max(ANNOTATION_MIN_WIDTH,e-s);return width});rects.exit().remove();var textRects=annotations.selectAll(".mlAnnotationTextRect").data(function(d){return[d]});var texts=annotations.selectAll(".mlAnnotationText").data(function(d){return[d]});textRects.enter().append("rect").classed("mlAnnotationTextRect",true).attr("width",ANNOTATION_TEXT_RECT_WIDTH).attr("height",ANNOTATION_TEXT_RECT_HEIGHT).attr("rx",ANNOTATION_RECT_BORDER_RADIUS).attr("ry",ANNOTATION_RECT_BORDER_RADIUS);texts.enter().append("text").classed("mlAnnotationText",true);function labelXOffset(ts){var earliestMs=focusXScale.domain()[0];var latestMs=focusXScale.domain()[1];var date=moment_1.default(ts);var minX=Math.max(focusXScale(earliestMs),focusXScale(date));var maxOffset=32;return Math.min(focusXScale(latestMs)-maxOffset,minX)}texts.attr("x",function(d){var leftInnerOffset=17;return labelXOffset(d.timestamp)+leftInnerOffset}).attr("y",function(d){var level=d.key!==undefined?levels[d.key]:ANNOTATION_DEFAULT_LEVEL;return focusZoomPanelHeight+upperTextMargin+ANNOTATION_TEXT_VERTICAL_OFFSET+level*levelHeight}).text(function(d){return d.key});textRects.attr("x",function(d){var leftInnerOffset=5;return labelXOffset(d.timestamp)+leftInnerOffset}).attr("y",function(d){var level=d.key!==undefined?levels[d.key]:ANNOTATION_DEFAULT_LEVEL;return focusZoomPanelHeight+upperTextMargin+ANNOTATION_TEXT_RECT_VERTICAL_OFFSET+level*levelHeight});textRects.exit().remove();texts.exit().remove();annotations.classed("mlAnnotationHidden",!showAnnotations);annotations.exit().remove()}exports.renderAnnotations=renderAnnotations;function highlightFocusChartAnnotation(annotation){var annotations=d3_1.default.selectAll(".mlAnnotation");annotations.each(function(d){var element=d3_1.default.select(this);if(d._id===annotation._id){element.selectAll(".mlAnnotationRect").classed("mlAnnotationRect-isHighlight",true)}else{element.selectAll(".mlAnnotationTextRect").classed("mlAnnotationTextRect-isBlur",true);element.selectAll(".mlAnnotationText").classed("mlAnnotationText-isBlur",true);element.selectAll(".mlAnnotationRect").classed("mlAnnotationRect-isBlur",true)}})}exports.highlightFocusChartAnnotation=highlightFocusChartAnnotation;function unhighlightFocusChartAnnotation(){var annotations=d3_1.default.selectAll(".mlAnnotation");annotations.each(function(){var element=d3_1.default.select(this);element.selectAll(".mlAnnotationTextRect").classed("mlAnnotationTextRect-isBlur",false);element.selectAll(".mlAnnotationRect").classed("mlAnnotationRect-isHighlight",false).classed("mlAnnotationRect-isBlur",false);element.selectAll(".mlAnnotationText").classed("mlAnnotationText-isBlur",false)})}exports.unhighlightFocusChartAnnotation=unhighlightFocusChartAnnotation},2467:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ANNOTATION_TYPE;(function(ANNOTATION_TYPE){ANNOTATION_TYPE["ANNOTATION"]="annotation";ANNOTATION_TYPE["COMMENT"]="comment"})(ANNOTATION_TYPE=exports.ANNOTATION_TYPE||(exports.ANNOTATION_TYPE={}));exports.ANNOTATION_DOC_TYPE="doc";exports.ANNOTATION_USER_UNKNOWN="<user unknown>"},2469:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _momentTimezone=__webpack_require__(191);var _momentTimezone2=_interopRequireDefault(_momentTimezone);__webpack_require__(626);__webpack_require__(1009);__webpack_require__(1012);var _notify=__webpack_require__(10);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _timefilter=__webpack_require__(16);var _parse_interval=__webpack_require__(196);var _check_license=__webpack_require__(43);var _check_privilege=__webpack_require__(32);var _job_utils=__webpack_require__(34);var _index_utils=__webpack_require__(62);var _timeseriesexplorer_utils=__webpack_require__(1018);var _refresh_interval_watcher=__webpack_require__(1014);var _ml_time_buckets=__webpack_require__(258);var _results_service=__webpack_require__(338);var _timeseriesexplorer=__webpack_require__(2470);var _timeseriesexplorer2=_interopRequireDefault(_timeseriesexplorer);var _check_ml_nodes=__webpack_require__(47);var _ml_api_service=__webpack_require__(22);var _job_service=__webpack_require__(23);var _field_format_service=__webpack_require__(209);var _job_select_service=__webpack_require__(408);var _forecast_service=__webpack_require__(630);var _timeseries_search_service=__webpack_require__(1020);var _search=__webpack_require__(629);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}var mlAnnotationsEnabled=_chrome2.default.getInjected("mlAnnotationsEnabled",false);_routes2.default.when("/timeseriesexplorer/?",{template:_timeseriesexplorer2.default,resolve:{CheckLicense:_check_license.checkFullLicense,privileges:_check_privilege.checkGetJobsPrivilege,indexPatterns:_index_utils.loadIndexPatterns,mlNodeCount:_check_ml_nodes.getMlNodeCount}});var _module=_modules.uiModules.get("apps/ml");_module.controller("MlTimeSeriesExplorerController",function($scope,$timeout,Private,AppState,config,mlSelectIntervalService,mlSelectSeverityService){$scope.timeFieldName="timestamp";_timefilter.timefilter.enableTimeRangeSelector();_timefilter.timefilter.enableAutoRefreshSelector();var CHARTS_POINT_TARGET=500;var MAX_SCHEDULED_EVENTS=10;var TimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider);var mlJobSelectService=Private(_job_select_service.JobSelectServiceProvider);$scope.jobPickerSelections=[];$scope.selectedJob;$scope.detectors=[];$scope.loading=true;$scope.loadCounter=0;$scope.hasResults=false;$scope.anomalyRecords=[];$scope.modelPlotEnabled=false;$scope.showModelBounds=true;$scope.showModelBoundsCheckbox=false;$scope.showAnnotations=mlAnnotationsEnabled;$scope.showAnnotationsCheckbox=mlAnnotationsEnabled;$scope.showForecast=true;$scope.showForecastCheckbox=false;$scope.focusAnnotationData=[];var tzConfig=config.get("dateFormat:tz");var dateFormatTz=tzConfig!=="Browser"?tzConfig:_momentTimezone2.default.tz.guess();$scope.permissions={canForecastJob:(0,_check_privilege.checkPermission)("canForecastJob")};$scope.initializeVis=function(){var stateDefaults={mlTimeSeriesExplorer:{}};$scope.appState=new AppState(stateDefaults);$scope.jobs=[];_job_service.mlJobService.loadJobs().then(function(resp){if(resp.jobs.length>0){$scope.jobs=(0,_timeseriesexplorer_utils.createTimeSeriesJobData)(resp.jobs);var timeSeriesJobIds=$scope.jobs.map(function(j){return j.id});var selectedJobIds=mlJobSelectService.getSelectedJobIds(true);var invalidIds=_lodash2.default.difference(selectedJobIds,timeSeriesJobIds);selectedJobIds=_lodash2.default.without.apply(_lodash2.default,[selectedJobIds].concat(_toConsumableArray(invalidIds)));if(invalidIds.length>0){var s=invalidIds.length===1?"":"s";var warningText="You can't view requested job"+s+" "+invalidIds+" in this dashboard";if(selectedJobIds.length===0&&timeSeriesJobIds.length>0){warningText+=", auto selecting first job"}_notify.toastNotifications.addWarning(warningText)}if(selectedJobIds.length>1||mlJobSelectService.groupIds.length){if(selectedJobIds.length>1){_notify.toastNotifications.addWarning("You can only view one job at a time in this dashboard");mlJobSelectService.setJobIds([selectedJobIds[0]])}else{if(selectedJobIds.length>0){_notify.toastNotifications.addWarning("You can only view one job at a time in this dashboard");mlJobSelectService.setJobIds([selectedJobIds[0]])}else if($scope.jobs.length>0){mlJobSelectService.setJobIds([$scope.jobs[0].id])}else{$scope.loading=false}}}else if(invalidIds.length>0&&selectedJobIds.length>0){mlJobSelectService.setJobIds([selectedJobIds[0]])}else if(selectedJobIds.length>0){loadForJobId(selectedJobIds[0])}else{if(selectedJobIds.length===0&&$scope.jobs.length>0){mlJobSelectService.setJobIds([$scope.jobs[0].id])}else{$scope.loading=false}}}else{$scope.loading=false}$scope.$applyAsync()}).catch(function(resp){console.log("Time series explorer - error getting job info from elasticsearch:",resp)})};$scope.refresh=function(){if($scope.selectedJob===undefined){return}$scope.loading=true;$scope.hasResults=false;delete $scope.chartDetails;delete $scope.contextChartData;delete $scope.focusChartData;delete $scope.contextForecastData;delete $scope.focusForecastData;$scope.loadCounter++;var awaitingCount=3;function finish(counterVar){awaitingCount--;if(awaitingCount===0&&counterVar===$scope.loadCounter){if($scope.contextChartData&&$scope.contextChartData.length||$scope.contextForecastData&&$scope.contextForecastData.length){$scope.hasResults=true}else{$scope.hasResults=false}$scope.loading=false;if($scope.contextChartData.length){var focusRange=calculateInitialFocusRange();$scope.zoomFrom=focusRange[0];$scope.zoomTo=focusRange[1]}if($scope.contextChartData&&$scope.contextChartData.length||$scope.contextForecastData&&$scope.contextForecastData.length){$timeout(function(){$scope.$broadcast("render")},0)}else{$scope.$applyAsync()}}}var bounds=_timefilter.timefilter.getActiveBounds();var detectorIndex=+$scope.detectorId;$scope.modelPlotEnabled=(0,_job_utils.isModelPlotEnabled)($scope.selectedJob,detectorIndex,$scope.entities);var nonBlankEntities=_lodash2.default.filter($scope.entities,function(entity){return entity.fieldValue.length>0});$scope.criteriaFields=[{fieldName:"detector_index",fieldValue:detectorIndex}].concat(nonBlankEntities);$scope.contextAggregationInterval=calculateAggregationInterval(bounds,CHARTS_POINT_TARGET,CHARTS_POINT_TARGET);console.log("aggregationInterval for context data (s):",$scope.contextAggregationInterval.asSeconds());var searchBounds=(0,_ml_time_buckets.getBoundsRoundedToInterval)(bounds,$scope.contextAggregationInterval,false);var counter=$scope.loadCounter;_timeseries_search_service.mlTimeSeriesSearchService.getMetricData($scope.selectedJob,detectorIndex,nonBlankEntities,searchBounds.min.valueOf(),searchBounds.max.valueOf(),$scope.contextAggregationInterval.expression).then(function(resp){var fullRangeChartData=(0,_timeseriesexplorer_utils.processMetricPlotResults)(resp.results,$scope.modelPlotEnabled);$scope.contextChartData=fullRangeChartData;console.log("Time series explorer context chart data set:",$scope.contextChartData);finish(counter)}).catch(function(resp){console.log("Time series explorer - error getting metric data from elasticsearch:",resp)});_results_service.mlResultsService.getRecordMaxScoreByTime($scope.selectedJob.job_id,$scope.criteriaFields,searchBounds.min.valueOf(),searchBounds.max.valueOf(),$scope.contextAggregationInterval.expression).then(function(resp){var fullRangeRecordScoreData=(0,_timeseriesexplorer_utils.processRecordScoreResults)(resp.results);$scope.swimlaneData=fullRangeRecordScoreData;console.log("Time series explorer swimlane anomalies data set:",$scope.swimlaneData);finish(counter)}).catch(function(resp){console.log("Time series explorer - error getting bucket anomaly scores from elasticsearch:",resp)});_timeseries_search_service.mlTimeSeriesSearchService.getChartDetails($scope.selectedJob,detectorIndex,$scope.entities,searchBounds.min.valueOf(),searchBounds.max.valueOf()).then(function(resp){$scope.chartDetails=resp.results;finish(counter)}).catch(function(resp){console.log("Time series explorer - error getting entity counts from elasticsearch:",resp)});var forecastId=_lodash2.default.get($scope,"appState.mlTimeSeriesExplorer.forecastId");if(forecastId!==undefined){awaitingCount++;var aggType=undefined;var detector=$scope.selectedJob.analysis_config.detectors[detectorIndex];var esAgg=(0,_job_utils.mlFunctionToESAggregation)(detector.function);if($scope.modelPlotEnabled===false&&(esAgg==="sum"||esAgg==="count")){aggType={avg:"sum",max:"sum",min:"sum"}}_forecast_service.mlForecastService.getForecastData($scope.selectedJob,detectorIndex,forecastId,nonBlankEntities,searchBounds.min.valueOf(),searchBounds.max.valueOf(),$scope.contextAggregationInterval.expression,aggType).then(function(resp){$scope.contextForecastData=(0,_timeseriesexplorer_utils.processForecastResults)(resp.results);finish(counter)}).catch(function(resp){console.log("Time series explorer - error loading data for forecast ID "+forecastId,resp)})}loadEntityValues()};$scope.refreshFocusData=function(fromDate,toDate){var awaitingCount=4;var refreshFocusData={};function finish(){awaitingCount--;if(awaitingCount===0){refreshFocusData.focusChartData=(0,_timeseriesexplorer_utils.processDataForFocusAnomalies)(refreshFocusData.focusChartData,refreshFocusData.anomalyRecords,$scope.timeFieldName);refreshFocusData.focusChartData=(0,_timeseriesexplorer_utils.processScheduledEventsForChart)(refreshFocusData.focusChartData,refreshFocusData.scheduledEvents);$scope.$evalAsync(function(){$scope=Object.assign($scope,refreshFocusData);console.log("Time series explorer focus chart data set:",$scope.focusChartData);$scope.loading=false})}}var detectorIndex=+$scope.detectorId;var nonBlankEntities=_lodash2.default.filter($scope.entities,function(entity){return entity.fieldValue.length>0});var bounds={min:(0,_momentTimezone2.default)(fromDate),max:(0,_momentTimezone2.default)(toDate)};$scope.focusAggregationInterval=calculateAggregationInterval(bounds,CHARTS_POINT_TARGET,CHARTS_POINT_TARGET);var searchBounds=(0,_ml_time_buckets.getBoundsRoundedToInterval)(bounds,$scope.focusAggregationInterval,false);_timeseries_search_service.mlTimeSeriesSearchService.getMetricData($scope.selectedJob,detectorIndex,nonBlankEntities,searchBounds.min.valueOf(),searchBounds.max.valueOf(),$scope.focusAggregationInterval.expression).then(function(resp){refreshFocusData.focusChartData=(0,_timeseriesexplorer_utils.processMetricPlotResults)(resp.results,$scope.modelPlotEnabled);$scope.showModelBoundsCheckbox=$scope.modelPlotEnabled===true&&refreshFocusData.focusChartData.length>0;finish()}).catch(function(resp){console.log("Time series explorer - error getting metric data from elasticsearch:",resp)});_results_service.mlResultsService.getRecordsForCriteria([$scope.selectedJob.job_id],$scope.criteriaFields,0,searchBounds.min.valueOf(),searchBounds.max.valueOf(),_search.ANOMALIES_TABLE_DEFAULT_QUERY_SIZE).then(function(resp){refreshFocusData.anomalyRecords=_lodash2.default.chain(resp.records).sortBy(function(record){return record[$scope.timeFieldName]}).reverse().value();console.log("Time series explorer anomalies:",refreshFocusData.anomalyRecords);finish()});_results_service.mlResultsService.getScheduledEventsByBucket([$scope.selectedJob.job_id],searchBounds.min.valueOf(),searchBounds.max.valueOf(),$scope.focusAggregationInterval.expression,1,MAX_SCHEDULED_EVENTS).then(function(resp){refreshFocusData.scheduledEvents=resp.events[$scope.selectedJob.job_id];finish()}).catch(function(resp){console.log("Time series explorer - error getting scheduled events from elasticsearch:",resp)});if(mlAnnotationsEnabled){_ml_api_service.ml.annotations.getAnnotations({jobIds:[$scope.selectedJob.job_id],earliestMs:searchBounds.min.valueOf(),latestMs:searchBounds.max.valueOf(),maxAnnotations:_search.ANNOTATIONS_TABLE_DEFAULT_QUERY_SIZE}).then(function(resp){refreshFocusData.focusAnnotationData=resp.annotations[$scope.selectedJob.job_id].sort(function(a,b){return a.timestamp-b.timestamp}).map(function(d,i){d.key=String.fromCharCode(65+i);return d});finish()}).catch(function(){refreshFocusData.focusAnnotationData=[];finish()})}else{finish()}var forecastId=_lodash2.default.get($scope,"appState.mlTimeSeriesExplorer.forecastId");if(forecastId!==undefined){awaitingCount++;var aggType=undefined;var detector=$scope.selectedJob.analysis_config.detectors[detectorIndex];var esAgg=(0,_job_utils.mlFunctionToESAggregation)(detector.function);if($scope.modelPlotEnabled===false&&(esAgg==="sum"||esAgg==="count")){aggType={avg:"sum",max:"sum",min:"sum"}}_forecast_service.mlForecastService.getForecastData($scope.selectedJob,detectorIndex,forecastId,nonBlankEntities,searchBounds.min.valueOf(),searchBounds.max.valueOf(),$scope.focusAggregationInterval.expression,aggType).then(function(resp){refreshFocusData.focusForecastData=(0,_timeseriesexplorer_utils.processForecastResults)(resp.results);refreshFocusData.showForecastCheckbox=refreshFocusData.focusForecastData.length>0;finish()}).catch(function(resp){console.log("Time series explorer - error loading data for forecast ID "+forecastId,resp)})}loadAnomaliesTableData(searchBounds.min.valueOf(),searchBounds.max.valueOf())};$scope.saveSeriesPropertiesAndRefresh=function(){$scope.appState.mlTimeSeriesExplorer.detectorIndex=+$scope.detectorId;$scope.appState.mlTimeSeriesExplorer.entities={};_lodash2.default.each($scope.entities,function(entity){$scope.appState.mlTimeSeriesExplorer.entities[entity.fieldName]=entity.fieldValue});$scope.appState.save();$scope.refresh()};$scope.filter=function(field,value,operator){var entity=_lodash2.default.find($scope.entities,{fieldName:field});if(entity!==undefined){if(operator==="+"&&entity.fieldValue!==value){entity.fieldValue=value;$scope.saveSeriesPropertiesAndRefresh()}else if(operator==="-"&&entity.fieldValue===value){entity.fieldValue="";$scope.saveSeriesPropertiesAndRefresh()}}};$scope.loadForForecastId=function(forecastId){_forecast_service.mlForecastService.getForecastDateRange($scope.selectedJob,forecastId).then(function(resp){var bounds=_timefilter.timefilter.getActiveBounds();var earliest=(0,_momentTimezone2.default)(resp.earliest||_timefilter.timefilter.getTime().from);var latest=(0,_momentTimezone2.default)(resp.latest||_timefilter.timefilter.getTime().to);$scope.appState.mlTimeSeriesExplorer.forecastId=forecastId;var earliestDataDate=_lodash2.default.first($scope.contextChartData).date;var zoomLatestMs=resp.latest;var zoomEarliestMs=Math.max(earliestDataDate.getTime(),zoomLatestMs-$scope.autoZoomDuration);var zoomState={from:(0,_momentTimezone2.default)(zoomEarliestMs).toISOString(),to:(0,_momentTimezone2.default)(zoomLatestMs).toISOString()};$scope.appState.mlTimeSeriesExplorer.zoom=zoomState;$scope.appState.save();$scope.showForecast=true;if(earliest.isBefore(bounds.min)||latest.isAfter(bounds.max)){var earliestMs=Math.min(earliest.valueOf(),bounds.min.valueOf());var latestMs=Math.max(latest.valueOf(),bounds.max.valueOf());_timefilter.timefilter.setTime({from:(0,_momentTimezone2.default)(earliestMs).toISOString(),to:(0,_momentTimezone2.default)(latestMs).toISOString()})}else{$scope.refresh()}}).catch(function(resp){console.log("Time series explorer - error loading time range of forecast from elasticsearch:",resp)})};$scope.detectorIndexChanged=function(){updateControlsForDetector();loadEntityValues()};$scope.toggleShowModelBounds=function(){$timeout(function(){$scope.showModelBounds=!$scope.showModelBounds},0)};if(mlAnnotationsEnabled){$scope.toggleShowAnnotations=function(){$timeout(function(){$scope.showAnnotations=!$scope.showAnnotations},0)}}$scope.toggleShowForecast=function(){$timeout(function(){$scope.showForecast=!$scope.showForecast},0)};$scope.$listenAndDigestAsync(_timefilter.timefilter,"fetch",$scope.refresh);var refreshWatcher=Private(_refresh_interval_watcher.refreshIntervalWatcher);refreshWatcher.init(function(){$scope.refresh()});var tableControlsListener=function tableControlsListener(){if($scope.zoomFrom!==undefined&&$scope.zoomTo!==undefined){loadAnomaliesTableData($scope.zoomFrom.getTime(),$scope.zoomTo.getTime())}};mlSelectIntervalService.state.watch(tableControlsListener);mlSelectSeverityService.state.watch(tableControlsListener);$scope.$on("$destroy",function(){refreshWatcher.cancel();mlSelectIntervalService.state.unwatch(tableControlsListener);mlSelectSeverityService.state.unwatch(tableControlsListener)});mlJobSelectService.listenJobSelectionChange($scope,function(event,selections){if(selections.length>0){delete $scope.appState.mlTimeSeriesExplorer.detectorIndex;delete $scope.appState.mlTimeSeriesExplorer.entities;delete $scope.appState.mlTimeSeriesExplorer.forecastId;$scope.appState.save();$scope.showForecastCheckbox=false;loadForJobId(selections[0])}});$scope.$on("contextChartSelected",function(event,selection){if(($scope.contextChartData===undefined||$scope.contextChartData.length===0)&&($scope.contextForecastData===undefined||$scope.contextForecastData.length===0)){return}var defaultRange=calculateDefaultFocusRange();if((selection.from.getTime()!==defaultRange[0].getTime()||selection.to.getTime()!==defaultRange[1].getTime())&&isNaN(Date.parse(selection.from))===false&&isNaN(Date.parse(selection.to))===false){var zoomState={from:selection.from.toISOString(),to:selection.to.toISOString()};$scope.appState.mlTimeSeriesExplorer.zoom=zoomState}else{delete $scope.appState.mlTimeSeriesExplorer.zoom}$scope.appState.save();if($scope.focusChartData===undefined||$scope.zoomFrom.getTime()!==selection.from.getTime()||$scope.zoomTo.getTime()!==selection.to.getTime()){$scope.refreshFocusData(selection.from,selection.to)}$scope.zoomFrom=selection.from;$scope.zoomTo=selection.to});function loadForJobId(jobId){var jobPickerSelectedJob=_lodash2.default.find($scope.jobs,{id:jobId});if(jobPickerSelectedJob===undefined){var newJobs=[];_lodash2.default.each(_job_service.mlJobService.jobs,function(job){if((0,_job_utils.isTimeSeriesViewJob)(job)===true){var bucketSpan=(0,_parse_interval.parseInterval)(job.analysis_config.bucket_span);newJobs.push({id:job.job_id,selected:false,bucketSpanSeconds:bucketSpan.asSeconds()})}});$scope.jobs=newJobs;jobPickerSelectedJob=_lodash2.default.find(newJobs,{id:jobId})}$scope.selectedJob=_job_service.mlJobService.getJob(jobId);$scope.jobPickerSelections=[jobPickerSelectedJob];var jobDetectors=$scope.selectedJob.analysis_config.detectors;var viewableDetectors=[];_lodash2.default.each(jobDetectors,function(dtr,index){if((0,_job_utils.isTimeSeriesViewDetector)($scope.selectedJob,index)){viewableDetectors.push({index:""+index,detector_description:dtr.detector_description})}});$scope.detectors=viewableDetectors;var appStateDtrIdx=$scope.appState.mlTimeSeriesExplorer.detectorIndex;var detectorIndex=appStateDtrIdx!==undefined?appStateDtrIdx:+viewableDetectors[0].index;if(_lodash2.default.find(viewableDetectors,{index:""+detectorIndex})===undefined){var warningText="Requested detector index "+detectorIndex+" is not valid for job "+$scope.selectedJob.job_id;_notify.toastNotifications.addWarning(warningText);detectorIndex=+viewableDetectors[0].index;$scope.appState.mlTimeSeriesExplorer.detectorIndex=detectorIndex;$scope.appState.save()}$scope.detectorId=""+detectorIndex;updateControlsForDetector();_field_format_service.mlFieldFormatService.populateFormats([jobId],(0,_index_utils.getIndexPatterns)()).catch(function(err){console.log("Error populating field formats:",err)}).then(function(){$scope.refresh()})}function loadAnomaliesTableData(earliestMs,latestMs){_ml_api_service.ml.results.getAnomaliesTableData([$scope.selectedJob.job_id],$scope.criteriaFields,[],mlSelectIntervalService.state.get("interval").val,mlSelectSeverityService.state.get("threshold").val,earliestMs,latestMs,dateFormatTz,_search.ANOMALIES_TABLE_DEFAULT_QUERY_SIZE).then(function(resp){var anomalies=resp.anomalies;var detectorsByJob=_job_service.mlJobService.detectorsByJob;anomalies.forEach(function(anomaly){var jobId=anomaly.jobId;var detector=_lodash2.default.get(detectorsByJob,[jobId,anomaly.detectorIndex]);anomaly.detector=_lodash2.default.get(detector,["detector_description"],anomaly.source.function_description);var customRules=detector.custom_rules;if(customRules!==undefined){anomaly.rulesLength=customRules.length}if(_lodash2.default.has(_job_service.mlJobService.customUrlsByJob,jobId)){anomaly.customUrls=_job_service.mlJobService.customUrlsByJob[jobId]}});$scope.$evalAsync(function(){$scope.tableData={anomalies:anomalies,interval:resp.interval,examplesByJobId:resp.examplesByJobId,showViewSeriesLink:false}})}).catch(function(resp){console.log("Time series explorer - error loading data for anomalies table:",resp)})}function updateControlsForDetector(){var detectorIndex=+$scope.detectorId;var detector=$scope.selectedJob.analysis_config.detectors[detectorIndex];var entities=[];var entitiesState=$scope.appState.mlTimeSeriesExplorer.entities||{};var partitionFieldName=_lodash2.default.get(detector,"partition_field_name");var overFieldName=_lodash2.default.get(detector,"over_field_name");var byFieldName=_lodash2.default.get(detector,"by_field_name");if(partitionFieldName!==undefined){var partitionFieldValue=_lodash2.default.get(entitiesState,partitionFieldName,"");entities.push({fieldName:partitionFieldName,fieldValue:partitionFieldValue})}if(overFieldName!==undefined){var overFieldValue=_lodash2.default.get(entitiesState,overFieldName,"");entities.push({fieldName:overFieldName,fieldValue:overFieldValue})}if(byFieldName!==undefined&&overFieldName===undefined){var byFieldValue=_lodash2.default.get(entitiesState,byFieldName,"");entities.push({fieldName:byFieldName,fieldValue:byFieldValue})}$scope.entities=entities}function loadEntityValues(){var bounds=_timefilter.timefilter.getActiveBounds();var detectorIndex=+$scope.detectorId;_results_service.mlResultsService.getRecordsForCriteria([$scope.selectedJob.job_id],[{fieldName:"detector_index",fieldValue:detectorIndex}],0,bounds.min.valueOf(),bounds.max.valueOf(),_search.ANOMALIES_TABLE_DEFAULT_QUERY_SIZE).then(function(resp){if(resp.records&&resp.records.length>0){var firstRec=resp.records[0];_lodash2.default.each($scope.entities,function(entity){if(firstRec.partition_field_name===entity.fieldName){entity.fieldValues=_lodash2.default.chain(resp.records).pluck("partition_field_value").uniq().value()}if(firstRec.over_field_name===entity.fieldName){entity.fieldValues=_lodash2.default.chain(resp.records).pluck("over_field_value").uniq().value()}if(firstRec.by_field_name===entity.fieldName){entity.fieldValues=_lodash2.default.chain(resp.records).pluck("by_field_value").uniq().value()}});$scope.$applyAsync()}})}function calculateInitialFocusRange(){var zoomState=$scope.appState.mlTimeSeriesExplorer.zoom;if(zoomState!==undefined){$scope.autoZoomDuration=getAutoZoomDuration();var zoomFrom=(0,_momentTimezone2.default)(zoomState.from,"YYYY-MM-DDTHH:mm:ss.SSSZ",true);var zoomTo=(0,_momentTimezone2.default)(zoomState.to,"YYYY-MM-DDTHH:mm:ss.SSSZ",true);var aggIntervalMs=$scope.contextAggregationInterval.asMilliseconds();var bounds=_timefilter.timefilter.getActiveBounds();var earliest=bounds.min;var latest=(0,_momentTimezone2.default)(bounds.max).add(aggIntervalMs,"ms");if(zoomFrom.isValid()&&zoomTo.isValid&&zoomTo.isAfter(zoomFrom)&&zoomFrom.isBetween(earliest,latest,null,"[]")&&zoomTo.isBetween(earliest,latest,null,"[]")){return[zoomFrom.toDate(),zoomTo.toDate()]}}return calculateDefaultFocusRange()}function calculateDefaultFocusRange(){$scope.autoZoomDuration=getAutoZoomDuration();var combinedData=$scope.contextForecastData===undefined?$scope.contextChartData:$scope.contextChartData.concat($scope.contextForecastData);var earliestDataDate=_lodash2.default.first(combinedData).date;var latestDataDate=_lodash2.default.last(combinedData).date;var latestMsToLoad=latestDataDate.getTime()+$scope.contextAggregationInterval.asMilliseconds();var earliestMsToLoad=Math.max(earliestDataDate.getTime(),latestMsToLoad-$scope.autoZoomDuration);return[new Date(earliestMsToLoad),new Date(latestMsToLoad)]}function calculateAggregationInterval(bounds,bucketsTarget){var barTarget=bucketsTarget!==undefined?bucketsTarget:100;var maxBars=Math.floor(1.1*barTarget);var buckets=new TimeBuckets;buckets.setInterval("auto");buckets.setBounds(bounds);buckets.setBarTarget(Math.floor(barTarget));buckets.setMaxBars(maxBars);var bucketSpanSeconds=_lodash2.default.find($scope.jobs,{id:$scope.selectedJob.job_id}).bucketSpanSeconds;var aggInterval=buckets.getIntervalToNearestMultiple(bucketSpanSeconds);var secs=aggInterval.asSeconds();if(secs<bucketSpanSeconds){buckets.setInterval(bucketSpanSeconds+"s");aggInterval=buckets.getInterval()}console.log("calculateAggregationInterval() barTarget,maxBars,returning:",bucketsTarget,maxBars,bounds.max.diff(bounds.min)/aggInterval.asMilliseconds());return aggInterval}function getAutoZoomDuration(){var bucketSpanSeconds=_lodash2.default.find($scope.jobs,{id:$scope.selectedJob.job_id}).bucketSpanSeconds;var autoZoomDuration=bucketSpanSeconds*1e3*(CHARTS_POINT_TARGET-1);var maxBars=Math.floor(1.1*CHARTS_POINT_TARGET);var buckets=new TimeBuckets;buckets.setInterval("auto");buckets.setBarTarget(Math.floor(CHARTS_POINT_TARGET));buckets.setMaxBars(maxBars);var nowMs=(new Date).getTime();var max=(0,_momentTimezone2.default)(nowMs);var min=(0,_momentTimezone2.default)(nowMs-autoZoomDuration);buckets.setBounds({min:min,max:max});var calculatedInterval=buckets.getIntervalToNearestMultiple(bucketSpanSeconds);var calculatedIntervalSecs=calculatedInterval.asSeconds();if(calculatedIntervalSecs!==bucketSpanSeconds){autoZoomDuration=autoZoomDuration*(bucketSpanSeconds/calculatedIntervalSecs)}return autoZoomDuration}$scope.initializeVis()})},2470:function(module,exports){module.exports='<ml-nav-menu name="timeseriesexplorer"></ml-nav-menu>\n<ml-chart-tooltip></ml-chart-tooltip>\n<div class="ml-time-series-explorer" ng-controller="MlTimeSeriesExplorerController">\n  <navbar ng-show="jobs.length > 0 && chrome.getVisible()">\n    <job-select-button\n      timeseriesonly="true"\n      single-selection="true">\n    </job-select-button>\n  </navbar>\n\n  <div class="no-results-container" ng-if="jobs.length === 0 && loading === false">\n    <div class="no-results">\n      <div><i class="fa fa-exclamation-triangle"></i>No single metric jobs found</div>\n      <div><a href="ml#/jobs">Create new single metric job</a></div>\n    </div>\n  </div>\n\n  <div class="series-controls" ng-show="jobs.length > 0">\n    <label for="selectDetector" class="kuiLabel">Detector:</label>\n    <select id="selectDetector" class="kuiSelect kuiSelect--large" ng-model="detectorId" ng-change="detectorIndexChanged()">\n      <option ng-repeat="detector in detectors track by detector.index" value="{{detector.index}}">{{detector.detector_description}}</option>\n    </select>\n\n    <div class="entity-controls" ng-repeat="entity in entities">\n      <datalist id="{{entity.fieldName}}_datalist">\n        <option ng-repeat="value in entity.fieldValues">{{value}}</option>\n      </datalist>\n\n      <label for="select{{entity.fieldName}}" class="kuiLabel">{{entity.fieldName}}:</label>\n      <input id="select{{entity.fieldName}}" class="kuiTextInput entity-input"\n        ng-class="{ \'entity-input-blank\': entity.fieldValue.length === 0 }"\n        ng-model="entity.fieldValue" ng-model-options="{ updateOn: \'blur\' }" placeholder="Enter value"\n        list=\'{{entity.fieldName}}_datalist\' />\n    </div>\n\n    <button class="kuiButton kuiButton--primary" ng-click="saveSeriesPropertiesAndRefresh()" aria-label="refresh">\n      <i class="fa fa-play" ></i>\n    </button>\n\n    <ml-forecasting-modal\n      job="selectedJob"\n      detectorIndex="+detectorId"\n      entities="entities"\n      loadForForecastId="loadForForecastId"\n      class="forecast-controls"\n    />\n\n  </div>\n\n  <ml-loading-indicator\n    label="Loading"\n    is-loading="loading === true"\n  />\n\n  <div class="no-results-container" ng-show="jobs.length > 0 && loading === false && hasResults === false">\n    <div class="no-results">\n      <div><i class="fa fa-info-circle" ></i>No results found</div>\n      <div>Try widening the time selection or moving further back in time</div>\n    </div>\n  </div>\n\n  <div ng-show="jobs.length > 0 && loading === false && hasResults === true">\n    <div class="results-container">\n\n      <span class="panel-title euiText">\n        Single time series analysis of {{chartDetails.functionLabel}}\n      </span>\n      <span ng-if="chartDetails.entityData.count === 1" class="entity-count-text">\n        <span ng-repeat="entity in chartDetails.entityData.entities">\n          {{$first ? \'(\' : \'\'}}{{entity.fieldName}}: {{entity.fieldValue}}{{$last ? \')\' : \', \'}}\n        </span>\n      </span>\n      <span ng-if="chartDetails.entityData.count !== 1" class="entity-count-text">\n        <span ng-repeat="countData in chartDetails.entityData.entities">\n          {{$first ? \'(\' : \'\'}}{{countData.cardinality}} distinct {{countData.fieldName}}{{countData.cardinality > 1 ? \' values\' : \'\'}}{{$last ? \')\' : \', \'}}\n        </span>\n      </span>\n\n      <div class="show-model-controls">\n        <div ng-show="showModelBoundsCheckbox === true">\n          <input id="toggleShowModelBoundsCheckbox"\n            type="checkbox"\n            class="kuiCheckBox"\n            ng-click="toggleShowModelBounds()"\n            ng-checked="showModelBounds === true">\n          <label for="toggleShowModelBoundsCheckbox" class="kuiCheckBoxLabel">show model bounds</label>\n        </div>\n\n        <div ng-show="showAnnotationsCheckbox === true">\n          <input id="toggleAnnotationsCheckbox"\n            type="checkbox"\n            class="kuiCheckBox"\n            ng-click="toggleShowAnnotations()"\n            ng-checked="showAnnotations === true">\n          <label for="toggleAnnotationsCheckbox" class="kuiCheckBoxLabel">annotations</label>\n        </div>\n\n        <div ng-show="showForecastCheckbox === true">\n          <input id="toggleShowForecastCheckbox"\n            type="checkbox"\n            class="kuiCheckBox"\n            ng-click="toggleShowForecast()"\n            ng-checked="showForecast === true">\n          <label for="toggleShowForecastCheckbox" class="kuiCheckBoxLabel">show forecast</label>\n        </div>\n      </div>\n\n      <div class="ml-timeseries-chart">\n\n        <ml-timeseries-chart style="width: 1200px; height: 400px;"\n          selected-job="selectedJob"\n          detector-index="detectorId"\n          model-plot-enabled="modelPlotEnabled"\n          context-chart-data="contextChartData"\n          context-forecast-data="contextForecastData"\n          context-aggregation-interval="contextAggregationInterval"\n          swimlane-data="swimlaneData"\n          focus-annotation-data="focusAnnotationData"\n          focus-chart-data="focusChartData"\n          focus-forecast-data="focusForecastData"\n          focus-aggregation-interval="focusAggregationInterval"\n          show-annotations="showAnnotations"\n          show-model-bounds="showModelBounds"\n          show-forecast="showForecast"\n          zoom-from="zoomFrom"\n          zoom-to="zoomTo"\n          auto-zoom-duration="autoZoomDuration"\n          refresh="refresh">\n        </ml-timeseries-chart>\n\n      </div>\n\n      <div ng-show="showAnnotations && focusAnnotationData.length > 0">\n        <span class="panel-title euiText">\n          Annotations\n        </span>\n  \n        <ml-annotation-table\n          annotations="focusAnnotationData"\n          drill-down="false"\n          number-badge="true"\n        />\n\n        <br /><br />\n      </div>\n\n      <span class="panel-title euiText">\n        Anomalies\n      </span>\n\n      <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--directionRow euiFlexGroup--responsive ml-anomalies-controls">\n        <div class="euiFlexItem euiFlexItem--flexGrowZero" style="width:170px">\n          <div class="euiFormRow" id="select_severity_control">\n            <label class="euiFormLabel" for="select_severity">Severity threshold</label>\n            <div class="euiFormControlLayout">\n              <ml-select-severity id="select_severity" />\n            </div>\n          </div>\n        </div>\n        <div class="euiFlexItem euiFlexItem--flexGrowZero" style="width:170px">\n          <div class="euiFormRow" id="select_interval_control">\n            <label class="euiFormLabel" for="select_interval">Interval</label>\n            <div class="euiFormControlLayout">\n              <ml-select-interval id="select_interval" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <ml-anomalies-table\n        table-data="tableData"\n        filter="filter"\n      />\n\n    </div>\n  </div>\n\n</div>\n'},2471:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2472)},2472:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _angular=__webpack_require__(21);var _angular2=_interopRequireDefault(_angular);var _modules=__webpack_require__(4);var _form_label=__webpack_require__(2473);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml",["react"]);_module.directive("mlFormLabel",function(){return{scope:{labelId:"@"},restrict:"E",replace:false,transclude:true,link:function link(scope,element,attrs,ctrl,transclude){var props={labelId:scope.labelId,labelClassName:"kuiFormLabel",ref:function ref(c){return _angular2.default.element(c.labelRef.current).append(transclude())}};_reactDom2.default.render(_react2.default.createElement(_form_label.FormLabel,props),element[0])}}})},2473:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FormLabel=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _json_tooltip=__webpack_require__(640);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var FormLabel=exports.FormLabel=function(_Component){_inherits(FormLabel,_Component);function FormLabel(props){_classCallCheck(this,FormLabel);var _this=_possibleConstructorReturn(this,(FormLabel.__proto__||Object.getPrototypeOf(FormLabel)).call(this,props));_this.labelRef=_react2.default.createRef();return _this}_createClass(FormLabel,[{key:"render",value:function render(){var _props=this.props,labelId=_props.labelId,_props$labelClassName=_props.labelClassName,labelClassName=_props$labelClassName===undefined?"euiFormLabel":_props$labelClassName,children=_props.children;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement("label",{className:labelClassName,id:"ml_aria_label_"+labelId,ref:this.labelRef},children),_react2.default.createElement(_json_tooltip.JsonTooltip,{id:labelId,position:"top"}))}}]);return FormLabel}(_react.Component);FormLabel.propTypes={labelId:_propTypes2.default.string}},2474:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2475)},2475:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _modules=__webpack_require__(4);var _json_tooltip=__webpack_require__(640);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml",["react"]);_module.directive("mlInfoIcon",function(){return{scope:{id:"@mlInfoIcon",position:"@"},restrict:"AE",replace:false,link:function link(scope,element){var props={id:scope.id,position:scope.position};_reactDom2.default.render(_react2.default.createElement(_json_tooltip.JsonTooltip,props),element[0])}}})},2476:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2477)},2477:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _modules=__webpack_require__(4);var _tooltip_view=__webpack_require__(2478);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml",["react"]);_module.directive("mlTooltip",function($compile){var link=function link(scope,element){var content=element.html();element.html("");var props={position:scope.position,text:scope.text,transclude:function transclude(el){var transcludeScope=scope.$new();var compiled=$compile(content)(transcludeScope);el.append(compiled[0])}};_reactDom2.default.render(_react2.default.createElement(_tooltip_view.Tooltip,props),element[0])};return{restrict:"A",replace:true,scope:false,transclude:false,link:link}})},2478:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Tooltip=Tooltip;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function Tooltip(_ref){var _ref$position=_ref.position,position=_ref$position===undefined?"top":_ref$position,text=_ref.text,transclude=_ref.transclude;return _react2.default.createElement(_eui.EuiToolTip,{position:position,content:text},_react2.default.createElement("span",{ref:transclude}))}Tooltip.propTypes={position:_propTypes2.default.string,text:_propTypes2.default.string,transclude:_propTypes2.default.func}},2479:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2480);__webpack_require__(2482)},2480:function(module,exports,__webpack_require__){"use strict";var _confirm_modal=__webpack_require__(2481);var _confirm_modal2=_interopRequireDefault(_confirm_modal);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.service("mlConfirmModalService",function($modal){this.open=function(options){return new Promise(function(resolve,reject){$modal.open({template:_confirm_modal2.default,controller:"MlConfirmModal",backdrop:"static",keyboard:false,size:options.size===undefined?"sm":options.size,resolve:{params:function params(){return{message:options.message,title:options.title,okLabel:options.okLabel,cancelLabel:options.cancelLabel,hideCancel:options.hideCancel,ok:resolve,cancel:reject}}}})})}})},2481:function(module,exports){module.exports='<div class="confirm-modal">\n  <div class="modal-title" ng-show="(title !== undefined && title !== \'\' )">{{title}}</div>\n  <div class="modal-body" bind-html-unsafe="message"></div>\n  <div class="modal-footer">\n    <button\n      ng-click="ok()"\n      ng-disabled="(saveLock === true)"\n      class="kuiButton kuiButton--primary"\n      aria-label="OK">\n      {{okLabel}}\n    </button>\n    <button\n      ng-hide="hideCancel"\n      ng-click="cancel()"\n      ng-disabled="(saveLock === true)"\n      class="kuiButton kuiButton--primary"\n      aria-label="Cancel">\n      {{cancelLabel}}\n    </button>\n  </div>\n</div>\n'},2482:function(module,exports,__webpack_require__){"use strict";var _modules=__webpack_require__(4);var _module=_modules.uiModules.get("apps/ml");_module.controller("MlConfirmModal",function($scope,$modalInstance,params){$scope.okFunc=params.ok;$scope.cancelFunc=params.cancel;$scope.message=params.message||"";$scope.title=params.title||"";$scope.okLabel=params.okLabel||"OK";$scope.cancelLabel=params.cancelLabel||"Cancel";$scope.hideCancel=params.hideCancel||false;$scope.ok=function(){$scope.okFunc();$modalInstance.close()};$scope.cancel=function(){$scope.cancelFunc();$modalInstance.close()}})},2483:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2484)},2484:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _jquery=__webpack_require__(17);var _jquery2=_interopRequireDefault(_jquery);var _nav_menu=__webpack_require__(2485);var _nav_menu2=_interopRequireDefault(_nav_menu);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _check_license=__webpack_require__(43);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlNavMenu",function(config){return{restrict:"E",transclude:true,template:_nav_menu2.default,link:function link(scope,el,attrs){scope.name=attrs.name;scope.showTabs=false;if(scope.name==="jobs"||scope.name==="settings"||scope.name==="datavisualizer"||scope.name==="filedatavisualizer"||scope.name==="timeseriesexplorer"||scope.name==="explorer"){scope.showTabs=true}scope.isActiveTab=function(path){return scope.name===path};scope.disableLinks=(0,_check_license.isFullLicense)()===false;var crumbNames={jobs:{label:"Job Management",url:"#/jobs"},new_job:{label:"Create New Job",url:"#/jobs/new_job"},single_metric:{label:"Single Metric Job",url:""},multi_metric:{label:"Multi Metric job",url:""},population:{label:"Population job",url:""},advanced:{label:"Advanced Job Configuration",url:""},datavisualizer:{label:"Data Visualizer",url:""},filedatavisualizer:{label:"File Data Visualizer (Experimental)",url:""},explorer:{label:"Anomaly Explorer",url:"#/explorer"},timeseriesexplorer:{label:"Single Metric Viewer",url:"#/timeseriesexplorer"},settings:{label:"Settings",url:"#/settings"},calendars_list:{label:"Calendar Management",url:"#/settings/calendars_list"},new_calendar:{label:"New Calendar",url:"#/settings/calendars_list/new_calendar"},edit_calendar:{label:"Edit Calendar",url:"#/settings/calendars_list/edit_calendar"},filter_lists:{label:"Filter Lists",url:"#/settings/filter_lists"},new_filter_list:{label:"New Filter List",url:"#/settings/filter_lists/new"},edit_filter_list:{label:"Edit Filter List",url:"#/settings/filter_lists/edit"}};var breadcrumbs=[{label:"Machine Learning",url:"#/"}];var crumbs=_routes2.default.getBreadcrumbs();_lodash2.default.each(crumbs,function(crumb){breadcrumbs.push(crumbNames[crumb.id])});scope.breadcrumbs=breadcrumbs.filter(Boolean);config.watch("k7design",function(val){return scope.showPluginBreadcrumbs=!val});_chrome2.default.breadcrumbs.set(scope.breadcrumbs.map(function(b){return{text:b.label,href:b.url}}));el.ready(function(){var $crumbs=(0,_jquery2.default)(".kuiLocalBreadcrumbs a");if($crumbs.length){$crumbs[0].focus()}})}}})},2485:function(module,exports){module.exports='<kbn-top-nav name="dashboard" config="topNavMenu">\n<div data-transclude-slots>\n    \x3c!-- Breadcrumbs. --\x3e\n    <div data-transclude-slot="topLeftCorner">\n      <div\n        ng-if="showPluginBreadcrumbs"\n        class="kuiLocalBreadcrumbs">\n        <div ng-repeat="crumb in breadcrumbs" class="kuiLocalBreadcrumb">\n          <a ng-if="crumb.url" kbn-href="{{ crumb.url }}" class="kuiLocalBreadcrumb__link">{{ crumb.label }}</a>\n          <span ng-if="!crumb.url" class="kuiLocalBreadcrumb__link">{{ crumb.label }}</span>\n        </div>\n      </div>\n    </div>\n    \x3c!-- Tabs --\x3e\n    <div data-transclude-slot="bottomRow">\n      <div ng-if="showTabs" class="kuiLocalTabs" role="tablist">\n        <a kbn-href="#/jobs" class="kuiLocalTab" role="tab"\n        ng-class="{\'kuiLocalTab-isSelected\': isActiveTab(\'jobs\'), \'disabled-nav-link\': disableLinks}">\n         Job Management\n        </a>\n        <a kbn-href="#/explorer" class="kuiLocalTab" role="tab"\n        ng-class="{\'kuiLocalTab-isSelected\': isActiveTab(\'explorer\'), \'disabled-nav-link\': disableLinks}">\n          Anomaly Explorer\n        </a>\n        <a kbn-href="#/timeseriesexplorer" class="kuiLocalTab" role="tab"\n        ng-class="{\'kuiLocalTab-isSelected\': isActiveTab(\'timeseriesexplorer\'), \'disabled-nav-link\': disableLinks}">\n          Single Metric Viewer\n        </a>\n        <a kbn-href="#/datavisualizer" class="kuiLocalTab" role="tab"\n        ng-class="{\'kuiLocalTab-isSelected\': isActiveTab(\'datavisualizer\')}">\n          Data Visualizer\n        </a>\n        <a kbn-href="#/settings" class="kuiLocalTab" role="tab"\n        ng-class="{\'kuiLocalTab-isSelected\': isActiveTab(\'settings\'), \'disabled-nav-link\': disableLinks}">\n          Settings\n        </a>\n      </div>\n    </div>\n  </div>\n</kbn-top-nav>\n'},2486:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2487)},2487:function(module,exports,__webpack_require__){"use strict";var _loading_indicator=__webpack_require__(2488);var _loading_indicator2=_interopRequireDefault(_loading_indicator);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlLoadingIndicator",function(){return{restrict:"E",template:_loading_indicator2.default,transclude:true,scope:{label:"@?",isLoading:"<",height:"<?"},link:function link(scope){scope.height=scope.height?+scope.height:100}}})},2488:function(module,exports){module.exports='<div ng-if="isLoading" class="loading-indicator" style="height: {{height}}px">\n  <div class="loading-spinner"><i class=\'fa fa-spinner fa-spin\'></i></div>\n  <div ng-if="label!==undefined" ml-loading-indicator-label>{{label}}</div>\n</div>\n'},2489:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2490);__webpack_require__(2492);__webpack_require__(2513)},2490:function(module,exports,__webpack_require__){"use strict";__webpack_require__(53);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _modules=__webpack_require__(4);var _check_license=__webpack_require__(43);var _check_privilege=__webpack_require__(32);var _check_ml_nodes=__webpack_require__(47);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _timefilter=__webpack_require__(16);var _settings=__webpack_require__(2491);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml",["react"]);var template='\n  <ml-nav-menu name="settings" />\n  <div class="mlSettingsPage">\n    <ml-settings />\n  </div>\n';_routes2.default.when("/settings",{template:template,resolve:{CheckLicense:_check_license.checkFullLicense,privileges:_check_privilege.checkGetJobsPrivilege,mlNodeCount:_check_ml_nodes.getMlNodeCount}});_module.directive("mlSettings",function(){_timefilter.timefilter.disableTimeRangeSelector();_timefilter.timefilter.disableAutoRefreshSelector();var canGetFilters=(0,_check_privilege.checkPermission)("canGetFilters");var canGetCalendars=(0,_check_privilege.checkPermission)("canGetCalendars");return{restrict:"E",replace:false,scope:{},link:function link(scope,element){_reactDom2.default.render(_react2.default.createElement(_settings.Settings,{canGetFilters:canGetFilters,canGetCalendars:canGetCalendars}),element[0])}}})},2491:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Settings=Settings;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(6);var _eui=__webpack_require__(2);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function Settings(_ref){var canGetFilters=_ref.canGetFilters,canGetCalendars=_ref.canGetCalendars;return _react2.default.createElement(_eui.EuiPage,{className:"mlSettingsPage"},_react2.default.createElement(_eui.EuiPageBody,{className:"mlSettingsPage__body"},_react2.default.createElement(_eui.EuiPageContent,{className:"mlSettingsPage__content",horizontalPosition:"center"},_react2.default.createElement(_eui.EuiPageContentHeader,null,_react2.default.createElement(_eui.EuiTitle,null,_react2.default.createElement("h2",null,"Job Management"))),_react2.default.createElement(_eui.EuiFlexGroup,{gutterSize:"xl"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonEmpty,{"data-testid":"ml_calendar_mng_button",size:"l",color:"primary",href:_chrome2.default.getBasePath()+"/app/ml#/settings/calendars_list",isDisabled:canGetCalendars===false},"Calendar management")),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonEmpty,{"data-testid":"ml_filter_lists_button",size:"l",color:"primary",href:_chrome2.default.getBasePath()+"/app/ml#/settings/filter_lists",isDisabled:canGetFilters===false},"Filter Lists"))))))}Settings.propTypes={canGetFilters:_propTypes.PropTypes.bool.isRequired,canGetCalendars:_propTypes.PropTypes.bool.isRequired}},2492:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2493);__webpack_require__(2499)},2493:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2494)},2494:function(module,exports,__webpack_require__){"use strict";__webpack_require__(53);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _modules=__webpack_require__(4);var _check_license=__webpack_require__(43);var _check_privilege=__webpack_require__(32);var _check_ml_nodes=__webpack_require__(47);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _calendars_list=__webpack_require__(2495);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml",["react"]);var template='\n  <ml-nav-menu name="settings" />\n  <div class="mlCalendarManagement">\n    <ml-calendars-list />\n  </div>\n';_routes2.default.when("/settings/calendars_list",{template:template,resolve:{CheckLicense:_check_license.checkFullLicense,privileges:_check_privilege.checkGetJobsPrivilege,mlNodeCount:_check_ml_nodes.getMlNodeCount}});_module.directive("mlCalendarsList",function(){return{restrict:"E",replace:false,scope:{},link:function link(scope,element){var props={canCreateCalendar:(0,_check_privilege.checkPermission)("canCreateCalendar"),canDeleteCalendar:(0,_check_privilege.checkPermission)("canDeleteCalendar")};_reactDom2.default.render(_react2.default.createElement(_calendars_list.CalendarsList,props),element[0])}}})},2495:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CalendarsList=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(6);var _eui=__webpack_require__(2);var _table=__webpack_require__(2496);var _ml_api_service=__webpack_require__(22);var _notify=__webpack_require__(10);var _check_ml_nodes=__webpack_require__(47);var _delete_calendars=__webpack_require__(2498);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CalendarsList=exports.CalendarsList=function(_Component){_inherits(CalendarsList,_Component);function CalendarsList(props){var _this2=this;_classCallCheck(this,CalendarsList);var _this=_possibleConstructorReturn(this,(CalendarsList.__proto__||Object.getPrototypeOf(CalendarsList)).call(this,props));_this.loadCalendars=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var calendars;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return _ml_api_service.ml.calendars();case 3:calendars=_context.sent;_this.setState({calendars:calendars,loading:false,isDestroyModalVisible:false});_context.next=12;break;case 7:_context.prev=7;_context.t0=_context["catch"](0);console.log(_context.t0);_this.setState({loading:false});_notify.toastNotifications.addDanger("An error occurred loading the list of calendars.");case 12:case"end":return _context.stop()}}},_callee,_this2,[[0,7]])}));_this.closeDestroyModal=function(){_this.setState({isDestroyModalVisible:false,calendarId:null})};_this.showDestroyModal=function(){_this.setState({isDestroyModalVisible:true})};_this.setSelectedCalendarList=function(selectedCalendars){_this.setState({selectedForDeletion:selectedCalendars})};_this.deleteCalendars=function(){var selectedForDeletion=_this.state.selectedForDeletion;_this.closeDestroyModal();(0,_delete_calendars.deleteCalendars)(selectedForDeletion,_this.loadCalendars)};_this.addRequiredFieldsToList=function(){var calendarsList=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];for(var i=0;i<calendarsList.length;i++){calendarsList[i].job_ids_string=calendarsList[i].job_ids.join(", ");calendarsList[i].events_length=calendarsList[i].events.length}return calendarsList};_this.state={loading:true,calendars:[],isDestroyModalVisible:false,calendarId:null,selectedForDeletion:[],nodesAvailable:(0,_check_ml_nodes.mlNodesAvailable)()};return _this}_createClass(CalendarsList,[{key:"componentDidMount",value:function componentDidMount(){this.loadCalendars()}},{key:"render",value:function render(){var _state=this.state,calendars=_state.calendars,selectedForDeletion=_state.selectedForDeletion,loading=_state.loading,nodesAvailable=_state.nodesAvailable;var _props=this.props,canCreateCalendar=_props.canCreateCalendar,canDeleteCalendar=_props.canDeleteCalendar;var destroyModal="";if(this.state.isDestroyModalVisible){destroyModal=_react2.default.createElement(_eui.EuiOverlayMask,null,_react2.default.createElement(_eui.EuiConfirmModal,{title:"Delete calendar",onCancel:this.closeDestroyModal,onConfirm:this.deleteCalendars,cancelButtonText:"Cancel",confirmButtonText:"Delete",buttonColor:"danger",defaultFocusedButton:_eui.EUI_MODAL_CONFIRM_BUTTON},_react2.default.createElement("p",null,"Delete "+(selectedForDeletion.length===1?"this":"these")+"\n                calendar"+(selectedForDeletion.length===1?"":"s")+"?\n                "+selectedForDeletion.map(function(c){return c.calendar_id}).join(", "))))}return _react2.default.createElement(_eui.EuiPage,{className:"mlCalendarList"},_react2.default.createElement(_eui.EuiPageContent,{className:"mlCalendarList__content",verticalPosition:"center",horizontalPosition:"center"},_react2.default.createElement(_table.CalendarsListTable,{loading:loading,calendarsList:this.addRequiredFieldsToList(calendars),onDeleteClick:this.showDestroyModal,canCreateCalendar:canCreateCalendar,canDeleteCalendar:canDeleteCalendar,mlNodesAvailable:nodesAvailable,setSelectedCalendarList:this.setSelectedCalendarList,itemsSelected:selectedForDeletion.length>0})),destroyModal)}}]);return CalendarsList}(_react.Component);_table.CalendarsListTable.propTypes={canCreateCalendar:_propTypes.PropTypes.bool.isRequired,canDeleteCalendar:_propTypes.PropTypes.bool.isRequired}},2496:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _table=__webpack_require__(2497);Object.defineProperty(exports,"CalendarsListTable",{enumerable:true,get:function get(){return _table.CalendarsListTable}})},2497:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CalendarsListTable=CalendarsListTable;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function CalendarsListTable(_ref){var calendarsList=_ref.calendarsList,onDeleteClick=_ref.onDeleteClick,setSelectedCalendarList=_ref.setSelectedCalendarList,loading=_ref.loading,canCreateCalendar=_ref.canCreateCalendar,canDeleteCalendar=_ref.canDeleteCalendar,mlNodesAvailable=_ref.mlNodesAvailable,itemsSelected=_ref.itemsSelected;var sorting={sort:{field:"calendar_id",direction:"asc"}};var pagination={initialPageSize:20,pageSizeOptions:[10,20]};var columns=[{field:"calendar_id",name:"ID",sortable:true,truncateText:true,render:function render(id){return _react2.default.createElement(_eui.EuiLink,{href:_chrome2.default.getBasePath()+"/app/ml#/settings/calendars_list/edit_calendar/"+id},id)}},{field:"job_ids_string",name:"Jobs",sortable:true,truncateText:true},{field:"events_length",name:"Events",sortable:true,render:function render(eventsLength){return eventsLength+" "+(eventsLength===1?"event":"events")}}];var tableSelection={onSelectionChange:function onSelectionChange(selection){return setSelectedCalendarList(selection)}};var search={toolsRight:[_react2.default.createElement(_eui.EuiButton,{size:"s","data-testid":"new_calendar_button",key:"new_calendar_button",href:_chrome2.default.getBasePath()+"/app/ml#/settings/calendars_list/new_calendar",isDisabled:canCreateCalendar===false||mlNodesAvailable===false},"New"),_react2.default.createElement(_eui.EuiButton,{size:"s",color:"danger",iconType:"trash",onClick:onDeleteClick,isDisabled:canDeleteCalendar===false||mlNodesAvailable===false||itemsSelected===false},"Delete")],box:{incremental:true},filters:[]};return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiInMemoryTable,{items:calendarsList,itemId:"calendar_id",columns:columns,search:search,pagination:pagination,sorting:sorting,loading:loading,selection:tableSelection,isSelectable:true}))}CalendarsListTable.propTypes={calendarsList:_propTypes2.default.array.isRequired,onDeleteClick:_propTypes2.default.func.isRequired,loading:_propTypes2.default.bool.isRequired,canCreateCalendar:_propTypes2.default.bool.isRequired,canDeleteCalendar:_propTypes2.default.bool.isRequired,mlNodesAvailable:_propTypes2.default.bool.isRequired,setSelectedCalendarList:_propTypes2.default.func.isRequired,itemsSelected:_propTypes2.default.bool.isRequired}},2498:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.deleteCalendars=undefined;var deleteCalendars=exports.deleteCalendars=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(calendarsToDelete,callback){var messageId,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,calendar,calendarId,errorMessage;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(calendarsToDelete===undefined||calendarsToDelete.length===0)){_context.next=2;break}return _context.abrupt("return");case 2:messageId=""+(calendarsToDelete.length>1?calendarsToDelete.length+" calendars":calendarsToDelete[0].calendar_id);_notify.toastNotifications.add("Deleting "+messageId);_iteratorNormalCompletion=true;_didIteratorError=false;_iteratorError=undefined;_context.prev=7;_iterator=calendarsToDelete[Symbol.iterator]();case 9:if(_iteratorNormalCompletion=(_step=_iterator.next()).done){_context.next=26;break}calendar=_step.value;calendarId=calendar.calendar_id;_context.prev=12;_context.next=15;return _ml_api_service.ml.deleteCalendar({calendarId:calendarId});case 15:_context.next=23;break;case 17:_context.prev=17;_context.t0=_context["catch"](12);console.log("Error deleting calendar:",_context.t0);errorMessage="An error occurred deleting calendar "+calendar.calendar_id;if(_context.t0.message){errorMessage+=" : "+_context.t0.message}_notify.toastNotifications.addDanger(errorMessage);case 23:_iteratorNormalCompletion=true;_context.next=9;break;case 26:_context.next=32;break;case 28:_context.prev=28;_context.t1=_context["catch"](7);_didIteratorError=true;_iteratorError=_context.t1;case 32:_context.prev=32;_context.prev=33;if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}case 35:_context.prev=35;if(!_didIteratorError){_context.next=38;break}throw _iteratorError;case 38:return _context.finish(35);case 39:return _context.finish(32);case 40:_notify.toastNotifications.addSuccess(messageId+" deleted");callback();case 42:case"end":return _context.stop()}}},_callee,this,[[7,28,32,40],[12,17],[33,,35,39]])}));return function deleteCalendars(_x,_x2){return _ref.apply(this,arguments)}}();var _notify=__webpack_require__(10);var _ml_api_service=__webpack_require__(22);function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}},2499:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2500)},2500:function(module,exports,__webpack_require__){"use strict";__webpack_require__(53);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _modules=__webpack_require__(4);var _check_license=__webpack_require__(43);var _check_privilege=__webpack_require__(32);var _check_ml_nodes=__webpack_require__(47);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _new_calendar=__webpack_require__(2501);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml",["react"]);var template='\n  <ml-nav-menu name="settings" />\n  <div class="mlCalendarManagement">\n    <ml-new-calendar />\n  </div>\n';_routes2.default.when("/settings/calendars_list/new_calendar",{template:template,resolve:{CheckLicense:_check_license.checkFullLicense,privileges:_check_privilege.checkGetJobsPrivilege,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable}}).when("/settings/calendars_list/edit_calendar/:calendarId",{template:template,resolve:{CheckLicense:_check_license.checkFullLicense,privileges:_check_privilege.checkGetJobsPrivilege,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable}});_module.directive("mlNewCalendar",function($route){return{restrict:"E",replace:false,scope:{},link:function link(scope,element){var props={calendarId:$route.current.params.calendarId,canCreateCalendar:(0,_check_privilege.checkPermission)("canCreateCalendar"),canDeleteCalendar:(0,_check_privilege.checkPermission)("canDeleteCalendar")};_reactDom2.default.render(_react2.default.createElement(_new_calendar.NewCalendar,props),element[0])}}})},2501:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.NewCalendar=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(6);var _eui=__webpack_require__(2);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _utils=__webpack_require__(644);var _calendar_form=__webpack_require__(2502);var _new_event_modal=__webpack_require__(2505);var _import_modal=__webpack_require__(2507);var _ml_api_service=__webpack_require__(22);var _notify=__webpack_require__(10);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var NewCalendar=exports.NewCalendar=function(_Component){_inherits(NewCalendar,_Component);function NewCalendar(props){var _this2=this;_classCallCheck(this,NewCalendar);var _this=_possibleConstructorReturn(this,(NewCalendar.__proto__||Object.getPrototypeOf(NewCalendar)).call(this,props));_this.isDuplicateId=function(){var _this$state=_this.state,calendars=_this$state.calendars,formCalendarId=_this$state.formCalendarId;for(var i=0;i<calendars.length;i++){if(calendars[i].calendar_id===formCalendarId){return true}}return false};_this.onCreate=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var formCalendarId,calendar;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:formCalendarId=_this.state.formCalendarId;if(!_this.isDuplicateId()){_context.next=5;break}_notify.toastNotifications.addDanger("Cannot create calendar with id ["+formCalendarId+"] as it already exists.");_context.next=18;break;case 5:calendar=_this.setUpCalendarForApi();_this.setState({saving:true});_context.prev=7;_context.next=10;return _ml_api_service.ml.addCalendar(calendar);case 10:window.location=_chrome2.default.getBasePath()+"/app/ml#/settings/calendars_list";_context.next=18;break;case 13:_context.prev=13;_context.t0=_context["catch"](7);console.log("Error saving calendar",_context.t0);_this.setState({saving:false});_notify.toastNotifications.addDanger("An error occurred creating calendar "+calendar.calendarId);case 18:case"end":return _context.stop()}}},_callee,_this2,[[7,13]])}));_this.onEdit=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var calendar;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:calendar=_this.setUpCalendarForApi();_this.setState({saving:true});_context2.prev=2;_context2.next=5;return _ml_api_service.ml.updateCalendar(calendar);case 5:window.location=_chrome2.default.getBasePath()+"/app/ml#/settings/calendars_list";_context2.next=13;break;case 8:_context2.prev=8;_context2.t0=_context2["catch"](2);console.log("Error saving calendar",_context2.t0);_this.setState({saving:false});_notify.toastNotifications.addDanger("An error occurred saving calendar "+calendar.calendarId+". Try refreshing the page.");case 13:case"end":return _context2.stop()}}},_callee2,_this2,[[2,8]])}));_this.setUpCalendarForApi=function(){var _this$state2=_this.state,formCalendarId=_this$state2.formCalendarId,description=_this$state2.description,events=_this$state2.events,selectedGroupOptions=_this$state2.selectedGroupOptions,selectedJobOptions=_this$state2.selectedJobOptions;var jobIds=selectedJobOptions.map(function(option){return option.label});var groupIds=selectedGroupOptions.map(function(option){return option.label});var eventsToSave=events.map(function(event){return{description:event.description,start_time:event.start_time,end_time:event.end_time}});var calendar={calendarId:formCalendarId,description:description,events:eventsToSave,job_ids:[].concat(_toConsumableArray(jobIds),_toConsumableArray(groupIds))};return calendar};_this.onCreateGroupOption=function(newGroup){var newOption={label:newGroup};_this.setState(function(prevState){return{selectedGroupOptions:prevState.selectedGroupOptions.concat(newOption)}})};_this.onJobSelection=function(selectedJobOptions){_this.setState({selectedJobOptions:selectedJobOptions})};_this.onGroupSelection=function(selectedGroupOptions){_this.setState({selectedGroupOptions:selectedGroupOptions})};_this.onCalendarIdChange=function(e){var isValid=(0,_utils.validateCalendarId)(e.target.value);_this.setState({formCalendarId:e.target.value,isNewCalendarIdValid:isValid})};_this.onDescriptionChange=function(e){_this.setState({description:e.target.value})};_this.showImportModal=function(){_this.setState(function(prevState){return{isImportModalVisible:!prevState.isImportModalVisible}})};_this.closeImportModal=function(){_this.setState({isImportModalVisible:false})};_this.onEventDelete=function(eventId){_this.setState(function(prevState){return{events:prevState.events.filter(function(event){return event.event_id!==eventId})}})};_this.closeNewEventModal=function(){_this.setState({isNewEventModalVisible:false})};_this.showNewEventModal=function(){_this.setState({isNewEventModalVisible:true})};_this.addEvent=function(event){_this.setState(function(prevState){return{events:[].concat(_toConsumableArray(prevState.events),[event]),isNewEventModalVisible:false}})};_this.addImportedEvents=function(events){_this.setState(function(prevState){return{events:[].concat(_toConsumableArray(prevState.events),_toConsumableArray(events)),isImportModalVisible:false}})};_this.state={isNewEventModalVisible:false,isImportModalVisible:false,isNewCalendarIdValid:null,loading:true,jobIds:[],jobIdOptions:[],groupIds:[],groupIdOptions:[],calendars:[],formCalendarId:"",description:"",selectedJobOptions:[],selectedGroupOptions:[],events:[],saving:false,selectedCalendar:undefined};return _this}_createClass(NewCalendar,[{key:"componentDidMount",value:function componentDidMount(){this.formSetup()}},{key:"formSetup",value:function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){var _this3=this;var _ref4,jobIds,groupIds,calendars,jobIdOptions,groupIdOptions,selectedJobOptions,selectedGroupOptions,eventsList,selectedCalendar,formCalendarId;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return(0,_utils.getCalendarSettingsData)();case 3:_ref4=_context3.sent;jobIds=_ref4.jobIds;groupIds=_ref4.groupIds;calendars=_ref4.calendars;jobIdOptions=jobIds.map(function(jobId){return{label:jobId}});groupIdOptions=groupIds.map(function(groupId){return{label:groupId}});selectedJobOptions=[];selectedGroupOptions=[];eventsList=[];selectedCalendar=void 0;formCalendarId="";if(this.props.calendarId!==undefined){selectedCalendar=calendars.find(function(cal){return cal.calendar_id===_this3.props.calendarId});if(selectedCalendar){formCalendarId=selectedCalendar.calendar_id;eventsList=selectedCalendar.events;selectedCalendar.job_ids.forEach(function(id){if(jobIds.find(function(jobId){return jobId===id})){selectedJobOptions.push({label:id})}else if(groupIds.find(function(groupId){return groupId===id})){selectedGroupOptions.push({label:id})}})}}this.setState({events:eventsList,formCalendarId:formCalendarId,jobIds:jobIds,jobIdOptions:jobIdOptions,groupIds:groupIds,groupIdOptions:groupIdOptions,calendars:calendars,loading:false,selectedJobOptions:selectedJobOptions,selectedGroupOptions:selectedGroupOptions,selectedCalendar:selectedCalendar});_context3.next=23;break;case 18:_context3.prev=18;_context3.t0=_context3["catch"](0);console.log(_context3.t0);this.setState({loading:false});_notify.toastNotifications.addDanger("An error occurred loading calendar form data. Try refreshing the page.");case 23:case"end":return _context3.stop()}}},_callee3,this,[[0,18]])}));function formSetup(){return _ref3.apply(this,arguments)}return formSetup}()},{key:"render",value:function render(){var _state=this.state,events=_state.events,isNewEventModalVisible=_state.isNewEventModalVisible,isImportModalVisible=_state.isImportModalVisible,isNewCalendarIdValid=_state.isNewCalendarIdValid,formCalendarId=_state.formCalendarId,description=_state.description,groupIdOptions=_state.groupIdOptions,jobIdOptions=_state.jobIdOptions,saving=_state.saving,selectedCalendar=_state.selectedCalendar,selectedJobOptions=_state.selectedJobOptions,selectedGroupOptions=_state.selectedGroupOptions;var modal="";if(isNewEventModalVisible){modal=_react2.default.createElement(_eui.EuiOverlayMask,null,_react2.default.createElement(_new_event_modal.NewEventModal,{addEvent:this.addEvent,closeModal:this.closeNewEventModal}))}else if(isImportModalVisible){modal=_react2.default.createElement(_eui.EuiOverlayMask,null,_react2.default.createElement(_import_modal.ImportModal,{addImportedEvents:this.addImportedEvents,closeImportModal:this.closeImportModal}))}return _react2.default.createElement(_eui.EuiPage,{className:"mlCalendarEditForm"},_react2.default.createElement(_eui.EuiPageContent,{className:"mlCalendarEditForm__content",verticalPosition:"center",horizontalPosition:"center"},_react2.default.createElement(_calendar_form.CalendarForm,{calendarId:selectedCalendar?selectedCalendar.calendar_id:formCalendarId,canCreateCalendar:this.props.canCreateCalendar,canDeleteCalendar:this.props.canDeleteCalendar,description:selectedCalendar?selectedCalendar.description:description,eventsList:events,groupIds:groupIdOptions,isEdit:selectedCalendar!==undefined,isNewCalendarIdValid:selectedCalendar||isNewCalendarIdValid===null?true:isNewCalendarIdValid,jobIds:jobIdOptions,onCalendarIdChange:this.onCalendarIdChange,onCreate:this.onCreate,onDescriptionChange:this.onDescriptionChange,onEdit:this.onEdit,onEventDelete:this.onEventDelete,onGroupSelection:this.onGroupSelection,showImportModal:this.showImportModal,onJobSelection:this.onJobSelection,saving:saving,selectedGroupOptions:selectedGroupOptions,selectedJobOptions:selectedJobOptions,onCreateGroupOption:this.onCreateGroupOption,showNewEventModal:this.showNewEventModal})),modal)}}]);return NewCalendar}(_react.Component);NewCalendar.propTypes={calendarId:_propTypes.PropTypes.string,canCreateCalendar:_propTypes.PropTypes.bool.isRequired,canDeleteCalendar:_propTypes.PropTypes.bool.isRequired}},2502:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _calendar_form=__webpack_require__(2503);Object.defineProperty(exports,"CalendarForm",{enumerable:true,get:function get(){return _calendar_form.CalendarForm}})},2503:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CalendarForm=CalendarForm;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(6);var _eui=__webpack_require__(2);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _events_table=__webpack_require__(645);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function EditHeader(_ref){var calendarId=_ref.calendarId,description=_ref.description;return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_eui.EuiTitle,null,_react2.default.createElement("h1",null,"Calendar ",calendarId)),_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("p",null,description)),_react2.default.createElement(_eui.EuiSpacer,{size:"l"}))}function CalendarForm(_ref2){var calendarId=_ref2.calendarId,canCreateCalendar=_ref2.canCreateCalendar,canDeleteCalendar=_ref2.canDeleteCalendar,description=_ref2.description,eventsList=_ref2.eventsList,groupIds=_ref2.groupIds,isEdit=_ref2.isEdit,isNewCalendarIdValid=_ref2.isNewCalendarIdValid,jobIds=_ref2.jobIds,onCalendarIdChange=_ref2.onCalendarIdChange,onCreate=_ref2.onCreate,onCreateGroupOption=_ref2.onCreateGroupOption,onDescriptionChange=_ref2.onDescriptionChange,onEdit=_ref2.onEdit,onEventDelete=_ref2.onEventDelete,onGroupSelection=_ref2.onGroupSelection,showImportModal=_ref2.showImportModal,onJobSelection=_ref2.onJobSelection,saving=_ref2.saving,selectedGroupOptions=_ref2.selectedGroupOptions,selectedJobOptions=_ref2.selectedJobOptions,showNewEventModal=_ref2.showNewEventModal;var msg="Use lowercase alphanumerics (a-z and 0-9), hyphens or underscores;\n    must start and end with an alphanumeric character";var helpText=isNewCalendarIdValid===true&&!isEdit?msg:undefined;var error=isNewCalendarIdValid===false&&!isEdit?[msg]:undefined;var saveButtonDisabled=canCreateCalendar===false||saving||!isNewCalendarIdValid||calendarId==="";return _react2.default.createElement(_eui.EuiForm,null,!isEdit&&_react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_eui.EuiFormRow,{label:"Calendar ID",helpText:helpText,error:error,isInvalid:!isNewCalendarIdValid},_react2.default.createElement(_eui.EuiFieldText,{name:"calendarId",value:calendarId,onChange:onCalendarIdChange,disabled:isEdit===true||saving===true})),_react2.default.createElement(_eui.EuiFormRow,{label:"Description"},_react2.default.createElement(_eui.EuiFieldText,{name:"description",value:description,onChange:onDescriptionChange,disabled:isEdit===true||saving===true}))),isEdit&&_react2.default.createElement(EditHeader,{calendarId:calendarId,description:description}),_react2.default.createElement(_eui.EuiFormRow,{label:"Jobs"},_react2.default.createElement(_eui.EuiComboBox,{options:jobIds,selectedOptions:selectedJobOptions,onChange:onJobSelection,isDisabled:saving===true||canCreateCalendar===false})),_react2.default.createElement(_eui.EuiFormRow,{label:"Groups"},_react2.default.createElement(_eui.EuiComboBox,{onCreateOption:onCreateGroupOption,options:groupIds,selectedOptions:selectedGroupOptions,onChange:onGroupSelection,isDisabled:saving===true||canCreateCalendar===false})),_react2.default.createElement(_eui.EuiSpacer,{size:"xl"}),_react2.default.createElement(_eui.EuiFormRow,{label:"Events",fullWidth:true},_react2.default.createElement(_events_table.EventsTable,{canCreateCalendar:canCreateCalendar,canDeleteCalendar:canDeleteCalendar,eventsList:eventsList,onDeleteClick:onEventDelete,showImportModal:showImportModal,showNewEventModal:showNewEventModal,showSearchBar:true})),_react2.default.createElement(_eui.EuiSpacer,{size:"l"}),_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"flexEnd"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButton,{"data-testid":"ml_save_calendar_button",fill:true,onClick:isEdit?onEdit:onCreate,isDisabled:saveButtonDisabled},saving?"Saving...":"Save")),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButton,{isDisabled:saving,href:_chrome2.default.getBasePath()+"/app/ml#/settings/calendars_list"},"Cancel"))))}CalendarForm.propTypes={calendarId:_propTypes.PropTypes.string.isRequired,canCreateCalendar:_propTypes.PropTypes.bool.isRequired,canDeleteCalendar:_propTypes.PropTypes.bool.isRequired,description:_propTypes.PropTypes.string.isRequired,groupIds:_propTypes.PropTypes.array.isRequired,isEdit:_propTypes.PropTypes.bool.isRequired,isNewCalendarIdValid:_propTypes.PropTypes.bool.isRequired,jobIds:_propTypes.PropTypes.array.isRequired,onCalendarIdChange:_propTypes.PropTypes.func.isRequired,onCreate:_propTypes.PropTypes.func.isRequired,onCreateGroupOption:_propTypes.PropTypes.func.isRequired,onDescriptionChange:_propTypes.PropTypes.func.isRequired,onEdit:_propTypes.PropTypes.func.isRequired,onEventDelete:_propTypes.PropTypes.func.isRequired,onGroupSelection:_propTypes.PropTypes.func.isRequired,showImportModal:_propTypes.PropTypes.func.isRequired,onJobSelection:_propTypes.PropTypes.func.isRequired,saving:_propTypes.PropTypes.bool.isRequired,selectedGroupOptions:_propTypes.PropTypes.array.isRequired,selectedJobOptions:_propTypes.PropTypes.array.isRequired,showNewEventModal:_propTypes.PropTypes.func.isRequired}},2504:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TIME_FORMAT=undefined;exports.EventsTable=EventsTable;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var TIME_FORMAT=exports.TIME_FORMAT="YYYY-MM-DD HH:mm:ss";function DeleteButton(_ref){var onClick=_ref.onClick,canDeleteCalendar=_ref.canDeleteCalendar;return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_eui.EuiButtonEmpty,{size:"xs",color:"danger",onClick:onClick,isDisabled:canDeleteCalendar===false},"Delete"))}function EventsTable(_ref2){var canCreateCalendar=_ref2.canCreateCalendar,canDeleteCalendar=_ref2.canDeleteCalendar,eventsList=_ref2.eventsList,onDeleteClick=_ref2.onDeleteClick,showSearchBar=_ref2.showSearchBar,showImportModal=_ref2.showImportModal,showNewEventModal=_ref2.showNewEventModal;var sorting={sort:{field:"description",direction:"asc"}};var pagination={initialPageSize:5,pageSizeOptions:[5,10]};var columns=[{field:"description",name:"Description",sortable:true,truncateText:true},{field:"start_time",name:"Start",sortable:true,render:function render(timeMs){var time=(0,_moment2.default)(timeMs);return time.format(TIME_FORMAT)}},{field:"end_time",name:"End",sortable:true,render:function render(timeMs){var time=(0,_moment2.default)(timeMs);return time.format(TIME_FORMAT)}},{field:"",name:"",render:function render(event){return _react2.default.createElement(DeleteButton,{"data-testid":"event_delete",canDeleteCalendar:canDeleteCalendar,onClick:function onClick(){onDeleteClick(event.event_id)}})}}];var search={toolsRight:[_react2.default.createElement(_eui.EuiButton,{isDisabled:canCreateCalendar===false,key:"ml_new_event","data-testid":"ml_new_event",size:"s",iconType:"plusInCircle",onClick:showNewEventModal},"New event"),_react2.default.createElement(_eui.EuiButton,{isDisabled:canCreateCalendar===false,key:"ml_import_event","data-testid":"ml_import_events",size:"s",iconType:"importAction",onClick:showImportModal},"Import events")],box:{incremental:true},filters:[]};return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_eui.EuiInMemoryTable,{items:eventsList,itemId:"event_id",columns:columns,pagination:pagination,sorting:sorting,search:showSearchBar?search:undefined}))}EventsTable.propTypes={canCreateCalendar:_propTypes2.default.bool,canDeleteCalendar:_propTypes2.default.bool,eventsList:_propTypes2.default.array.isRequired,onDeleteClick:_propTypes2.default.func.isRequired,showImportModal:_propTypes2.default.func,showNewEventModal:_propTypes2.default.func,showSearchBar:_propTypes2.default.bool};EventsTable.defaultProps={showSearchBar:false,canCreateCalendar:true,canDeleteCalendar:true}},2505:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _new_event_modal=__webpack_require__(2506);Object.defineProperty(exports,"NewEventModal",{enumerable:true,get:function get(){return _new_event_modal.NewEventModal}})},2506:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.NewEventModal=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(6);var _eui=__webpack_require__(2);var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _events_table=__webpack_require__(645);var _utils=__webpack_require__(644);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var VALID_DATE_STRING_LENGTH=19;var NewEventModal=exports.NewEventModal=function(_Component){_inherits(NewEventModal,_Component);function NewEventModal(props){_classCallCheck(this,NewEventModal);var _this=_possibleConstructorReturn(this,(NewEventModal.__proto__||Object.getPrototypeOf(NewEventModal)).call(this,props));_initialiseProps.call(_this);var startDate=(0,_moment2.default)().startOf("day");var endDate=(0,_moment2.default)().startOf("day").add(1,"days");_this.state={startDate:startDate,endDate:endDate,description:"",startDateString:startDate.format(_events_table.TIME_FORMAT),endDateString:endDate.format(_events_table.TIME_FORMAT)};return _this}_createClass(NewEventModal,[{key:"render",value:function render(){var closeModal=this.props.closeModal;var description=this.state.description;return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_eui.EuiModal,{onClose:closeModal,initialFocus:"[name=description]",maxWidth:false},_react2.default.createElement(_eui.EuiModalHeader,null,_react2.default.createElement(_eui.EuiModalHeaderTitle,null,"Create new event")),_react2.default.createElement(_eui.EuiModalBody,null,_react2.default.createElement(_eui.EuiForm,null,_react2.default.createElement(_eui.EuiFormRow,{label:"Description",fullWidth:true},_react2.default.createElement(_eui.EuiFieldText,{name:"description",onChange:this.onDescriptionChange,isInvalid:!description,fullWidth:true})),this.renderRangedDatePicker())),_react2.default.createElement(_eui.EuiModalFooter,null,_react2.default.createElement(_eui.EuiButton,{onClick:this.handleAddEvent,fill:true,disabled:!description},"Add"),_react2.default.createElement(_eui.EuiButtonEmpty,{onClick:closeModal},"Cancel"))))}}]);return NewEventModal}(_react.Component);var _initialiseProps=function _initialiseProps(){var _this2=this;this.onDescriptionChange=function(e){_this2.setState({description:e.target.value})};this.handleAddEvent=function(){var _state=_this2.state,description=_state.description,startDate=_state.startDate,endDate=_state.endDate;var tempId=(0,_utils.generateTempId)();var event={description:description,start_time:startDate.valueOf(),end_time:endDate.valueOf(),event_id:tempId};_this2.props.addEvent(event)};this.handleChangeStart=function(date){var start=null;var end=_this2.state.endDate;var startMoment=(0,_moment2.default)(date);var endMoment=(0,_moment2.default)(date);start=startMoment.startOf("day");if(start>end){end=endMoment.startOf("day").add(1,"days")}_this2.setState({startDate:start,endDate:end,startDateString:start.format(_events_table.TIME_FORMAT),endDateString:end.format(_events_table.TIME_FORMAT)})};this.handleChangeEnd=function(date){var start=_this2.state.startDate;var end=null;var startMoment=(0,_moment2.default)(date);var endMoment=(0,_moment2.default)(date);end=endMoment.startOf("day");if(start>end){start=startMoment.startOf("day").subtract(1,"days")}_this2.setState({startDate:start,endDate:end,startDateString:start.format(_events_table.TIME_FORMAT),endDateString:end.format(_events_table.TIME_FORMAT)})};this.handleTimeStartChange=function(event){var dateString=event.target.value;var isValidDate=false;if(dateString.length===VALID_DATE_STRING_LENGTH){isValidDate=(0,_moment2.default)(dateString).isValid(_events_table.TIME_FORMAT,true)}else{_this2.setState({startDateString:dateString})}if(isValidDate){_this2.setState({startDateString:dateString,startDate:(0,_moment2.default)(dateString)})}};this.handleTimeEndChange=function(event){var dateString=event.target.value;var isValidDate=false;if(dateString.length===VALID_DATE_STRING_LENGTH){isValidDate=(0,_moment2.default)(dateString).isValid(_events_table.TIME_FORMAT,true)}else{_this2.setState({endDateString:dateString})}if(isValidDate){_this2.setState({endDateString:dateString,endDate:(0,_moment2.default)(dateString)})}};this.renderRangedDatePicker=function(){var _state2=_this2.state,startDate=_state2.startDate,endDate=_state2.endDate,startDateString=_state2.startDateString,endDateString=_state2.endDateString;var timeInputs=_react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_eui.EuiFlexGroup,null,_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiFormRow,{label:"From:",helpText:_events_table.TIME_FORMAT},_react2.default.createElement(_eui.EuiFieldText,{name:"startTime",onChange:_this2.handleTimeStartChange,placeholder:_events_table.TIME_FORMAT,value:startDateString}))),_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiFormRow,{label:"To:",helpText:_events_table.TIME_FORMAT},_react2.default.createElement(_eui.EuiFieldText,{name:"endTime",onChange:_this2.handleTimeEndChange,placeholder:_events_table.TIME_FORMAT,value:endDateString})))));return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),timeInputs,_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_eui.EuiFormRow,{fullWidth:true},_react2.default.createElement(_eui.EuiDatePickerRange,{fullWidth:true,iconType:false,startDateControl:_react2.default.createElement(_eui.EuiDatePicker,{fullWidth:true,inline:true,selected:startDate,onChange:_this2.handleChangeStart,startDate:startDate,endDate:endDate,isInvalid:startDate>endDate,"aria-label":"Start date",timeFormat:_events_table.TIME_FORMAT,dateFormat:_events_table.TIME_FORMAT}),endDateControl:_react2.default.createElement(_eui.EuiDatePicker,{fullWidth:true,inline:true,selected:endDate,onChange:_this2.handleChangeEnd,startDate:startDate,endDate:endDate,isInvalid:startDate>endDate,"aria-label":"End date",timeFormat:_events_table.TIME_FORMAT,dateFormat:_events_table.TIME_FORMAT})})))}};NewEventModal.propTypes={closeModal:_propTypes.PropTypes.func.isRequired,addEvent:_propTypes.PropTypes.func.isRequired}},2507:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _import_modal=__webpack_require__(2508);Object.defineProperty(exports,"ImportModal",{enumerable:true,get:function get(){return _import_modal.ImportModal}})},2508:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ImportModal=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(6);var _eui=__webpack_require__(2);var _imported_events=__webpack_require__(2509);var _utils=__webpack_require__(2511);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MAX_FILE_SIZE_MB=100;var ImportModal=exports.ImportModal=function(_Component){_inherits(ImportModal,_Component);function ImportModal(props){var _this2=this;_classCallCheck(this,ImportModal);var _this=_possibleConstructorReturn(this,(ImportModal.__proto__||Object.getPrototypeOf(ImportModal)).call(this,props));_this.handleImport=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(loadedFile){var incomingFile,errorMessage,events,parsedFile;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:incomingFile=loadedFile[0];errorMessage="Could not parse ICS file.";events=[];if(!(incomingFile&&incomingFile.size<=MAX_FILE_SIZE_MB*1e6)){_context.next=19;break}_this.setState({fileLoading:true,fileLoaded:true});_context.prev=5;_context.next=8;return(0,_utils.readFile)(incomingFile);case 8:parsedFile=_context.sent;events=(0,_utils.parseICSFile)(parsedFile.data);_this.setState({allImportedEvents:events,selectedEvents:(0,_utils.filterEvents)(events),fileLoading:false,errorMessage:null,includePastEvents:false});_context.next=17;break;case 13:_context.prev=13;_context.t0=_context["catch"](5);console.log(errorMessage,_context.t0);_this.setState({errorMessage:errorMessage,fileLoading:false});case 17:_context.next=20;break;case 19:if(incomingFile&&incomingFile.size>MAX_FILE_SIZE_MB*1e6){_this.setState({fileLoading:false,errorMessage:errorMessage})}else{_this.setState({fileLoading:false,errorMessage:null})}case 20:case"end":return _context.stop()}}},_callee,_this2,[[5,13]])}));return function(_x){return _ref.apply(this,arguments)}}();_this.onEventDelete=function(eventId){_this.setState(function(prevState){return{allImportedEvents:prevState.allImportedEvents.filter(function(event){return event.event_id!==eventId}),selectedEvents:prevState.selectedEvents.filter(function(event){return event.event_id!==eventId})}})};_this.onCheckboxToggle=function(e){_this.setState({includePastEvents:e.target.checked})};_this.handleEventsAdd=function(){var _this$state=_this.state,allImportedEvents=_this$state.allImportedEvents,selectedEvents=_this$state.selectedEvents,includePastEvents=_this$state.includePastEvents;var eventsToImport=includePastEvents?allImportedEvents:selectedEvents;var events=eventsToImport.map(function(event){return{description:event.description,start_time:event.start_time,end_time:event.end_time,event_id:event.event_id}});_this.props.addImportedEvents(events)};_this.renderCallout=function(){return _react2.default.createElement(_eui.EuiCallOut,{color:"danger"},_react2.default.createElement("p",null,_this.state.errorMessage))};_this.state={includePastEvents:false,allImportedEvents:[],selectedEvents:[],fileLoading:false,fileLoaded:false,errorMessage:null};return _this}_createClass(ImportModal,[{key:"render",value:function render(){var closeImportModal=this.props.closeImportModal;var _state=this.state,fileLoading=_state.fileLoading,fileLoaded=_state.fileLoaded,allImportedEvents=_state.allImportedEvents,selectedEvents=_state.selectedEvents,errorMessage=_state.errorMessage,includePastEvents=_state.includePastEvents;var showRecurringWarning=false;var importedEvents=void 0;if(includePastEvents){importedEvents=allImportedEvents}else{importedEvents=selectedEvents}if(importedEvents.find(function(e){return e.asterisk})!==undefined){showRecurringWarning=true}return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_eui.EuiModal,{onClose:closeImportModal,maxWidth:true},_react2.default.createElement(_eui.EuiModalHeader,null,_react2.default.createElement(_eui.EuiFlexGroup,{direction:"column",gutterSize:"none"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiModalHeaderTitle,null,"Import events")),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement("p",null,"Import events from an ICS file.")))),_react2.default.createElement(_eui.EuiModalBody,null,_react2.default.createElement(_eui.EuiFlexGroup,{direction:"column"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiFilePicker,{compressed:true,initialPromptText:"Select or drag and drop a file",onChange:this.handleImport,disabled:fileLoading})),errorMessage!==null&&this.renderCallout(),allImportedEvents.length>0&&_react2.default.createElement(_imported_events.ImportedEvents,{events:importedEvents,showRecurringWarning:showRecurringWarning,includePastEvents:includePastEvents,onCheckboxToggle:this.onCheckboxToggle,onEventDelete:this.onEventDelete}))),_react2.default.createElement(_eui.EuiModalFooter,null,_react2.default.createElement(_eui.EuiButton,{onClick:this.handleEventsAdd,fill:true,disabled:fileLoaded===false||errorMessage!==null},"Import"),_react2.default.createElement(_eui.EuiButtonEmpty,{onClick:closeImportModal},"Cancel"))))}}]);return ImportModal}(_react.Component);ImportModal.propTypes={addImportedEvents:_propTypes.PropTypes.func.isRequired,closeImportModal:_propTypes.PropTypes.func.isRequired}},2509:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _imported_events=__webpack_require__(2510);Object.defineProperty(exports,"ImportedEvents",{enumerable:true,get:function get(){return _imported_events.ImportedEvents}})},2510:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ImportedEvents=ImportedEvents;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(6);var _eui=__webpack_require__(2);var _events_table=__webpack_require__(645);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ImportedEvents(_ref){var events=_ref.events,showRecurringWarning=_ref.showRecurringWarning,includePastEvents=_ref.includePastEvents,onCheckboxToggle=_ref.onCheckboxToggle,onEventDelete=_ref.onEventDelete;return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("h4",null,"Events to import: ",events.length),showRecurringWarning&&_react2.default.createElement(_eui.EuiText,{color:"danger"},_react2.default.createElement("p",null,"Recurring events not supported. Only the first event will be imported.")))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_events_table.EventsTable,{eventsList:events,onDeleteClick:onEventDelete})),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiCheckbox,{id:"ml-include-past-events",label:"Include past events",checked:includePastEvents,onChange:onCheckboxToggle})))}ImportedEvents.propTypes={events:_propTypes.PropTypes.array.isRequired,showRecurringWarning:_propTypes.PropTypes.bool.isRequired,includePastEvents:_propTypes.PropTypes.bool.isRequired,onCheckboxToggle:_propTypes.PropTypes.func.isRequired,onEventDelete:_propTypes.PropTypes.func.isRequired}},2511:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.filterEvents=filterEvents;exports.parseICSFile=parseICSFile;exports.readFile=readFile;var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _utils=__webpack_require__(644);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var icalendar=__webpack_require__(3122);function createEvents(ical){var events=ical.events();var mlEvents=[];events.forEach(function(e){if(e.element==="VEVENT"){var description=e.properties.SUMMARY;var start=e.properties.DTSTART;var end=e.properties.DTEND;var recurring=e.properties.RRULE!==undefined;if(description&&start&&end&&description.length&&start.length&&end.length){var tempId=(0,_utils.generateTempId)();mlEvents.push({event_id:tempId,description:description[0].value,start_time:start[0].value.valueOf(),end_time:end[0].value.valueOf(),asterisk:recurring})}}});return mlEvents}function filterEvents(events){var now=(0,_moment2.default)().valueOf();return events.filter(function(e){return e.start_time>now})}function parseICSFile(data){var cal=icalendar.parse_calendar(data);return createEvents(cal)}function readFile(file){return new Promise(function(resolve,reject){if(file&&file.size){var reader=new FileReader;reader.readAsText(file);reader.onload=function(){return function(){var data=reader.result;if(data===""){reject()}else{resolve({data:data})}}}(file)}else{reject()}})}},2513:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2514);__webpack_require__(2529)},2514:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2515)},2515:function(module,exports,__webpack_require__){"use strict";__webpack_require__(53);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _modules=__webpack_require__(4);var _check_license=__webpack_require__(43);var _check_privilege=__webpack_require__(32);var _check_ml_nodes=__webpack_require__(47);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _edit_filter_list=__webpack_require__(2516);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml",["react"]);var template='\n  <ml-nav-menu name="settings"></ml-nav-menu>\n  <div class="ml-filter-lists">\n    <ml-edit-filter-list></ml-edit-filter-list>\n  </div>\n';_routes2.default.when("/settings/filter_lists/new_filter_list",{template:template,resolve:{CheckLicense:_check_license.checkFullLicense,privileges:_check_privilege.checkGetJobsPrivilege,mlNodeCount:_check_ml_nodes.getMlNodeCount}}).when("/settings/filter_lists/edit_filter_list/:filterId",{template:template,resolve:{CheckLicense:_check_license.checkFullLicense,privileges:_check_privilege.checkGetJobsPrivilege,mlNodeCount:_check_ml_nodes.getMlNodeCount}});_module.directive("mlEditFilterList",function($route){return{restrict:"E",replace:false,scope:{},link:function link(scope,element){var props={filterId:$route.current.params.filterId,canCreateFilter:(0,_check_privilege.checkPermission)("canCreateFilter"),canDeleteFilter:(0,_check_privilege.checkPermission)("canDeleteFilter")};_reactDom2.default.render(_react2.default.createElement(_edit_filter_list.EditFilterList,props),element[0])}}})},2516:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EditFilterList=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _notify=__webpack_require__(10);var _header=__webpack_require__(2517);var _toolbar=__webpack_require__(2522);var _items_grid=__webpack_require__(2525);var _utils=__webpack_require__(2528);var _ml_api_service=__webpack_require__(22);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}var DEFAULT_ITEMS_PER_PAGE=50;function getMatchingFilterItems(searchBarQuery,items){if(items===undefined){return[]}if(searchBarQuery===undefined){return[].concat(_toConsumableArray(items))}var allItems=items.map(function(item){return{value:item}});var matchingObjects=_eui.EuiSearchBar.Query.execute(searchBarQuery,allItems,{defaultFields:["value"]});return matchingObjects.map(function(item){return item.value})}function getActivePage(activePageState,itemsPerPage,numMatchingItems){var activePage=activePageState;var activePageStartIndex=itemsPerPage*activePageState;if(activePageStartIndex>numMatchingItems){activePage=Math.max(Math.ceil(numMatchingItems/itemsPerPage)-1,0)}return activePage}function returnToFiltersList(){window.location.href="#/settings/filter_lists"}var EditFilterList=exports.EditFilterList=function(_Component){_inherits(EditFilterList,_Component);function EditFilterList(props){_classCallCheck(this,EditFilterList);var _this=_possibleConstructorReturn(this,(EditFilterList.__proto__||Object.getPrototypeOf(EditFilterList)).call(this,props));_this.loadFilterList=function(filterId){_ml_api_service.ml.filters.filters({filterId:filterId}).then(function(filter){_this.setLoadedFilterState(filter)}).catch(function(resp){console.log("Error loading filter "+filterId+":",resp);_notify.toastNotifications.addDanger("An error occurred loading details of filter "+filterId)})};_this.setLoadedFilterState=function(loadedFilter){_this.setState(function(prevState){var itemsPerPage=prevState.itemsPerPage,searchQuery=prevState.searchQuery;var matchingItems=getMatchingFilterItems(searchQuery,loadedFilter.items);var activePage=getActivePage(prevState.activePage,itemsPerPage,matchingItems.length);return{description:loadedFilter.description,items:loadedFilter.items!==undefined?[].concat(_toConsumableArray(loadedFilter.items)):[],matchingItems:matchingItems,selectedItems:[],loadedFilter:loadedFilter,isNewFilterIdInvalid:false,activePage:activePage,searchQuery:searchQuery,saveInProgress:false}})};_this.updateNewFilterId=function(newFilterId){_this.setState({newFilterId:newFilterId,isNewFilterIdInvalid:!(0,_utils.isValidFilterListId)(newFilterId)})};_this.updateDescription=function(description){_this.setState({description:description})};_this.addItems=function(itemsToAdd){_this.setState(function(prevState){var itemsPerPage=prevState.itemsPerPage,searchQuery=prevState.searchQuery;var items=[].concat(_toConsumableArray(prevState.items));var alreadyInFilter=[];itemsToAdd.forEach(function(item){if(items.indexOf(item)===-1){items.push(item)}else{alreadyInFilter.push(item)}});items.sort(function(str1,str2){return str1.localeCompare(str2)});if(alreadyInFilter.length>0){_notify.toastNotifications.addWarning("The following items were already in the filter list: "+alreadyInFilter)}var matchingItems=getMatchingFilterItems(searchQuery,items);var activePage=getActivePage(prevState.activePage,itemsPerPage,matchingItems.length);return{items:items,matchingItems:matchingItems,activePage:activePage,searchQuery:searchQuery}})};_this.deleteSelectedItems=function(){_this.setState(function(prevState){var selectedItems=prevState.selectedItems,itemsPerPage=prevState.itemsPerPage,searchQuery=prevState.searchQuery;var items=[].concat(_toConsumableArray(prevState.items));selectedItems.forEach(function(item){var index=items.indexOf(item);if(index!==-1){items.splice(index,1)}});var matchingItems=getMatchingFilterItems(searchQuery,items);var activePage=getActivePage(prevState.activePage,itemsPerPage,matchingItems.length);return{items:items,matchingItems:matchingItems,selectedItems:[],activePage:activePage,searchQuery:searchQuery}})};_this.onSearchChange=function(_ref){var query=_ref.query;_this.setState(function(prevState){var items=prevState.items,itemsPerPage=prevState.itemsPerPage;var matchingItems=getMatchingFilterItems(query,items);var activePage=getActivePage(prevState.activePage,itemsPerPage,matchingItems.length);return{matchingItems:matchingItems,activePage:activePage,searchQuery:query}})};_this.setItemSelected=function(item,isSelected){_this.setState(function(prevState){var selectedItems=[].concat(_toConsumableArray(prevState.selectedItems));var index=selectedItems.indexOf(item);if(isSelected===true&&index===-1){selectedItems.push(item)}else if(isSelected===false&&index!==-1){selectedItems.splice(index,1)}return{selectedItems:selectedItems}})};_this.setActivePage=function(activePage){_this.setState({activePage:activePage})};_this.setItemsPerPage=function(itemsPerPage){_this.setState({itemsPerPage:itemsPerPage,activePage:0})};_this.save=function(){_this.setState({saveInProgress:true});var _this$state=_this.state,loadedFilter=_this$state.loadedFilter,newFilterId=_this$state.newFilterId,description=_this$state.description,items=_this$state.items;var filterId=_this.props.filterId!==undefined?_this.props.filterId:newFilterId;(0,_utils.saveFilterList)(filterId,description,items,loadedFilter).then(function(savedFilter){_this.setLoadedFilterState(savedFilter);returnToFiltersList()}).catch(function(resp){console.log("Error saving filter "+filterId+":",resp);_notify.toastNotifications.addDanger("An error occurred saving filter "+filterId);_this.setState({saveInProgress:false})})};_this.state={description:"",items:[],matchingItems:[],selectedItems:[],loadedFilter:{},newFilterId:"",isNewFilterIdInvalid:true,activePage:0,itemsPerPage:DEFAULT_ITEMS_PER_PAGE,saveInProgress:false};return _this}_createClass(EditFilterList,[{key:"componentDidMount",value:function componentDidMount(){var filterId=this.props.filterId;if(filterId!==undefined){this.loadFilterList(filterId)}else{this.setState({newFilterId:""})}}},{key:"render",value:function render(){var _state=this.state,loadedFilter=_state.loadedFilter,newFilterId=_state.newFilterId,isNewFilterIdInvalid=_state.isNewFilterIdInvalid,description=_state.description,items=_state.items,matchingItems=_state.matchingItems,selectedItems=_state.selectedItems,itemsPerPage=_state.itemsPerPage,activePage=_state.activePage,saveInProgress=_state.saveInProgress;var _props=this.props,canCreateFilter=_props.canCreateFilter,canDeleteFilter=_props.canDeleteFilter;var totalItemCount=items!==undefined?items.length:0;return _react2.default.createElement(_eui.EuiPage,{className:"ml-edit-filter-lists"},_react2.default.createElement(_eui.EuiPageContent,{className:"ml-edit-filter-lists-content",verticalPosition:"center",horizontalPosition:"center"},_react2.default.createElement(_header.EditFilterListHeader,{canCreateFilter:canCreateFilter,filterId:this.props.filterId,newFilterId:newFilterId,isNewFilterIdInvalid:isNewFilterIdInvalid,updateNewFilterId:this.updateNewFilterId,description:description,updateDescription:this.updateDescription,totalItemCount:totalItemCount,usedBy:loadedFilter.used_by}),_react2.default.createElement(_toolbar.EditFilterListToolbar,{canCreateFilter:canCreateFilter,canDeleteFilter:canDeleteFilter,onSearchChange:this.onSearchChange,addItems:this.addItems,deleteSelectedItems:this.deleteSelectedItems,selectedItemCount:selectedItems.length}),_react2.default.createElement(_eui.EuiSpacer,{size:"xl"}),_react2.default.createElement(_items_grid.ItemsGrid,{totalItemCount:totalItemCount,items:matchingItems,selectedItems:selectedItems,itemsPerPage:itemsPerPage,setItemsPerPage:this.setItemsPerPage,setItemSelected:this.setItemSelected,activePage:activePage,setActivePage:this.setActivePage}),_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"flexEnd"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonEmpty,{onClick:returnToFiltersList},"Cancel")),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButton,{onClick:this.save,disabled:saveInProgress===true||isNewFilterIdInvalid===true||canCreateFilter===false,fill:true},"Save")))))}}]);return EditFilterList}(_react.Component);EditFilterList.propTypes={filterId:_propTypes2.default.string,canCreateFilter:_propTypes2.default.bool.isRequired,canDeleteFilter:_propTypes2.default.bool.isRequired}},2517:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EditFilterListHeader=EditFilterListHeader;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _edit_description_popover=__webpack_require__(2518);var _filter_list_usage_popover=__webpack_require__(2520);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function EditFilterListHeader(_ref){var canCreateFilter=_ref.canCreateFilter,filterId=_ref.filterId,totalItemCount=_ref.totalItemCount,description=_ref.description,updateDescription=_ref.updateDescription,newFilterId=_ref.newFilterId,isNewFilterIdInvalid=_ref.isNewFilterIdInvalid,updateNewFilterId=_ref.updateNewFilterId,usedBy=_ref.usedBy;var title=filterId!==undefined?"Filter list "+filterId:"Create new filter list";var idField=void 0;var descriptionField=void 0;var usedByElement=void 0;if(filterId===undefined){var msg="Use lowercase alphanumerics (a-z and 0-9), hyphens or underscores;"+" must start and end with an alphanumeric character";var helpText=isNewFilterIdInvalid===false?msg:undefined;var error=isNewFilterIdInvalid===true?[msg]:undefined;idField=_react2.default.createElement(_eui.EuiFormRow,{label:"Filter list ID",helpText:helpText,error:error,isInvalid:isNewFilterIdInvalid},_react2.default.createElement(_eui.EuiFieldText,{name:"new_filter_id",value:newFilterId,isInvalid:isNewFilterIdInvalid,onChange:function onChange(e){return updateNewFilterId(e.target.value)}}))}if(description!==undefined&&description.length>0){descriptionField=_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("p",null,description))}else{descriptionField=_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement(_eui.EuiTextColor,{color:"subdued"},"Add a description"))}if(filterId!==undefined){if(usedBy!==undefined&&usedBy.jobs.length>0){usedByElement=_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement("div",{className:"ml-filter-list-usage"},_react2.default.createElement(_eui.EuiText,null,"This filter list is used in"),_react2.default.createElement(_filter_list_usage_popover.FilterListUsagePopover,{entityType:"detector",entityValues:usedBy.detectors}),_react2.default.createElement(_eui.EuiText,null,"across"),_react2.default.createElement(_filter_list_usage_popover.FilterListUsagePopover,{entityType:"job",entityValues:usedBy.jobs})),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}))}else{usedByElement=_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("p",null,"This filter list is not used by any jobs.")),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}))}}return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"baseline"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"baseline",gutterSize:"m",responsive:false},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiTitle,null,_react2.default.createElement("h1",null,title))),_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiTextColor,{color:"subdued"},_react2.default.createElement("p",null,totalItemCount," ",totalItemCount!==1?"items":"item"," in total")))))),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),idField,_react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"baseline",gutterSize:"s",responsive:false},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},descriptionField),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_edit_description_popover.EditDescriptionPopover,{canCreateFilter:canCreateFilter,description:description,updateDescription:updateDescription}))),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),usedByElement)}EditFilterListHeader.propTypes={canCreateFilter:_propTypes2.default.bool.isRequired,filterId:_propTypes2.default.string,newFilterId:_propTypes2.default.string,isNewFilterIdInvalid:_propTypes2.default.bool,updateNewFilterId:_propTypes2.default.func.isRequired,totalItemCount:_propTypes2.default.number.isRequired,description:_propTypes2.default.string,updateDescription:_propTypes2.default.func.isRequired,usedBy:_propTypes2.default.object}},2518:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _edit_description_popover=__webpack_require__(2519);Object.defineProperty(exports,"EditDescriptionPopover",{enumerable:true,get:function get(){return _edit_description_popover.EditDescriptionPopover}})},2519:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EditDescriptionPopover=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var EditDescriptionPopover=exports.EditDescriptionPopover=function(_Component){_inherits(EditDescriptionPopover,_Component);function EditDescriptionPopover(props){_classCallCheck(this,EditDescriptionPopover);var _this=_possibleConstructorReturn(this,(EditDescriptionPopover.__proto__||Object.getPrototypeOf(EditDescriptionPopover)).call(this,props));_this.onChange=function(e){_this.setState({value:e.target.value})};_this.onButtonClick=function(){if(_this.state.isPopoverOpen===false){_this.setState({isPopoverOpen:!_this.state.isPopoverOpen,value:_this.props.description})}else{_this.closePopover()}};_this.closePopover=function(){if(_this.state.isPopoverOpen===true){_this.setState({isPopoverOpen:false});_this.props.updateDescription(_this.state.value)}};_this.state={isPopoverOpen:false,value:props.description};return _this}_createClass(EditDescriptionPopover,[{key:"render",value:function render(){var _state=this.state,isPopoverOpen=_state.isPopoverOpen,value=_state.value;var button=_react2.default.createElement(_eui.EuiButtonIcon,{size:"s",color:"primary",onClick:this.onButtonClick,iconType:"pencil","aria-label":"Edit description",isDisabled:this.props.canCreateFilter===false});return _react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiPopover,{id:"filter_list_description_popover",ownFocus:true,button:button,isOpen:isPopoverOpen,closePopover:this.closePopover},_react2.default.createElement("div",{style:{width:"300px"}},_react2.default.createElement(_eui.EuiForm,null,_react2.default.createElement(_eui.EuiFormRow,{label:"Filter list description"},_react2.default.createElement(_eui.EuiFieldText,{name:"filter_list_description",value:value,onChange:this.onChange}))))))}}]);return EditDescriptionPopover}(_react.Component);EditDescriptionPopover.propTypes={canCreateFilter:_propTypes2.default.bool.isRequired,description:_propTypes2.default.string,updateDescription:_propTypes2.default.func.isRequired}},2520:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _filter_list_usage_popover=__webpack_require__(2521);Object.defineProperty(exports,"FilterListUsagePopover",{enumerable:true,get:function get(){return _filter_list_usage_popover.FilterListUsagePopover}})},2521:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FilterListUsagePopover=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var FilterListUsagePopover=exports.FilterListUsagePopover=function(_Component){_inherits(FilterListUsagePopover,_Component);function FilterListUsagePopover(props){_classCallCheck(this,FilterListUsagePopover);var _this=_possibleConstructorReturn(this,(FilterListUsagePopover.__proto__||Object.getPrototypeOf(FilterListUsagePopover)).call(this,props));_this.onButtonClick=function(){_this.setState({isPopoverOpen:!_this.state.isPopoverOpen})};_this.closePopover=function(){_this.setState({isPopoverOpen:false})};_this.state={isPopoverOpen:false};return _this}_createClass(FilterListUsagePopover,[{key:"render",value:function render(){var _props=this.props,entityType=_props.entityType,entityValues=_props.entityValues;var linkText=entityValues.length+" "+entityType+(entityValues.length!==1?"s":"");var listItems=entityValues.map(function(value){return _react2.default.createElement("li",{key:value},value)});var button=_react2.default.createElement(_eui.EuiButtonEmpty,{size:"s",color:"primary",onClick:this.onButtonClick},linkText);return _react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiPopover,{id:entityType+"_filter_list_usage",panelClassName:"ml-filter-list-usage-popover",ownFocus:true,button:button,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover},_react2.default.createElement("ul",null,listItems)))}}]);return FilterListUsagePopover}(_react.Component);FilterListUsagePopover.propTypes={entityType:_propTypes2.default.oneOf(["job","detector"]),entityValues:_propTypes2.default.array.isRequired}},2522:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EditFilterListToolbar=EditFilterListToolbar;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _add_item_popover=__webpack_require__(2523);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function EditFilterListToolbar(_ref){var canCreateFilter=_ref.canCreateFilter,canDeleteFilter=_ref.canDeleteFilter,onSearchChange=_ref.onSearchChange,addItems=_ref.addItems,deleteSelectedItems=_ref.deleteSelectedItems,selectedItemCount=_ref.selectedItemCount;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"flexEnd"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_add_item_popover.AddItemPopover,{addItems:addItems,canCreateFilter:canCreateFilter}))),_react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"center",gutterSize:"xl"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButton,{color:"danger",disabled:selectedItemCount===0||canDeleteFilter===false,onClick:deleteSelectedItems},"Delete item")),_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiSearchBar,{onChange:onSearchChange}))))}EditFilterListToolbar.propTypes={canCreateFilter:_propTypes2.default.bool.isRequired,canDeleteFilter:_propTypes2.default.bool.isRequired,onSearchChange:_propTypes2.default.func.isRequired,addItems:_propTypes2.default.func.isRequired,deleteSelectedItems:_propTypes2.default.func.isRequired,selectedItemCount:_propTypes2.default.number.isRequired}},2523:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _add_item_popover=__webpack_require__(2524);Object.defineProperty(exports,"AddItemPopover",{enumerable:true,get:function get(){return _add_item_popover.AddItemPopover}})},2524:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AddItemPopover=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var AddItemPopover=exports.AddItemPopover=function(_Component){_inherits(AddItemPopover,_Component);function AddItemPopover(props){_classCallCheck(this,AddItemPopover);var _this=_possibleConstructorReturn(this,(AddItemPopover.__proto__||Object.getPrototypeOf(AddItemPopover)).call(this,props));_this.onItemsTextChange=function(e){_this.setState({itemsText:e.target.value})};_this.onButtonClick=function(){_this.setState({isPopoverOpen:!_this.state.isPopoverOpen})};_this.closePopover=function(){_this.setState({isPopoverOpen:false})};_this.onAddButtonClick=function(){var items=_this.state.itemsText.split("\n");var addItems=[];items.forEach(function(item){if(addItems.indexOf(item)===-1&&item.length>0){addItems.push(item)}});_this.props.addItems(addItems);_this.setState({isPopoverOpen:false,itemsText:""})};_this.state={isPopoverOpen:false,itemsText:""};return _this}_createClass(AddItemPopover,[{key:"render",value:function render(){var button=_react2.default.createElement(_eui.EuiButton,{size:"s",color:"primary",iconType:"arrowDown",iconSide:"right",onClick:this.onButtonClick,isDisabled:this.props.canCreateFilter===false},"Add item");return _react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiPopover,{id:"add_item_popover",panelClassName:"ml-add-filter-item-popover",ownFocus:true,button:button,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover},_react2.default.createElement(_eui.EuiForm,null,_react2.default.createElement(_eui.EuiFormRow,{label:"Items"},_react2.default.createElement(_eui.EuiTextArea,{value:this.state.itemsText,onChange:this.onItemsTextChange}))),_react2.default.createElement(_eui.EuiText,{size:"xs"},"Enter one item per line"),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"flexEnd"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButton,{onClick:this.onAddButtonClick,disabled:this.state.itemsText.length===0},"Add")))))}}]);return AddItemPopover}(_react.Component);AddItemPopover.propTypes={addItems:_propTypes2.default.func.isRequired,canCreateFilter:_propTypes2.default.bool.isRequired}},2525:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _items_grid=__webpack_require__(2526);Object.defineProperty(exports,"ItemsGrid",{enumerable:true,get:function get(){return _items_grid.ItemsGrid}})},2526:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ItemsGrid=ItemsGrid;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _items_grid_pagination=__webpack_require__(2527);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ItemsGrid(_ref){var numberColumns=_ref.numberColumns,totalItemCount=_ref.totalItemCount,items=_ref.items,selectedItems=_ref.selectedItems,itemsPerPage=_ref.itemsPerPage,itemsPerPageOptions=_ref.itemsPerPageOptions,setItemsPerPage=_ref.setItemsPerPage,setItemSelected=_ref.setItemSelected,activePage=_ref.activePage,setActivePage=_ref.setActivePage;if(items===undefined||items.length===0){return _react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceAround"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("h4",null,totalItemCount===0?"No items have been added":"No matching items"))))}var startIndex=activePage*itemsPerPage;var pageItems=items.slice(startIndex,startIndex+itemsPerPage);var gridItems=pageItems.map(function(item,index){return _react2.default.createElement(_eui.EuiFlexItem,{key:"ml_grid_item_"+index},_react2.default.createElement(_eui.EuiCheckbox,{id:"ml_grid_item_"+index,label:item,checked:selectedItems.indexOf(item)>=0,onChange:function onChange(e){setItemSelected(item,e.target.checked)}}))});return _react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiFlexGrid,{columns:numberColumns,className:"eui-textBreakWord",gutterSize:"m"},gridItems),_react2.default.createElement(_items_grid_pagination.ItemsGridPagination,{itemCount:items.length,itemsPerPage:itemsPerPage,itemsPerPageOptions:itemsPerPageOptions,setItemsPerPage:setItemsPerPage,activePage:activePage,setActivePage:setActivePage}))}ItemsGrid.propTypes={numberColumns:_propTypes2.default.oneOf([2,3,4]),totalItemCount:_propTypes2.default.number.isRequired,items:_propTypes2.default.array,selectedItems:_propTypes2.default.array,itemsPerPage:_propTypes2.default.number,itemsPerPageOptions:_propTypes2.default.arrayOf(_propTypes2.default.number),setItemsPerPage:_propTypes2.default.func.isRequired,setItemSelected:_propTypes2.default.func.isRequired,activePage:_propTypes2.default.number.isRequired,setActivePage:_propTypes2.default.func.isRequired};ItemsGrid.defaultProps={numberColumns:4,itemsPerPage:50,itemsPerPageOptions:[50,100,500,1e3]}},2527:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ItemsGridPagination=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function getContextMenuItemIcon(menuItemSetting,itemsPerPage){return menuItemSetting===itemsPerPage?"check":"empty"}var ItemsGridPagination=exports.ItemsGridPagination=function(_Component){_inherits(ItemsGridPagination,_Component);function ItemsGridPagination(props){_classCallCheck(this,ItemsGridPagination);var _this=_possibleConstructorReturn(this,(ItemsGridPagination.__proto__||Object.getPrototypeOf(ItemsGridPagination)).call(this,props));_this.onButtonClick=function(){_this.setState({isPopoverOpen:!_this.state.isPopoverOpen})};_this.closePopover=function(){_this.setState({isPopoverOpen:false})};_this.onPageClick=function(pageNumber){_this.props.setActivePage(pageNumber)};_this.onChangeItemsPerPage=function(pageSize){_this.closePopover();_this.props.setItemsPerPage(pageSize)};_this.state={isPopoverOpen:false};return _this}_createClass(ItemsGridPagination,[{key:"render",value:function render(){var _this2=this;var _props=this.props,itemCount=_props.itemCount,itemsPerPage=_props.itemsPerPage,itemsPerPageOptions=_props.itemsPerPageOptions,activePage=_props.activePage;var button=_react2.default.createElement(_eui.EuiButtonEmpty,{size:"s",color:"text",iconType:"arrowDown",iconSide:"right",onClick:this.onButtonClick},"Items per page: ",itemsPerPage);var pageCount=Math.ceil(itemCount/itemsPerPage);var items=itemsPerPageOptions.map(function(pageSize){return _react2.default.createElement(_eui.EuiContextMenuItem,{key:pageSize+" items",icon:getContextMenuItemIcon(pageSize,itemsPerPage),onClick:function onClick(){_this2.onChangeItemsPerPage(pageSize)}},pageSize," items")});return _react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiPopover,{id:"customizablePagination",button:button,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover,panelPaddingSize:"none"},_react2.default.createElement(_eui.EuiContextMenuPanel,{items:items,className:"ml-items-grid-page-size-menu"}))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiPagination,{pageCount:pageCount,activePage:activePage,onPageClick:this.onPageClick})))}}]);return ItemsGridPagination}(_react.Component);ItemsGridPagination.propTypes={itemCount:_propTypes2.default.number.isRequired,itemsPerPage:_propTypes2.default.number.isRequired,itemsPerPageOptions:_propTypes2.default.arrayOf(_propTypes2.default.number).isRequired,setItemsPerPage:_propTypes2.default.func.isRequired,activePage:_propTypes2.default.number.isRequired,setActivePage:_propTypes2.default.func.isRequired}},2528:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isValidFilterListId=isValidFilterListId;exports.saveFilterList=saveFilterList;exports.addFilterList=addFilterList;exports.updateFilterList=updateFilterList;var _notify=__webpack_require__(10);var _job_utils=__webpack_require__(34);var _ml_api_service=__webpack_require__(22);function isValidFilterListId(id){return id!==undefined&&id.length>0&&(0,_job_utils.isJobIdValid)(id)}function saveFilterList(filterId,description,items,loadedFilterList){return new Promise(function(resolve,reject){if(loadedFilterList===undefined||loadedFilterList.filter_id===undefined){addFilterList(filterId,description,items).then(function(newFilter){resolve(newFilter)}).catch(function(error){reject(error)})}else{updateFilterList(loadedFilterList,description,items).then(function(updatedFilter){resolve(updatedFilter)}).catch(function(error){reject(error)})}})}function addFilterList(filterId,description,items){return new Promise(function(resolve,reject){_ml_api_service.ml.filters.filtersStats().then(function(filterLists){var savedFilterIds=filterLists.map(function(filterList){return filterList.filter_id});if(savedFilterIds.indexOf(filterId)===-1){_ml_api_service.ml.filters.addFilter(filterId,description,items).then(function(newFilter){resolve(newFilter)}).catch(function(error){reject(error)})}else{_notify.toastNotifications.addDanger("A filter with id "+filterId+" already exists");reject(new Error("A filter with id "+filterId+" already exists"))}}).catch(function(error){reject(error)})})}function updateFilterList(loadedFilterList,description,items){return new Promise(function(resolve,reject){var loadedItems=loadedFilterList.items;var addItems=items.filter(function(item){return loadedItems.includes(item)===false});var removeItems=loadedItems.filter(function(item){return items.includes(item)===false});_ml_api_service.ml.filters.updateFilter(loadedFilterList.filter_id,description,addItems,removeItems).then(function(updatedFilter){resolve(updatedFilter)}).catch(function(error){reject(error)})})}},2529:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2530)},2530:function(module,exports,__webpack_require__){"use strict";__webpack_require__(53);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _modules=__webpack_require__(4);var _check_license=__webpack_require__(43);var _check_privilege=__webpack_require__(32);var _check_ml_nodes=__webpack_require__(47);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _filter_lists=__webpack_require__(2531);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml",["react"]);var template='\n  <ml-nav-menu name="settings"></ml-nav-menu>\n  <div class="ml-filter-lists">\n    <ml-filter-lists></ml-filter-lists>\n  </div>\n';_routes2.default.when("/settings/filter_lists",{template:template,resolve:{CheckLicense:_check_license.checkFullLicense,privileges:_check_privilege.checkGetJobsPrivilege,mlNodeCount:_check_ml_nodes.getMlNodeCount}});_module.directive("mlFilterLists",function(){return{restrict:"E",replace:false,scope:{},link:function link(scope,element){var props={canCreateFilter:(0,_check_privilege.checkPermission)("canCreateFilter"),canDeleteFilter:(0,_check_privilege.checkPermission)("canDeleteFilter")};_reactDom2.default.render(_react2.default.createElement(_filter_lists.FilterLists,props),element[0])}}})},2531:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FilterLists=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(6);var _eui=__webpack_require__(2);var _notify=__webpack_require__(10);var _header=__webpack_require__(2532);var _table=__webpack_require__(2533);var _ml_api_service=__webpack_require__(22);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var FilterLists=exports.FilterLists=function(_Component){_inherits(FilterLists,_Component);function FilterLists(props){_classCallCheck(this,FilterLists);var _this=_possibleConstructorReturn(this,(FilterLists.__proto__||Object.getPrototypeOf(FilterLists)).call(this,props));_this.setFilterLists=function(filterLists){_this.setState(function(prevState){var loadedFilterIds=filterLists.map(function(filterList){return filterList.filter_id});var selectedFilterLists=prevState.selectedFilterLists.filter(function(filterList){return loadedFilterIds.indexOf(filterList.filter_id)!==-1});return{filterLists:filterLists,selectedFilterLists:selectedFilterLists}})};_this.setSelectedFilterLists=function(selectedFilterLists){_this.setState({selectedFilterLists:selectedFilterLists})};_this.refreshFilterLists=function(){_ml_api_service.ml.filters.filtersStats().then(function(filterLists){_this.setFilterLists(filterLists)}).catch(function(resp){console.log("Error loading list of filters:",resp);_notify.toastNotifications.addDanger("An error occurred loading the filter lists")})};_this.state={filterLists:[],selectedFilterLists:[]};return _this}_createClass(FilterLists,[{key:"componentDidMount",value:function componentDidMount(){this.refreshFilterLists()}},{key:"render",value:function render(){var _state=this.state,filterLists=_state.filterLists,selectedFilterLists=_state.selectedFilterLists;var _props=this.props,canCreateFilter=_props.canCreateFilter,canDeleteFilter=_props.canDeleteFilter;return _react2.default.createElement(_eui.EuiPage,{className:"ml-list-filter-lists"},_react2.default.createElement(_eui.EuiPageContent,{className:"ml-list-filter-lists-content",verticalPosition:"center",horizontalPosition:"center"},_react2.default.createElement(_header.FilterListsHeader,{totalCount:filterLists.length,refreshFilterLists:this.refreshFilterLists}),_react2.default.createElement(_table.FilterListsTable,{canCreateFilter:canCreateFilter,canDeleteFilter:canDeleteFilter,filterLists:filterLists,selectedFilterLists:selectedFilterLists,setSelectedFilterLists:this.setSelectedFilterLists,refreshFilterLists:this.refreshFilterLists})))}}]);return FilterLists}(_react.Component);FilterLists.propTypes={canCreateFilter:_propTypes.PropTypes.bool.isRequired,canDeleteFilter:_propTypes.PropTypes.bool.isRequired}},2532:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FilterListsHeader=FilterListsHeader;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _metadata=__webpack_require__(190);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var docsUrl="https://www.elastic.co/guide/en/elastic-stack-overview/"+_metadata.metadata.branch+"/ml-rules.html";function FilterListsHeader(_ref){var totalCount=_ref.totalCount,refreshFilterLists=_ref.refreshFilterLists;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"baseline"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"baseline",gutterSize:"m",responsive:false},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiTitle,null,_react2.default.createElement("h1",null,"Filter Lists"))),_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiTextColor,{color:"subdued"},_react2.default.createElement("p",null,totalCount," in total"))))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"baseline",gutterSize:"m",responsive:false},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonEmpty,{size:"s",iconType:"refresh",onClick:function onClick(){return refreshFilterLists()}},"Refresh"))))),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("p",null,_react2.default.createElement(_eui.EuiTextColor,{color:"subdued"},"Filter lists contain values that you can use to include or exclude events from the machine learning analysis. You can use the same filter list in multiple jobs.",_react2.default.createElement("br",null),_react2.default.createElement(_eui.EuiLink,{href:docsUrl,target:"_blank"},"Learn more")))),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}))}FilterListsHeader.propTypes={totalCount:_propTypes2.default.number.isRequired,refreshFilterLists:_propTypes2.default.func.isRequired}},2533:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FilterListsTable=FilterListsTable;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _delete_filter_list_modal=__webpack_require__(2534);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function UsedByIcon(_ref){var usedBy=_ref.usedBy;var icon=void 0;if(usedBy!==undefined&&usedBy.jobs.length>0){icon=_react2.default.createElement(_eui.EuiIcon,{type:"check","aria-label":"In use"})}else{icon=_react2.default.createElement(_eui.EuiIcon,{type:"cross","aria-label":"Not in use"})}return icon}UsedByIcon.propTypes={usedBy:_propTypes2.default.object};function NewFilterButton(_ref2){var canCreateFilter=_ref2.canCreateFilter;return _react2.default.createElement(_eui.EuiButton,{key:"new_filter_list",href:_chrome2.default.getBasePath()+"/app/ml#/settings/filter_lists/new_filter_list",isDisabled:canCreateFilter===false},"New")}function getColumns(){var columns=[{field:"filter_id",name:"ID",render:function render(id){return _react2.default.createElement(_eui.EuiLink,{href:_chrome2.default.getBasePath()+"/app/ml#/settings/filter_lists/edit_filter_list/"+id},id)},sortable:true},{field:"description",name:"Description",sortable:true},{field:"item_count",name:"Item count",sortable:true},{field:"used_by",name:"In use",render:function render(usedBy){return _react2.default.createElement(UsedByIcon,{usedBy:usedBy})},sortable:true}];return columns}function renderToolsRight(canCreateFilter,canDeleteFilter,selectedFilterLists,refreshFilterLists){return[_react2.default.createElement(NewFilterButton,{key:"new_filter_list",canCreateFilter:canCreateFilter}),_react2.default.createElement(_delete_filter_list_modal.DeleteFilterListModal,{canDeleteFilter:canDeleteFilter,selectedFilterLists:selectedFilterLists,refreshFilterLists:refreshFilterLists})]}function FilterListsTable(_ref3){var canCreateFilter=_ref3.canCreateFilter,canDeleteFilter=_ref3.canDeleteFilter,filterLists=_ref3.filterLists,selectedFilterLists=_ref3.selectedFilterLists,setSelectedFilterLists=_ref3.setSelectedFilterLists,refreshFilterLists=_ref3.refreshFilterLists;var sorting={sort:{field:"filter_id",direction:"asc"}};var search={toolsRight:renderToolsRight(canCreateFilter,canDeleteFilter,selectedFilterLists,refreshFilterLists),box:{incremental:true},filters:[]};var tableSelection={selectable:function selectable(filterList){return filterList.used_by===undefined||filterList.used_by.jobs.length===0},selectableMessage:function selectableMessage(){return undefined},onSelectionChange:function onSelectionChange(selection){return setSelectedFilterLists(selection)}};return _react2.default.createElement(_react2.default.Fragment,null,filterLists===undefined||filterLists.length===0?_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"flexEnd",justifyContent:"flexEnd"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(NewFilterButton,null))),_react2.default.createElement(_eui.EuiSpacer,{size:"l"}),_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceAround"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("h4",null,"No filters have been created"))))):_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiInMemoryTable,{className:"ml-filter-lists-table",items:filterLists,itemId:"filter_id",columns:getColumns(),search:search,pagination:true,sorting:sorting,selection:tableSelection,isSelectable:true})))}FilterListsTable.propTypes={canCreateFilter:_propTypes2.default.bool.isRequired,canDeleteFilter:_propTypes2.default.bool.isRequired,filterLists:_propTypes2.default.array,selectedFilterLists:_propTypes2.default.array,setSelectedFilterLists:_propTypes2.default.func.isRequired,refreshFilterLists:_propTypes2.default.func.isRequired}},2534:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _delete_filter_list_modal=__webpack_require__(2535);Object.defineProperty(exports,"DeleteFilterListModal",{enumerable:true,get:function get(){return _delete_filter_list_modal.DeleteFilterListModal}})},2535:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DeleteFilterListModal=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _delete_filter_lists=__webpack_require__(2536);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DeleteFilterListModal=exports.DeleteFilterListModal=function(_Component){_inherits(DeleteFilterListModal,_Component);function DeleteFilterListModal(props){_classCallCheck(this,DeleteFilterListModal);var _this=_possibleConstructorReturn(this,(DeleteFilterListModal.__proto__||Object.getPrototypeOf(DeleteFilterListModal)).call(this,props));_this.closeModal=function(){_this.setState({isModalVisible:false})};_this.showModal=function(){_this.setState({isModalVisible:true})};_this.onConfirmDelete=function(){_this.doDelete()};_this.state={isModalVisible:false};return _this}_createClass(DeleteFilterListModal,[{key:"doDelete",value:function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var _props,selectedFilterLists,refreshFilterLists;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_props=this.props,selectedFilterLists=_props.selectedFilterLists,refreshFilterLists=_props.refreshFilterLists;_context.next=3;return(0,_delete_filter_lists.deleteFilterLists)(selectedFilterLists);case 3:refreshFilterLists();this.closeModal();case 5:case"end":return _context.stop()}}},_callee,this)}));function doDelete(){return _ref.apply(this,arguments)}return doDelete}()},{key:"render",value:function render(){var _props2=this.props,selectedFilterLists=_props2.selectedFilterLists,canDeleteFilter=_props2.canDeleteFilter;var modal=void 0;if(this.state.isModalVisible){var title="Delete "+(selectedFilterLists.length>1?selectedFilterLists.length+" filter lists":selectedFilterLists[0].filter_id);modal=_react2.default.createElement(_eui.EuiOverlayMask,null,_react2.default.createElement(_eui.EuiConfirmModal,{title:title,className:"eui-textBreakWord",onCancel:this.closeModal,onConfirm:this.onConfirmDelete,cancelButtonText:"Cancel",confirmButtonText:"Delete",buttonColor:"danger",defaultFocusedButton:_eui.EUI_MODAL_CONFIRM_BUTTON},_react2.default.createElement("p",null,"Are you sure you want to delete ",selectedFilterLists.length>1?"these filter lists":"this filter list","?")))}return _react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiButton,{key:"delete_filter_list",iconType:"trash",color:"danger",onClick:this.showModal,isDisabled:selectedFilterLists===undefined||selectedFilterLists.length===0||canDeleteFilter===false},"Delete"),modal)}}]);return DeleteFilterListModal}(_react.Component);DeleteFilterListModal.propTypes={canDeleteFilter:_propTypes2.default.bool.isRequired,selectedFilterLists:_propTypes2.default.array}},2536:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.deleteFilterLists=undefined;var deleteFilterLists=exports.deleteFilterLists=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(filterListsToDelete){var messageId,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,filterList,filterId,errorMessage;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(filterListsToDelete===undefined||filterListsToDelete.length===0)){_context.next=2;break}return _context.abrupt("return");case 2:messageId=""+(filterListsToDelete.length>1?filterListsToDelete.length+" filter lists":filterListsToDelete[0].filter_id);_notify.toastNotifications.add("Deleting "+messageId);_iteratorNormalCompletion=true;_didIteratorError=false;_iteratorError=undefined;_context.prev=7;_iterator=filterListsToDelete[Symbol.iterator]();case 9:if(_iteratorNormalCompletion=(_step=_iterator.next()).done){_context.next=26;break}filterList=_step.value;filterId=filterList.filter_id;_context.prev=12;_context.next=15;return _ml_api_service.ml.filters.deleteFilter(filterId);case 15:_context.next=23;break;case 17:_context.prev=17;_context.t0=_context["catch"](12);console.log("Error deleting filter list:",_context.t0);errorMessage="An error occurred deleting filter list "+filterList.filter_id;if(_context.t0.message){errorMessage+=" : "+_context.t0.message}_notify.toastNotifications.addDanger(errorMessage);case 23:_iteratorNormalCompletion=true;_context.next=9;break;case 26:_context.next=32;break;case 28:_context.prev=28;_context.t1=_context["catch"](7);_didIteratorError=true;_iteratorError=_context.t1;case 32:_context.prev=32;_context.prev=33;if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}case 35:_context.prev=35;if(!_didIteratorError){_context.next=38;break}throw _iteratorError;case 38:return _context.finish(35);case 39:return _context.finish(32);case 40:_notify.toastNotifications.addSuccess(messageId+" deleted");case 41:case"end":return _context.stop()}}},_callee,this,[[7,28,32,40],[12,17],[33,,35,39]])}));return function deleteFilterLists(_x){return _ref.apply(this,arguments)}}();var _notify=__webpack_require__(10);var _ml_api_service=__webpack_require__(22);function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}},2537:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2538)},2538:function(module,exports,__webpack_require__){"use strict";__webpack_require__(53);var _react=__webpack_require__(3);var _modules=__webpack_require__(4);var _check_license=__webpack_require__(43);var _check_privilege=__webpack_require__(32);var _check_ml_nodes=__webpack_require__(47);var _new_job_defaults=__webpack_require__(241);var _index_utils=__webpack_require__(62);var _file_datavisualizer=__webpack_require__(2539);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml",["react"]);var template='<ml-nav-menu name="datavisualizer" /><file-datavisualizer-page />';_routes2.default.when("/filedatavisualizer/?",{template:template,resolve:{CheckLicense:_check_license.checkBasicLicense,privileges:_check_privilege.checkFindFileStructurePrivilege,indexPatterns:_index_utils.loadIndexPatterns,mlNodeCount:_check_ml_nodes.getMlNodeCount,loadNewJobDefaults:_new_job_defaults.loadNewJobDefaults}});_module.directive("fileDatavisualizerPage",function($injector){var reactDirective=$injector.get("reactDirective");var indexPatterns=$injector.get("indexPatterns");var kibanaConfig=$injector.get("config");return reactDirective((0,_react.injectI18nProvider)(_file_datavisualizer.FileDataVisualizerPage),undefined,{restrict:"E"},{indexPatterns:indexPatterns,kibanaConfig:kibanaConfig})})},2539:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FileDataVisualizerPage=FileDataVisualizerPage;var _file_datavisualizer_view=__webpack_require__(1021);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function FileDataVisualizerPage(_ref){var indexPatterns=_ref.indexPatterns,kibanaConfig=_ref.kibanaConfig;return _react2.default.createElement("div",{className:"file-datavisualizer-container"},_react2.default.createElement(_file_datavisualizer_view.FileDataVisualizerView,{indexPatterns:indexPatterns,kibanaConfig:kibanaConfig}))}},2540:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FileDataVisualizerView=exports.MODE=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(3);var _react2=__webpack_require__(0);var _react3=_interopRequireDefault(_react2);var _eui=__webpack_require__(2);var _lodash=__webpack_require__(1);var _ml_api_service=__webpack_require__(22);var _about_panel=__webpack_require__(2541);var _bottom_bar=__webpack_require__(2545);var _results_view=__webpack_require__(2547);var _file_error_callouts=__webpack_require__(2557);var _edit_flyout=__webpack_require__(2558);var _import_view=__webpack_require__(2564);var _file_datavisualizer=__webpack_require__(2583);var _utils=__webpack_require__(2584);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MODE=exports.MODE={READ:0,IMPORT:1};var UPLOAD_SIZE_MB=5;var FileDataVisualizerView=exports.FileDataVisualizerView=function(_Component){_inherits(FileDataVisualizerView,_Component);function FileDataVisualizerView(props){_classCallCheck(this,FileDataVisualizerView);var _this=_possibleConstructorReturn(this,(FileDataVisualizerView.__proto__||Object.getPrototypeOf(FileDataVisualizerView)).call(this,props));_this.onFilePickerChange=function(files){_this.overrides={};_this.setState({loading:files.length>0,bottomBarVisible:files.length>0,loaded:false,fileContents:"",fileSize:0,fileTooLarge:false,fileCouldNotBeRead:false,serverErrorMessage:"",results:undefined},function(){if(files.length){_this.loadFile(files[0])}})};_this.closeEditFlyout=function(){_this.setState({isEditFlyoutVisible:false});_this.showBottomBar()};_this.showEditFlyout=function(){_this.setState({isEditFlyoutVisible:true});_this.hideBottomBar()};_this.showBottomBar=function(){_this.setState({bottomBarVisible:true})};_this.hideBottomBar=function(){_this.setState({bottomBarVisible:false})};_this.setOverrides=function(overrides){console.log("setOverrides",overrides);_this.setState({loading:true,loaded:false},function(){var formattedOverrides=(0,_utils.createUrlOverrides)(overrides,_this.originalSettings);_this.loadSettings(_this.state.fileContents,formattedOverrides)})};_this.changeMode=function(mode){_this.setState({mode:mode})};_this.onCancel=function(){_this.changeMode(MODE.READ);_this.onFilePickerChange([])};_this.state={files:{},fileContents:"",fileSize:0,fileTooLarge:false,fileCouldNotBeRead:false,serverErrorMessage:"",loading:false,loaded:false,results:undefined,mode:MODE.READ,isEditFlyoutVisible:false,bottomBarVisible:false};_this.overrides={};_this.previousOverrides={};_this.originalSettings={};return _this}_createClass(FileDataVisualizerView,[{key:"loadFile",value:function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(file){var fileContents,data;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(file.size<=_file_datavisualizer.MAX_BYTES)){_context.next=17;break}_context.prev=1;_context.next=4;return(0,_utils.readFile)(file);case 4:fileContents=_context.sent;data=fileContents.data;this.setState({fileContents:data,fileSize:file.size});_context.next=9;return this.loadSettings(data);case 9:_context.next=15;break;case 11:_context.prev=11;_context.t0=_context["catch"](1);console.error(_context.t0);this.setState({loaded:false,loading:false,fileCouldNotBeRead:true});case 15:_context.next=18;break;case 17:this.setState({loaded:false,loading:false,fileTooLarge:true,fileSize:file.size});case 18:case"end":return _context.stop()}}},_callee,this,[[1,11]])}));function loadFile(_x){return _ref.apply(this,arguments)}return loadFile}()},{key:"loadSettings",value:function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(data,overrides){var _this2=this;var isRetry=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var lessData,analyzeFile,resp,serverSettings,serverOverrides;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;lessData=(0,_utils.reduceData)(data,UPLOAD_SIZE_MB);console.log("overrides",overrides);analyzeFile=_ml_api_service.ml.fileDatavisualizer.analyzeFile;_context2.next=6;return analyzeFile(lessData,overrides);case 6:resp=_context2.sent;serverSettings=(0,_utils.processResults)(resp.results);serverOverrides=resp.overrides;this.previousOverrides=this.overrides;this.overrides={};if(!(serverSettings.format==="xml")){_context2.next=13;break}throw{message:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.fileDatavisualizerView.xmlNotCurrentlySupportedErrorMessage",defaultMessage:"XML not currently supported"})};case 13:if(serverOverrides===undefined){this.originalSettings=serverSettings}else{Object.keys(serverOverrides).forEach(function(o){var camelCaseO=o.replace(/_\w/g,function(m){return m[1].toUpperCase()});_this2.overrides[camelCaseO]=serverOverrides[o]});Object.keys(serverSettings).forEach(function(o){var value=serverSettings[o];if(_this2.overrides[o]===undefined&&(Array.isArray(value)&&(0,_lodash.isEqual)(value,_this2.originalSettings[o])===false||value!==_this2.originalSettings[o])){_this2.originalSettings[o]=value}})}this.setState({results:resp.results,loaded:true,loading:false,fileCouldNotBeRead:isRetry});_context2.next=22;break;case 17:_context2.prev=17;_context2.t0=_context2["catch"](0);console.error(_context2.t0);this.setState({results:undefined,loaded:false,loading:false,fileCouldNotBeRead:true,serverErrorMessage:_context2.t0.message});if(overrides!==undefined&&(0,_lodash.isEqual)(this.previousOverrides,overrides)===false){this.setState({loading:true,loaded:false});this.loadSettings(data,this.previousOverrides,true)}case 22:case"end":return _context2.stop()}}},_callee2,this,[[0,17]])}));function loadSettings(_x3,_x4){return _ref2.apply(this,arguments)}return loadSettings}()},{key:"render",value:function render(){var _this3=this;var _state=this.state,loading=_state.loading,loaded=_state.loaded,results=_state.results,fileContents=_state.fileContents,fileSize=_state.fileSize,fileTooLarge=_state.fileTooLarge,fileCouldNotBeRead=_state.fileCouldNotBeRead,serverErrorMessage=_state.serverErrorMessage,mode=_state.mode,isEditFlyoutVisible=_state.isEditFlyoutVisible,bottomBarVisible=_state.bottomBarVisible;var fields=results!==undefined&&results.field_stats!==undefined?Object.keys(results.field_stats):[];return _react3.default.createElement(_react3.default.Fragment,null,mode===MODE.READ&&_react3.default.createElement(_react3.default.Fragment,null,!loading&&!loaded&&_react3.default.createElement(_about_panel.AboutPanel,{onFilePickerChange:this.onFilePickerChange}),loading&&_react3.default.createElement(_about_panel.LoadingPanel,null),fileTooLarge&&_react3.default.createElement(_file_error_callouts.FileTooLarge,{fileSize:fileSize,maxFileSize:_file_datavisualizer.MAX_BYTES}),fileCouldNotBeRead&&loading===false&&_react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_file_error_callouts.FileCouldNotBeRead,{error:serverErrorMessage,loaded:loaded}),_react3.default.createElement(_eui.EuiSpacer,{size:"l"})),loaded&&_react3.default.createElement(_results_view.ResultsView,{results:results,data:fileContents,showEditFlyout:function showEditFlyout(){return _this3.showEditFlyout()}}),_react3.default.createElement(_edit_flyout.EditFlyout,{setOverrides:this.setOverrides,closeEditFlyout:this.closeEditFlyout,isFlyoutVisible:isEditFlyoutVisible,originalSettings:this.originalSettings,overrides:this.overrides,fields:fields}),_react3.default.createElement(_bottom_bar.BottomBar,{showBar:bottomBarVisible&&loaded,mode:MODE.READ,changeMode:this.changeMode,onCancel:this.onCancel}),_react3.default.createElement(BottomPadding,null)),mode===MODE.IMPORT&&_react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_import_view.ImportView,{results:results,fileContents:fileContents,fileSize:fileSize,indexPatterns:this.props.indexPatterns,kibanaConfig:this.props.kibanaConfig,showBottomBar:this.showBottomBar,hideBottomBar:this.hideBottomBar}),_react3.default.createElement(_bottom_bar.BottomBar,{showBar:bottomBarVisible,mode:MODE.IMPORT,changeMode:this.changeMode,onCancel:this.onCancel}),_react3.default.createElement(BottomPadding,null)))}}]);return FileDataVisualizerView}(_react2.Component);function BottomPadding(){return _react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiSpacer,{size:"m"}),_react3.default.createElement(_eui.EuiSpacer,{size:"l"}),_react3.default.createElement(_eui.EuiSpacer,{size:"l"}))}},2541:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _about_panel=__webpack_require__(2542);Object.defineProperty(exports,"AboutPanel",{enumerable:true,get:function get(){return _about_panel.AboutPanel}});Object.defineProperty(exports,"LoadingPanel",{enumerable:true,get:function get(){return _about_panel.LoadingPanel}})},2542:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AboutPanel=undefined;exports.LoadingPanel=LoadingPanel;var _react=__webpack_require__(3);var _react2=__webpack_require__(0);var _react3=_interopRequireDefault(_react2);var _eui=__webpack_require__(2);var _welcome_content=__webpack_require__(2543);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var AboutPanel=exports.AboutPanel=(0,_react.injectI18n)(function AboutPanel(_ref){var onFilePickerChange=_ref.onFilePickerChange,intl=_ref.intl;return _react3.default.createElement(_eui.EuiPage,{restrictWidth:1e3},_react3.default.createElement(_eui.EuiPageBody,null,_react3.default.createElement(_eui.EuiFlexGroup,{gutterSize:"xl"},_react3.default.createElement(_eui.EuiFlexItem,{grow:true},_react3.default.createElement(_eui.EuiPanel,{paddingSize:"l"},_react3.default.createElement(_welcome_content.WelcomeContent,null),_react3.default.createElement(_eui.EuiHorizontalRule,{margin:"l"}),_react3.default.createElement("div",{style:{textAlign:"center"}},_react3.default.createElement(_eui.EuiFilePicker,{id:"filePicker",initialPromptText:intl.formatMessage({id:"xpack.ml.fileDatavisualizer.aboutPanel.selectOrDragAndDropFileDescription",defaultMessage:"Select or drag and drop a file"}),onChange:function onChange(files){return onFilePickerChange(files)},className:"file-datavisualizer-file-picker"}))),_react3.default.createElement(_eui.EuiSpacer,{size:"l"})))))});function LoadingPanel(){return _react3.default.createElement(_eui.EuiPage,{restrictWidth:400},_react3.default.createElement(_eui.EuiPageBody,null,_react3.default.createElement(_eui.EuiFlexGroup,{gutterSize:"xl"},_react3.default.createElement(_eui.EuiFlexItem,{grow:false},_react3.default.createElement(_eui.EuiPanel,{paddingSize:"l",style:{textAlign:"center"}},_react3.default.createElement(_eui.EuiTitle,{size:"s"},_react3.default.createElement("h3",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.aboutPanel.analyzingDataTitle",defaultMessage:"Analyzing data"}))),_react3.default.createElement(_eui.EuiSpacer,{size:"l"}),_react3.default.createElement(_eui.EuiLoadingSpinner,{size:"xl"}))))))}},2543:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.WelcomeContent=WelcomeContent;var _react=__webpack_require__(3);var _react2=__webpack_require__(0);var _react3=_interopRequireDefault(_react2);var _eui=__webpack_require__(2);var _experimental_badge=__webpack_require__(1022);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function WelcomeContent(){return _react3.default.createElement(_eui.EuiFlexGroup,{gutterSize:"xl",alignItems:"center"},_react3.default.createElement(_eui.EuiFlexItem,{grow:false},_react3.default.createElement(_eui.EuiIcon,{size:"xxl",type:"addDataApp",className:"file-datavisualizer-about-panel__icon"})),_react3.default.createElement(_eui.EuiFlexItem,null,_react3.default.createElement(_eui.EuiTitle,{size:"m"},_react3.default.createElement("h3",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.welcomeContent.visualizeDataFromLogFileTitle",defaultMessage:"Visualize data from a log file {experimentalBadge}",values:{experimentalBadge:_react3.default.createElement(_experimental_badge.ExperimentalBadge,{tooltipContent:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.welcomeContent.experimentalFeatureTooltip",defaultMessage:"Experimental feature. We'd love to hear your feedback."})})}}))),_react3.default.createElement(_eui.EuiSpacer,{size:"s"}),_react3.default.createElement(_eui.EuiText,null,_react3.default.createElement("p",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.welcomeContent.visualizeDataFromLogFileDescription",defaultMessage:"The File Data Visualizer helps you understand the fields and metrics in a log file. Upload your file, analyze its data, and then choose whether to import the data into an Elasticsearch index."}))),_react3.default.createElement(_eui.EuiSpacer,{size:"s"}),_react3.default.createElement(_eui.EuiText,null,_react3.default.createElement("p",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.welcomeContent.supportedFileFormatDescription",defaultMessage:"The File Data Visualizer supports these file formats:"}))),_react3.default.createElement(_eui.EuiSpacer,{size:"m"}),_react3.default.createElement(_eui.EuiFlexGroup,{gutterSize:"l"},_react3.default.createElement(_eui.EuiFlexItem,{grow:false,className:"file-datavisualizer-about-panel__doc-icon"},_react3.default.createElement(_eui.EuiIcon,{size:"m",type:"document"})),_react3.default.createElement(_eui.EuiFlexItem,null,_react3.default.createElement(_eui.EuiText,null,_react3.default.createElement("p",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.welcomeContent.delimitedTextFilesDescription",defaultMessage:"Delimited text files, such as CSV and TSV"}))))),_react3.default.createElement(_eui.EuiSpacer,{size:"s"}),_react3.default.createElement(_eui.EuiFlexGroup,{gutterSize:"l"},_react3.default.createElement(_eui.EuiFlexItem,{grow:false,className:"file-datavisualizer-about-panel__doc-icon"},_react3.default.createElement(_eui.EuiIcon,{size:"m",type:"document"})),_react3.default.createElement(_eui.EuiFlexItem,null,_react3.default.createElement(_eui.EuiText,null,_react3.default.createElement("p",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.welcomeContent.newlineDelimitedJsonDescription",defaultMessage:"Newline-delimited JSON"}))))),_react3.default.createElement(_eui.EuiSpacer,{size:"s"}),_react3.default.createElement(_eui.EuiFlexGroup,{gutterSize:"l"},_react3.default.createElement(_eui.EuiFlexItem,{grow:false,className:"file-datavisualizer-about-panel__doc-icon"},_react3.default.createElement(_eui.EuiIcon,{size:"m",type:"document"})),_react3.default.createElement(_eui.EuiFlexItem,null,_react3.default.createElement(_eui.EuiText,null,_react3.default.createElement("p",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.welcomeContent.logFilesWithCommonFormatDescription",defaultMessage:"Log files with a common format for the timestamp"}))))),_react3.default.createElement(_eui.EuiSpacer,{size:"m"}),_react3.default.createElement(_eui.EuiText,null,_react3.default.createElement("p",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.welcomeContent.uploadedFilesAllowedSizeDescription",defaultMessage:"You can upload files up to 100 MB."}))),_react3.default.createElement(_eui.EuiSpacer,{size:"s"}),_react3.default.createElement(_eui.EuiText,null,_react3.default.createElement("p",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.welcomeContent.experimentalFeatureDescription",defaultMessage:"This feature is experimental. Got feedback? Please create an issue in {githubLink}.",values:{githubLink:_react3.default.createElement(_eui.EuiLink,{href:"https://github.com/elastic/kibana/issues/new",target:"_blank"},"GitHub")}})))))}},2544:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ExperimentalBadge=ExperimentalBadge;var _react=__webpack_require__(3);var _react2=__webpack_require__(0);var _react3=_interopRequireDefault(_react2);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ExperimentalBadge(_ref){var tooltipContent=_ref.tooltipContent;return _react3.default.createElement("span",null,_react3.default.createElement(_eui.EuiBetaBadge,{className:"ml-experimental-badge",label:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.experimentalBadge.experimentalLabel",defaultMessage:"Experimental"}),tooltipContent:tooltipContent}))}},2545:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _bottom_bar=__webpack_require__(2546);Object.defineProperty(exports,"BottomBar",{enumerable:true,get:function get(){return _bottom_bar.BottomBar}})},2546:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.BottomBar=BottomBar;var _react=__webpack_require__(3);var _react2=__webpack_require__(0);var _react3=_interopRequireDefault(_react2);var _eui=__webpack_require__(2);var _file_datavisualizer_view=__webpack_require__(1021);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function BottomBar(_ref){var showBar=_ref.showBar,mode=_ref.mode,changeMode=_ref.changeMode,onCancel=_ref.onCancel;if(showBar){if(mode===_file_datavisualizer_view.MODE.READ){return _react3.default.createElement(_eui.EuiBottomBar,null,_react3.default.createElement(_eui.EuiFlexGroup,null,_react3.default.createElement(_eui.EuiFlexItem,{grow:false},_react3.default.createElement(_eui.EuiButton,{fill:true,onClick:function onClick(){return changeMode(_file_datavisualizer_view.MODE.IMPORT)}},_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.bottomBar.readMode.importButtonLabel",defaultMessage:"Import"}))),_react3.default.createElement(_eui.EuiFlexItem,{grow:false},_react3.default.createElement(_eui.EuiButtonEmpty,{color:"ghost",onClick:function onClick(){return onCancel()}},_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.bottomBar.readMode.cancelButtonLabel",defaultMessage:"Cancel"})))))}else{return _react3.default.createElement(_eui.EuiBottomBar,null,_react3.default.createElement(_eui.EuiFlexGroup,null,_react3.default.createElement(_eui.EuiFlexItem,{grow:false},_react3.default.createElement(_eui.EuiButton,{color:"ghost",onClick:function onClick(){return changeMode(_file_datavisualizer_view.MODE.READ)}},_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.bottomBar.backButtonLabel",defaultMessage:"Back"}))),_react3.default.createElement(_eui.EuiFlexItem,{grow:false},_react3.default.createElement(_eui.EuiButtonEmpty,{color:"ghost",onClick:function onClick(){return onCancel()}},_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.bottomBar.cancelButtonLabel",defaultMessage:"Cancel"})))))}}return null}},2547:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _results_view=__webpack_require__(2548);Object.defineProperty(exports,"ResultsView",{enumerable:true,get:function get(){return _results_view.ResultsView}})},2548:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ResultsView=undefined;var _react=__webpack_require__(3);var _react2=__webpack_require__(0);var _react3=_interopRequireDefault(_react2);var _eui=__webpack_require__(2);var _file_contents=__webpack_require__(2549);var _analysis_summary=__webpack_require__(2551);var _fields_stats=__webpack_require__(2553);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ResultsView=exports.ResultsView=(0,_react.injectI18n)(function(_ref){var data=_ref.data,results=_ref.results,showEditFlyout=_ref.showEditFlyout,intl=_ref.intl;console.log(results);var tabs=[{id:"file-stats",name:intl.formatMessage({id:"xpack.ml.fileDatavisualizer.resultsView.fileStatsTabName",defaultMessage:"File stats"}),content:_react3.default.createElement(_fields_stats.FieldsStats,{results:results})}];return _react3.default.createElement("div",{className:"results"},_react3.default.createElement(_eui.EuiPanel,null,_react3.default.createElement(_file_contents.FileContents,{data:data,format:results.format,numberOfLines:results.num_lines_analyzed})),_react3.default.createElement(_eui.EuiSpacer,{size:"m"}),_react3.default.createElement(_eui.EuiPanel,null,_react3.default.createElement(_analysis_summary.AnalysisSummary,{results:results}),_react3.default.createElement(_eui.EuiSpacer,{size:"m"}),_react3.default.createElement(_eui.EuiButton,{onClick:function onClick(){return showEditFlyout()}},_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.resultsView.overrideSettingsButtonLabel",defaultMessage:"Override settings"}))),_react3.default.createElement(_eui.EuiSpacer,{size:"m"}),_react3.default.createElement(_eui.EuiPanel,null,_react3.default.createElement(_eui.EuiTabbedContent,{tabs:tabs,initialSelectedTab:tabs[0],onTabClick:function onTabClick(){}})))})},2549:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _file_contents=__webpack_require__(2550);Object.defineProperty(exports,"FileContents",{enumerable:true,get:function get(){return _file_contents.FileContents}})},2550:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FileContents=FileContents;var _react=__webpack_require__(3);var _react2=__webpack_require__(0);var _react3=_interopRequireDefault(_react2);var _eui=__webpack_require__(2);var _ml_job_editor=__webpack_require__(403);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function FileContents(_ref){var data=_ref.data,format=_ref.format,numberOfLines=_ref.numberOfLines;var mode=_ml_job_editor.EDITOR_MODE.TEXT;if(format===_ml_job_editor.EDITOR_MODE.JSON){mode=_ml_job_editor.EDITOR_MODE.JSON}var formattedData=limitByNumberOfLines(data,numberOfLines);return _react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiTitle,{size:"s"},_react3.default.createElement("h3",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.fileContents.fileContentsTitle",defaultMessage:"File contents"}))),_react3.default.createElement("div",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.fileContents.firstLinesDescription",defaultMessage:"First {numberOfLines, plural, zero {# line} one {# line} other {# lines}}",values:{numberOfLines:numberOfLines}})),_react3.default.createElement(_eui.EuiSpacer,{size:"s"}),_react3.default.createElement(_ml_job_editor.MLJobEditor,{mode:mode,readOnly:true,value:formattedData,height:"200px",syntaxChecking:false}))}function limitByNumberOfLines(data,numberOfLines){return data.split("\n").slice(0,numberOfLines).join("\n")}},2551:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _analysis_summary=__webpack_require__(2552);Object.defineProperty(exports,"AnalysisSummary",{enumerable:true,get:function get(){return _analysis_summary.AnalysisSummary}})},2552:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AnalysisSummary=AnalysisSummary;var _react=__webpack_require__(3);var _react2=__webpack_require__(0);var _react3=_interopRequireDefault(_react2);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function AnalysisSummary(_ref){var results=_ref.results;var items=createDisplayItems(results);return _react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiTitle,{size:"s"},_react3.default.createElement("h3",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.analysisSummary.summaryTitle",defaultMessage:"Summary"}))),_react3.default.createElement(_eui.EuiSpacer,{size:"m"}),_react3.default.createElement(_eui.EuiDescriptionList,{type:"column",listItems:items,className:"analysis-summary-list"}))}function createDisplayItems(results){var items=[{title:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.analysisSummary.analyzedLinesNumberTitle",defaultMessage:"Number of lines analyzed"}),description:results.num_lines_analyzed}];if(results.format!==undefined){items.push({title:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.analysisSummary.formatTitle",defaultMessage:"Format"}),description:results.format});if(results.format==="delimited"){items.push({title:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.analysisSummary.delimiterTitle",defaultMessage:"Delimiter"}),description:results.delimiter});items.push({title:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.analysisSummary.hasHeaderRowTitle",defaultMessage:"Has header row"}),description:""+results.has_header_row})}}if(results.grok_pattern!==undefined){items.push({title:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.analysisSummary.grokPatternTitle",defaultMessage:"Grok pattern"}),description:results.grok_pattern})}if(results.timestamp_field!==undefined){items.push({title:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.analysisSummary.timeFieldTitle",defaultMessage:"Time field"}),description:results.timestamp_field})}if(results.joda_timestamp_formats!==undefined){items.push({title:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.analysisSummary.timeFormatTitle",defaultMessage:"Time {timestampFormats, plural, zero {format} one {format} other {formats}}",values:{timestampFormats:results.joda_timestamp_formats.length}}),description:results.joda_timestamp_formats.join(", ")})}return items}},2553:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _fields_stats=__webpack_require__(2554);Object.defineProperty(exports,"FieldsStats",{enumerable:true,get:function get(){return _fields_stats.FieldsStats}})},2554:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FieldsStats=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _field_stats_card=__webpack_require__(2555);var _get_field_names=__webpack_require__(2556);var _field_types=__webpack_require__(257);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var FieldsStats=exports.FieldsStats=function(_Component){_inherits(FieldsStats,_Component);function FieldsStats(props){_classCallCheck(this,FieldsStats);var _this=_possibleConstructorReturn(this,(FieldsStats.__proto__||Object.getPrototypeOf(FieldsStats)).call(this,props));_this.state={fields:[]};return _this}_createClass(FieldsStats,[{key:"componentDidMount",value:function componentDidMount(){this.setState({fields:createFields(this.props.results)})}},{key:"render",value:function render(){return _react2.default.createElement("div",{className:"fields-stats"},this.state.fields.map(function(f){return _react2.default.createElement(_field_stats_card.FieldStatsCard,{field:f,key:f.name})}))}}]);return FieldsStats}(_react.Component);function createFields(results){var mappings=results.mappings,fieldStats=results.field_stats,numMessagesAnalyzed=results.num_messages_analyzed,timestampField=results.timestamp_field;if(mappings&&fieldStats){var fieldNames=(0,_get_field_names.getFieldNames)(results);return fieldNames.map(function(name){if(fieldStats[name]!==undefined){var field={name:name};var f=fieldStats[name];var m=mappings[name];if(name===timestampField&&field.type===undefined){field.type=_field_types.ML_JOB_FIELD_TYPES.DATE}if(f!==undefined){Object.assign(field,f)}if(m!==undefined){field.type=m.type;if(m.format!==undefined){field.format=m.format}}field.percent=field.count/numMessagesAnalyzed*100;return field}else{var type=mappings[name]&&mappings[name].type===_field_types.ML_JOB_FIELD_TYPES.TEXT?_field_types.ML_JOB_FIELD_TYPES.TEXT:_field_types.ML_JOB_FIELD_TYPES.UNKNOWN;return{name:name,type:type,mean_value:0,count:0,cardinality:0,percent:0}}})}return[]}},2555:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FieldStatsCard=FieldStatsCard;var _react=__webpack_require__(3);var _react2=__webpack_require__(0);var _react3=_interopRequireDefault(_react2);var _eui=__webpack_require__(2);var _field_type_icon=__webpack_require__(274);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function FieldStatsCard(_ref){var field=_ref.field;var percent=Math.round(field.percent*100)/100;var type=field.type;if(type==="double"||type==="long"){type="number"}return _react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement("div",{className:"card-container"},_react3.default.createElement("div",{className:"ml-field-data-card"},_react3.default.createElement("div",{className:"ml-field-title-bar "+type},_react3.default.createElement(_field_type_icon.FieldTypeIcon,{type:type}),_react3.default.createElement("div",{className:"field-name"},field.name)),_react3.default.createElement("div",{className:"card-contents"},field.count>0&&_react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement("div",{className:"stats"},_react3.default.createElement("div",{className:"stat"},_react3.default.createElement("i",{className:"fa fa-files-o","aria-hidden":"true"}),_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.fieldStatsCard.documentsCountDescription",defaultMessage:"{fieldCount, plural, zero {# document} one {# document} other {# documents}} ({fieldPercent}%)",values:{fieldCount:field.count,fieldPercent:percent}})),_react3.default.createElement("div",{className:"stat"},_react3.default.createElement("i",{className:"fa fa-cubes","aria-hidden":"true"}),_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.fieldStatsCard.distinctCountDescription",defaultMessage:"{fieldCardinality} distinct {fieldCardinality, plural, zero {value} one {value} other {values}}",values:{fieldCardinality:field.cardinality}})),field.mean_value&&_react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement("div",null,_react3.default.createElement("div",{className:"stat min heading"},_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.fieldStatsCard.minTitle",defaultMessage:"min"})),_react3.default.createElement("div",{className:"stat median heading"},_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.fieldStatsCard.medianTitle",defaultMessage:"median"})),_react3.default.createElement("div",{className:"stat max heading"},_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.fieldStatsCard.maxTitle",defaultMessage:"max"}))),_react3.default.createElement("div",null,_react3.default.createElement("div",{className:"stat min heading"},field.min_value),_react3.default.createElement("div",{className:"stat median heading"},field.median_value),_react3.default.createElement("div",{className:"stat max heading"},field.max_value)))),field.top_hits&&_react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiSpacer,{size:"s"}),_react3.default.createElement("div",{className:"stats"},_react3.default.createElement("div",{className:"stat"},_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.fieldStatsCard.topStatsValuesDescription",defaultMessage:"top values"})),field.top_hits.map(function(_ref2){var count=_ref2.count,value=_ref2.value;var pcnt=Math.round(count/field.count*100*100)/100;return _react3.default.createElement("div",{key:value,className:"top-value"},_react3.default.createElement("div",{className:"field-label"},value," "),_react3.default.createElement("div",{className:"top-value-bar-holder"},_react3.default.createElement("div",{className:"top-value-bar "+type,style:{width:pcnt+"%"}})),_react3.default.createElement("div",{className:"count-label"},pcnt,"%"))})))),field.count===0&&_react3.default.createElement("div",{className:"stats"},_react3.default.createElement("div",{className:"stat"},_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.fieldStatsCard.noFieldInformationAvailableDescription",defaultMessage:"No field information available"})))))))}},2556:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getFieldNames=getFieldNames;var _lodash=__webpack_require__(1);function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function getFieldNames(results){var mappings=results.mappings,fieldStats=results.field_stats,columnNames=results.column_names;var tempFields=columnNames!==undefined?columnNames:Object.keys(fieldStats);var differenceFields=(0,_lodash.difference)(Object.keys(mappings),tempFields);var timestampIndex=differenceFields.indexOf("@timestamp");if(timestampIndex!==-1){differenceFields.splice(timestampIndex,1)}if(differenceFields.length){tempFields.push.apply(tempFields,_toConsumableArray(differenceFields))}return tempFields}},2557:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FileTooLarge=FileTooLarge;exports.FileCouldNotBeRead=FileCouldNotBeRead;var _react=__webpack_require__(3);var _react2=__webpack_require__(0);var _react3=_interopRequireDefault(_react2);var _eui=__webpack_require__(2);var _numeral=__webpack_require__(212);var _numeral2=_interopRequireDefault(_numeral);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var FILE_SIZE_DISPLAY_FORMAT="0,0.[0] b";function FileTooLarge(_ref){var fileSize=_ref.fileSize,maxFileSize=_ref.maxFileSize;var fileSizeFormatted=(0,_numeral2.default)(fileSize).format(FILE_SIZE_DISPLAY_FORMAT);var maxFileSizeFormatted=(0,_numeral2.default)(maxFileSize).format(FILE_SIZE_DISPLAY_FORMAT);var errorText=void 0;if(fileSizeFormatted!==maxFileSizeFormatted){errorText=_react3.default.createElement("p",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.fileErrorCallouts.fileSizeExceedsAllowedSizeErrorMessage",defaultMessage:"The size of the file you selected for upload is {fileSizeFormatted} which exceeds the maximum permitted size of {maxFileSizeFormatted}",values:{fileSizeFormatted:fileSizeFormatted,maxFileSizeFormatted:maxFileSizeFormatted}}))}else{var diffFormatted=(0,_numeral2.default)(fileSize-maxFileSize).format(FILE_SIZE_DISPLAY_FORMAT);errorText=_react3.default.createElement("p",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.fileErrorCallouts.fileSizeExceedsAllowedSizeByDiffFormatErrorMessage",defaultMessage:"The size of the file you selected for upload exceeds the maximum permitted size of {maxFileSizeFormatted} by {diffFormatted}",values:{maxFileSizeFormatted:maxFileSizeFormatted,diffFormatted:diffFormatted}}))}return _react3.default.createElement(_eui.EuiCallOut,{title:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.fileErrorCallouts.fileSizeTooLargeTitle",defaultMessage:"File size is too large"}),color:"danger",iconType:"cross"},errorText)}function FileCouldNotBeRead(_ref2){var error=_ref2.error,loaded=_ref2.loaded;return _react3.default.createElement(_eui.EuiCallOut,{title:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.fileErrorCallouts.fileCouldNotBeReadTitle",defaultMessage:"File could not be read"}),color:"danger",iconType:"cross"},error!==undefined&&_react3.default.createElement("p",null,error),loaded&&_react3.default.createElement("p",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.fileErrorCallouts.revertingToPreviousSettingsDescription",defaultMessage:"Reverting to previous settings"})))}},2558:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _edit_flyout=__webpack_require__(2559);Object.defineProperty(exports,"EditFlyout",{enumerable:true,get:function get(){return _edit_flyout.EditFlyout}})},2559:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EditFlyout=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(3);var _react2=__webpack_require__(0);var _react3=_interopRequireDefault(_react2);var _eui=__webpack_require__(2);var _overrides=__webpack_require__(2560);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var EditFlyout=exports.EditFlyout=function(_Component){_inherits(EditFlyout,_Component);function EditFlyout(props){_classCallCheck(this,EditFlyout);var _this=_possibleConstructorReturn(this,(EditFlyout.__proto__||Object.getPrototypeOf(EditFlyout)).call(this,props));_this.applyAndClose=function(){_this.applyOverrides();_this.props.closeEditFlyout()};_this.setApplyOverrides=function(applyOverrides){_this.applyOverrides=applyOverrides};_this.unsetApplyOverrides=function(){_this.applyOverrides=function(){}};_this.applyOverrides=function(){};return _this}_createClass(EditFlyout,[{key:"render",value:function render(){var _props=this.props,isFlyoutVisible=_props.isFlyoutVisible,closeEditFlyout=_props.closeEditFlyout;var _props2=this.props,setOverrides=_props2.setOverrides,overrides=_props2.overrides,originalSettings=_props2.originalSettings,fields=_props2.fields;return _react3.default.createElement(_react3.default.Fragment,null,isFlyoutVisible&&_react3.default.createElement(_eui.EuiFlyout,{onClose:closeEditFlyout,size:"m"},_react3.default.createElement(_eui.EuiFlyoutHeader,null,_react3.default.createElement(_eui.EuiTitle,null,_react3.default.createElement("h2",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.editFlyout.overrideSettingsTitle",defaultMessage:"Override settings"})))),_react3.default.createElement(_eui.EuiFlyoutBody,null,_react3.default.createElement(_overrides.Overrides,{setOverrides:setOverrides,overrides:overrides,originalSettings:originalSettings,setApplyOverrides:this.setApplyOverrides,fields:fields})),_react3.default.createElement(_eui.EuiFlyoutFooter,null,_react3.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceBetween"},_react3.default.createElement(_eui.EuiFlexItem,{grow:false},_react3.default.createElement(_eui.EuiButtonEmpty,{iconType:"cross",onClick:closeEditFlyout,flush:"left"},_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.editFlyout.closeOverrideSettingsButtonLabel",defaultMessage:"Close"}))),_react3.default.createElement(_eui.EuiFlexItem,{grow:false},_react3.default.createElement(_eui.EuiButton,{onClick:this.applyAndClose,fill:true},_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.editFlyout.applyOverrideSettingsButtonLabel",defaultMessage:"Apply"})))))))}}]);return EditFlyout}(_react2.Component)},256:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.aggregationTypeTransform=undefined;exports.getSeverity=getSeverity;exports.getSeverityWithLow=getSeverityWithLow;exports.getSeverityColor=getSeverityColor;exports.getMultiBucketImpactLabel=getMultiBucketImpactLabel;exports.getEntityFieldName=getEntityFieldName;exports.getEntityFieldValue=getEntityFieldValue;exports.showActualForFunction=showActualForFunction;exports.showTypicalForFunction=showTypicalForFunction;exports.isRuleSupported=isRuleSupported;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _detector_rule=__webpack_require__(298);var _multi_bucket_impact=__webpack_require__(634);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var DISPLAY_ACTUAL_FUNCTIONS=["count","distinct_count","lat_long","mean","max","min","sum","median","varp","info_content","time"];var DISPLAY_TYPICAL_FUNCTIONS=["count","distinct_count","lat_long","mean","max","min","sum","median","varp","info_content","time"];function getSeverity(normalizedScore){if(normalizedScore>=75){return"critical"}else if(normalizedScore>=50){return"major"}else if(normalizedScore>=25){return"minor"}else if(normalizedScore>=0){return"warning"}else{return"unknown"}}function getSeverityWithLow(normalizedScore){if(normalizedScore>=75){return"critical"}else if(normalizedScore>=50){return"major"}else if(normalizedScore>=25){return"minor"}else if(normalizedScore>=3){return"warning"}else if(normalizedScore>=0){return"low"}else{return"unknown"}}function getSeverityColor(normalizedScore){if(normalizedScore>=75){return"#fe5050"}else if(normalizedScore>=50){return"#fba740"}else if(normalizedScore>=25){return"#fdec25"}else if(normalizedScore>=3){return"#8bc8fb"}else if(normalizedScore>=0){return"#d2e9f7"}else{return"#ffffff"}}function getMultiBucketImpactLabel(multiBucketImpact){if(multiBucketImpact>=_multi_bucket_impact.MULTI_BUCKET_IMPACT.HIGH){return"high"}else if(multiBucketImpact>=_multi_bucket_impact.MULTI_BUCKET_IMPACT.MEDIUM){return"medium"}else if(multiBucketImpact>=_multi_bucket_impact.MULTI_BUCKET_IMPACT.LOW){return"low"}else{return"none"}}function getEntityFieldName(record){if(_lodash2.default.has(record,"by_field_name")&&_lodash2.default.has(record,"by_field_value")){return record.by_field_name}if(_lodash2.default.has(record,"over_field_name")){return record.over_field_name}if(_lodash2.default.has(record,"partition_field_name")){return record.partition_field_name}return undefined}function getEntityFieldValue(record){if(_lodash2.default.has(record,"by_field_value")){return record.by_field_value}if(_lodash2.default.has(record,"over_field_value")){return record.over_field_value}if(_lodash2.default.has(record,"partition_field_value")){return record.partition_field_value}return undefined}function showActualForFunction(functionDescription){return _lodash2.default.indexOf(DISPLAY_ACTUAL_FUNCTIONS,functionDescription)>-1}function showTypicalForFunction(functionDescription){return _lodash2.default.indexOf(DISPLAY_TYPICAL_FUNCTIONS,functionDescription)>-1}function isRuleSupported(record){return _detector_rule.CONDITIONS_NOT_SUPPORTED_FUNCTIONS.indexOf(record.function)===-1||getEntityFieldName(record)!==undefined}var aggregationTypeTransform=exports.aggregationTypeTransform={toES:function toES(oldAggType){var newAggType=oldAggType;if(newAggType==="mean"){newAggType="avg"}else if(newAggType==="distinct_count"){newAggType="cardinality"}else if(newAggType==="median"){newAggType="percentiles"}return newAggType},toML:function toML(oldAggType){var newAggType=oldAggType;if(newAggType==="avg"){newAggType="mean"}else if(newAggType==="cardinality"){newAggType="distinct_count"}else if(newAggType==="percentiles"){newAggType="median"}return newAggType}}},2560:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Overrides=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(3);var _react2=__webpack_require__(0);var _react3=_interopRequireDefault(_react2);var _eui=__webpack_require__(2);var _options=__webpack_require__(2561);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var formatOptions=(0,_options.getFormatOptions)();var timestampFormatOptions=(0,_options.getTimestampFormatOptions)();var delimiterOptions=(0,_options.getDelimiterOptions)();var quoteOptions=(0,_options.getQuoteOptions)();var Overrides=exports.Overrides=function(_Component){_inherits(Overrides,_Component);function Overrides(props){_classCallCheck(this,Overrides);var _this=_possibleConstructorReturn(this,(Overrides.__proto__||Object.getPrototypeOf(Overrides)).call(this,props));_this.applyOverrides=function(){var overrides=_extends({},_this.state);overrides.delimiter=convertDelimiterBack(overrides);delete overrides.customDelimiter;delete overrides.originalColumnNames;_this.props.setOverrides(overrides)};_this.onFormatChange=function(format){_this.setState({format:format})};_this.onTimestampFormatChange=function(timestampFormat){_this.setState({timestampFormat:timestampFormat})};_this.onTimestampFieldChange=function(timestampField){_this.setState({timestampField:timestampField})};_this.onDelimiterChange=function(delimiter){_this.setState({delimiter:delimiter})};_this.onCustomDelimiterChange=function(e){_this.setState({customDelimiter:e.target.value})};_this.onQuoteChange=function(quote){_this.setState({quote:quote})};_this.onHasHeaderRowChange=function(e){_this.setState({hasHeaderRow:e.target.checked})};_this.onShouldTrimFieldsChange=function(e){_this.setState({shouldTrimFields:e.target.checked})};_this.onCharsetChange=function(charset){_this.setState({charset:charset})};_this.onColumnNameChange=function(e,i){var columnNames=_this.state.columnNames;columnNames[i]=e.target.value;_this.setState({columnNames:columnNames})};_this.grokPatternChange=function(e){_this.setState({grokPattern:e.target.value})};_this.state={};return _this}_createClass(Overrides,[{key:"componentDidMount",value:function componentDidMount(){if(typeof this.props.setApplyOverrides==="function"){this.props.setApplyOverrides(this.applyOverrides)}}},{key:"componentWillUnmount",value:function componentWillUnmount(){if(typeof this.props.unsetApplyOverrides==="function"){this.props.unsetApplyOverrides()}}},{key:"render",value:function render(){var _this2=this;var fields=this.props.fields;var _state=this.state,timestampFormat=_state.timestampFormat,timestampField=_state.timestampField,format=_state.format,delimiter=_state.delimiter,customDelimiter=_state.customDelimiter,quote=_state.quote,hasHeaderRow=_state.hasHeaderRow,shouldTrimFields=_state.shouldTrimFields,columnNames=_state.columnNames,originalColumnNames=_state.originalColumnNames,grokPattern=_state.grokPattern;var fieldOptions=fields.map(function(f){return{value:f,inputDisplay:f}});return _react3.default.createElement(_eui.EuiForm,null,_react3.default.createElement(_eui.EuiFormRow,{label:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.editFlyout.overrides.dataFormatFormRowLabel",defaultMessage:"Data format"})},_react3.default.createElement(_eui.EuiSuperSelect,{options:formatOptions,valueOfSelected:format,onChange:this.onFormatChange})),this.state.format==="delimited"&&_react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiFormRow,{label:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.editFlyout.overrides.delimiterFormRowLabel",defaultMessage:"Delimiter"})},_react3.default.createElement(_eui.EuiSuperSelect,{options:delimiterOptions,valueOfSelected:delimiter,onChange:this.onDelimiterChange})),delimiter==="other"&&_react3.default.createElement(_eui.EuiFormRow,{label:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.editFlyout.overrides.customDelimiterFormRowLabel",defaultMessage:"Custom delimiter"})},_react3.default.createElement(_eui.EuiFieldText,{value:customDelimiter,onChange:this.onCustomDelimiterChange})),_react3.default.createElement(_eui.EuiFormRow,{label:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.editFlyout.overrides.quoteCharacterFormRowLabel",defaultMessage:"Quote character"})},_react3.default.createElement(_eui.EuiSuperSelect,{options:quoteOptions,valueOfSelected:quote,onChange:this.onQuoteChange})),_react3.default.createElement(_eui.EuiFormRow,null,_react3.default.createElement(_eui.EuiCheckbox,{id:"hasHeaderRow",label:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.editFlyout.overrides.hasHeaderRowLabel",defaultMessage:"Has header row"}),checked:hasHeaderRow,onChange:this.onHasHeaderRowChange})),_react3.default.createElement(_eui.EuiFormRow,null,_react3.default.createElement(_eui.EuiCheckbox,{id:"shouldTrimFields",label:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.editFlyout.overrides.trimFieldsLabel",defaultMessage:"Should trim fields"}),checked:shouldTrimFields,onChange:this.onShouldTrimFieldsChange}))),this.state.format==="semi_structured_text"&&_react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiFormRow,{label:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.editFlyout.overrides.grokPatternFormRowLabel",defaultMessage:"Grok pattern"})},_react3.default.createElement(_eui.EuiTextArea,{placeholder:grokPattern,value:grokPattern,onChange:this.grokPatternChange}))),_react3.default.createElement(_eui.EuiFormRow,{label:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.editFlyout.overrides.timestampFormatFormRowLabel",defaultMessage:"Timestamp format"})},_react3.default.createElement(_eui.EuiSuperSelect,{options:timestampFormatOptions,valueOfSelected:timestampFormat,onChange:this.onTimestampFormatChange})),_react3.default.createElement(_eui.EuiFormRow,{label:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.editFlyout.overrides.timeFieldFormRowLabel",defaultMessage:"Time field"})},_react3.default.createElement(_eui.EuiSuperSelect,{options:fieldOptions,valueOfSelected:timestampField,onChange:this.onTimestampFieldChange})),this.state.format==="delimited"&&originalColumnNames.length>0&&_react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiSpacer,null),_react3.default.createElement(_eui.EuiTitle,{size:"s"},_react3.default.createElement("h3",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.editFlyout.overrides.editFieldNamesTitle",defaultMessage:"Edit field names"}))),originalColumnNames.map(function(f,i){return _react3.default.createElement(_eui.EuiFormRow,{label:f,key:f},_react3.default.createElement(_eui.EuiFieldText,{value:columnNames[i],onChange:function onChange(e){return _this2.onColumnNameChange(e,i)}}))})))}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props,state){var originalSettings=props.originalSettings;var _props$overrides=props.overrides,charset=_props$overrides.charset,format=_props$overrides.format,hasHeaderRow=_props$overrides.hasHeaderRow,columnNames=_props$overrides.columnNames,delimiter=_props$overrides.delimiter,quote=_props$overrides.quote,shouldTrimFields=_props$overrides.shouldTrimFields,grokPattern=_props$overrides.grokPattern,timestampField=_props$overrides.timestampField,timestampFormat=_props$overrides.timestampFormat;var _convertDelimiter=convertDelimiter(delimiter===undefined?originalSettings.delimiter:delimiter),d=_convertDelimiter.delimiter,customD=_convertDelimiter.customDelimiter;var _getColumnNames=getColumnNames(columnNames,originalSettings),newColumnNames=_getColumnNames.newColumnNames,originalColumnNames=_getColumnNames.originalColumnNames;var initialState={charset:charset===undefined?originalSettings.charset:charset,format:format===undefined?originalSettings.format:format,hasHeaderRow:hasHeaderRow===undefined?originalSettings.hasHeaderRow:hasHeaderRow,columnNames:newColumnNames,originalColumnNames:originalColumnNames,delimiter:d,customDelimiter:customD===undefined?"":customD,quote:quote===undefined?originalSettings.quote:quote,shouldTrimFields:shouldTrimFields===undefined?originalSettings.shouldTrimFields:shouldTrimFields,grokPattern:grokPattern===undefined?originalSettings.grokPattern:grokPattern,timestampFormat:timestampFormat===undefined?originalSettings.timestampFormat:timestampFormat,timestampField:timestampField===undefined?originalSettings.timestampField:timestampField};return _extends({},initialState,state)}}]);return Overrides}(_react2.Component);function convertDelimiter(d){switch(d){case",":return{delimiter:"comma"};case"\t":return{delimiter:"tab"};case";":return{delimiter:"semicolon"};case"|":return{delimiter:"pipe"};case" ":return{delimiter:"space"};default:return{delimiter:"other",customDelimiter:d}}}function convertDelimiterBack(_ref){var delimiter=_ref.delimiter,customDelimiter=_ref.customDelimiter;switch(delimiter){case"comma":return",";case"tab":return"\t";case"semicolon":return";";case"pipe":return"|";case"space":return" ";case"other":return customDelimiter;default:return undefined}}function getColumnNames(columnNames,originalSettings){var newColumnNames=columnNames===undefined&&originalSettings.columnNames!==undefined?[].concat(_toConsumableArray(originalSettings.columnNames)):columnNames;var originalColumnNames=newColumnNames!==undefined?[].concat(_toConsumableArray(newColumnNames)):[];return{newColumnNames:newColumnNames,originalColumnNames:originalColumnNames}}},2561:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _options=__webpack_require__(2562);Object.defineProperty(exports,"getCharsetOptions",{enumerable:true,get:function get(){return _options.getCharsetOptions}});Object.defineProperty(exports,"getFormatOptions",{enumerable:true,get:function get(){return _options.getFormatOptions}});Object.defineProperty(exports,"getTimestampFormatOptions",{enumerable:true,get:function get(){return _options.getTimestampFormatOptions}});Object.defineProperty(exports,"getDelimiterOptions",{enumerable:true,get:function get(){return _options.getDelimiterOptions}});Object.defineProperty(exports,"getQuoteOptions",{enumerable:true,get:function get(){return _options.getQuoteOptions}})},2562:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getFormatOptions=getFormatOptions;exports.getTimestampFormatOptions=getTimestampFormatOptions;exports.getDelimiterOptions=getDelimiterOptions;exports.getQuoteOptions=getQuoteOptions;exports.getCharsetOptions=getCharsetOptions;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _option_lists=__webpack_require__(2563);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getOptions(list){return list.map(function(o){return{value:o,inputDisplay:_react2.default.createElement("span",null,o)}})}function getFormatOptions(){return getOptions(_option_lists.FORMAT_OPTIONS)}function getTimestampFormatOptions(){return getOptions(_option_lists.TIMESTAMP_OPTIONS)}function getDelimiterOptions(){return getOptions(_option_lists.DELIMITER_OPTIONS)}function getQuoteOptions(){return getOptions(_option_lists.QUOTE_OPTIONS)}function getCharsetOptions(){return getOptions(_option_lists.CHARSET_OPTIONS)}},2563:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var FORMAT_OPTIONS=exports.FORMAT_OPTIONS=["delimited","ndjson","semi_structured_text","xml"];var TIMESTAMP_OPTIONS=exports.TIMESTAMP_OPTIONS=["dd/MMM/YYYY:HH:mm:ss Z","EEE MMM dd HH:mm zzz YYYY","EEE MMM dd HH:mm:ss YYYY","EEE MMM dd HH:mm:ss zzz YYYY","EEE MMM dd YYYY HH:mm zzz","EEE MMM dd YYYY HH:mm:ss zzz","EEE, dd MMM YYYY HH:mm Z","EEE, dd MMM YYYY HH:mm ZZ","EEE, dd MMM YYYY HH:mm:ss Z","EEE, dd MMM YYYY HH:mm:ss ZZ","ISO8601","MMM dd HH:mm:ss","MMM dd HH:mm:ss,SSS","MMM dd HH:mm:ss,SSSSSS","MMM dd HH:mm:ss,SSSSSSSSS","MMM dd HH:mm:ss.SSS","MMM dd HH:mm:ss.SSSSSS","MMM dd HH:mm:ss.SSSSSSSSS","MMM dd HH:mm:ss:SSS","MMM dd HH:mm:ss:SSSSSS","MMM dd HH:mm:ss:SSSSSSSSS","MMM dd YYYY HH:mm:ss","MMM dd, YYYY h:mm:ss a","TAI64N","UNIX","UNIX_MS","YYYY-MM-dd HH:mm:ss","YYYY-MM-dd HH:mm:ss,SSS","YYYY-MM-dd HH:mm:ss,SSSSSS","YYYY-MM-dd HH:mm:ss,SSSSSSSSS","YYYY-MM-dd HH:mm:ss.SSS","YYYY-MM-dd HH:mm:ss.SSSSSS","YYYY-MM-dd HH:mm:ss.SSSSSSSSS","YYYY-MM-dd HH:mm:ss:SSS","YYYY-MM-dd HH:mm:ss:SSSSSS","YYYY-MM-dd HH:mm:ss:SSSSSSSSS","YYYY-MM-dd HH:mm:ss,SSS Z","YYYY-MM-dd HH:mm:ss,SSSSSS Z","YYYY-MM-dd HH:mm:ss,SSSSSSSSS Z","YYYY-MM-dd HH:mm:ss.SSS Z","YYYY-MM-dd HH:mm:ss.SSSSSS Z","YYYY-MM-dd HH:mm:ss.SSSSSSSSS Z","YYYY-MM-dd HH:mm:ss:SSS Z","YYYY-MM-dd HH:mm:ss:SSSSSS Z","YYYY-MM-dd HH:mm:ss:SSSSSSSSS Z","YYYY-MM-dd HH:mm:ss,SSSZ","YYYY-MM-dd HH:mm:ss,SSSSSSZ","YYYY-MM-dd HH:mm:ss,SSSSSSSSSZ","YYYY-MM-dd HH:mm:ss.SSSZ","YYYY-MM-dd HH:mm:ss.SSSSSSZ","YYYY-MM-dd HH:mm:ss.SSSSSSSSSZ","YYYY-MM-dd HH:mm:ss:SSSZ","YYYY-MM-dd HH:mm:ss:SSSSSSZ","YYYY-MM-dd HH:mm:ss:SSSSSSSSSZ","YYYY-MM-dd HH:mm:ss,SSSZZ","YYYY-MM-dd HH:mm:ss,SSSSSSZZ","YYYY-MM-dd HH:mm:ss,SSSSSSSSSZZ","YYYY-MM-dd HH:mm:ss.SSSZZ","YYYY-MM-dd HH:mm:ss.SSSSSSZZ","YYYY-MM-dd HH:mm:ss.SSSSSSSSSZZ","YYYY-MM-dd HH:mm:ss:SSSZZ","YYYY-MM-dd HH:mm:ss:SSSSSSZZ","YYYY-MM-dd HH:mm:ss:SSSSSSSSSZZ","YYYY-MM-dd HH:mm:ssZ","YYYY-MM-dd HH:mm:ssZZ","YYYYMMddHHmmss"];var DELIMITER_OPTIONS=exports.DELIMITER_OPTIONS=["comma","tab","semicolon","pipe","space","other"];var QUOTE_OPTIONS=exports.QUOTE_OPTIONS=["'",'"',"`"];var CHARSET_OPTIONS=exports.CHARSET_OPTIONS=["IBM00858","IBM437","IBM775","IBM850","IBM852","IBM855","IBM857","IBM862","IBM866","ISO-8859-1","ISO-8859-2","ISO-8859-4","ISO-8859-5","ISO-8859-7","ISO-8859-9","ISO-8859-13","ISO-8859-15","KOI8-R","KOI8-U","US-ASCII","UTF-8","UTF-16","UTF-16BE","UTF-16LE","UTF-32","UTF-32BE","UTF-32LE","x-UTF-32BE-BOM","x-UTF-32LE-BOM","windows-1250","windows-1251","windows-1252","windows-1253","windows-1254","windows-1257","Not available","x-IBM737","x-IBM874","x-UTF-16LE-BOM","Big5","Big5-HKSCS","EUC-JP","EUC-KR","GB18030","GB2312","GBK","IBM-Thai","IBM01140","IBM01141","IBM01142","IBM01143","IBM01144","IBM01145","IBM01146","IBM01147","IBM01148","IBM01149","IBM037","IBM1026","IBM1047","IBM273","IBM277","IBM278","IBM280","IBM284","IBM285","IBM297","IBM420","IBM424","IBM500","IBM860","IBM861","IBM863","IBM864","IBM865","IBM868","IBM869","IBM870","IBM871","IBM918","ISO-2022-CN","ISO-2022-JP","ISO-2022-KR","ISO-8859-3","ISO-8859-6","ISO-8859-8","JIS_X0201","JIS_X0212-1990","Shift_JIS","TIS-620","windows-1255","windows-1256","windows-1258","windows-31j","x-Big5-Solaris","x-euc-jp-linux","x-EUC-TW","x-eucJP-Open","x-IBM1006","x-IBM1025","x-IBM1046","x-IBM1097","x-IBM1098","x-IBM1112","x-IBM1122","x-IBM1123","x-IBM1124","x-IBM1381","x-IBM1383","x-IBM33722","x-IBM834","x-IBM856","x-IBM875","x-IBM921","x-IBM922","x-IBM930","x-IBM933","x-IBM935","x-IBM937","x-IBM939","x-IBM942","x-IBM942C","x-IBM943","x-IBM943C","x-IBM948","x-IBM949","x-IBM949C","x-IBM950","x-IBM964","x-IBM970","x-ISCII91","x-ISO2022-CN-CNS","x-ISO2022-CN-GB","x-iso-8859-11","x-JIS0208","x-JISAutoDetect","x-Johab","x-MacArabic","x-MacCentralEurope","x-MacCroatian","x-MacCyrillic","x-MacDingbat","x-MacGreek","x-MacHebrew","x-MacIceland","x-MacRoman","x-MacRomania","x-MacSymbol","x-MacThai","x-MacTurkish","x-MacUkraine","x-MS950-HKSCS","x-mswin-936","x-PCK","x-SJIS_0213","x-windows-50220","x-windows-50221","x-windows-874","x-windows-949","x-windows-950","x-windows-iso2022jp"]},2564:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _import_view=__webpack_require__(2565);Object.defineProperty(exports,"ImportView",{enumerable:true,get:function get(){return _import_view.ImportView}})},2565:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ImportView=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var createKibanaIndexPattern=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(indexPatternName,indexPatterns,timeFieldName,kibanaConfig){var emptyPattern,id;return regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return indexPatterns.get();case 3:emptyPattern=_context5.sent;Object.assign(emptyPattern,{id:"",title:indexPatternName,timeFieldName:timeFieldName});_context5.next=7;return emptyPattern.create();case 7:id=_context5.sent;if(kibanaConfig.get("defaultIndex")){_context5.next=11;break}_context5.next=11;return kibanaConfig.set("defaultIndex",id);case 11:return _context5.abrupt("return",{success:true,id:id});case 14:_context5.prev=14;_context5.t0=_context5["catch"](0);console.error(_context5.t0);return _context5.abrupt("return",{success:false,error:_context5.t0});case 18:case"end":return _context5.stop()}}},_callee5,this,[[0,14]])}));return function createKibanaIndexPattern(_x,_x2,_x3,_x4){return _ref5.apply(this,arguments)}}();var _react=__webpack_require__(3);var _react2=__webpack_require__(0);var _react3=_interopRequireDefault(_react2);var _eui=__webpack_require__(2);var _importer=__webpack_require__(2566);var _results_links=__webpack_require__(2572);var _import_progress=__webpack_require__(1023);var _import_errors=__webpack_require__(2575);var _import_summary=__webpack_require__(2577);var _import_settings=__webpack_require__(2579);var _experimental_badge=__webpack_require__(1022);var _index_utils=__webpack_require__(62);var _ml_api_service=__webpack_require__(22);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_TIME_FIELD="@timestamp";var CONFIG_MODE={SIMPLE:0,ADVANCED:1};var DEFAULT_STATE={index:"",importing:false,imported:false,initialized:false,reading:false,readProgress:0,readStatus:_import_progress.IMPORT_STATUS.INCOMPLETE,indexCreatedStatus:_import_progress.IMPORT_STATUS.INCOMPLETE,indexPatternCreatedStatus:_import_progress.IMPORT_STATUS.INCOMPLETE,ingestPipelineCreatedStatus:_import_progress.IMPORT_STATUS.INCOMPLETE,uploadProgress:0,uploadStatus:_import_progress.IMPORT_STATUS.INCOMPLETE,createIndexPattern:true,indexPattern:"",indexPatternId:"",ingestPipelineId:"",errors:[],importFailures:[],docCount:0,configMode:CONFIG_MODE.SIMPLE,indexSettingsString:"",mappingsString:"",pipelineString:"",indexNames:[],indexPatternNames:[],indexNameError:"",indexPatternNameError:"",timeFieldName:undefined};var ImportView=exports.ImportView=function(_Component){_inherits(ImportView,_Component);function ImportView(props){_classCallCheck(this,ImportView);var _this=_possibleConstructorReturn(this,(ImportView.__proto__||Object.getPrototypeOf(ImportView)).call(this,props));_this.clickReset=function(){var state=getDefaultState(_this.state,_this.props.results);_this.setState(state,function(){_this.loadIndexNames();_this.loadIndexPatternNames()})};_this.clickImport=function(){_this.import()};_this.onConfigModeChange=function(configMode){_this.setState({configMode:configMode})};_this.onIndexChange=function(e){var name=e.target.value;_this.setState({index:name,indexNameError:isIndexNameValid(name,_this.state.indexNames)})};_this.onIndexPatternChange=function(e){var name=e.target.value;var _this$state=_this.state,indexPatternNames=_this$state.indexPatternNames,index=_this$state.index;_this.setState({indexPattern:name,indexPatternNameError:isIndexPatternNameValid(name,indexPatternNames,index)})};_this.onCreateIndexPatternChange=function(e){_this.setState({createIndexPattern:e.target.checked})};_this.onIndexSettingsStringChange=function(text){_this.setState({indexSettingsString:text})};_this.onMappingsStringChange=function(text){_this.setState({mappingsString:text})};_this.onPipelineStringChange=function(text){_this.setState({pipelineString:text})};_this.setImportProgress=function(progress){_this.setState({uploadProgress:progress})};_this.setReadProgress=function(progress){_this.setState({readProgress:progress})};_this.state=getDefaultState(DEFAULT_STATE,_this.props.results);return _this}_createClass(ImportView,[{key:"componentDidMount",value:function componentDidMount(){this.loadIndexNames();this.loadIndexPatternNames()}},{key:"import",value:function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var _this2=this;var _props,fileContents,results,indexPatterns,kibanaConfig,showBottomBar,format,timeFieldName,_state,index,indexPattern,createIndexPattern,indexSettingsString,mappingsString,pipelineString,errors;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_props=this.props,fileContents=_props.fileContents,results=_props.results,indexPatterns=_props.indexPatterns,kibanaConfig=_props.kibanaConfig,showBottomBar=_props.showBottomBar;format=results.format;timeFieldName=this.state.timeFieldName;_state=this.state,index=_state.index,indexPattern=_state.indexPattern,createIndexPattern=_state.createIndexPattern,indexSettingsString=_state.indexSettingsString,mappingsString=_state.mappingsString,pipelineString=_state.pipelineString;errors=[];if(index!==""){this.setState({importing:true,imported:false,reading:true,initialized:true},function(){_this2.props.hideBottomBar();setTimeout(_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var success,createPipeline,indexCreationSettings,settings,mappings,importer,readResp,initializeImportResp,indexCreated,pipelineCreated,importId,pipelineId,importResp,indexPatternName,indexPatternResp;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:success=false;createPipeline=pipelineString!=="";indexCreationSettings={};try{settings=JSON.parse(indexSettingsString);mappings=JSON.parse(mappingsString);indexCreationSettings={settings:settings,mappings:mappings};if(createPipeline){indexCreationSettings.pipeline=JSON.parse(pipelineString)}if(mappings[DEFAULT_TIME_FIELD]!==undefined){timeFieldName=DEFAULT_TIME_FIELD;_this2.setState({timeFieldName:timeFieldName})}success=true}catch(error){success=false;errors.push(error)}if(!success){_context.next=43;break}importer=(0,_importer.importerFactory)(format,results,indexCreationSettings);if(!(importer!==undefined)){_context.next=43;break}_context.next=9;return importer.read(fileContents,_this2.setReadProgress);case 9:readResp=_context.sent;success=readResp.success;_this2.setState({readStatus:success?_import_progress.IMPORT_STATUS.COMPLETE:_import_progress.IMPORT_STATUS.FAILED,reading:false});if(readResp.success===false){console.error(readResp.error);errors.push(readResp.error)}if(!success){_context.next=43;break}_context.next=16;return importer.initializeImport(index);case 16:initializeImportResp=_context.sent;indexCreated=initializeImportResp.index!==undefined;_this2.setState({indexCreatedStatus:indexCreated?_import_progress.IMPORT_STATUS.COMPLETE:_import_progress.IMPORT_STATUS.FAILED});if(createPipeline){pipelineCreated=initializeImportResp.pipelineId!==undefined;if(indexCreated){_this2.setState({ingestPipelineCreatedStatus:pipelineCreated?_import_progress.IMPORT_STATUS.COMPLETE:_import_progress.IMPORT_STATUS.FAILED,ingestPipelineId:pipelineCreated?initializeImportResp.pipelineId:""})}success=indexCreated&&pipelineCreated}else{success=indexCreated}if(!success){_context.next=42;break}importId=initializeImportResp.id;pipelineId=initializeImportResp.pipelineId;_context.next=25;return importer.import(importId,index,pipelineId,_this2.setImportProgress);case 25:importResp=_context.sent;success=importResp.success;_this2.setState({uploadStatus:importResp.success?_import_progress.IMPORT_STATUS.COMPLETE:_import_progress.IMPORT_STATUS.FAILED,importFailures:importResp.failures,docCount:importResp.docCount});if(!success){_context.next=39;break}if(!createIndexPattern){_context.next=37;break}indexPatternName=indexPattern===""?index:indexPattern;_context.next=33;return createKibanaIndexPattern(indexPatternName,indexPatterns,timeFieldName,kibanaConfig);case 33:indexPatternResp=_context.sent;success=indexPatternResp.success;_this2.setState({indexPatternCreatedStatus:indexPatternResp.success?_import_progress.IMPORT_STATUS.COMPLETE:_import_progress.IMPORT_STATUS.FAILED,indexPatternId:indexPatternResp.id});if(indexPatternResp.success===false){errors.push(indexPatternResp.error)}case 37:_context.next=40;break;case 39:errors.push(importResp.error);case 40:_context.next=43;break;case 42:errors.push(initializeImportResp.error);case 43:showBottomBar();_this2.setState({importing:false,imported:success,errors:errors});case 45:case"end":return _context.stop()}}},_callee,_this2)})),500)})}case 6:case"end":return _context2.stop()}}},_callee2,this)}));function _import(){return _ref.apply(this,arguments)}return _import}()},{key:"loadIndexNames",value:function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){var indices,indexNames;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _ml_api_service.ml.getIndices();case 2:indices=_context3.sent;indexNames=indices.map(function(i){return i.name});this.setState({indexNames:indexNames});case 5:case"end":return _context3.stop()}}},_callee3,this)}));function loadIndexNames(){return _ref3.apply(this,arguments)}return loadIndexNames}()},{key:"loadIndexPatternNames",value:function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){var indexPatternNames;return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return(0,_index_utils.refreshIndexPatterns)();case 2:indexPatternNames=(0,_index_utils.getIndexPatternNames)();this.setState({indexPatternNames:indexPatternNames});case 4:case"end":return _context4.stop()}}},_callee4,this)}));function loadIndexPatternNames(){return _ref4.apply(this,arguments)}return loadIndexPatternNames}()},{key:"render",value:function render(){var _state2=this.state,index=_state2.index,indexPattern=_state2.indexPattern,indexPatternId=_state2.indexPatternId,ingestPipelineId=_state2.ingestPipelineId,importing=_state2.importing,imported=_state2.imported,reading=_state2.reading,initialized=_state2.initialized,readStatus=_state2.readStatus,indexCreatedStatus=_state2.indexCreatedStatus,ingestPipelineCreatedStatus=_state2.ingestPipelineCreatedStatus,indexPatternCreatedStatus=_state2.indexPatternCreatedStatus,uploadProgress=_state2.uploadProgress,uploadStatus=_state2.uploadStatus,createIndexPattern=_state2.createIndexPattern,errors=_state2.errors,docCount=_state2.docCount,importFailures=_state2.importFailures,indexSettingsString=_state2.indexSettingsString,mappingsString=_state2.mappingsString,pipelineString=_state2.pipelineString,indexNameError=_state2.indexNameError,indexPatternNameError=_state2.indexPatternNameError,timeFieldName=_state2.timeFieldName;var createPipeline=pipelineString!=="";var statuses={reading:reading,readStatus:readStatus,indexCreatedStatus:indexCreatedStatus,ingestPipelineCreatedStatus:ingestPipelineCreatedStatus,indexPatternCreatedStatus:indexPatternCreatedStatus,uploadProgress:uploadProgress,uploadStatus:uploadStatus,createIndexPattern:createIndexPattern,createPipeline:createPipeline};var disableImport=index===""||indexNameError!==""||createIndexPattern===true&&indexPatternNameError!==""||initialized===true;return _react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiPanel,null,_react3.default.createElement(_eui.EuiTitle,{size:"s"},_react3.default.createElement("h3",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importView.importDataTitle",defaultMessage:"Import data"})," ",_react3.default.createElement(_experimental_badge.ExperimentalBadge,{tooltipContent:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importView.experimentalFeatureTooltip",defaultMessage:"Experimental feature. We'd love to hear your feedback."})}))),_react3.default.createElement(_import_settings.ImportSettings,{index:index,indexPattern:indexPattern,initialized:initialized,onIndexChange:this.onIndexChange,createIndexPattern:createIndexPattern,onCreateIndexPatternChange:this.onCreateIndexPatternChange,onIndexPatternChange:this.onIndexPatternChange,indexSettingsString:indexSettingsString,mappingsString:mappingsString,pipelineString:pipelineString,onIndexSettingsStringChange:this.onIndexSettingsStringChange,onMappingsStringChange:this.onMappingsStringChange,onPipelineStringChange:this.onPipelineStringChange,indexNameError:indexNameError,indexPatternNameError:indexPatternNameError}),_react3.default.createElement(_eui.EuiSpacer,{size:"m"}),(initialized===false||importing===true)&&_react3.default.createElement(_eui.EuiButton,{isDisabled:disableImport,onClick:this.clickImport,isLoading:importing,iconSide:"right",fill:true},_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importView.importButtonLabel",defaultMessage:"Import"})),initialized===true&&importing===false&&_react3.default.createElement(_eui.EuiButton,{onClick:this.clickReset},_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importView.resetButtonLabel",defaultMessage:"Reset"}))),initialized===true&&_react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiSpacer,{size:"m"}),_react3.default.createElement(_eui.EuiPanel,null,_react3.default.createElement(_import_progress.ImportProgress,{statuses:statuses}),imported===true&&_react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiSpacer,{size:"m"}),_react3.default.createElement(_import_summary.ImportSummary,{index:index,indexPattern:indexPattern===""?index:indexPattern,ingestPipelineId:ingestPipelineId,docCount:docCount,importFailures:importFailures,createIndexPattern:createIndexPattern,createPipeline:createPipeline}),_react3.default.createElement(_eui.EuiSpacer,{size:"l"}),_react3.default.createElement(_results_links.ResultsLinks,{index:index,indexPatternId:indexPatternId,timeFieldName:timeFieldName,createIndexPattern:createIndexPattern}))),errors.length>0&&_react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiSpacer,{size:"m"}),_react3.default.createElement(_import_errors.ImportErrors,{errors:errors,statuses:statuses}))))}}]);return ImportView}(_react2.Component);function getDefaultState(state,results){var indexSettingsString=state.indexSettingsString===""?"{}":state.indexSettingsString;var mappingsString=state.mappingsString===""?JSON.stringify(results.mappings,null,2):state.mappingsString;var pipelineString=state.pipelineString===""&&results.ingest_pipeline!==undefined?JSON.stringify(results.ingest_pipeline,null,2):state.pipelineString;var timeFieldName=results.timestamp_field;return _extends({},DEFAULT_STATE,{indexSettingsString:indexSettingsString,mappingsString:mappingsString,pipelineString:pipelineString,timeFieldName:timeFieldName})}function isIndexNameValid(name,indexNames){if(indexNames.find(function(i){return i===name})){return _react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importView.indexNameAlreadyExistsErrorMessage",defaultMessage:"Index name already exists"})}var reg=new RegExp('[\\\\/*?"<>|\\s,#]+');if(name!==name.toLowerCase()||name==="."||name===".."||name.match(/^[-_+]/)!==null||name.match(reg)!==null){return _react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importView.indexNameContainsIllegalCharactersErrorMessage",defaultMessage:"Index name contains illegal characters"})}return""}function isIndexPatternNameValid(name,indexPatternNames,index){if(name===""){return""}if(indexPatternNames.find(function(i){return i===name})){return _react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importView.indexPatternNameAlreadyExistsErrorMessage",defaultMessage:"Index pattern name already exists"})}var newName=name.replace(".","\\.");newName=newName.replace("+","\\+");newName=newName.replace("*",".*");var reg=new RegExp("^"+newName+"$");if(index.match(reg)===null){return _react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importView.indexPatternDoesNotMatchIndexNameErrorMessage",defaultMessage:"Index pattern does not match index name"})}return""}},2566:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _importer_factory=__webpack_require__(2567);Object.defineProperty(exports,"importerFactory",{enumerable:true,get:function get(){return _importer_factory.importerFactory}})},2567:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.importerFactory=importerFactory;var _csv_importer=__webpack_require__(2568);var _sst_importer=__webpack_require__(2570);var _ndjson_importer=__webpack_require__(2571);function importerFactory(format,results,settings){switch(format){case"delimited":return new _csv_importer.CsvImporter(results,settings);case"semi_structured_text":return new _sst_importer.SstImporter(results,settings);case"ndjson":return new _ndjson_importer.NdjsonImporter(results,settings);default:return}}},2568:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CsvImporter=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _importer=__webpack_require__(646);var _papaparse=__webpack_require__(3156);var _papaparse2=_interopRequireDefault(_papaparse);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CsvImporter=exports.CsvImporter=function(_Importer){_inherits(CsvImporter,_Importer);function CsvImporter(results,settings){_classCallCheck(this,CsvImporter);var _this=_possibleConstructorReturn(this,(CsvImporter.__proto__||Object.getPrototypeOf(CsvImporter)).call(this,settings));_this.format=results.format;_this.delimiter=results.delimiter;_this.quote=results.quote;_this.hasHeaderRow=results.has_header_row;_this.columnNames=results.column_names;_this.shouldTrimFields=results.should_trim_fields||false;return _this}_createClass(CsvImporter,[{key:"read",value:function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(csv){var transform,config,parserOutput;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;transform=this.shouldTrimFields?function(f){return f.trim()}:function(f){return f};config={header:false,skipEmptyLines:"greedy",delimiter:this.delimiter,quoteChar:this.quote,transform:transform};parserOutput=_papaparse2.default.parse(csv,config);if(!parserOutput.errors.length){_context.next=6;break}throw parserOutput.errors[0].message;case 6:this.data=parserOutput.data;if(this.hasHeaderRow){this.data.shift()}this.docArray=formatToJson(this.data,this.columnNames);return _context.abrupt("return",{success:true});case 12:_context.prev=12;_context.t0=_context["catch"](0);return _context.abrupt("return",{success:false,error:_context.t0});case 15:case"end":return _context.stop()}}},_callee,this,[[0,12]])}));function read(_x){return _ref.apply(this,arguments)}return read}()}]);return CsvImporter}(_importer.Importer);function formatToJson(data,columnNames){var docArray=[];for(var i=0;i<data.length;i++){var line={};for(var c=0;c<columnNames.length;c++){var col=columnNames[c];line[col]=data[i][c]}docArray.push(line)}return docArray}},257:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ES_FIELD_TYPES=exports.ES_FIELD_TYPES={ATTACHMENT:"attachment",BOOLEAN:"boolean",BYTE:"byte",DATE:"date",DOUBLE:"double",FLOAT:"float",GEO_POINT:"geo_point",GEO_SHAPE:"geo_shape",HALF_FLOAT:"half_float",INTEGER:"integer",IP:"ip",KEYWORD:"keyword",LONG:"long",MURMUR3:"murmur3",SCALED_FLOAT:"scaled_float",SHORT:"short",TEXT:"text",TOKEN_COUNT:"token_count",_ID:"_id",_SOURCE:"_source",_TYPE:"_type"};var KBN_FIELD_TYPES=exports.KBN_FIELD_TYPES={ATTACHMENT:"attachment",BOOLEAN:"boolean",DATE:"date",GEO_POINT:"geo_point",GEO_SHAPE:"geo_shape",IP:"ip",MURMUR3:"murmur3",NUMBER:"number",STRING:"string",_SOURCE:"_source",UNKNOWN:"unknown",CONFLICT:"conflict"};var ML_JOB_FIELD_TYPES=exports.ML_JOB_FIELD_TYPES={BOOLEAN:"boolean",DATE:"date",GEO_POINT:"geo_point",IP:"ip",KEYWORD:"keyword",NUMBER:"number",TEXT:"text",UNKNOWN:"unknown"}},2570:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SstImporter=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _importer=__webpack_require__(646);function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var SstImporter=exports.SstImporter=function(_Importer){_inherits(SstImporter,_Importer);function SstImporter(results,settings){_classCallCheck(this,SstImporter);var _this=_possibleConstructorReturn(this,(SstImporter.__proto__||Object.getPrototypeOf(SstImporter)).call(this,settings));_this.format=results.format;_this.multilineStartPattern=results.multiline_start_pattern;_this.grokPattern=results.grok_pattern;return _this}_createClass(SstImporter,[{key:"read",value:function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(text){var data,message,line,i,char;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;data=[];message="";line="";for(i=0;i<text.length;i++){char=text[i];if(char==="\n"){if(line.match(this.multilineStartPattern)!==null){data.push({message:message});message=""}else{message+=char}message+=line;line=""}else{line+=char}}if(message!==""){data.push({message:message})}if(data[0]&&data[0].message===""){data.shift()}this.data=data;this.docArray=this.data;return _context.abrupt("return",{success:true});case 12:_context.prev=12;_context.t0=_context["catch"](0);console.error(_context.t0);return _context.abrupt("return",{success:false,error:_context.t0});case 16:case"end":return _context.stop()}}},_callee,this,[[0,12]])}));function read(_x){return _ref.apply(this,arguments)}return read}()}]);return SstImporter}(_importer.Importer)},2571:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.NdjsonImporter=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _importer=__webpack_require__(646);function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var NdjsonImporter=exports.NdjsonImporter=function(_Importer){_inherits(NdjsonImporter,_Importer);function NdjsonImporter(results,settings){_classCallCheck(this,NdjsonImporter);return _possibleConstructorReturn(this,(NdjsonImporter.__proto__||Object.getPrototypeOf(NdjsonImporter)).call(this,settings))}_createClass(NdjsonImporter,[{key:"read",value:function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(json){var splitJson,ndjson,i;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;splitJson=json.split(/}\s*\n/);ndjson=[];for(i=0;i<splitJson.length;i++){if(splitJson[i]!==""){ndjson.push(splitJson[i]+"}")}}this.docArray=ndjson;return _context.abrupt("return",{success:true});case 8:_context.prev=8;_context.t0=_context["catch"](0);return _context.abrupt("return",{success:false,error:_context.t0});case 11:case"end":return _context.stop()}}},_callee,this,[[0,8]])}));function read(_x){return _ref.apply(this,arguments)}return read}()}]);return NdjsonImporter}(_importer.Importer)},2572:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _results_links=__webpack_require__(2573);Object.defineProperty(exports,"ResultsLinks",{enumerable:true,get:function get(){return _results_links.ResultsLinks}})},2573:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ResultsLinks=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var getFullTimeRange=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(index,timeFieldName){var query,resp;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:query={bool:{must:[{query_string:{analyze_wildcard:true,query:"*"}}]}};_context2.next=3;return _ml_api_service.ml.getTimeFieldRange({index:index,timeFieldName:timeFieldName,query:query});case 3:resp=_context2.sent;return _context2.abrupt("return",{from:(0,_moment2.default)(resp.start.epoch).toISOString(),to:(0,_moment2.default)(resp.end.epoch).toISOString()});case 5:case"end":return _context2.stop()}}},_callee2,this)}));return function getFullTimeRange(_x2,_x3){return _ref3.apply(this,arguments)}}();var _react=__webpack_require__(3);var _react2=__webpack_require__(0);var _react3=_interopRequireDefault(_react2);var _eui=__webpack_require__(2);var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _ml_api_service=__webpack_require__(22);var _check_license=__webpack_require__(43);var _check_privilege=__webpack_require__(32);var _check_ml_nodes=__webpack_require__(47);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var RECHECK_DELAY_MS=3e3;var ResultsLinks=exports.ResultsLinks=function(_Component){_inherits(ResultsLinks,_Component);function ResultsLinks(props){_classCallCheck(this,ResultsLinks);var _this=_possibleConstructorReturn(this,(ResultsLinks.__proto__||Object.getPrototypeOf(ResultsLinks)).call(this,props));_this.state={from:"now-30m",to:"now"};_this.recheckTimeout=null;_this.showCreateJobLink=true;return _this}_createClass(ResultsLinks,[{key:"componentDidMount",value:function componentDidMount(){this.showCreateJobLink=(0,_check_privilege.checkPermission)("canCreateJob")&&(0,_check_ml_nodes.mlNodesAvailable)();if(this.props.timeFieldName!==undefined){this.updateTimeValues()}}},{key:"componentWillUnmount",value:function componentWillUnmount(){clearTimeout(this.recheckTimeout)}},{key:"updateTimeValues",value:function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var _this2=this;var recheck=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var _props,index,timeFieldName,_ref2,from,to;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_props=this.props,index=_props.index,timeFieldName=_props.timeFieldName;_context.next=3;return getFullTimeRange(index,timeFieldName);case 3:_ref2=_context.sent;from=_ref2.from;to=_ref2.to;this.setState({from:from===null?this.state.from:from,to:to===null?this.state.to:to});if(recheck&&(from===null||to===null)){this.recheckTimeout=setTimeout(function(){_this2.updateTimeValues(false)},RECHECK_DELAY_MS)}case 8:case"end":return _context.stop()}}},_callee,this)}));function updateTimeValues(){return _ref.apply(this,arguments)}return updateTimeValues}()},{key:"render",value:function render(){var _props2=this.props,indexPatternId=_props2.indexPatternId,timeFieldName=_props2.timeFieldName,createIndexPattern=_props2.createIndexPattern;var _state=this.state,from=_state.from,to=_state.to;var _g=this.props.timeFieldName!==undefined?"&_g=(time:(from:'"+from+"',mode:quick,to:'"+to+"'))":"";return _react3.default.createElement(_eui.EuiFlexGroup,{gutterSize:"l"},createIndexPattern&&_react3.default.createElement(_eui.EuiFlexItem,null,_react3.default.createElement(_eui.EuiCard,{icon:_react3.default.createElement(_eui.EuiIcon,{size:"xxl",type:"discoverApp"}),title:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.resultsLinks.viewIndexInDiscoverTitle",defaultMessage:"View index in Discover"}),description:"",href:_chrome2.default.getBasePath()+"/app/kibana#/discover?&_a=(index:'"+indexPatternId+"')"+_g})),(0,_check_license.isFullLicense)()===true&&timeFieldName!==undefined&&this.showCreateJobLink&&createIndexPattern&&_react3.default.createElement(_eui.EuiFlexItem,null,_react3.default.createElement(_eui.EuiCard,{icon:_react3.default.createElement(_eui.EuiIcon,{size:"xxl",type:"machineLearningApp"}),title:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.resultsLinks.createNewMLJobTitle",defaultMessage:"Create new ML job"}),description:"",href:_chrome2.default.getBasePath()+"/app/ml#/jobs/new_job/step/job_type?index="+indexPatternId+_g})),createIndexPattern&&_react3.default.createElement(_eui.EuiFlexItem,null,_react3.default.createElement(_eui.EuiCard,{icon:_react3.default.createElement(_eui.EuiIcon,{size:"xxl",type:"dataVisualizer"}),title:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.resultsLinks.openInDataVisualizerTitle",defaultMessage:"Open in Data Visualizer"}),description:"",href:_chrome2.default.getBasePath()+"/app/ml#/jobs/new_job/datavisualizer?index="+indexPatternId+_g})),_react3.default.createElement(_eui.EuiFlexItem,null,_react3.default.createElement(_eui.EuiCard,{icon:_react3.default.createElement(_eui.EuiIcon,{size:"xxl",type:"managementApp"}),title:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.resultsLinks.indexManagementTitle",defaultMessage:"Index Management"}),description:"",href:_chrome2.default.getBasePath()+"/app/kibana#/management/elasticsearch/index_management/indices"})),_react3.default.createElement(_eui.EuiFlexItem,null,_react3.default.createElement(_eui.EuiCard,{icon:_react3.default.createElement(_eui.EuiIcon,{size:"xxl",type:"managementApp"}),title:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.resultsLinks.indexPatternManagementTitle",defaultMessage:"Index Pattern Management"}),description:"",href:_chrome2.default.getBasePath()+"/app/kibana#/management/kibana/indices/"+(createIndexPattern?indexPatternId:"")})))}}]);return ResultsLinks}(_react2.Component)},2574:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ImportProgress=exports.IMPORT_STATUS=undefined;var _react=__webpack_require__(3);var _react2=__webpack_require__(0);var _react3=_interopRequireDefault(_react2);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var IMPORT_STATUS=exports.IMPORT_STATUS={INCOMPLETE:"incomplete",COMPLETE:"complete",FAILED:"danger"};var ImportProgress=exports.ImportProgress=(0,_react.injectI18n)(function(_ref){var statuses=_ref.statuses,intl=_ref.intl;var reading=statuses.reading,readStatus=statuses.readStatus,indexCreatedStatus=statuses.indexCreatedStatus,ingestPipelineCreatedStatus=statuses.ingestPipelineCreatedStatus,indexPatternCreatedStatus=statuses.indexPatternCreatedStatus,uploadProgress=statuses.uploadProgress,uploadStatus=statuses.uploadStatus,createIndexPattern=statuses.createIndexPattern,createPipeline=statuses.createPipeline;var statusInfo=null;var completedStep=0;if(reading===true&&readStatus===IMPORT_STATUS.INCOMPLETE){completedStep=0}if(readStatus===IMPORT_STATUS.COMPLETE&&indexCreatedStatus===IMPORT_STATUS.INCOMPLETE&&ingestPipelineCreatedStatus===IMPORT_STATUS.INCOMPLETE){completedStep=1}if(indexCreatedStatus===IMPORT_STATUS.COMPLETE){completedStep=2}if(ingestPipelineCreatedStatus===IMPORT_STATUS.COMPLETE){completedStep=3}if(uploadStatus===IMPORT_STATUS.COMPLETE){completedStep=4}if(indexPatternCreatedStatus===IMPORT_STATUS.COMPLETE){completedStep=5}var processFileTitle=intl.formatMessage({id:"xpack.ml.fileDatavisualizer.importProgress.processFileTitle",defaultMessage:"Process file"});var createIndexTitle=intl.formatMessage({id:"xpack.ml.fileDatavisualizer.importProgress.createIndexTitle",defaultMessage:"Create index"});var createIngestPipelineTitle=intl.formatMessage({id:"xpack.ml.fileDatavisualizer.importProgress.createIngestPipelineTitle",defaultMessage:"Create ingest pipeline"});var uploadingDataTitle=intl.formatMessage({id:"xpack.ml.fileDatavisualizer.importProgress.uploadDataTitle",defaultMessage:"Upload data"});var createIndexPatternTitle=intl.formatMessage({id:"xpack.ml.fileDatavisualizer.importProgress.createIndexPatternTitle",defaultMessage:"Create index pattern"});if(completedStep>=0){processFileTitle=intl.formatMessage({id:"xpack.ml.fileDatavisualizer.importProgress.processingFileTitle",defaultMessage:"Processing file"});statusInfo=_react3.default.createElement("p",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importProgress.processingImportedFileDescription",defaultMessage:"Processing file for import"}))}if(completedStep>=1){processFileTitle=intl.formatMessage({id:"xpack.ml.fileDatavisualizer.importProgress.fileProcessedTitle",defaultMessage:"File processed"});createIndexTitle=intl.formatMessage({id:"xpack.ml.fileDatavisualizer.importProgress.creatingIndexTitle",defaultMessage:"Creating index"});statusInfo=_react3.default.createElement("p",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importProgress.stepTwoCreatingIndexIngestPipelineDescription",defaultMessage:"Creating index and ingest pipeline"}))}if(completedStep>=2){createIndexTitle=intl.formatMessage({id:"xpack.ml.fileDatavisualizer.importProgress.indexCreatedTitle",defaultMessage:"Index created"});createIngestPipelineTitle=intl.formatMessage({id:"xpack.ml.fileDatavisualizer.importProgress.creatingIngestPipelineTitle",defaultMessage:"Creating ingest pipeline"});statusInfo=_react3.default.createElement("p",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importProgress.stepThreeCreatingIndexIngestPipelineDescription",defaultMessage:"Creating index and ingest pipeline"}))}if(completedStep>=3){createIngestPipelineTitle=intl.formatMessage({id:"xpack.ml.fileDatavisualizer.importProgress.ingestPipelineCreatedTitle",defaultMessage:"Ingest pipeline created"});uploadingDataTitle=intl.formatMessage({id:"xpack.ml.fileDatavisualizer.importProgress.uploadingDataTitle",defaultMessage:"Uploading data"});statusInfo=_react3.default.createElement(UploadFunctionProgress,{progress:uploadProgress})}if(completedStep>=4){uploadingDataTitle=intl.formatMessage({id:"xpack.ml.fileDatavisualizer.importProgress.dataUploadedTitle",defaultMessage:"Data uploaded"});if(createIndexPattern===true){createIndexPatternTitle=intl.formatMessage({id:"xpack.ml.fileDatavisualizer.importProgress.creatingIndexPatternTitle",defaultMessage:"Creating index pattern"});statusInfo=_react3.default.createElement("p",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importProgress.creatingIndexPatternDescription",defaultMessage:"Creating index pattern"}))}else{statusInfo=null}}if(completedStep>=5){createIndexPatternTitle=intl.formatMessage({id:"xpack.ml.fileDatavisualizer.importProgress.indexPatternCreatedTitle",defaultMessage:"Index pattern created"});statusInfo=null}var steps=[{title:processFileTitle,isSelected:true,isComplete:readStatus===IMPORT_STATUS.COMPLETE,status:readStatus,onClick:function onClick(){}},{title:createIndexTitle,isSelected:readStatus===IMPORT_STATUS.COMPLETE,isComplete:indexCreatedStatus===IMPORT_STATUS.COMPLETE,status:indexCreatedStatus,onClick:function onClick(){}},{title:uploadingDataTitle,isSelected:indexCreatedStatus===IMPORT_STATUS.COMPLETE&&(createPipeline===false||createPipeline===true&&ingestPipelineCreatedStatus===IMPORT_STATUS.COMPLETE),isComplete:uploadStatus===IMPORT_STATUS.COMPLETE,status:uploadStatus,onClick:function onClick(){}}];if(createPipeline===true){steps.splice(2,0,{title:createIngestPipelineTitle,isSelected:indexCreatedStatus===IMPORT_STATUS.COMPLETE,isComplete:ingestPipelineCreatedStatus===IMPORT_STATUS.COMPLETE,status:ingestPipelineCreatedStatus,onClick:function onClick(){}})}if(createIndexPattern===true){steps.push({title:createIndexPatternTitle,isSelected:uploadStatus===IMPORT_STATUS.COMPLETE,isComplete:indexPatternCreatedStatus===IMPORT_STATUS.COMPLETE,status:indexPatternCreatedStatus,onClick:function onClick(){}})}return _react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiStepsHorizontal,{steps:steps,style:{backgroundColor:"transparent"}}),statusInfo&&_react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiSpacer,{size:"m"}),statusInfo))});function UploadFunctionProgress(_ref2){var progress=_ref2.progress;return _react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement("p",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importProgress.uploadingDataDescription",defaultMessage:"Uploading data"})),progress<100&&_react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiSpacer,{size:"s"}),_react3.default.createElement(_eui.EuiProgress,{value:progress,max:100,color:"primary",size:"s"})))}},2575:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _errors=__webpack_require__(2576);Object.defineProperty(exports,"ImportErrors",{enumerable:true,get:function get(){return _errors.ImportErrors}})},2576:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.ImportErrors=ImportErrors;var _react=__webpack_require__(3);var _react2=__webpack_require__(0);var _react3=_interopRequireDefault(_react2);var _eui=__webpack_require__(2);var _import_progress=__webpack_require__(1023);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ImportErrors(_ref){var errors=_ref.errors,statuses=_ref.statuses;return _react3.default.createElement(_eui.EuiCallOut,{title:title(statuses),color:"danger",iconType:"cross"},errors.map(function(e,i){return _react3.default.createElement(ImportError,{error:e,key:i})}))}function title(statuses){switch(_import_progress.IMPORT_STATUS.FAILED){case statuses.readStatus:return _react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importErrors.readingFileErrorMessage",defaultMessage:"Error reading file"});case statuses.indexCreatedStatus:return _react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importErrors.creatingIndexErrorMessage",defaultMessage:"Error creating index"});case statuses.ingestPipelineCreatedStatus:return _react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importErrors.creatingIngestPipelineErrorMessage",defaultMessage:"Error creating ingest pipeline"});case statuses.uploadStatus:return _react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importErrors.uploadingDataErrorMessage",defaultMessage:"Error uploading data"});case statuses.indexPatternCreatedStatus:return _react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importErrors.creatingIndexPatternErrorMessage",defaultMessage:"Error creating index pattern"});default:return _react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importErrors.defaultErrorMessage",defaultMessage:"Error"})}}function ImportError(error,key){var errorObj=toString(error);return _react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement("p",{key:key},errorObj.msg),errorObj.more!==undefined&&_react3.default.createElement(_eui.EuiAccordion,{id:"more",buttonContent:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importErrors.moreButtonLabel",defaultMessage:"More"}),paddingSize:"m"},errorObj.more))}function toString(error){if(typeof error==="string"){return{msg:error}}if((typeof error==="undefined"?"undefined":_typeof(error))==="object"){if(error.msg!==undefined){return{msg:error.msg}}else if(error.error!==undefined){if(_typeof(error.error)==="object"){if(error.error.msg!==undefined){var errorObj={msg:error.error.msg};if(error.error.body!==undefined){errorObj.more=error.error.response}return errorObj}if(error.error.message!==undefined){return{msg:error.error.message}}}else{return{msg:error.error}}}else{return{msg:JSON.stringify(error)}}}return{msg:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importErrors.unknownErrorMessage",defaultMessage:"Unknown error"})}}},2577:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _import_summary=__webpack_require__(2578);Object.defineProperty(exports,"ImportSummary",{enumerable:true,get:function get(){return _import_summary.ImportSummary}})},2578:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ImportSummary=ImportSummary;var _react=__webpack_require__(3);var _react2=__webpack_require__(0);var _react3=_interopRequireDefault(_react2);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ImportSummary(_ref){var index=_ref.index,indexPattern=_ref.indexPattern,ingestPipelineId=_ref.ingestPipelineId,docCount=_ref.docCount,importFailures=_ref.importFailures,createIndexPattern=_ref.createIndexPattern,createPipeline=_ref.createPipeline;var items=createDisplayItems(index,indexPattern,ingestPipelineId,docCount,importFailures,createIndexPattern,createPipeline);return _react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiCallOut,{title:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importSummary.importCompleteTitle",defaultMessage:"Import complete"}),color:"success",iconType:"check"},_react3.default.createElement(_eui.EuiDescriptionList,{type:"column",listItems:items,className:"import-summary-list"})),importFailures&&importFailures.length>0&&_react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiSpacer,{size:"m"}),_react3.default.createElement(_eui.EuiCallOut,{title:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importSummary.documentsCouldNotBeImportedTitle",defaultMessage:"Some documents could not be imported"}),color:"warning",iconType:"help"},_react3.default.createElement("p",null,_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importSummary.documentsCouldNotBeImportedDescription",defaultMessage:"{importFailuresLength} out of {docCount} documents could not be imported. This could be due to lines not matching the Grok pattern.",values:{importFailuresLength:importFailures.length,docCount:docCount}})),_react3.default.createElement(Failures,{failedDocs:importFailures}))))}function Failures(_ref2){var failedDocs=_ref2.failedDocs;return _react3.default.createElement(_eui.EuiAccordion,{id:"failureList",buttonContent:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importSummary.failedDocumentsButtonLabel",defaultMessage:"Failed documents"}),paddingSize:"m"},_react3.default.createElement("div",{className:"failure-list"},failedDocs.map(function(_ref3){var item=_ref3.item,reason=_ref3.reason,doc=_ref3.doc;return _react3.default.createElement("div",{key:item},_react3.default.createElement("div",{className:"error-message"},item,": ",reason),_react3.default.createElement("div",null,JSON.stringify(doc)))})))}function createDisplayItems(index,indexPattern,ingestPipelineId,docCount,importFailures,createIndexPattern,createPipeline){var items=[{title:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importSummary.indexTitle",defaultMessage:"Index"}),description:index},{title:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importSummary.documentsIngestedTitle",defaultMessage:"Documents ingested"}),description:docCount-(importFailures&&importFailures.length||0)}];if(createPipeline){items.splice(1,0,{title:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importSummary.ingestPipelineTitle",defaultMessage:"Ingest pipeline"}),description:ingestPipelineId})}if(createIndexPattern){items.splice(1,0,{title:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importSummary.indexPatternTitle",defaultMessage:"Index pattern"}),description:indexPattern})}if(importFailures&&importFailures.length>0){items.push({title:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.importSummary.failedDocumentsTitle",defaultMessage:"Failed documents"}),description:importFailures.length})}return items}},2579:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _import_settings=__webpack_require__(2580);Object.defineProperty(exports,"ImportSettings",{enumerable:true,get:function get(){return _import_settings.ImportSettings}})},258:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.IntervalHelperProvider=IntervalHelperProvider;exports.getBoundsRoundedToInterval=getBoundsRoundedToInterval;exports.calcEsInterval=calcEsInterval;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _datemath=__webpack_require__(57);var _datemath2=_interopRequireDefault(_datemath);var _ml_calc_auto_interval=__webpack_require__(2305);var _inherits=__webpack_require__(2306);var _time_buckets=__webpack_require__(218);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var unitsDesc=_datemath2.default.unitsDesc;var largeMax=unitsDesc.indexOf("w");function IntervalHelperProvider(Private,config){var calcAuto=Private(_ml_calc_auto_interval.TimeBucketsCalcAutoIntervalProvider);(0,_inherits.inherits)(TimeBuckets,_time_buckets.TimeBuckets);function TimeBuckets(){this.barTarget=config.get("histogram:barTarget");this.maxBars=config.get("histogram:maxBars")}TimeBuckets.prototype.setBarTarget=function(bt){this.barTarget=bt};TimeBuckets.prototype.setMaxBars=function(mb){this.maxBars=mb};TimeBuckets.prototype.getInterval=function(){var self=this;var duration=self.getDuration();return decorateInterval(maybeScaleInterval(readInterval()),duration);function readInterval(){var interval=self._i;if(_moment2.default.isDuration(interval))return interval;return calcAuto.near(self.barTarget,duration)}function maybeScaleInterval(interval){if(!self.hasBounds())return interval;var maxLength=self.maxBars;var approxLen=duration/interval;var scaled=void 0;if(approxLen>maxLength){scaled=calcAuto.lessThan(maxLength,duration)}else{return interval}if(+scaled===+interval)return interval;decorateInterval(interval,duration);return _lodash2.default.assign(scaled,{preScaled:interval,scale:interval/scaled,scaled:true})}};TimeBuckets.prototype.getIntervalToNearestMultiple=function(divisorSecs){var interval=this.getInterval();var intervalSecs=interval.asSeconds();var remainder=intervalSecs%divisorSecs;if(remainder===0){return interval}var nearestMultiple=remainder>divisorSecs/2?intervalSecs+divisorSecs-remainder:intervalSecs-remainder;nearestMultiple=nearestMultiple===0?divisorSecs:nearestMultiple;var nearestMultipleInt=_moment2.default.duration(nearestMultiple,"seconds");decorateInterval(nearestMultipleInt,this.getDuration());var preScaled=_lodash2.default.get(interval,"preScaled");if(preScaled!==undefined&&preScaled<nearestMultipleInt){nearestMultipleInt.preScaled=preScaled;nearestMultipleInt.scale=preScaled/nearestMultipleInt;nearestMultipleInt.scaled=true}return nearestMultipleInt};function decorateInterval(interval,originalDuration){var esInterval=calcEsInterval(interval);interval.esValue=esInterval.value;interval.esUnit=esInterval.unit;interval.expression=esInterval.expression;interval.overflow=originalDuration>interval?_moment2.default.duration(interval-originalDuration):false;var prettyUnits=_moment2.default.normalizeUnits(esInterval.unit);if(esInterval.value===1){interval.description=prettyUnits}else{interval.description=esInterval.value+" "+prettyUnits+"s"}return interval}return TimeBuckets}function getBoundsRoundedToInterval(bounds,interval){var inclusiveEnd=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var intervalMs=interval.asMilliseconds();var adjustedMinMs=Math.floor(bounds.min.valueOf()/intervalMs)*intervalMs;var adjustedMaxMs=Math.ceil(bounds.max.valueOf()/intervalMs)*intervalMs;if(inclusiveEnd===false){adjustedMaxMs=adjustedMaxMs-1}return{min:(0,_moment2.default)(adjustedMinMs),max:(0,_moment2.default)(adjustedMaxMs)}}function calcEsInterval(duration){for(var i=0;i<unitsDesc.length;i++){var unit=unitsDesc[i];var val=duration.as(unit);if(val>=1&&Math.floor(val)===val){if(i<=largeMax&&val!==1){continue}return{value:val,unit:unit,expression:val+unit}}}var ms=duration.as("ms");return{value:ms,unit:"ms",expression:ms+"ms"}}},2580:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ImportSettings=undefined;var _react=__webpack_require__(3);var _react2=__webpack_require__(0);var _react3=_interopRequireDefault(_react2);var _eui=__webpack_require__(2);var _simple=__webpack_require__(2581);var _advanced=__webpack_require__(2582);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ImportSettings=exports.ImportSettings=(0,_react.injectI18n)(function(_ref){var index=_ref.index,indexPattern=_ref.indexPattern,initialized=_ref.initialized,onIndexChange=_ref.onIndexChange,createIndexPattern=_ref.createIndexPattern,onCreateIndexPatternChange=_ref.onCreateIndexPatternChange,onIndexPatternChange=_ref.onIndexPatternChange,indexSettingsString=_ref.indexSettingsString,mappingsString=_ref.mappingsString,pipelineString=_ref.pipelineString,onIndexSettingsStringChange=_ref.onIndexSettingsStringChange,onMappingsStringChange=_ref.onMappingsStringChange,onPipelineStringChange=_ref.onPipelineStringChange,indexNameError=_ref.indexNameError,indexPatternNameError=_ref.indexPatternNameError,intl=_ref.intl;var tabs=[{id:"simple-settings",name:intl.formatMessage({id:"xpack.ml.fileDatavisualizer.importSettings.simpleTabName",defaultMessage:"Simple"}),content:_react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiSpacer,{size:"m"}),_react3.default.createElement(_simple.SimpleSettings,{index:index,initialized:initialized,onIndexChange:onIndexChange,createIndexPattern:createIndexPattern,onCreateIndexPatternChange:onCreateIndexPatternChange,indexNameError:indexNameError}))},{id:"advanced-settings",name:intl.formatMessage({id:"xpack.ml.fileDatavisualizer.importSettings.advancedTabName",defaultMessage:"Advanced"}),content:_react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiSpacer,{size:"m"}),_react3.default.createElement(_advanced.AdvancedSettings,{index:index,indexPattern:indexPattern,initialized:initialized,onIndexChange:onIndexChange,createIndexPattern:createIndexPattern,onCreateIndexPatternChange:onCreateIndexPatternChange,onIndexPatternChange:onIndexPatternChange,indexSettingsString:indexSettingsString,mappingsString:mappingsString,pipelineString:pipelineString,onIndexSettingsStringChange:onIndexSettingsStringChange,onMappingsStringChange:onMappingsStringChange,onPipelineStringChange:onPipelineStringChange,indexNameError:indexNameError,indexPatternNameError:indexPatternNameError}))}];return _react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiTabbedContent,{tabs:tabs,initialSelectedTab:tabs[0],onTabClick:function onTabClick(){}}))})},2581:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SimpleSettings=undefined;var _react=__webpack_require__(3);var _react2=__webpack_require__(0);var _react3=_interopRequireDefault(_react2);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var SimpleSettings=exports.SimpleSettings=(0,_react.injectI18n)(function(_ref){var index=_ref.index,initialized=_ref.initialized,onIndexChange=_ref.onIndexChange,createIndexPattern=_ref.createIndexPattern,onCreateIndexPatternChange=_ref.onCreateIndexPatternChange,indexNameError=_ref.indexNameError,intl=_ref.intl;return _react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiFormRow,{label:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.simpleImportSettings.indexNameFormRowLabel",defaultMessage:"Index name"}),isInvalid:indexNameError!=="",error:[indexNameError]},_react3.default.createElement(_eui.EuiFieldText,{placeholder:intl.formatMessage({id:"xpack.ml.fileDatavisualizer.simpleImportSettings.indexNamePlaceholder",defaultMessage:"index name"}),value:index,disabled:initialized===true,onChange:onIndexChange,isInvalid:indexNameError!==""})),_react3.default.createElement(_eui.EuiCheckbox,{id:"createIndexPattern",label:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.simpleImportSettings.createIndexPatternLabel",defaultMessage:"Create index pattern"}),checked:createIndexPattern===true,disabled:initialized===true,onChange:onCreateIndexPatternChange}))})},2582:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AdvancedSettings=undefined;var _react=__webpack_require__(3);var _react2=__webpack_require__(0);var _react3=_interopRequireDefault(_react2);var _eui=__webpack_require__(2);var _ml_job_editor=__webpack_require__(403);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EDITOR_HEIGHT="300px";function AdvancedSettingsUi(_ref){var index=_ref.index,indexPattern=_ref.indexPattern,initialized=_ref.initialized,onIndexChange=_ref.onIndexChange,createIndexPattern=_ref.createIndexPattern,onCreateIndexPatternChange=_ref.onCreateIndexPatternChange,onIndexPatternChange=_ref.onIndexPatternChange,indexSettingsString=_ref.indexSettingsString,mappingsString=_ref.mappingsString,pipelineString=_ref.pipelineString,onIndexSettingsStringChange=_ref.onIndexSettingsStringChange,onMappingsStringChange=_ref.onMappingsStringChange,onPipelineStringChange=_ref.onPipelineStringChange,indexNameError=_ref.indexNameError,indexPatternNameError=_ref.indexPatternNameError,intl=_ref.intl;return _react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiFormRow,{label:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.advancedImportSettings.indexNameLabel",defaultMessage:"Index name"}),isInvalid:indexNameError!=="",error:[indexNameError]},_react3.default.createElement(_eui.EuiFieldText,{placeholder:intl.formatMessage({id:"xpack.ml.fileDatavisualizer.advancedImportSettings.indexNamePlaceholder",defaultMessage:"index name"}),value:index,disabled:initialized===true,onChange:onIndexChange,isInvalid:indexNameError!==""})),_react3.default.createElement(_eui.EuiCheckbox,{id:"createIndexPattern",label:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.advancedImportSettings.createIndexPatternLabel",defaultMessage:"Create index pattern"}),checked:createIndexPattern===true,disabled:initialized===true,onChange:onCreateIndexPatternChange}),_react3.default.createElement(_eui.EuiSpacer,{size:"s"}),_react3.default.createElement(_eui.EuiFormRow,{label:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.advancedImportSettings.indexPatternNameLabel",defaultMessage:"Index pattern name"}),disabled:createIndexPattern===false||initialized===true,isInvalid:indexPatternNameError!=="",error:[indexPatternNameError]},_react3.default.createElement(_eui.EuiFieldText,{disabled:createIndexPattern===false||initialized===true,placeholder:createIndexPattern===true?index:"",value:indexPattern,onChange:onIndexPatternChange,isInvalid:indexPatternNameError!==""})),_react3.default.createElement(_eui.EuiFlexGroup,null,_react3.default.createElement(_eui.EuiFlexItem,null,_react3.default.createElement(IndexSettings,{initialized:initialized,data:indexSettingsString,onChange:onIndexSettingsStringChange})),_react3.default.createElement(_eui.EuiFlexItem,null,_react3.default.createElement(Mappings,{initialized:initialized,data:mappingsString,onChange:onMappingsStringChange})),_react3.default.createElement(_eui.EuiFlexItem,null,_react3.default.createElement(IngestPipeline,{initialized:initialized,data:pipelineString,onChange:onPipelineStringChange}))))}var AdvancedSettings=exports.AdvancedSettings=(0,_react.injectI18n)(AdvancedSettingsUi);function IndexSettings(_ref2){var initialized=_ref2.initialized,data=_ref2.data,onChange=_ref2.onChange;return _react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiFormRow,{label:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.advancedImportSettings.indexSettingsLabel",defaultMessage:"Index settings"}),disabled:initialized===true,fullWidth:true},_react3.default.createElement(_ml_job_editor.MLJobEditor,{mode:_ml_job_editor.EDITOR_MODE.JSON,readOnly:initialized===true,value:data,height:EDITOR_HEIGHT,syntaxChecking:false,onChange:onChange})))}function Mappings(_ref3){var initialized=_ref3.initialized,data=_ref3.data,onChange=_ref3.onChange;return _react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiFormRow,{label:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.advancedImportSettings.mappingsLabel",defaultMessage:"Mappings"}),disabled:initialized===true,fullWidth:true},_react3.default.createElement(_ml_job_editor.MLJobEditor,{mode:_ml_job_editor.EDITOR_MODE.JSON,readOnly:initialized===true,value:data,height:EDITOR_HEIGHT,syntaxChecking:false,onChange:onChange})))}function IngestPipeline(_ref4){var initialized=_ref4.initialized,data=_ref4.data,onChange=_ref4.onChange;return _react3.default.createElement(_react3.default.Fragment,null,_react3.default.createElement(_eui.EuiFormRow,{label:_react3.default.createElement(_react.FormattedMessage,{id:"xpack.ml.fileDatavisualizer.advancedImportSettings.ingestPipelineLabel",defaultMessage:"Ingest pipeline"}),disabled:initialized===true,fullWidth:true},_react3.default.createElement(_ml_job_editor.MLJobEditor,{mode:_ml_job_editor.EDITOR_MODE.JSON,readOnly:initialized===true,value:data,height:EDITOR_HEIGHT,syntaxChecking:false,onChange:onChange})))}},2583:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var MAX_BYTES=exports.MAX_BYTES=104857600;var INDEX_META_DATA_CREATED_BY=exports.INDEX_META_DATA_CREATED_BY="ml_file_data_visualizer"},2584:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.readFile=readFile;exports.reduceData=reduceData;exports.createUrlOverrides=createUrlOverrides;exports.processResults=processResults;var _overrides=__webpack_require__(2585);var _lodash=__webpack_require__(1);function readFile(file){return new Promise(function(resolve,reject){if(file&&file.size){var reader=new FileReader;reader.readAsText(file);reader.onload=function(){return function(){var data=reader.result;if(data===""){reject()}else{resolve({data:data})}}}(file)}else{reject()}})}function reduceData(data,mb){var size=mb*Math.pow(2,20);return data.length>=size?data.slice(0,size):data}function createUrlOverrides(overrides,originalSettings){var formattedOverrides={};for(var o in _overrides.overrideDefaults){if(_overrides.overrideDefaults.hasOwnProperty(o)){var value=overrides[o];if(Array.isArray(value)&&(0,_lodash.isEqual)(value,originalSettings[o])||value===undefined||value===originalSettings[o]){value=""}var snakeCaseO=o.replace(/([A-Z])/g,function($1){return"_"+$1.toLowerCase()});formattedOverrides[snakeCaseO]=value}}if(formattedOverrides.format===""&&originalSettings.format==="delimited"){if(formattedOverrides.should_trim_fields!==""||formattedOverrides.has_header_row!==""||formattedOverrides.delimiter!==""||formattedOverrides.quote!==""||formattedOverrides.column_names!==""){formattedOverrides.format=originalSettings.format}}if(formattedOverrides.format===""&&originalSettings.format==="semi_structured_text"){if(formattedOverrides.grok_pattern!==""){formattedOverrides.format=originalSettings.format}}if(formattedOverrides.format==="ndjson"||originalSettings.format==="ndjson"){formattedOverrides.should_trim_fields="";formattedOverrides.has_header_row="";formattedOverrides.delimiter="";formattedOverrides.quote="";formattedOverrides.column_names=""}if(formattedOverrides.grok_pattern!==""){formattedOverrides.grok_pattern=encodeURIComponent(formattedOverrides.grok_pattern)}return formattedOverrides}function processResults(results){var timestampFormat=results.joda_timestamp_formats!==undefined&&results.joda_timestamp_formats.length?results.joda_timestamp_formats[0]:undefined;return{format:results.format,delimiter:results.delimiter,timestampField:results.timestamp_field,timestampFormat:timestampFormat,quote:results.quote,hasHeaderRow:results.has_header_row,shouldTrimFields:results.should_trim_fields,charset:results.charset,columnNames:results.column_names,grokPattern:results.grok_pattern}}},2585:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var overrideDefaults=exports.overrideDefaults={timestampFormat:undefined,timestampField:undefined,format:undefined,delimiter:undefined,quote:undefined,hasHeaderRow:undefined,charset:undefined,columnNames:undefined,shouldTrimFields:undefined,grokPattern:undefined}},259:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var EVENT_RATE_COUNT_FIELD=exports.EVENT_RATE_COUNT_FIELD="__ml_event_rate_count__";var WIZARD_TYPE=exports.WIZARD_TYPE={SINGLE_METRIC:"single-metric-wizard",MULTI_METRIC:"multi-metric-wizard",POPULATION:"population-wizard"}},273:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var DRAG_SELECT_ACTION=exports.DRAG_SELECT_ACTION={NEW_SELECTION:"newSelection",ELEMENT_SELECT:"elementSelect",DRAG_START:"dragStart"};var SWIMLANE_DEFAULT_LIMIT=exports.SWIMLANE_DEFAULT_LIMIT=10;var SWIMLANE_TYPE=exports.SWIMLANE_TYPE={OVERALL:"overall",VIEW_BY:"viewBy"};var CHART_TYPE=exports.CHART_TYPE={EVENT_DISTRIBUTION:"event_distribution",POPULATION_DISTRIBUTION:"population_distribution",SINGLE_METRIC:"single_metric"}},274:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FieldTypeIcon=undefined;var _field_type_icon=__webpack_require__(996);Object.defineProperty(exports,"FieldTypeIcon",{enumerable:true,get:function get(){return _field_type_icon.FieldTypeIcon}});__webpack_require__(2318)},296:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.http=http;var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);__webpack_require__(445);var _system_api=__webpack_require__(439);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function http(options){return new Promise(function(resolve,reject){if(options&&options.url){var url="";url=url+(options.url||"");var headers=(0,_system_api.addSystemApiHeader)(_extends({"Content-Type":"application/json","kbn-version":_chrome2.default.getXsrfToken()},options.headers));var allHeaders=options.headers===undefined?headers:_extends({},options.headers,headers);var body=options.data===undefined?null:JSON.stringify(options.data);var payload={method:options.method||"GET",headers:allHeaders,credentials:"same-origin"};if(body!==null){payload.body=body}fetch(url,payload).then(function(resp){resp.json().then(resp.ok===true?resolve:reject)}).catch(function(resp){reject(resp)})}else{reject()}})}},297:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.loadFullJob=loadFullJob;exports.isStartable=isStartable;exports.isStoppable=isStoppable;exports.isClosable=isClosable;exports.forceStartDatafeeds=forceStartDatafeeds;exports.stopDatafeeds=stopDatafeeds;exports.cloneJob=cloneJob;exports.closeJobs=closeJobs;exports.deleteJobs=deleteJobs;exports.filterJobs=filterJobs;var _lodash=__webpack_require__(1);var _notify=__webpack_require__(10);var _messagebar_service=__webpack_require__(178);var _job_service=__webpack_require__(23);var _ml_api_service=__webpack_require__(22);var _states=__webpack_require__(401);var _i18n=__webpack_require__(9);function loadFullJob(jobId){return new Promise(function(resolve,reject){_ml_api_service.ml.jobs.jobs(jobId).then(function(jobs){if(jobs.length){resolve(jobs[0])}else{throw new Error("Could not find job "+jobId)}}).catch(function(error){reject(error)})})}function isStartable(jobs){return jobs.some(function(j){return j.datafeedState===_states.DATAFEED_STATE.STOPPED})}function isStoppable(jobs){return jobs.some(function(j){return j.datafeedState===_states.DATAFEED_STATE.STARTED})}function isClosable(jobs){return jobs.some(function(j){return j.datafeedState===_states.DATAFEED_STATE.STOPPED&&j.jobState!==_states.JOB_STATE.CLOSED})}function forceStartDatafeeds(jobs,start,end){var finish=arguments.length>3&&arguments[3]!==undefined?arguments[3]:function(){};var datafeedIds=jobs.filter(function(j){return j.hasDatafeed}).map(function(j){return j.datafeedId});_job_service.mlJobService.forceStartDatafeeds(datafeedIds,start,end).then(function(resp){showResults(resp,_states.DATAFEED_STATE.STARTED);finish()}).catch(function(error){_messagebar_service.mlMessageBarService.notify.error(error);_notify.toastNotifications.addDanger(_i18n.i18n.translate("xpack.ml.jobsList.startJobErrorMessage",{defaultMessage:"Jobs failed to start"}),error);finish()})}function stopDatafeeds(jobs){var finish=arguments.length>1&&arguments[1]!==undefined?arguments[1]:function(){};var datafeedIds=jobs.filter(function(j){return j.hasDatafeed}).map(function(j){return j.datafeedId});_job_service.mlJobService.stopDatafeeds(datafeedIds).then(function(resp){showResults(resp,_states.DATAFEED_STATE.STOPPED);finish()}).catch(function(error){_messagebar_service.mlMessageBarService.notify.error(error);_notify.toastNotifications.addDanger(_i18n.i18n.translate("xpack.ml.jobsList.stopJobErrorMessage",{defaultMessage:"Jobs failed to stop"}),error);finish()})}function showResults(resp,action){var successes=[];var failures=[];for(var d in resp){if(resp[d][action]===true||resp[d][action]===false&&resp[d].error.statusCode===409&&action===_states.DATAFEED_STATE.STARTED){successes.push(d)}else{failures.push({id:d,result:resp[d]})}}var actionText="";var actionTextPT="";if(action===_states.DATAFEED_STATE.STARTED){actionText=_i18n.i18n.translate("xpack.ml.jobsList.startActionStatusText",{defaultMessage:"start"});actionTextPT=_i18n.i18n.translate("xpack.ml.jobsList.startedActionStatusText",{defaultMessage:"started"})}else if(action===_states.DATAFEED_STATE.STOPPED){actionText=_i18n.i18n.translate("xpack.ml.jobsList.stopActionStatusText",{defaultMessage:"stop"});actionTextPT=_i18n.i18n.translate("xpack.ml.jobsList.stoppedActionStatusText",{defaultMessage:"stopped"})}else if(action===_states.DATAFEED_STATE.DELETED){actionText=_i18n.i18n.translate("xpack.ml.jobsList.deleteActionStatusText",{defaultMessage:"delete"});actionTextPT=_i18n.i18n.translate("xpack.ml.jobsList.deletedActionStatusText",{defaultMessage:"deleted"})}else if(action===_states.JOB_STATE.CLOSED){actionText=_i18n.i18n.translate("xpack.ml.jobsList.closeActionStatusText",{defaultMessage:"close"});actionTextPT=_i18n.i18n.translate("xpack.ml.jobsList.closedActionStatusText",{defaultMessage:"closed"})}_notify.toastNotifications.addSuccess(_i18n.i18n.translate("xpack.ml.jobsList.actionExecuteSuccessfullyNotificationMessage",{defaultMessage:"{successesJobsCount, plural, one{{successJob}} other{# jobs}} {actionTextPT} successfully",values:{successesJobsCount:successes.length,successJob:successes[0],actionTextPT:actionTextPT}}));if(failures.length>0){failures.forEach(function(f){_messagebar_service.mlMessageBarService.notify.error(f.result.error);_notify.toastNotifications.addDanger(_i18n.i18n.translate("xpack.ml.jobsList.actionFailedNotificationMessage",{defaultMessage:"{failureId} failed to {actionText}",values:{failureId:f.id,actionText:actionText}}))})}}function cloneJob(jobId){loadFullJob(jobId).then(function(job){_job_service.mlJobService.currentJob=job;window.location.href="#/jobs/new_job"}).catch(function(error){_messagebar_service.mlMessageBarService.notify.error(error);_notify.toastNotifications.addDanger(_i18n.i18n.translate("xpack.ml.jobsList.cloneJobErrorMessage",{defaultMessage:"Could not clone {jobId}. Job could not be found",values:{jobId:jobId}}))})}function closeJobs(jobs){var finish=arguments.length>1&&arguments[1]!==undefined?arguments[1]:function(){};var jobIds=jobs.map(function(j){return j.id});_job_service.mlJobService.closeJobs(jobIds).then(function(resp){showResults(resp,_states.JOB_STATE.CLOSED);finish()}).catch(function(error){_messagebar_service.mlMessageBarService.notify.error(error);_notify.toastNotifications.addDanger(_i18n.i18n.translate("xpack.ml.jobsList.closeJobErrorMessage",{defaultMessage:"Jobs failed to close"}),error);finish()})}function deleteJobs(jobs){var finish=arguments.length>1&&arguments[1]!==undefined?arguments[1]:function(){};var jobIds=jobs.map(function(j){return j.id});_job_service.mlJobService.deleteJobs(jobIds).then(function(resp){showResults(resp,_states.DATAFEED_STATE.DELETED);finish()}).catch(function(error){_messagebar_service.mlMessageBarService.notify.error(error);_notify.toastNotifications.addDanger(_i18n.i18n.translate("xpack.ml.jobsList.deleteJobErrorMessage",{defaultMessage:"Jobs failed to delete"}),error);finish()})}function filterJobs(jobs,clauses){if(clauses.length===0){return jobs}var matches=jobs.reduce(function(p,c){p[c.id]={job:c,count:0};return p},{});clauses.forEach(function(c){var bool=c.match==="must";var js=[];if(c.type==="term"){if(bool===true){js=jobs.filter(function(job){return stringMatch(job.id,c.value)===bool||stringMatch(job.description,c.value)===bool||stringMatch(job.memory_status,c.value)===bool})}else{js=jobs.filter(function(job){return stringMatch(job.id,c.value)===bool&&stringMatch(job.description,c.value)===bool&&stringMatch(job.memory_status,c.value)===bool})}}else{if(Array.isArray(c.value)){js=jobs.filter(function(job){return jobProperty(job,c.field).some(function(g){return c.value.indexOf(g)>=0})})}else{js=jobs.filter(function(job){return jobProperty(job,c.field)===c.value})}}js.forEach(function(j){return matches[j.id].count++})});var filteredJobs=[];(0,_lodash.each)(matches,function(m){if(m.count>=clauses.length){filteredJobs.push(m.job)}});return filteredJobs}function stringMatch(str,substr){return typeof str==="string"&&typeof substr==="string"&&str.toLowerCase().match(substr.toLowerCase())===null===false}function jobProperty(job,prop){var propMap={job_state:"jobState",datafeed_state:"datafeedState",groups:"groups"};return job[propMap[prop]]}},298:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ACTION=exports.ACTION={SKIP_MODEL_UPDATE:"skip_model_update",SKIP_RESULT:"skip_result"};var FILTER_TYPE=exports.FILTER_TYPE={EXCLUDE:"exclude",INCLUDE:"include"};var APPLIES_TO=exports.APPLIES_TO={ACTUAL:"actual",DIFF_FROM_TYPICAL:"diff_from_typical",TYPICAL:"typical"};var OPERATOR=exports.OPERATOR={LESS_THAN:"lt",LESS_THAN_OR_EQUAL:"lte",GREATER_THAN:"gt",GREATER_THAN_OR_EQUAL:"gte"};var CONDITIONS_NOT_SUPPORTED_FUNCTIONS=exports.CONDITIONS_NOT_SUPPORTED_FUNCTIONS=["freq_rare","lat_long","metric","rare"]},299:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.formatValue=formatValue;var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _modules=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");var SIGFIGS_IF_ROUNDING=3;function formatValue(value,mlFunction,fieldFormat){if(Array.isArray(value)){if(value.length===1){return formatSingleValue(value[0],mlFunction,fieldFormat)}else{var values=value.map(function(val){return formatSingleValue(val,mlFunction,fieldFormat)});return"["+values+"]"}}else{return formatSingleValue(value,mlFunction,fieldFormat)}}function formatSingleValue(value,mlFunction,fieldFormat){if(value===undefined||value===null){return""}if(mlFunction==="time_of_week"){var d=new Date;var i=parseInt(value);d.setTime(i*1e3);return(0,_moment2.default)(d).format("ddd hh:mm")}else if(mlFunction==="time_of_day"){var _d=new Date;var _i=parseInt(value);_d.setTime(_i*1e3);return(0,_moment2.default)(_d).format("hh:mm")}else{if(fieldFormat!==undefined){return fieldFormat.convert(value,"text")}else{var absValue=Math.abs(value);if(absValue>=1e4||absValue===Math.floor(absValue)){if(fieldFormat!==undefined){return fieldFormat.convert(value,"text")}else{return Number(value.toFixed(0))}}else if(absValue>=10){return Number(value.toFixed(1))}else{var multiple=void 0;if(value>0){multiple=Math.pow(10,SIGFIGS_IF_ROUNDING-Math.floor(Math.log(value)/Math.LN10)-1)}else{multiple=Math.pow(10,SIGFIGS_IF_ROUNDING-Math.floor(Math.log(-1*value)/Math.LN10)-1)}return Math.round(value*multiple)/multiple}}}}_module.filter("formatValue",function(){return formatValue})},3092:function(module,exports,__webpack_require__){module.exports=__webpack_require__(7)(2993)},3110:function(module,exports,__webpack_require__){module.exports=__webpack_require__(7)(3431)},3111:function(module,exports,__webpack_require__){module.exports=__webpack_require__(7)(2420)},3112:function(module,exports,__webpack_require__){module.exports=__webpack_require__(7)(205)},3122:function(module,exports,__webpack_require__){module.exports=__webpack_require__(7)(965)},3156:function(module,exports,__webpack_require__){module.exports=__webpack_require__(7)(2667)},32:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.checkGetJobsPrivilege=checkGetJobsPrivilege;exports.checkCreateJobsPrivilege=checkCreateJobsPrivilege;exports.checkFindFileStructurePrivilege=checkFindFileStructurePrivilege;exports.checkPermission=checkPermission;exports.createPermissionFailureMessage=createPermissionFailureMessage;var _get_privileges=__webpack_require__(2198);var _check_license=__webpack_require__(43);var privileges={};function checkGetJobsPrivilege(Private,Promise,kbnUrl){return new Promise(function(resolve,reject){(0,_get_privileges.getPrivileges)().then(function(priv){privileges=priv;if(privileges.canGetJobs){return resolve(privileges)}else{kbnUrl.redirect("/access-denied");return reject()}})})}function checkCreateJobsPrivilege(Private,Promise,kbnUrl){return new Promise(function(resolve,reject){(0,_get_privileges.getPrivileges)().then(function(priv){privileges=priv;if(privileges.canCreateJob){return resolve(privileges)}else{kbnUrl.redirect("/jobs");return reject()}})})}function checkFindFileStructurePrivilege(Private,Promise,kbnUrl){return new Promise(function(resolve,reject){(0,_get_privileges.getPrivileges)().then(function(priv){privileges=priv;if(privileges.canFindFileStructure){return resolve(privileges)}else{kbnUrl.redirect("/access-denied");return reject()}})})}function checkPermission(privilegeType){var licenseHasExpired=(0,_check_license.hasLicenseExpired)();return privileges[privilegeType]===true&&licenseHasExpired!==true}function createPermissionFailureMessage(privilegeType){var message="";var licenseHasExpired=(0,_check_license.hasLicenseExpired)();if(licenseHasExpired){message="Your license has expired."}else if(privilegeType==="canCreateJob"){message="You do not have permission to create Machine Learning jobs."}else if(privilegeType==="canStartStopDatafeed"){message="You do not have permission to start or stop datafeeds."}else if(privilegeType==="canUpdateJob"){message="You do not have permission to edit jobs."}else if(privilegeType==="canDeleteJob"){message="You do not have permission to delete jobs."}else if(privilegeType==="canCreateCalendar"){message="You do not have permission to create calendars."}else if(privilegeType==="canDeleteCalendar"){message="You do not have permission to delete calendars."}else if(privilegeType==="canForecastJob"){message="You do not have permission to run forecasts."}return message+" Please contact your administrator."}},337:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mlCreateWatchService=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _http_service=__webpack_require__(296);var _email=__webpack_require__(2247);var _email2=_interopRequireDefault(_email);var _emailInfluencers=__webpack_require__(2248);var _emailInfluencers2=_interopRequireDefault(_emailInfluencers);var _watch=__webpack_require__(2249);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var compiledEmailBody=_lodash2.default.template(_email2.default);var emailSection={send_email:{throttle_period_in_millis:9e5,email:{profile:"standard",to:[],subject:"ML Watcher Alert",body:{html:""}}}};function randomNumber(min,max){return Math.floor(Math.random()*(max-min+1)+min)}function saveWatch(watchModel){var basePath=_chrome2.default.addBasePath("/api/watcher");var url=basePath+"/watch/"+watchModel.id;return(0,_http_service.http)({url:url,method:"PUT",data:watchModel.upstreamJSON})}var CreateWatchService=function(){function CreateWatchService(){_classCallCheck(this,CreateWatchService);this.createNewWatch=function(jobId){var _this=this;return new Promise(function(resolve,reject){_this.status.watch=_this.STATUS.SAVING;if(jobId!==undefined){var id="ml-"+jobId;_this.config.id=id;_watch.watch.input.search.request.body.query.bool.filter[0].term.job_id=jobId;_watch.watch.input.search.request.body.query.bool.filter[1].range.timestamp.gte="now-"+_this.config.interval;_watch.watch.input.search.request.body.aggs.bucket_results.filter.range.anomaly_score.gte=_this.config.threshold.val;if(_this.config.includeEmail&&_this.config.email!==""){var emails=_this.config.email.split(",");emailSection.send_email.email.to=emails;emailSection.send_email.email.body.html=compiledEmailBody({serverAddress:_chrome2.default.getAppUrl(),influencersSection:_this.config.includeInfluencers===true?_emailInfluencers2.default:""});_watch.watch.actions.send_email=emailSection.send_email}var triggerInterval=randomNumber(60,120);_watch.watch.trigger.schedule.interval=triggerInterval+"s";var watchModel={id:id,upstreamJSON:{id:id,type:"json",watch:_watch.watch}};if(id!==""){saveWatch(watchModel).then(function(){_this.status.watch=_this.STATUS.SAVED;_this.config.watcherEditURL=_chrome2.default.getBasePath()+"/app/kibana#/management/elasticsearch/watcher/watches/watch/"+id+"/edit?_g=()";resolve({id:id,url:_this.config.watcherEditURL})}).catch(function(resp){_this.status.watch=_this.STATUS.SAVE_FAILED;reject(resp)})}}else{_this.status.watch=_this.STATUS.SAVE_FAILED;reject()}})};this.config={};this.STATUS={SAVE_FAILED:-1,SAVING:0,SAVED:1};this.status={realtimeJob:null,watch:null}}_createClass(CreateWatchService,[{key:"reset",value:function reset(){this.status.realtimeJob=null;this.status.watch=null;this.config.id="";this.config.includeEmail=false;this.config.email="";this.config.interval="20m";this.config.watcherEditURL="";this.config.includeInfluencers=false;this.config.threshold={display:"critical",val:75}}},{key:"loadWatch",value:function loadWatch(jobId){var id="ml-"+jobId;var basePath=_chrome2.default.addBasePath("/api/watcher");var url=basePath+"/watch/"+id;return(0,_http_service.http)({url:url,method:"GET"})}}]);return CreateWatchService}();var mlCreateWatchService=exports.mlCreateWatchService=new CreateWatchService},338:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mlResultsService=undefined;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _job_utils=__webpack_require__(34);var _string_utils=__webpack_require__(38);var _index_patterns=__webpack_require__(404);var _ml_api_service=__webpack_require__(22);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function getScoresByBucket(jobIds,earliestMs,latestMs,interval,maxResults){return new Promise(function(resolve,reject){var obj={success:true,results:{}};var boolCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}}];if(jobIds&&jobIds.length>0&&!(jobIds.length===1&&jobIds[0]==="*")){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){if(i>0){jobIdFilterStr+=" OR "}jobIdFilterStr+="job_id:";jobIdFilterStr+=jobId});boolCriteria.push({query_string:{analyze_wildcard:false,query:jobIdFilterStr}})}_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:bucket",analyze_wildcard:false}},{bool:{must:boolCriteria}}]}},aggs:{jobId:{terms:{field:"job_id",size:maxResults!==undefined?maxResults:5,order:{anomalyScore:"desc"}},aggs:{anomalyScore:{max:{field:"anomaly_score"}},byTime:{date_histogram:{field:"timestamp",interval:interval,min_doc_count:1,extended_bounds:{min:earliestMs,max:latestMs}},aggs:{anomalyScore:{max:{field:"anomaly_score"}}}}}}}}}).then(function(resp){var dataByJobId=_lodash2.default.get(resp,["aggregations","jobId","buckets"],[]);_lodash2.default.each(dataByJobId,function(dataForJob){var jobId=dataForJob.key;var resultsForTime={};var dataByTime=_lodash2.default.get(dataForJob,["byTime","buckets"],[]);_lodash2.default.each(dataByTime,function(dataForTime){var value=_lodash2.default.get(dataForTime,["anomalyScore","value"]);if(value!==undefined){var time=dataForTime.key;resultsForTime[time]=_lodash2.default.get(dataForTime,["anomalyScore","value"])}});obj.results[jobId]=resultsForTime});resolve(obj)}).catch(function(resp){reject(resp)})})}function getScheduledEventsByBucket(jobIds,earliestMs,latestMs,interval,maxJobs,maxEvents){return new Promise(function(resolve,reject){var obj={success:true,events:{}};var boolCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{exists:{field:"scheduled_events"}}];if(jobIds&&jobIds.length>0&&!(jobIds.length===1&&jobIds[0]==="*")){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){jobIdFilterStr+=(i>0?" OR ":"")+"job_id:"+jobId});boolCriteria.push({query_string:{analyze_wildcard:false,query:jobIdFilterStr}})}_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:bucket",analyze_wildcard:false}},{bool:{must:boolCriteria}}]}},aggs:{jobs:{terms:{field:"job_id",min_doc_count:1,size:maxJobs},aggs:{times:{date_histogram:{field:"timestamp",interval:interval,min_doc_count:1},aggs:{events:{terms:{field:"scheduled_events",size:maxEvents}}}}}}}}}).then(function(resp){var dataByJobId=_lodash2.default.get(resp,["aggregations","jobs","buckets"],[]);_lodash2.default.each(dataByJobId,function(dataForJob){var jobId=dataForJob.key;var resultsForTime={};var dataByTime=_lodash2.default.get(dataForJob,["times","buckets"],[]);_lodash2.default.each(dataByTime,function(dataForTime){var time=dataForTime.key;var events=_lodash2.default.get(dataForTime,["events","buckets"]);resultsForTime[time]=_lodash2.default.map(events,"key")});obj.events[jobId]=resultsForTime});resolve(obj)}).catch(function(resp){reject(resp)})})}function getTopInfluencers(jobIds,earliestMs,latestMs){var maxFieldValues=arguments.length>3&&arguments[3]!==undefined?arguments[3]:10;var influencers=arguments.length>4&&arguments[4]!==undefined?arguments[4]:[];return new Promise(function(resolve,reject){var obj={success:true,influencers:{}};var boolCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{range:{influencer_score:{gt:0}}}];if(jobIds&&jobIds.length>0&&!(jobIds.length===1&&jobIds[0]==="*")){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){if(i>0){jobIdFilterStr+=" OR "}jobIdFilterStr+="job_id:";jobIdFilterStr+=jobId});boolCriteria.push({query_string:{analyze_wildcard:false,query:jobIdFilterStr}})}if(influencers.length>0){boolCriteria.push({bool:{should:influencers.map(function(influencer){return{bool:{must:[{term:{influencer_field_name:influencer.fieldName}},{term:{influencer_field_value:influencer.fieldValue}}]}}}),minimum_should_match:1}})}_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:influencer",analyze_wildcard:false}},{bool:{must:boolCriteria}}]}},aggs:{influencerFieldNames:{terms:{field:"influencer_field_name",size:5,order:{maxAnomalyScore:"desc"}},aggs:{maxAnomalyScore:{max:{field:"influencer_score"}},influencerFieldValues:{terms:{field:"influencer_field_value",size:maxFieldValues,order:{maxAnomalyScore:"desc"}},aggs:{maxAnomalyScore:{max:{field:"influencer_score"}},sumAnomalyScore:{sum:{field:"influencer_score"}}}}}}}}}).then(function(resp){var fieldNameBuckets=_lodash2.default.get(resp,["aggregations","influencerFieldNames","buckets"],[]);_lodash2.default.each(fieldNameBuckets,function(nameBucket){var fieldName=nameBucket.key;var fieldValues=[];var fieldValueBuckets=_lodash2.default.get(nameBucket,["influencerFieldValues","buckets"],[]);_lodash2.default.each(fieldValueBuckets,function(valueBucket){var fieldValueResult={influencerFieldValue:valueBucket.key,maxAnomalyScore:valueBucket.maxAnomalyScore.value,sumAnomalyScore:valueBucket.sumAnomalyScore.value};fieldValues.push(fieldValueResult)});obj.influencers[fieldName]=fieldValues});resolve(obj)}).catch(function(resp){reject(resp)})})}function getTopInfluencerValues(jobIds,influencerFieldName,earliestMs,latestMs,maxResults){return new Promise(function(resolve,reject){var obj={success:true,results:[]};var boolCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}}];if(jobIds&&jobIds.length>0&&!(jobIds.length===1&&jobIds[0]==="*")){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){if(i>0){jobIdFilterStr+=" OR "}jobIdFilterStr+="job_id:";jobIdFilterStr+=jobId});boolCriteria.push({query_string:{analyze_wildcard:false,query:jobIdFilterStr}})}_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:influencer AND influencer_field_name: "+(0,_string_utils.escapeForElasticsearchQuery)(influencerFieldName),analyze_wildcard:false}},{bool:{must:boolCriteria}}]}},aggs:{influencerFieldValues:{terms:{field:"influencer_field_value",size:maxResults!==undefined?maxResults:2,order:{maxAnomalyScore:"desc"}},aggs:{maxAnomalyScore:{max:{field:"influencer_score"}},sumAnomalyScore:{sum:{field:"influencer_score"}}}}}}}).then(function(resp){var buckets=_lodash2.default.get(resp,["aggregations","influencerFieldValues","buckets"],[]);_lodash2.default.each(buckets,function(bucket){var result={influencerFieldValue:bucket.key,maxAnomalyScore:bucket.maxAnomalyScore.value,sumAnomalyScore:bucket.sumAnomalyScore.value};obj.results.push(result)});resolve(obj)}).catch(function(resp){reject(resp)})})}function getOverallBucketScores(jobIds,topN,earliestMs,latestMs,interval){return new Promise(function(resolve,reject){var obj={success:true,results:{}};_ml_api_service.ml.overallBuckets({jobId:jobIds,topN:topN,bucketSpan:interval,start:earliestMs,end:latestMs}).then(function(resp){var dataByTime=_lodash2.default.get(resp,["overall_buckets"],[]);_lodash2.default.each(dataByTime,function(dataForTime){var value=_lodash2.default.get(dataForTime,["overall_score"]);if(value!==undefined){obj.results[dataForTime.timestamp]=value}});resolve(obj)}).catch(function(resp){reject(resp)})})}function getInfluencerValueMaxScoreByTime(jobIds,influencerFieldName,influencerFieldValues,earliestMs,latestMs,interval,maxResults){return new Promise(function(resolve,reject){var obj={success:true,results:{}};var boolCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{range:{influencer_score:{gt:0}}}];if(jobIds&&jobIds.length>0&&!(jobIds.length===1&&jobIds[0]==="*")){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){if(i>0){jobIdFilterStr+=" OR "}jobIdFilterStr+="job_id:"+jobId});boolCriteria.push({query_string:{analyze_wildcard:false,query:jobIdFilterStr}})}if(influencerFieldValues&&influencerFieldValues.length>0){var influencerFilterStr="";_lodash2.default.each(influencerFieldValues,function(value,i){if(i>0){influencerFilterStr+=" OR "}if(value.trim().length>0){influencerFilterStr+="influencer_field_value:"+(0,_string_utils.escapeForElasticsearchQuery)(value)}else{influencerFilterStr+='influencer_field_value:"'+value+'"'}});boolCriteria.push({query_string:{analyze_wildcard:false,query:influencerFilterStr}})}_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:influencer AND influencer_field_name: "+(0,_string_utils.escapeForElasticsearchQuery)(influencerFieldName),analyze_wildcard:false}},{bool:{must:boolCriteria}}]}},aggs:{influencerFieldValues:{terms:{field:"influencer_field_value",size:maxResults!==undefined?maxResults:10,order:{maxAnomalyScore:"desc"}},aggs:{maxAnomalyScore:{max:{field:"influencer_score"}},byTime:{date_histogram:{field:"timestamp",interval:interval,min_doc_count:1},aggs:{maxAnomalyScore:{max:{field:"influencer_score"}}}}}}}}}).then(function(resp){var fieldValueBuckets=_lodash2.default.get(resp,["aggregations","influencerFieldValues","buckets"],[]);_lodash2.default.each(fieldValueBuckets,function(valueBucket){var fieldValue=valueBucket.key;var fieldValues={};var timeBuckets=_lodash2.default.get(valueBucket,["byTime","buckets"],[]);_lodash2.default.each(timeBuckets,function(timeBucket){var time=timeBucket.key;var score=timeBucket.maxAnomalyScore.value;fieldValues[time]=score});obj.results[fieldValue]=fieldValues});resolve(obj)}).catch(function(resp){reject(resp)})})}function getRecordInfluencers(jobIds,threshold,earliestMs,latestMs,maxResults){return new Promise(function(resolve,reject){var obj={success:true,records:[]};var boolCriteria=[{nested:{path:"influencers",query:{bool:{must:[{exists:{field:"influencers"}}]}}}},{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{range:{record_score:{gte:threshold}}}];if(jobIds&&jobIds.length>0&&!(jobIds.length===1&&jobIds[0]==="*")){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){if(i>0){jobIdFilterStr+=" OR "}jobIdFilterStr+="job_id:";jobIdFilterStr+=jobId});boolCriteria.push({query_string:{analyze_wildcard:false,query:jobIdFilterStr}})}_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:maxResults!==undefined?maxResults:100,rest_total_hits_as_int:true,body:{_source:["job_id","detector_index","influencers","record_score"],query:{bool:{filter:[{query_string:{query:"result_type:record",analyze_wildcard:false}},{bool:{must:boolCriteria}}]}},sort:[{record_score:{order:"desc"}}]}}).then(function(resp){if(resp.hits.total!==0){_lodash2.default.each(resp.hits.hits,function(hit){obj.records.push(hit._source)})}resolve(obj)}).catch(function(resp){reject(resp)})})}function getRecordsForInfluencer(jobIds,influencers,threshold,earliestMs,latestMs,maxResults){return new Promise(function(resolve,reject){var obj={success:true,records:[]};var boolCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{range:{record_score:{gte:threshold}}}];if(jobIds&&jobIds.length>0&&!(jobIds.length===1&&jobIds[0]==="*")){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){if(i>0){jobIdFilterStr+=" OR "}jobIdFilterStr+="job_id:";jobIdFilterStr+=jobId});boolCriteria.push({query_string:{analyze_wildcard:false,query:jobIdFilterStr}})}if(influencers.length>0){boolCriteria.push({bool:{should:influencers.map(function(influencer){return{nested:{path:"influencers",query:{bool:{must:[{match:{"influencers.influencer_field_name":influencer.fieldName}},{match:{"influencers.influencer_field_values":influencer.fieldValue}}]}}}}}),minimum_should_match:1}})}_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:maxResults!==undefined?maxResults:100,rest_total_hits_as_int:true,body:{query:{bool:{filter:[{query_string:{query:"result_type:record",analyze_wildcard:false}},{bool:{must:boolCriteria}}]}},sort:[{record_score:{order:"desc"}}]}}).then(function(resp){if(resp.hits.total!==0){_lodash2.default.each(resp.hits.hits,function(hit){obj.records.push(hit._source)})}resolve(obj)}).catch(function(resp){reject(resp)})})}function getRecordsForDetector(jobId,detectorIndex,checkForInfluencers,influencerFieldName,influencerFieldValue,threshold,earliestMs,latestMs,maxResults){return new Promise(function(resolve,reject){var obj={success:true,records:[]};var boolCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{term:{job_id:jobId}},{term:{detector_index:detectorIndex}},{range:{record_score:{gte:threshold}}}];if(influencerFieldName&&influencerFieldValue){boolCriteria.push({nested:{path:"influencers",query:{bool:{must:[{match:{"influencers.influencer_field_name":influencerFieldName}},{match:{"influencers.influencer_field_values":influencerFieldValue}}]}}}})}else{if(checkForInfluencers===true){boolCriteria.push({nested:{path:"influencers",query:{bool:{must:[{exists:{field:"influencers"}}]}}}})}}_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:maxResults!==undefined?maxResults:100,rest_total_hits_as_int:true,body:{query:{bool:{filter:[{query_string:{query:"result_type:record",analyze_wildcard:false}},{bool:{must:boolCriteria}}]}},sort:[{record_score:{order:"desc"}}]}}).then(function(resp){if(resp.hits.total!==0){_lodash2.default.each(resp.hits.hits,function(hit){obj.records.push(hit._source)})}resolve(obj)}).catch(function(resp){reject(resp)})})}function getRecords(jobIds,threshold,earliestMs,latestMs,maxResults){return this.getRecordsForInfluencer(jobIds,[],threshold,earliestMs,latestMs,maxResults)}function getRecordsForCriteria(jobIds,criteriaFields,threshold,earliestMs,latestMs,maxResults){return new Promise(function(resolve,reject){var obj={success:true,records:[]};var boolCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{range:{record_score:{gte:threshold}}}];if(jobIds&&jobIds.length>0&&!(jobIds.length===1&&jobIds[0]==="*")){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){if(i>0){jobIdFilterStr+=" OR "}jobIdFilterStr+="job_id:";jobIdFilterStr+=jobId});boolCriteria.push({query_string:{analyze_wildcard:false,query:jobIdFilterStr}})}_lodash2.default.each(criteriaFields,function(criteria){boolCriteria.push({term:_defineProperty({},criteria.fieldName,criteria.fieldValue)})});_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,rest_total_hits_as_int:true,size:maxResults!==undefined?maxResults:100,body:{query:{bool:{filter:[{query_string:{query:"result_type:record",analyze_wildcard:false}},{bool:{must:boolCriteria}}]}},sort:[{record_score:{order:"desc"}}]}}).then(function(resp){if(resp.hits.total!==0){_lodash2.default.each(resp.hits.hits,function(hit){obj.records.push(hit._source)})}resolve(obj)}).catch(function(resp){reject(resp)})})}function getMetricData(index,types,entityFields,query,metricFunction,metricFieldName,timeFieldName,earliestMs,latestMs,interval){return new Promise(function(resolve,reject){var obj={success:true,results:{}};var mustCriteria=[];var shouldCriteria=[];if(types&&types.length){mustCriteria.push({terms:{_type:types}})}mustCriteria.push({range:_defineProperty({},timeFieldName,{gte:earliestMs,lte:latestMs,format:"epoch_millis"})});if(query){mustCriteria.push(query)}_lodash2.default.each(entityFields,function(entity){if(entity.fieldValue.length!==0){mustCriteria.push({term:_defineProperty({},entity.fieldName,entity.fieldValue)})}else{shouldCriteria.push({bool:{must:[{term:_defineProperty({},entity.fieldName,"")}]}});shouldCriteria.push({bool:{must_not:[{exists:{field:entity.fieldName}}]}})}});var body={query:{bool:{must:mustCriteria}},size:0,_source:{excludes:[]},aggs:{byTime:{date_histogram:{field:timeFieldName,interval:interval,min_doc_count:0}}}};if(shouldCriteria.length>0){body.query.bool.should=shouldCriteria;body.query.bool.minimum_should_match=shouldCriteria.length/2}if(metricFieldName!==undefined&&metricFieldName!==""){body.aggs.byTime.aggs={};var metricAgg=_defineProperty({},metricFunction,{field:metricFieldName});if(metricFunction==="percentiles"){metricAgg[metricFunction].percents=[_job_utils.ML_MEDIAN_PERCENTS]}body.aggs.byTime.aggs.metric=metricAgg}_ml_api_service.ml.esSearch({index:index,body:body}).then(function(resp){var dataByTime=_lodash2.default.get(resp,["aggregations","byTime","buckets"],[]);_lodash2.default.each(dataByTime,function(dataForTime){if(metricFunction==="count"){obj.results[dataForTime.key]=dataForTime.doc_count}else{var value=_lodash2.default.get(dataForTime,["metric","value"]);var values=_lodash2.default.get(dataForTime,["metric","values"]);if(dataForTime.doc_count===0){obj.results[dataForTime.key]=null}else if(value!==undefined){obj.results[dataForTime.key]=value}else if(values!==undefined){var medianValues=values[_job_utils.ML_MEDIAN_PERCENTS];obj.results[dataForTime.key]=!isNaN(medianValues)?medianValues:null}else{obj.results[dataForTime.key]=null}}});resolve(obj)}).catch(function(resp){reject(resp)})})}function getEventRateData(index,query,timeFieldName,earliestMs,latestMs,interval){return new Promise(function(resolve,reject){var obj={success:true,results:{}};var mustCriteria=[{range:_defineProperty({},timeFieldName,{gte:earliestMs,lte:latestMs,format:"epoch_millis"})}];if(query){mustCriteria.push(query)}_ml_api_service.ml.esSearch({index:index,rest_total_hits_as_int:true,size:0,body:{query:{bool:{must:mustCriteria}},_source:{excludes:[]},aggs:{eventRate:{date_histogram:{field:timeFieldName,interval:interval,min_doc_count:0,extended_bounds:{min:earliestMs,max:latestMs}}}}}}).then(function(resp){var dataByTimeBucket=_lodash2.default.get(resp,["aggregations","eventRate","buckets"],[]);_lodash2.default.each(dataByTimeBucket,function(dataForTime){var time=dataForTime.key;obj.results[time]=dataForTime.doc_count});obj.total=resp.hits.total;resolve(obj)}).catch(function(resp){reject(resp)})})}var SAMPLER_TOP_TERMS_SHARD_SIZE=5e4;var ENTITY_AGGREGATION_SIZE=10;var AGGREGATION_MIN_DOC_COUNT=1;function getEventDistributionData(index,types,splitField){var filterField=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var query=arguments[4];var metricFunction=arguments[5];var metricFieldName=arguments[6];var timeFieldName=arguments[7];var earliestMs=arguments[8];var latestMs=arguments[9];var interval=arguments[10];return new Promise(function(resolve,reject){if(splitField===undefined){return resolve([])}var mustCriteria=[];if(types&&types.length){mustCriteria.push({terms:{_type:types}})}mustCriteria.push({range:_defineProperty({},timeFieldName,{gte:earliestMs,lte:latestMs,format:"epoch_millis"})});if(query){mustCriteria.push(query)}if(filterField!==null){mustCriteria.push({term:_defineProperty({},filterField.fieldName,filterField.fieldValue)})}var body={query:{function_score:{query:{bool:{must:mustCriteria}},functions:[{random_score:{seed:10,field:"_seq_no"}}]}},size:0,_source:{excludes:[]},aggs:{sample:{sampler:{shard_size:SAMPLER_TOP_TERMS_SHARD_SIZE},aggs:{byTime:{date_histogram:{field:timeFieldName,interval:interval,min_doc_count:AGGREGATION_MIN_DOC_COUNT},aggs:{entities:{terms:{field:splitField.fieldName,size:ENTITY_AGGREGATION_SIZE,min_doc_count:AGGREGATION_MIN_DOC_COUNT}}}}}}}};if(metricFieldName!==undefined&&metricFieldName!==""){body.aggs.sample.aggs.byTime.aggs.entities.aggs={};var metricAgg=_defineProperty({},metricFunction,{field:metricFieldName});if(metricFunction==="percentiles"){metricAgg[metricFunction].percents=[_job_utils.ML_MEDIAN_PERCENTS]}body.aggs.sample.aggs.byTime.aggs.entities.aggs.metric=metricAgg}_ml_api_service.ml.esSearch({index:index,body:body}).then(function(resp){var totalHits=_lodash2.default.get(resp,["hits","total"],0);var successfulShards=_lodash2.default.get(resp,["_shards","successful"],0);var normalizeFactor=1;if(totalHits>successfulShards*SAMPLER_TOP_TERMS_SHARD_SIZE){normalizeFactor=totalHits/(successfulShards*SAMPLER_TOP_TERMS_SHARD_SIZE)}var dataByTime=_lodash2.default.get(resp,["aggregations","sample","byTime","buckets"],[]);var data=dataByTime.reduce(function(d,dataForTime){var date=+dataForTime.key;var entities=_lodash2.default.get(dataForTime,["entities","buckets"],[]);entities.forEach(function(entity){var value=metricFunction==="count"?entity.doc_count:entity.metric.value;if(metricFunction==="count"||metricFunction==="distinct_count"||metricFunction==="sum"){value=value*normalizeFactor}d.push({date:date,entity:entity.key,value:value})});return d},[]);resolve(data)}).catch(function(resp){reject(resp)})})}function getModelPlotOutput(jobId,detectorIndex,criteriaFields,earliestMs,latestMs,interval,aggType){return new Promise(function(resolve,reject){var obj={success:true,results:{}};var modelAggs=aggType===undefined?{max:"max",min:"min"}:{max:aggType.max,min:aggType.min};var mustCriteria=[{term:{job_id:jobId}},{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}}];_lodash2.default.each(criteriaFields,function(criteria){mustCriteria.push({term:_defineProperty({},criteria.fieldName,criteria.fieldValue)})});var shouldCriteria=[{term:{detector_index:detectorIndex}},{bool:{must_not:[{exists:{field:"detector_index"}}]}}];_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:model_plot",analyze_wildcard:true}},{bool:{must:mustCriteria,should:shouldCriteria,minimum_should_match:1}}]}},aggs:{times:{date_histogram:{field:"timestamp",interval:interval,min_doc_count:0},aggs:{actual:{avg:{field:"actual"}},modelUpper:_defineProperty({},modelAggs.max,{field:"model_upper"}),modelLower:_defineProperty({},modelAggs.min,{field:"model_lower"})}}}}}).then(function(resp){var aggregationsByTime=_lodash2.default.get(resp,["aggregations","times","buckets"],[]);_lodash2.default.each(aggregationsByTime,function(dataForTime){var time=dataForTime.key;var modelUpper=_lodash2.default.get(dataForTime,["modelUpper","value"]);var modelLower=_lodash2.default.get(dataForTime,["modelLower","value"]);var actual=_lodash2.default.get(dataForTime,["actual","value"]);if(modelUpper===undefined||isFinite(modelUpper)===false){modelUpper=null}if(modelLower===undefined||isFinite(modelLower)===false){modelLower=null}obj.results[time]={actual:actual,modelUpper:modelUpper,modelLower:modelLower}});resolve(obj)}).catch(function(resp){reject(resp)})})}function getRecordMaxScoreByTime(jobId,criteriaFields,earliestMs,latestMs,interval){return new Promise(function(resolve,reject){var obj={success:true,results:{}};var mustCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{term:{job_id:jobId}}];var shouldCriteria=[];_lodash2.default.each(criteriaFields,function(criteria){if(criteria.fieldValue.length!==0){mustCriteria.push({term:_defineProperty({},criteria.fieldName,criteria.fieldValue)})}else{var emptyFieldCondition={bool:{must:[{term:{}}]}};emptyFieldCondition.bool.must[0].term[criteria.fieldName]="";shouldCriteria.push(emptyFieldCondition);shouldCriteria.push({bool:{must_not:[{exists:{field:criteria.fieldName}}]}})}});_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:record",analyze_wildcard:true}},{bool:{must:mustCriteria}}]}},aggs:{times:{date_histogram:{field:"timestamp",interval:interval,min_doc_count:1},aggs:{recordScore:{max:{field:"record_score"}}}}}}}).then(function(resp){var aggregationsByTime=_lodash2.default.get(resp,["aggregations","times","buckets"],[]);_lodash2.default.each(aggregationsByTime,function(dataForTime){var time=dataForTime.key;obj.results[time]={score:_lodash2.default.get(dataForTime,["recordScore","value"])}});resolve(obj)}).catch(function(resp){reject(resp)})})}var mlResultsService=exports.mlResultsService={getScoresByBucket:getScoresByBucket,getScheduledEventsByBucket:getScheduledEventsByBucket,getTopInfluencers:getTopInfluencers,getTopInfluencerValues:getTopInfluencerValues,getOverallBucketScores:getOverallBucketScores,getInfluencerValueMaxScoreByTime:getInfluencerValueMaxScoreByTime,getRecordInfluencers:getRecordInfluencers,getRecordsForInfluencer:getRecordsForInfluencer,getRecordsForDetector:getRecordsForDetector,getRecords:getRecords,getRecordsForCriteria:getRecordsForCriteria,getMetricData:getMetricData,getEventRateData:getEventRateData,getEventDistributionData:getEventDistributionData,getModelPlotOutput:getModelPlotOutput,getRecordMaxScoreByTime:getRecordMaxScoreByTime}},339:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getFieldTypeFromMapping=getFieldTypeFromMapping;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _ml_api_service=__webpack_require__(22);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getFieldTypeFromMapping(index,fieldName){return new Promise(function(resolve,reject){if(index!==""){_ml_api_service.ml.getFieldCaps({index:index,fields:[fieldName]}).then(function(resp){var fieldType="";_lodash2.default.each(resp.fields,function(field){_lodash2.default.each(field,function(type){if(fieldType===""){fieldType=type.type}})});resolve(fieldType)}).catch(function(error){reject(error)})}else{reject()}})}},34:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ML_DATA_PREVIEW_COUNT=exports.ML_MEDIAN_PERCENTS=undefined;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.calculateDatafeedFrequencyDefaultSeconds=calculateDatafeedFrequencyDefaultSeconds;exports.isTimeSeriesViewJob=isTimeSeriesViewJob;exports.isTimeSeriesViewDetector=isTimeSeriesViewDetector;exports.isTimeSeriesViewFunction=isTimeSeriesViewFunction;exports.getPartitioningFieldNames=getPartitioningFieldNames;exports.isModelPlotEnabled=isModelPlotEnabled;exports.isJobVersionGte=isJobVersionGte;exports.mlFunctionToESAggregation=mlFunctionToESAggregation;exports.isJobIdValid=isJobIdValid;exports.prefixDatafeedId=prefixDatafeedId;exports.getSafeAggregationName=getSafeAggregationName;exports.uniqWithIsEqual=uniqWithIsEqual;exports.basicJobValidation=basicJobValidation;exports.validateModelMemoryLimit=validateModelMemoryLimit;exports.validateModelMemoryLimitUnits=validateModelMemoryLimitUnits;exports.validateGroupNames=validateGroupNames;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _semver=__webpack_require__(627);var _semver2=_interopRequireDefault(_semver);var _numeral=__webpack_require__(212);var _numeral2=_interopRequireDefault(_numeral);var _validation=__webpack_require__(400);var _parse_interval=__webpack_require__(219);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function calculateDatafeedFrequencyDefaultSeconds(bucketSpanSeconds){var freq=3600;if(bucketSpanSeconds<=120){freq=60}else if(bucketSpanSeconds<=1200){freq=Math.floor(bucketSpanSeconds/2)}else if(bucketSpanSeconds<=43200){freq=600}return freq}function isTimeSeriesViewJob(job){var isViewable=false;var dtrs=job.analysis_config.detectors;for(var i=0;i<dtrs.length;i++){isViewable=isTimeSeriesViewDetector(job,i);if(isViewable===true){break}}return isViewable}function isTimeSeriesViewDetector(job,dtrIndex){var isDetectorViewable=false;var dtrs=job.analysis_config.detectors;if(dtrIndex>=0&&dtrIndex<dtrs.length){var dtr=dtrs[dtrIndex];isDetectorViewable=isTimeSeriesViewFunction(dtr.function)===true&&dtr.by_field_name!=="mlcategory"&&dtr.partition_field_name!=="mlcategory"&&dtr.over_field_name!=="mlcategory";var usesScriptFields=_lodash2.default.has(job,"datafeed_config.script_fields");if(isDetectorViewable===true&&usesScriptFields===true){var scriptFields=usesScriptFields?_lodash2.default.keys(job.datafeed_config.script_fields):[];isDetectorViewable=scriptFields.indexOf(dtr.field_name)===-1&&scriptFields.indexOf(dtr.partition_field_name)===-1&&scriptFields.indexOf(dtr.by_field_name)===-1&&scriptFields.indexOf(dtr.over_field_name)===-1}}return isDetectorViewable}function isTimeSeriesViewFunction(functionName){return mlFunctionToESAggregation(functionName)!==null}function getPartitioningFieldNames(job,detectorIndex){var fieldNames=[];var detector=job.analysis_config.detectors[detectorIndex];if(_lodash2.default.has(detector,"partition_field_name")){fieldNames.push(detector.partition_field_name)}if(_lodash2.default.has(detector,"by_field_name")){fieldNames.push(detector.by_field_name)}if(_lodash2.default.has(detector,"over_field_name")){fieldNames.push(detector.over_field_name)}return fieldNames}function isModelPlotEnabled(job,detectorIndex,entityFields){var isEnabled=_lodash2.default.get(job,["model_plot_config","enabled"],false);if(isEnabled===true){var termsStr=_lodash2.default.get(job,["model_plot_config","terms"],"");if(termsStr!==""){var detector=job.analysis_config.detectors[detectorIndex];var detectorHasPartitionField=_lodash2.default.has(detector,"partition_field_name");var detectorHasByField=_lodash2.default.has(detector,"by_field_name");var terms=termsStr.split(",");if(detectorHasPartitionField===true){var partitionEntity=_lodash2.default.find(entityFields,{fieldName:detector.partition_field_name});isEnabled=partitionEntity!==undefined&&terms.indexOf(partitionEntity.fieldValue)!==-1}if(isEnabled===true&&detectorHasByField===true){var byEntity=_lodash2.default.find(entityFields,{fieldName:detector.by_field_name});isEnabled=byEntity!==undefined&&terms.indexOf(byEntity.fieldValue)!==-1}}}return isEnabled}function isJobVersionGte(job,version){var jobVersion=_lodash2.default.get(job,"job_version","0.0.0");return _semver2.default.gte(jobVersion,version)}function mlFunctionToESAggregation(functionName){if(functionName==="mean"||functionName==="high_mean"||functionName==="low_mean"||functionName==="metric"){return"avg"}if(functionName==="sum"||functionName==="high_sum"||functionName==="low_sum"||functionName==="non_null_sum"||functionName==="low_non_null_sum"||functionName==="high_non_null_sum"){return"sum"}if(functionName==="count"||functionName==="high_count"||functionName==="low_count"||functionName==="non_zero_count"||functionName==="low_non_zero_count"||functionName==="high_non_zero_count"){return"count"}if(functionName==="distinct_count"||functionName==="low_distinct_count"||functionName==="high_distinct_count"){return"cardinality"}if(functionName==="median"||functionName==="high_median"||functionName==="low_median"){return"percentiles"}if(functionName==="min"||functionName==="max"){return functionName}if(functionName==="rare"){return"count"}return null}function isJobIdValid(jobId){return jobId.match(/^[a-z0-9\-\_]{1,64}$/g)&&!jobId.match(/^([_-].*)?(.*[_-])?$/g)?true:false}var ML_MEDIAN_PERCENTS=exports.ML_MEDIAN_PERCENTS="50.0";var ML_DATA_PREVIEW_COUNT=exports.ML_DATA_PREVIEW_COUNT=10;function prefixDatafeedId(datafeedId,prefix){return datafeedId.match(/^datafeed-/)?datafeedId.replace(/^datafeed-/,"datafeed-"+prefix):""+prefix+datafeedId}function getSafeAggregationName(fieldName,index){return fieldName.match(/^[a-zA-Z0-9-_.]+$/)?fieldName:"field_"+index}function uniqWithIsEqual(arr){return arr.reduce(function(dedupedArray,value){if(dedupedArray.filter(function(compareValue){return _lodash2.default.isEqual(compareValue,value)}).length===0){dedupedArray.push(value)}return dedupedArray},[])}function basicJobValidation(job,fields,limits){var skipMmlChecks=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var messages=[];var valid=true;if(job){if(_lodash2.default.isEmpty(job.job_id)){messages.push({id:"job_id_empty"});valid=false}else if(isJobIdValid(job.job_id)===false){messages.push({id:"job_id_invalid"});valid=false}else{messages.push({id:"job_id_valid"})}var _validateGroupNames=validateGroupNames(job),groupsMessages=_validateGroupNames.messages,groupsValid=_validateGroupNames.valid;messages.push.apply(messages,_toConsumableArray(groupsMessages));valid=valid&&groupsValid;if(job.analysis_config.categorization_filters){var v=true;_lodash2.default.each(job.analysis_config.categorization_filters,function(d){try{new RegExp(d)}catch(e){v=false}if(job.analysis_config.categorization_field_name===undefined||job.analysis_config.categorization_field_name===""){v=false}if(d===""){v=false}});if(v){messages.push({id:"categorization_filters_valid"})}else{messages.push({id:"categorization_filters_invalid"});valid=false}}if(job.analysis_config.detectors.length===0){messages.push({id:"detectors_empty"});valid=false}else{var _v=true;_lodash2.default.each(job.analysis_config.detectors,function(d){if(_lodash2.default.isEmpty(d.function)){_v=false}});if(_v){messages.push({id:"detectors_function_not_empty"})}else{messages.push({id:"detectors_function_empty"});valid=false}}if(job.analysis_config.detectors.length>=2){var compareSubSet=job.analysis_config.detectors.map(function(d){return _lodash2.default.pick(d,["function","field_name","by_field_name","over_field_name","partition_field_name"])});var dedupedSubSet=uniqWithIsEqual(compareSubSet);if(compareSubSet.length!==dedupedSubSet.length){messages.push({id:"detectors_duplicates"});valid=false}}if(job.analysis_config.bucket_span===""||job.analysis_config.bucket_span===undefined){messages.push({id:"bucket_span_empty"});valid=false}else{var bucketSpan=(0,_parse_interval.parseInterval)(job.analysis_config.bucket_span,false);if(bucketSpan===null||bucketSpan.asMilliseconds()===0){messages.push({id:"bucket_span_invalid"});valid=false}else{messages.push({id:"bucket_span_valid",bucketSpan:job.analysis_config.bucket_span})}}if(typeof fields!=="undefined"){var loadedFields=Object.keys(fields);if(loadedFields.length===0){messages.push({id:"index_fields_invalid"});valid=false}else{messages.push({id:"index_fields_valid"})}}if(skipMmlChecks===false){var _validateModelMemoryL=validateModelMemoryLimitUnits(job),mmlUnitMessages=_validateModelMemoryL.messages,mmlUnitValid=_validateModelMemoryL.valid;messages.push.apply(messages,_toConsumableArray(mmlUnitMessages));valid=valid&&mmlUnitValid;if(mmlUnitValid){var _validateModelMemoryL2=validateModelMemoryLimit(job,limits),mmlMessages=_validateModelMemoryL2.messages,mmlValid=_validateModelMemoryL2.valid;messages.push.apply(messages,_toConsumableArray(mmlMessages));valid=valid&&mmlValid}}}else{valid=false}return{messages:messages,valid:valid,contains:function contains(id){return messages.some(function(m){return id===m.id})},find:function find(id){return messages.find(function(m){return id===m.id})}}}function validateModelMemoryLimit(job,limits){var messages=[];var valid=true;if(typeof job.analysis_limits!=="undefined"&&typeof job.analysis_limits.model_memory_limit!=="undefined"){if((typeof limits==="undefined"?"undefined":_typeof(limits))==="object"&&typeof limits.max_model_memory_limit!=="undefined"){var max=limits.max_model_memory_limit.toUpperCase();var mml=job.analysis_limits.model_memory_limit.toUpperCase();var mmlBytes=(0,_numeral2.default)(mml).value();var maxBytes=(0,_numeral2.default)(max).value();if(mmlBytes>maxBytes){messages.push({id:"model_memory_limit_invalid"});valid=false}else{messages.push({id:"model_memory_limit_valid"})}}}return{valid:valid,messages:messages,contains:function contains(id){return messages.some(function(m){return id===m.id})},find:function find(id){return messages.find(function(m){return id===m.id})}}}function validateModelMemoryLimitUnits(job){var messages=[];var valid=true;if(typeof job.analysis_limits!=="undefined"&&typeof job.analysis_limits.model_memory_limit!=="undefined"){var mml=job.analysis_limits.model_memory_limit.toUpperCase();var mmlSplit=mml.match(/\d+(\w+)/);var unit=mmlSplit&&mmlSplit.length===2?mmlSplit[1]:null;if(_validation.ALLOWED_DATA_UNITS.indexOf(unit)===-1){messages.push({id:"model_memory_limit_units_invalid"});valid=false}else{messages.push({id:"model_memory_limit_units_valid"})}}return{valid:valid,messages:messages,contains:function contains(id){return messages.some(function(m){return id===m.id})},find:function find(id){return messages.find(function(m){return id===m.id})}}}function validateGroupNames(job){var messages=[];var valid=true;if(job.groups!==undefined){var groupIdValid=true;job.groups.forEach(function(group){if(isJobIdValid(group)===false){groupIdValid=false;valid=false}});if(job.groups.length>0&&groupIdValid){messages.push({id:"job_group_id_valid"})}else if(job.groups.length>0&&!groupIdValid){messages.push({id:"job_group_id_invalid"})}}return{valid:valid,messages:messages,contains:function contains(id){return messages.some(function(m){return id===m.id})},find:function find(id){return messages.find(function(m){return id===m.id})}}}},340:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.getNewConditionDefaults=getNewConditionDefaults;exports.getNewRuleDefaults=getNewRuleDefaults;exports.getScopeFieldDefaults=getScopeFieldDefaults;exports.isValidRule=isValidRule;exports.saveJobRule=saveJobRule;exports.deleteJobRule=deleteJobRule;exports.updateJobRules=updateJobRules;exports.addItemToFilter=addItemToFilter;exports.buildRuleDescription=buildRuleDescription;exports.filterTypeToText=filterTypeToText;exports.appliesToText=appliesToText;exports.operatorToText=operatorToText;exports.getAppliesToValueFromAnomaly=getAppliesToValueFromAnomaly;var _detector_rule=__webpack_require__(298);var _lodash=__webpack_require__(1);var _ml_api_service=__webpack_require__(22);var _job_service=__webpack_require__(23);function getNewConditionDefaults(){return{applies_to:_detector_rule.APPLIES_TO.ACTUAL,operator:_detector_rule.OPERATOR.LESS_THAN,value:1}}function getNewRuleDefaults(){return{actions:[_detector_rule.ACTION.SKIP_RESULT],conditions:[]}}function getScopeFieldDefaults(filterListIds){var defaults={filter_type:_detector_rule.FILTER_TYPE.INCLUDE,enabled:false};if(filterListIds!==undefined&&filterListIds.length>0){defaults.filter_id=filterListIds[0]}return defaults}function isValidRule(rule){var isValid=false;var actions=rule.actions;if(actions.length>0){var conditions=rule.conditions;if(conditions!==undefined&&conditions.length>0){isValid=true}else{var scope=rule.scope;if(scope!==undefined){isValid=Object.keys(scope).some(function(field){return scope[field].enabled===true})}}}return isValid}function saveJobRule(job,detectorIndex,ruleIndex,editedRule){var detector=job.analysis_config.detectors[detectorIndex];var clonedRule=(0,_lodash.cloneDeep)(editedRule);var scope=clonedRule.scope;if(scope!==undefined){Object.keys(scope).forEach(function(field){if(scope[field].enabled===false){delete scope[field]}else{delete scope[field].enabled}})}var rules=[];if(detector.custom_rules===undefined){rules=[clonedRule]}else{rules=(0,_lodash.cloneDeep)(detector.custom_rules);if(ruleIndex<rules.length){rules[ruleIndex]=clonedRule}else{rules.push(clonedRule)}}return updateJobRules(job,detectorIndex,rules)}function deleteJobRule(job,detectorIndex,ruleIndex){var detector=job.analysis_config.detectors[detectorIndex];var customRules=[];if(detector.custom_rules!==undefined&&ruleIndex<detector.custom_rules.length){customRules=(0,_lodash.cloneDeep)(detector.custom_rules);customRules.splice(ruleIndex,1);return updateJobRules(job,detectorIndex,customRules)}else{return Promise.reject(new Error("Rule no longer exists for detector index "+detectorIndex+" in job "+job.job_id))}}function updateJobRules(job,detectorIndex,rules){var jobId=job.job_id;var jobData={detectors:[{detector_index:detectorIndex,custom_rules:rules}]};var customSettings={};if(job.custom_settings!==undefined){customSettings=_extends({},job.custom_settings);delete customSettings.created_by;jobData.custom_settings=customSettings}return new Promise(function(resolve,reject){_job_service.mlJobService.updateJob(jobId,jobData).then(function(resp){if(resp.success){_job_service.mlJobService.refreshJob(jobId).then(function(){resolve({success:true})}).catch(function(refreshResp){reject(refreshResp)})}else{reject(resp)}}).catch(function(resp){reject(resp)})})}function addItemToFilter(item,filterId){return new Promise(function(resolve,reject){_ml_api_service.ml.filters.updateFilter(filterId,undefined,[item],undefined).then(function(updatedFilter){resolve(updatedFilter)}).catch(function(error){reject(error)})})}function buildRuleDescription(rule){var actions=rule.actions,conditions=rule.conditions,scope=rule.scope;var description="skip ";actions.forEach(function(action,i){if(i>0){description+=" AND "}switch(action){case _detector_rule.ACTION.SKIP_RESULT:description+="result";break;case _detector_rule.ACTION.SKIP_MODEL_UPDATE:description+="model update";break}});description+=" when ";if(conditions!==undefined){conditions.forEach(function(condition,i){if(i>0){description+=" AND "}description+=appliesToText(condition.applies_to)+" is "+operatorToText(condition.operator)+" "+condition.value})}if(scope!==undefined){if(conditions!==undefined&&conditions.length>0){description+=" AND "}var fieldNames=Object.keys(scope);fieldNames.forEach(function(fieldName,i){if(i>0){description+=" AND "}var filter=scope[fieldName];description+=fieldName+" is "+filterTypeToText(filter.filter_type)+" "+filter.filter_id})}return description}function filterTypeToText(filterType){switch(filterType){case _detector_rule.FILTER_TYPE.INCLUDE:return"in";case _detector_rule.FILTER_TYPE.EXCLUDE:return"not in";default:return filterType!==undefined?filterType:""}}function appliesToText(appliesTo){switch(appliesTo){case _detector_rule.APPLIES_TO.ACTUAL:return"actual";case _detector_rule.APPLIES_TO.TYPICAL:return"typical";case _detector_rule.APPLIES_TO.DIFF_FROM_TYPICAL:return"diff from typical";default:return appliesTo!==undefined?appliesTo:""}}function operatorToText(operator){switch(operator){case _detector_rule.OPERATOR.LESS_THAN:return"less than";case _detector_rule.OPERATOR.LESS_THAN_OR_EQUAL:return"less than or equal to";case _detector_rule.OPERATOR.GREATER_THAN:return"greater than";case _detector_rule.OPERATOR.GREATER_THAN_OR_EQUAL:return"greater than or equal to";default:return operator!==undefined?operator:""}}function getAppliesToValueFromAnomaly(anomaly,appliesTo){var actualValue=void 0;var typicalValue=void 0;var actual=anomaly.actual;if(actual!==undefined){actualValue=Array.isArray(actual)?actual[0]:actual}var typical=anomaly.typical;if(typical!==undefined){typicalValue=Array.isArray(typical)?typical[0]:typical}switch(appliesTo){case _detector_rule.APPLIES_TO.ACTUAL:return actualValue;case _detector_rule.APPLIES_TO.TYPICAL:return typicalValue;case _detector_rule.APPLIES_TO.DIFF_FROM_TYPICAL:if(actual!==undefined&&typical!==undefined){return Math.abs(actualValue-typicalValue)}}return undefined}},38:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.replaceStringTokens=replaceStringTokens;exports.detectorToString=detectorToString;exports.sortByKey=sortByKey;exports.guessTimeFormat=guessTimeFormat;exports.toLocaleString=toLocaleString;exports.mlEscape=mlEscape;exports.escapeForElasticsearchQuery=escapeForElasticsearchQuery;exports.isWebUrl=isWebUrl;exports.calculateTextWidth=calculateTextWidth;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _d=__webpack_require__(20);var _d2=_interopRequireDefault(_d);var _relative_to_absolute=__webpack_require__(845);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function replaceStringTokens(str,valuesByTokenName,encodeForURI){return String(str).replace(/\$([^?&$\'"]{1,40})\$/g,function(match,name){var tokenValue=_lodash2.default.get(valuesByTokenName,name,null);if(encodeForURI===true&&tokenValue!==null){tokenValue=encodeURIComponent(tokenValue)}return tokenValue!==null?tokenValue:match})}function detectorToString(dtr){var BY_TOKEN=" by ";var OVER_TOKEN=" over ";var USE_NULL_OPTION=" use_null=";var PARTITION_FIELD_OPTION=" partition_field_name=";var EXCLUDE_FREQUENT_OPTION=" exclude_frequent=";var txt="";if(dtr.function!==undefined&&dtr.function!==""){txt+=dtr.function;if(dtr.field_name!==undefined&&dtr.field_name!==""){txt+="("+quoteField(dtr.field_name)+")"}}else if(dtr.field_name!==undefined&&dtr.field_name!==""){txt+=quoteField(dtr.field_name)}if(dtr.by_field_name!==undefined&&dtr.by_field_name!==""){txt+=BY_TOKEN+quoteField(dtr.by_field_name)}if(dtr.over_field_name!==undefined&&dtr.over_field_name!==""){txt+=OVER_TOKEN+quoteField(dtr.over_field_name)}if(dtr.use_null!==undefined){txt+=USE_NULL_OPTION+dtr.use_null}if(dtr.partition_field_name!==undefined&&dtr.partition_field_name!==""){txt+=PARTITION_FIELD_OPTION+quoteField(dtr.partition_field_name)}if(dtr.exclude_frequent!==undefined&&dtr.exclude_frequent!==""){txt+=EXCLUDE_FREQUENT_OPTION+dtr.exclude_frequent}return txt}function quoteField(field){if(field.match(/\W/g)){return'"'+field+'"'}else{return field}}function sortByKey(list,reverse,comparator){var keys=_lodash2.default.sortBy(_lodash2.default.keys(list),function(key){return comparator?comparator(list[key],key):key});if(reverse){keys=keys.reverse()}return _lodash2.default.object(keys,_lodash2.default.map(keys,function(key){return list[key]}))}function guessTimeFormat(time){var format="";var matched=false;if(isNaN(time)){var match=void 0;if(!matched){var reg="";reg+="(";reg+="(";reg+="(\\d{4})";reg+="([-/.\\s])";reg+="(";reg+="([01]\\d)";reg+="|";reg+="(\\w{3})";reg+=")";reg+="([-/.\\s])";reg+="([0-3]\\d)";reg+=")";reg+="|";reg+="(";reg+="(";reg+="(\\d{1,2})";reg+="|";reg+="(\\w{3})";reg+=")";reg+="([-/.\\s])";reg+="(";reg+="(\\d{1,2})";reg+="|";reg+="(\\w{3})";reg+=")";reg+="([-/.\\s])";reg+="(\\d{4})";reg+=")";reg+=")";reg+="([T\\s])?";reg+="([0-2]\\d)";reg+="([:.])";reg+="([0-5]\\d)";reg+="(";reg+="([:.])";reg+="([0-5]\\d)";reg+=")?";reg+="(";reg+="([:.])";reg+="(\\d{3})";reg+=")?";reg+="(";reg+="([+-]\\d{2}[:.]\\d{2}[:.]\\d{2})";reg+="|";reg+="([+-]\\d{2}[:.]\\d{2})";reg+="|";reg+="([+-]\\d{6})";reg+="|";reg+="([+-]\\d{4})";reg+="|";reg+="(Z)";reg+="|";reg+="([+-]\\d{2})";reg+="|";reg+="(";reg+="(\\s)";reg+="(\\w{1,4})";reg+=")";reg+=")?";console.log("guessTimeFormat: time format regex: "+reg);match=time.match(new RegExp(reg));if(match){if(match[2]!==undefined){format+="yyyy";format+=match[4];if(match[6]!==undefined){format+="MM"}else if(match[7]!==undefined){format+="MMM"}format+=match[8];format+="dd"}else if(match[10]!==undefined){if(match[13]!==undefined){format+="MMM";format+=match[14];format+="dd"}else if(match[17]!==undefined){format+="dd";format+=match[14];format+="MMM"}else{if(match[12]!==undefined&&+match[12]>12){format+="dd";format+=match[14];format+="MM"}else{format+="MM";format+=match[14];format+="dd"}}format+=match[18];format+="yyyy"}format+=match[20]==="T"?"'"+match[20]+"'":match[20];format+="HH";format+=match[22];format+="mm";if(match[24]!==undefined){format+=match[25];format+="ss"}if(match[27]!==undefined){format+=match[28];format+="SSS"}if(match[31]!==undefined){format+="XXXXX"}else if(match[32]!==undefined){format+="XXX"}else if(match[33]!==undefined){format+="XXXX"}else if(match[34]!==undefined){format+="Z"}else if(match[35]!==undefined||match[36]!==undefined){format+="X"}else if(match[37]!==undefined){if(match[38]!==undefined){format+=match[38]}for(var i=0;i<match[39].length;i++){format+="z"}}matched=true}}}else{if(time>1e10){format="epoch_ms"}else{format="epoch"}matched=true}if(matched){console.log("guessTimeFormat: guessed time format: ",format)}else{console.log("guessTimeFormat: time format could not be guessed from: "+time)}return format}function toLocaleString(x){var result=x;if(x&&typeof x==="number"){var parts=x.toString().split(".");parts[0]=parts[0].replace(/\B(?=(\d{3})+(?!\d))/g,",");result=parts.join(".")}return result}function mlEscape(str){var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return String(str).replace(/[&<>"'\/]/g,function(s){return entityMap[s]})}function escapeForElasticsearchQuery(str){return String(str).replace(/[-[\]{}()+!<>=?:\/\\^"~*&|\s]/g,"\\$&")}function isWebUrl(str){var absoluteUrl=(0,_relative_to_absolute.relativeToAbsolute)(str);return absoluteUrl.startsWith("http://")||absoluteUrl.startsWith("https://")}function calculateTextWidth(txt,isNumber,elementSelection){txt=isNumber?_d2.default.format(",")(txt):txt;var svg=elementSelection;var $el=void 0;if(elementSelection===undefined){var $body=_d2.default.select("body");$el=$body.append("div");svg=$el.append("svg")}var tempLabelText=svg.append("g").attr("class","temp-axis-label tick").selectAll("text.temp.axis").data("a").enter().append("text").text(txt);var width=tempLabelText[0][0].getBBox().width;_d2.default.select(".temp-axis-label").remove();if($el!==undefined){$el.remove()}return Math.ceil(width)}},399:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.stateFactoryProvider=stateFactoryProvider;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _listener_factory=__webpack_require__(467);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function stateFactoryProvider(AppState){function initializeAppState(stateName,defaultState){var appState=new AppState;appState.fetch();if(appState[stateName]===undefined){appState[stateName]=_lodash2.default.cloneDeep(defaultState)||{};appState.save()}if(typeof defaultState!=="undefined"&&appState[stateName]!==defaultState){if(!_lodash2.default.isEqual(Object.keys(defaultState).sort(),Object.keys(appState[stateName]).sort())){appState[stateName]=_lodash2.default.cloneDeep(defaultState);appState.save()}}return appState}return function(stateName,defaultState){if(typeof stateName!=="string"){throw"stateName needs to be of type `string`"}var appState=initializeAppState(stateName,defaultState);var listener=(0,_listener_factory.listenerFactoryProvider)()();var _changed=false;var state={get:function get(name){updateAppState();return appState[stateName][name]},set:function set(name,value){updateAppState();if(!_lodash2.default.isEqual(appState[stateName][name],value)){appState[stateName][name]=value;appState.save();_changed=true}return state},reset:function reset(){updateAppState();if(!_lodash2.default.isEqual(appState[stateName],defaultState)){appState[stateName]=_lodash2.default.cloneDeep(defaultState);appState.save();_changed=true}return state},watch:listener.watch,unwatch:listener.unwatch,changed:function changed(){if(_changed){listener.changed.apply(listener,arguments);_changed=false}}};function updateAppState(){appState.fetch();if(typeof appState[stateName]==="undefined"){appState=initializeAppState(stateName,defaultState);_changed=true}}return state}}},400:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var VALIDATION_STATUS=exports.VALIDATION_STATUS={ERROR:"error",INFO:"info",SUCCESS:"success",WARNING:"warning"};var SKIP_BUCKET_SPAN_ESTIMATION=exports.SKIP_BUCKET_SPAN_ESTIMATION=true;var ALLOWED_DATA_UNITS=exports.ALLOWED_DATA_UNITS=["B","KB","MB","GB","TB","PB"]},401:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var DATAFEED_STATE=exports.DATAFEED_STATE={STARTED:"started",STARTING:"starting",STOPPED:"stopped",STOPPING:"stopping",DELETED:"deleted"};var FORECAST_REQUEST_STATE=exports.FORECAST_REQUEST_STATE={FAILED:"failed",FINISHED:"finished",SCHEDULED:"scheduled",STARTED:"started"};var JOB_STATE=exports.JOB_STATE={CLOSED:"closed",CLOSING:"closing",FAILED:"failed",OPENED:"opened",OPENING:"opening"}},403:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _ml_job_editor=__webpack_require__(2220);Object.defineProperty(exports,"MLJobEditor",{enumerable:true,get:function get(){return _ml_job_editor.MLJobEditor}});Object.defineProperty(exports,"EDITOR_MODE",{enumerable:true,get:function get(){return _ml_job_editor.EDITOR_MODE}})},404:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ML_ANNOTATIONS_INDEX_ALIAS_READ=".ml-annotations-read";exports.ML_ANNOTATIONS_INDEX_ALIAS_WRITE=".ml-annotations-write";exports.ML_ANNOTATIONS_INDEX_PATTERN=".ml-annotations-6";exports.ML_RESULTS_INDEX_PATTERN=".ml-anomalies-*";exports.ML_NOTIFICATION_INDEX_PATTERN=".ml-notifications"},405:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.replaceTokensInUrlValue=replaceTokensInUrlValue;exports.getUrlForRecord=getUrlForRecord;exports.isValidLabel=isValidLabel;exports.isValidTimeRange=isValidTimeRange;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _parse_interval=__webpack_require__(219);var _string_utils=__webpack_require__(38);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var TIME_RANGE_AUTO="auto";function replaceTokensInUrlValue(customUrlConfig,jobBucketSpanSecs,doc,timeFieldName){var urlValue=customUrlConfig.url_value;var timestamp=doc[timeFieldName];var timeRangeInterval=(0,_parse_interval.parseInterval)(customUrlConfig.time_range);if(urlValue.includes("$earliest$")){var earliestMoment=(0,_moment2.default)(timestamp);if(timeRangeInterval!==null){earliestMoment.subtract(timeRangeInterval)}else{earliestMoment.subtract(jobBucketSpanSecs,"s")}doc.earliest=earliestMoment.toISOString()}if(urlValue.includes("$latest$")){var latestMoment=(0,_moment2.default)(timestamp).add(jobBucketSpanSecs,"s");if(timeRangeInterval!==null){latestMoment.add(timeRangeInterval)}else{latestMoment.add(jobBucketSpanSecs,"s")}doc.latest=latestMoment.toISOString()}return getUrlForRecord(customUrlConfig,doc)}function getUrlForRecord(urlConfig,record){if(isKibanaUrl(urlConfig)===true){return buildKibanaUrl(urlConfig,record)}else{var urlPath=(0,_string_utils.replaceStringTokens)(urlConfig.url_value,record,false);return urlPath}}function isKibanaUrl(urlConfig){var urlValue=urlConfig.url_value;return urlValue.startsWith("kibana#/discover")||urlValue.startsWith("kibana#/dashboard")}function buildKibanaUrl(urlConfig,record){var urlValue=urlConfig.url_value;return String(urlValue).replace(/\$([^?&$\'"]{1,40})\$/g,function(match,name){var tokenValue=_lodash2.default.get(record,name,null);if(Array.isArray(tokenValue)){tokenValue=tokenValue[0]}if(tokenValue!==null&&!(name==="earliest"||name==="latest")){tokenValue=""+(0,_string_utils.escapeForElasticsearchQuery)(tokenValue);tokenValue=tokenValue.replace(/[!']/g,"!$&");tokenValue=encodeURIComponent(tokenValue)}return tokenValue!==null?tokenValue:match})}function isValidLabel(label,savedCustomUrls){var isValid=label!==undefined&&label.trim().length>0;if(isValid===true&&savedCustomUrls!==undefined){var existingLabels=savedCustomUrls.map(function(customUrl){return customUrl.url_name});isValid=!existingLabels.includes(label)}return isValid}function isValidTimeRange(timeRange){if(timeRange===undefined||timeRange.length===0||timeRange===TIME_RANGE_AUTO){return true}var interval=(0,_parse_interval.parseInterval)(timeRange);return interval!==null}},406:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2289)},407:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var CHART_STATE=exports.CHART_STATE={NOT_STARTED:0,LOADING:1,LOADED:2,NO_RESULTS:3};var JOB_STATE=exports.JOB_STATE={NOT_STARTED:0,RUNNING:1,FINISHED:2,STOPPING:3}},408:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.JobSelectServiceProvider=JobSelectServiceProvider;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _notify=__webpack_require__(10);var _job_service=__webpack_require__(23);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}var jobSelectService=undefined;function JobSelectServiceProvider($rootScope,globalState){function checkGlobalState(){if(globalState.ml===undefined){globalState.ml={};globalState.save()}}checkGlobalState();function loadJobIdsFromGlobalState(){var jobIds=[];if(globalState.ml&&globalState.ml.jobIds){var tempJobIds=[];if(typeof globalState.ml.jobIds==="string"){tempJobIds.push(globalState.ml.jobIds)}else{tempJobIds=globalState.ml.jobIds}tempJobIds=tempJobIds.map(function(id){return String(id)});var invalidIds=getInvalidJobIds(removeGroupIds(tempJobIds));warnAboutInvalidJobIds(invalidIds);var validIds=_lodash2.default.difference(tempJobIds,invalidIds);if(validIds.length===0){var warningText="No jobs selected, auto selecting first job";_notify.toastNotifications.addWarning(warningText);if(_job_service.mlJobService.jobs.length){validIds=[_job_service.mlJobService.jobs[0].job_id]}}jobIds.push.apply(jobIds,_toConsumableArray(validIds));storeJobIdsInGlobalState(jobIds)}else{checkGlobalState();if(_job_service.mlJobService.jobs.length){jobIds.push(_job_service.mlJobService.jobs[0].job_id)}storeJobIdsInGlobalState(jobIds)}return jobIds}function storeJobIdsInGlobalState(jobIds){globalState.ml.jobIds=jobIds;globalState.save()}function getInvalidJobIds(ids){return ids.filter(function(id){var job=_lodash2.default.find(_job_service.mlJobService.jobs,{job_id:id});return job===undefined&&id!=="*"})}function removeGroupIds(jobIds){return jobIds.map(function(id){var splitId=id.split(".");return splitId.length>1?splitId[1]:splitId[0]})}function warnAboutInvalidJobIds(invalidIds){if(invalidIds.length>0){var warningText=invalidIds.length===1?"Requested job "+invalidIds+" does not exist":"Requested jobs "+invalidIds+" do not exist";_notify.toastNotifications.addWarning(warningText)}}function createDescription(jobs){var txt="";var count=_job_service.mlJobService.jobs.reduce(function(sum,job){return sum+(job.groups===undefined?1:job.groups.length)},0);if(jobs.length===count){txt="All jobs"}else{var groupCounts={};var groupLessJobs=0;jobs.forEach(function(job){var obj=splitJobId(job);if(obj.group){groupCounts[obj.group]=(groupCounts[obj.group]||0)+1}else{groupLessJobs++}});var wholeGroups=[];var groups=_job_service.mlJobService.getJobGroups();groups.forEach(function(group){var groupCount=groupCounts[group.id];if(groupCount!==undefined&&groupCount===group.jobs.length){wholeGroups.push(group.id)}else{if(groupCount!==undefined){groupLessJobs+=groupCount}}});if(wholeGroups.length){txt=wholeGroups[0];if(wholeGroups.length>1||groupLessJobs>0){var total=wholeGroups.length-1+groupLessJobs;txt+=" and "+total+" other"+(total>1?"s":"")}}else{txt=splitJobId(jobs[0]).job;if(jobs.length>1){txt+=" and "+(jobs.length-1)+" other"+(jobs.length>2?"s":"")}}}return txt}function splitJobId(jobId){var obj={};var splitId=jobId.split(".");if(splitId.length===2){obj={group:splitId[0],job:splitId[1]}}else{obj={job:jobId}}return obj}this.splitJobId=splitJobId;function expandGroups(jobIds){var newJobIds=[];var groups=_job_service.mlJobService.getJobGroups();jobIds.forEach(function(jobId){if(jobId==="*"){_job_service.mlJobService.jobs.forEach(function(job){if(job.groups===undefined){newJobIds.push(job.job_id)}else{newJobIds.push.apply(newJobIds,_toConsumableArray(job.groups.map(function(g){return g+"."+job.job_id})))}})}else{var splitId=splitJobId(jobId);if(splitId.group!==undefined&&splitId.job==="*"){var groupId=splitId.group;var group=groups.find(function(g){return g.id===groupId});group.jobs.forEach(function(j){newJobIds.push(groupId+"."+j.job_id)})}else{newJobIds.push(jobId)}}});return newJobIds}function getGroupIds(jobIds){var groupIds=[];jobIds.forEach(function(jobId){var splitId=splitJobId(jobId);if(splitId.group!==undefined&&splitId.job==="*"){groupIds.push(splitId.group)}});return groupIds}function processIds(service,ids){var _service$jobIdsWithGr,_service$jobIds;var expandedJobIds=expandGroups(ids);service.jobIdsWithGroup.length=0;(_service$jobIdsWithGr=service.jobIdsWithGroup).push.apply(_service$jobIdsWithGr,_toConsumableArray(expandedJobIds));service.groupIds=getGroupIds(ids);service.jobIds.length=0;(_service$jobIds=service.jobIds).push.apply(_service$jobIds,_toConsumableArray(removeGroupIds(expandedJobIds)));service.description.txt=createDescription(service.jobIdsWithGroup);service.singleJobDescription.txt=ids[0];setBrowserTitle(service.description.txt)}function setBrowserTitle(title){document.title=title+" - Kibana"}var JobSelectService=function(){function JobSelectService(){_classCallCheck(this,JobSelectService);this.jobIds=[];this.groupIds=[];this.description={txt:""};this.singleJobDescription={txt:""};this.jobSelectListState={applyTimeRange:true};this.jobIdsWithGroup=[];this.splitJobId=splitJobId}_createClass(JobSelectService,[{key:"broadcastJobSelectionChange",value:function broadcastJobSelectionChange(){$rootScope.$broadcast("jobSelectionChange",this.getSelectedJobIds())}},{key:"listenJobSelectionChange",value:function listenJobSelectionChange(scope,callback){var handler=$rootScope.$on("jobSelectionChange",callback);scope.$on("$destroy",handler)}},{key:"getSelectedJobIds",value:function getSelectedJobIds(loadFromURL){if(loadFromURL){processIds(this,loadJobIdsFromGlobalState())}return this.jobIds}},{key:"setJobIds",value:function setJobIds(jobIds){processIds(this,jobIds);storeJobIdsInGlobalState(jobIds);this.broadcastJobSelectionChange()}}]);return JobSelectService}();if(jobSelectService===undefined){jobSelectService=new JobSelectService}return jobSelectService}},409:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mlExplorerDashboardService=undefined;var _listener_factory=__webpack_require__(467);function mlExplorerDashboardServiceFactory(){var service={allowCellRangeSelection:false};var listenerFactory=(0,_listener_factory.listenerFactoryProvider)();var dragSelect=service.dragSelect=listenerFactory();var swimlaneCellClick=service.swimlaneCellClick=listenerFactory();var swimlaneDataChange=service.swimlaneDataChange=listenerFactory();var swimlaneRenderDone=service.swimlaneRenderDone=listenerFactory();var chartsInitDone=service.chartsInitDone=listenerFactory();service.anomalyDataChange=listenerFactory();service.init=function(){dragSelect.unwatchAll();swimlaneCellClick.unwatchAll();swimlaneDataChange.unwatchAll();swimlaneRenderDone.unwatchAll();chartsInitDone.unwatchAll()};return service}var mlExplorerDashboardService=exports.mlExplorerDashboardService=mlExplorerDashboardServiceFactory()},418:function(module,exports,__webpack_require__){module.exports=__webpack_require__(7)(441)},43:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.checkFullLicense=checkFullLicense;exports.checkBasicLicense=checkBasicLicense;exports.checkLicenseExpired=checkLicenseExpired;exports.hasLicenseExpired=hasLicenseExpired;exports.isFullLicense=isFullLicense;exports.xpackFeatureProvider=xpackFeatureProvider;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _xpack_info=__webpack_require__(46);var _notify=__webpack_require__(10);var _license=__webpack_require__(2197);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var licenseHasExpired=true;var licenseType=null;var expiredLicenseBannerId=void 0;function checkFullLicense(Private,kbnBaseUrl,kbnUrl){var features=getFeatures(Private);licenseType=features.licenseType;if(features.isAvailable===false){return redirectToKibana(features,kbnBaseUrl)}else if(features.licenseType===_license.LICENSE_TYPE.BASIC){return redirectToBasic(kbnUrl)}else{setLicenseExpired(features);return Promise.resolve(features)}}function checkBasicLicense(Private,kbnBaseUrl){var features=getFeatures(Private);licenseType=features.licenseType;if(features.isAvailable===false){return redirectToKibana(features,kbnBaseUrl)}else{setLicenseExpired(features);return Promise.resolve(features)}}function checkLicenseExpired(Private,kbnBaseUrl,kbnUrl){return checkFullLicense(Private,kbnBaseUrl,kbnUrl).then(function(features){if(features.hasExpired){kbnUrl.redirect("/jobs");return Promise.halt()}else{return Promise.resolve(features)}}).catch(function(){return Promise.halt()})}function setLicenseExpired(features){licenseHasExpired=features.hasExpired||false;if(licenseHasExpired){var message=features.message;if(expiredLicenseBannerId===undefined){expiredLicenseBannerId=_notify.banners.add({component:_react2.default.createElement(_eui.EuiCallOut,{iconType:"iInCircle",color:"warning",title:message})})}}}function getFeatures(Private){var xpackInfo=Private(_xpack_info.XPackInfoProvider);return xpackInfo.get("features.ml")}function redirectToKibana(features,kbnBaseUrl){var message=features.message;var newUrl=(0,_notify.addAppRedirectMessageToUrl)(_chrome2.default.addBasePath(kbnBaseUrl),message||"");window.location.href=newUrl;return Promise.halt()}function redirectToBasic(kbnUrl){kbnUrl.redirect("/datavisualizer");return Promise.halt()}function hasLicenseExpired(){return licenseHasExpired}function isFullLicense(){return licenseType===_license.LICENSE_TYPE.FULL}function xpackFeatureProvider(Private){var xpackInfo=Private(_xpack_info.XPackInfoProvider);return{isAvailable:function isAvailable(feature){return xpackInfo.get("features."+feature+".isAvailable",false)}}}},467:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.listenerFactoryProvider=listenerFactoryProvider;function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function listenerFactoryProvider(){return function(){var listeners=[];return{changed:function changed(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}listeners.forEach(function(listener){return listener.apply(undefined,_toConsumableArray(args))})},watch:function watch(listener){listeners.push(listener)},unwatch:function unwatch(listener){var index=listeners.indexOf(listener);if(index>-1){listeners.splice(index,1)}},unwatchAll:function unwatchAll(){listeners.splice(0)}}}}},468:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.addItemToRecentlyAccessed=addItemToRecentlyAccessed;var _persisted_log=__webpack_require__(193);function addItemToRecentlyAccessed(page,itemId,url){var pageLabel="";var id="ml-job-"+itemId;switch(page){case"explorer":pageLabel="Anomaly Explorer";break;case"timeseriesexplorer":pageLabel="Single Metric Viewer";break;case"jobs/new_job/datavisualizer":pageLabel="Data Visualizer";id="ml-datavisualizer-"+itemId;break;default:console.error("addItemToRecentlyAccessed - No page specified");return;break}url="ml#/"+page+"/"+url;_persisted_log.recentlyAccessed.add(url,"ML - "+itemId+" - "+pageLabel,id)}},469:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.validateJob=validateJob;exports.populateValidationMessages=populateValidationMessages;var _job_utils=__webpack_require__(34);var _new_job_defaults=__webpack_require__(241);var _validation=__webpack_require__(400);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function validateJob(job,checks){var limits=(0,_new_job_defaults.newJobLimits)();var validationResults=(0,_job_utils.basicJobValidation)(job,undefined,limits);var valid=true;_lodash2.default.each(checks,function(item){item.valid=true});populateValidationMessages(validationResults,checks);_lodash2.default.each(checks,function(item){if(item.valid===false){valid=false}});return valid}function populateValidationMessages(validationResults,checks){var limits=(0,_new_job_defaults.newJobLimits)();if(validationResults.contains("job_id_empty")){checks.jobId.valid=false}else if(validationResults.contains("job_id_invalid")){checks.jobId.valid=false;var msg="Job name can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; ";msg+="must start and end with an alphanumeric character";checks.jobId.message=msg}if(validationResults.contains("job_group_id_invalid")){checks.groupIds.valid=false;var _msg="Job group names can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; ";_msg+="must start and end with an alphanumeric character";checks.groupIds.message=_msg}if(validationResults.contains("model_memory_limit_units_invalid")){checks.modelMemoryLimit.valid=false;var str=_validation.ALLOWED_DATA_UNITS.slice(0,_validation.ALLOWED_DATA_UNITS.length-1).join(", ")+" or "+[].concat(_toConsumableArray(_validation.ALLOWED_DATA_UNITS)).pop();var _msg2="Model memory limit data unit unrecognized. It must be "+str;checks.modelMemoryLimit.message=_msg2}if(validationResults.contains("model_memory_limit_invalid")){checks.modelMemoryLimit.valid=false;var _msg3="Model memory limit cannot be higher than the maximum value of "+limits.max_model_memory_limit.toUpperCase();checks.modelMemoryLimit.message=_msg3}if(validationResults.contains("detectors_duplicates")){checks.duplicateDetectors.valid=false;var _msg4="Duplicate detectors were found.";checks.duplicateDetectors.message=_msg4}}},47:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.checkMlNodesAvailable=checkMlNodesAvailable;exports.getMlNodeCount=getMlNodeCount;exports.mlNodesAvailable=mlNodesAvailable;exports.permissionToViewMlNodeCount=permissionToViewMlNodeCount;var _ml_api_service=__webpack_require__(22);var mlNodeCount=0;var userHasPermissionToViewMlNodeCount=false;function checkMlNodesAvailable(kbnUrl){getMlNodeCount().then(function(nodes){if(nodes.count!==undefined&&nodes.count>0){Promise.resolve()}else{kbnUrl.redirect("/jobs");Promise.reject()}})}function getMlNodeCount(){return new Promise(function(resolve){_ml_api_service.ml.mlNodeCount().then(function(nodes){mlNodeCount=nodes.count;userHasPermissionToViewMlNodeCount=true;resolve(nodes)}).catch(function(error){mlNodeCount=0;if(error.statusCode===403){userHasPermissionToViewMlNodeCount=false}else{console.error(error)}resolve({count:0})})})}function mlNodesAvailable(){return mlNodeCount!==0}function permissionToViewMlNodeCount(){return userHasPermissionToViewMlNodeCount}},470:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getMostSevereMessageStatus=getMostSevereMessageStatus;exports.addJobValidationMethods=addJobValidationMethods;var _validation=__webpack_require__(400);var contains=function contains(arr,str){return arr.findIndex(function(v){return v===str})>=0};function getMostSevereMessageStatus(messages){var statuses=messages.map(function(m){return m.status});return[_validation.VALIDATION_STATUS.INFO,_validation.VALIDATION_STATUS.WARNING,_validation.VALIDATION_STATUS.ERROR].reduce(function(previous,current){return contains(statuses,current)?current:previous},_validation.VALIDATION_STATUS.SUCCESS)}function addJobValidationMethods($scope,service){$scope.getDuration=function(){return{start:$scope.formConfig.start,end:$scope.formConfig.end}};$scope.isCurrentJobConfig=false;$scope.$watch("formConfig",function(){$scope.isCurrentJobConfig=false},true);$scope.getJobConfig=function(){$scope.isCurrentJobConfig=true;return service.getJobFromConfig($scope.formConfig)}}},471:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FullTimeRangeSelectorServiceProvider=FullTimeRangeSelectorServiceProvider;var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);var _ml_api_service=__webpack_require__(22);var _timefilter=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function FullTimeRangeSelectorServiceProvider(Notifier){var notify=new Notifier;function setFullTimeRange(indexPattern,query){return _ml_api_service.ml.getTimeFieldRange({index:indexPattern.title,timeFieldName:indexPattern.timeFieldName,query:query}).then(function(resp){_timefilter.timefilter.setTime({from:(0,_moment2.default)(resp.start.epoch).toISOString(),to:(0,_moment2.default)(resp.end.epoch).toISOString()})}).catch(function(resp){notify.error(resp)})}return{setFullTimeRange:setFullTimeRange}}},472:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mlSimpleJobSearchService=undefined;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _index_patterns=__webpack_require__(404);var _string_utils=__webpack_require__(38);var _ml_api_service=__webpack_require__(22);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getScoresByRecord(jobId,earliestMs,latestMs,interval,firstSplitField){return new Promise(function(resolve,reject){var obj={success:true,results:{}};var jobIdFilterStr="job_id: "+jobId;if(firstSplitField&&firstSplitField.value!==undefined){jobIdFilterStr+=" AND "+(0,_string_utils.escapeForElasticsearchQuery)(firstSplitField.name)+":";jobIdFilterStr+='"'+String(firstSplitField.value).replace(/\\/g,"\\\\")+'"'}_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:record"}},{bool:{must:[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{query_string:{query:jobIdFilterStr}}]}}]}},aggs:{detector_index:{terms:{field:"detector_index",order:{recordScore:"desc"}},aggs:{recordScore:{max:{field:"record_score"}},byTime:{date_histogram:{field:"timestamp",interval:interval,min_doc_count:1,extended_bounds:{min:earliestMs,max:latestMs}},aggs:{recordScore:{max:{field:"record_score"}}}}}}}}}).then(function(resp){var detectorsByIndex=_lodash2.default.get(resp,["aggregations","detector_index","buckets"],[]);_lodash2.default.each(detectorsByIndex,function(dtr){var dtrResults={};var dtrIndex=+dtr.key;var buckets=_lodash2.default.get(dtr,["byTime","buckets"],[]);for(var j=0;j<buckets.length;j++){var bkt=buckets[j];var time=bkt.key;dtrResults[time]={recordScore:_lodash2.default.get(bkt,["recordScore","value"])}}obj.results[dtrIndex]=dtrResults});resolve(obj)}).catch(function(resp){reject(resp)})})}function getCategoryFields(index,field,size,query){return new Promise(function(resolve,reject){var obj={success:true,results:{}};_ml_api_service.ml.esSearch({index:index,size:0,body:{query:query,aggs:{catFields:{terms:{field:field,size:size}}}}}).then(function(resp){obj.results.values=[];var catFields=_lodash2.default.get(resp,["aggregations","catFields","buckets"],[]);_lodash2.default.each(catFields,function(f){obj.results.values.push(f.key)});resolve(obj)}).catch(function(resp){reject(resp)})})}var mlSimpleJobSearchService=exports.mlSimpleJobSearchService={getScoresByRecord:getScoresByRecord,getCategoryFields:getCategoryFields}},473:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2316)},474:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2346)},62:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.refreshIndexPatterns=undefined;exports.loadIndexPatterns=loadIndexPatterns;exports.getIndexPatterns=getIndexPatterns;exports.getIndexPatternNames=getIndexPatternNames;exports.getIndexPatternIdFromName=getIndexPatternIdFromName;exports.loadCurrentIndexPattern=loadCurrentIndexPattern;exports.getIndexPatternById=getIndexPatternById;exports.loadCurrentSavedSearch=loadCurrentSavedSearch;exports.getCurrentIndexPattern=getCurrentIndexPattern;exports.getCurrentSavedSearch=getCurrentSavedSearch;exports.timeBasedIndexCheck=timeBasedIndexCheck;var _notify=__webpack_require__(10);var _saved_objects=__webpack_require__(50);var indexPatternCache=[];var fullIndexPatterns=[];var currentIndexPattern=null;var currentSavedSearch=null;var refreshIndexPatterns=exports.refreshIndexPatterns=null;function loadIndexPatterns(Private,indexPatterns){fullIndexPatterns=indexPatterns;var savedObjectsClient=Private(_saved_objects.SavedObjectsClientProvider);return savedObjectsClient.find({type:"index-pattern",fields:["title","type"],perPage:1e4}).then(function(response){indexPatternCache=response.savedObjects;if(refreshIndexPatterns===null){exports.refreshIndexPatterns=refreshIndexPatterns=function refreshIndexPatterns(){return new Promise(function(resolve,reject){loadIndexPatterns(Private,indexPatterns).then(function(resp){resolve(resp)}).catch(function(error){reject(error)})})}}return indexPatternCache})}function getIndexPatterns(){return indexPatternCache}function getIndexPatternNames(){return indexPatternCache.map(function(i){return i.attributes&&i.attributes.title})}function getIndexPatternIdFromName(name){for(var j=0;j<indexPatternCache.length;j++){if(indexPatternCache[j].get("title")===name){return indexPatternCache[j].id}}return name}function loadCurrentIndexPattern(indexPatterns,$route){fullIndexPatterns=indexPatterns;currentIndexPattern=fullIndexPatterns.get($route.current.params.index);return currentIndexPattern}function getIndexPatternById(id){return fullIndexPatterns.get(id)}function loadCurrentSavedSearch($route,savedSearches){currentSavedSearch=savedSearches.get($route.current.params.savedSearchId);return currentSavedSearch}function getCurrentIndexPattern(){return currentIndexPattern}function getCurrentSavedSearch(){return currentSavedSearch}function timeBasedIndexCheck(indexPattern){var showNotification=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(indexPattern.isTimeBased()===false){if(showNotification){_notify.toastNotifications.addWarning({title:"The index pattern "+indexPattern.title+" is not based on a time series",text:"Anomaly detection only runs over time-based indices"})}return false}else{return true}}},625:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _job_group=__webpack_require__(2213);Object.defineProperty(exports,"JobGroup",{enumerable:true,get:function get(){return _job_group.JobGroup}})},626:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AnnotationsTable=undefined;var _annotations_table=__webpack_require__(988);Object.defineProperty(exports,"AnnotationsTable",{enumerable:true,get:function get(){return _annotations_table.AnnotationsTable}});__webpack_require__(2222)},628:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mlTableService=undefined;var _listener_factory=__webpack_require__(467);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var TableService=function TableService(){_classCallCheck(this,TableService);var listenerFactory=(0,_listener_factory.listenerFactoryProvider)();this.rowMouseenter=listenerFactory();this.rowMouseleave=listenerFactory()};var mlTableService=exports.mlTableService=new TableService},629:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ANNOTATIONS_TABLE_DEFAULT_QUERY_SIZE=500;exports.ANOMALIES_TABLE_DEFAULT_QUERY_SIZE=500},630:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mlForecastService=undefined;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _index_patterns=__webpack_require__(404);var _ml_api_service=__webpack_require__(22);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function getForecastsSummary(job,query,earliestMs,maxResults){return new Promise(function(resolve,reject){var obj={success:true,forecasts:[]};var filterCriteria=[{term:{result_type:"model_forecast_request_stats"}},{term:{job_id:job.job_id}},{range:{timestamp:{gte:earliestMs,format:"epoch_millis"}}}];if(query){filterCriteria.push(query)}_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:maxResults,rest_total_hits_as_int:true,body:{query:{bool:{filter:filterCriteria}},sort:[{forecast_create_timestamp:{order:"desc"}}]}}).then(function(resp){if(resp.hits.total!==0){obj.forecasts=resp.hits.hits.map(function(hit){return hit._source})}resolve(obj)}).catch(function(resp){reject(resp)})})}function getForecastDateRange(job,forecastId){return new Promise(function(resolve,reject){var obj={success:true,earliest:null,latest:null};var filterCriteria=[{query_string:{query:"result_type:model_forecast",analyze_wildcard:true}},{term:{job_id:job.job_id}},{term:{forecast_id:forecastId}}];_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:filterCriteria}},aggs:{earliest:{min:{field:"timestamp"}},latest:{max:{field:"timestamp"}}}}}).then(function(resp){obj.earliest=_lodash2.default.get(resp,"aggregations.earliest.value",null);obj.latest=_lodash2.default.get(resp,"aggregations.latest.value",null);if(obj.earliest===null||obj.latest===null){reject(resp)}else{resolve(obj)}}).catch(function(resp){reject(resp)})})}function getForecastData(job,detectorIndex,forecastId,entityFields,earliestMs,latestMs,interval,aggType){var criteriaFields=[];var detector=job.analysis_config.detectors[detectorIndex];if(_lodash2.default.has(detector,"partition_field_name")){var partitionEntity=_lodash2.default.find(entityFields,{fieldName:detector.partition_field_name});if(partitionEntity!==undefined){criteriaFields.push({fieldName:"partition_field_name",fieldValue:partitionEntity.fieldName},{fieldName:"partition_field_value",fieldValue:partitionEntity.fieldValue})}}if(_lodash2.default.has(detector,"over_field_name")){var overEntity=_lodash2.default.find(entityFields,{fieldName:detector.over_field_name});if(overEntity!==undefined){criteriaFields.push({fieldName:"over_field_name",fieldValue:overEntity.fieldName},{fieldName:"over_field_value",fieldValue:overEntity.fieldValue})}}if(_lodash2.default.has(detector,"by_field_name")){var byEntity=_lodash2.default.find(entityFields,{fieldName:detector.by_field_name});if(byEntity!==undefined){criteriaFields.push({fieldName:"by_field_name",fieldValue:byEntity.fieldName},{fieldName:"by_field_value",fieldValue:byEntity.fieldValue})}}return new Promise(function(resolve,reject){var obj={success:true,results:{}};var filterCriteria=[{query_string:{query:"result_type:model_forecast",analyze_wildcard:true}},{term:{job_id:job.job_id}},{term:{forecast_id:forecastId}},{term:{detector_index:detectorIndex}},{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}}];_lodash2.default.each(criteriaFields,function(criteria){filterCriteria.push({term:_defineProperty({},criteria.fieldName,criteria.fieldValue)})});var forecastAggs=aggType===undefined?{avg:"avg",max:"max",min:"min"}:{avg:aggType.avg,max:aggType.max,min:aggType.min};_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:filterCriteria}},aggs:{times:{date_histogram:{field:"timestamp",interval:interval,min_doc_count:1},aggs:{prediction:_defineProperty({},forecastAggs.avg,{field:"forecast_prediction"}),forecastUpper:_defineProperty({},forecastAggs.max,{field:"forecast_upper"}),forecastLower:_defineProperty({},forecastAggs.min,{field:"forecast_lower"})}}}}}).then(function(resp){var aggregationsByTime=_lodash2.default.get(resp,["aggregations","times","buckets"],[]);_lodash2.default.each(aggregationsByTime,function(dataForTime){var time=dataForTime.key;obj.results[time]={prediction:_lodash2.default.get(dataForTime,["prediction","value"]),forecastUpper:_lodash2.default.get(dataForTime,["forecastUpper","value"]),forecastLower:_lodash2.default.get(dataForTime,["forecastLower","value"])}});resolve(obj)}).catch(function(resp){reject(resp)})})}function runForecast(jobId,duration){console.log("ML forecast service run forecast with duration:",duration);return new Promise(function(resolve,reject){_ml_api_service.ml.forecast({jobId:jobId,duration:duration}).then(function(resp){resolve(resp)}).catch(function(err){reject(err)})})}function getForecastRequestStats(job,forecastId){return new Promise(function(resolve,reject){var obj={success:true,stats:{}};var filterCriteria=[{query_string:{query:"result_type:model_forecast_request_stats",analyze_wildcard:true}},{term:{job_id:job.job_id}},{term:{forecast_id:forecastId}}];_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:1,rest_total_hits_as_int:true,body:{query:{bool:{filter:filterCriteria}}}}).then(function(resp){if(resp.hits.total!==0){obj.stats=_lodash2.default.first(resp.hits.hits)._source}resolve(obj)}).catch(function(resp){reject(resp)})})}var mlForecastService=exports.mlForecastService={getForecastsSummary:getForecastsSummary,getForecastDateRange:getForecastDateRange,getForecastData:getForecastData,runForecast:runForecast,getForecastRequestStats:getForecastRequestStats}},631:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getNewCustomUrlDefaults=getNewCustomUrlDefaults;exports.getQueryEntityFieldNames=getQueryEntityFieldNames;exports.isValidCustomUrlSettingsTimeRange=isValidCustomUrlSettingsTimeRange;exports.isValidCustomUrlSettings=isValidCustomUrlSettings;exports.buildCustomUrlFromSettings=buildCustomUrlFromSettings;exports.getTestUrl=getTestUrl;var _constants=__webpack_require__(632);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _risonNode=__webpack_require__(206);var _risonNode2=_interopRequireDefault(_risonNode);var _index_patterns=__webpack_require__(404);var _job_utils=__webpack_require__(34);var _parse_interval=__webpack_require__(219);var _custom_url_utils=__webpack_require__(405);var _ml_api_service=__webpack_require__(22);var _job_service=__webpack_require__(23);var _string_utils=__webpack_require__(38);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function getNewCustomUrlDefaults(job,dashboards,indexPatterns){var kibanaSettings={queryFieldNames:[]};var urlType=_constants.URL_TYPE.OTHER;if(dashboards!==undefined&&dashboards.length>0){urlType=_constants.URL_TYPE.KIBANA_DASHBOARD;kibanaSettings.dashboardId=dashboards[0].id}else if(indexPatterns!==undefined&&indexPatterns.length>0){urlType=_constants.URL_TYPE.KIBANA_DISCOVER}var datafeedConfig=job.datafeed_config;if(indexPatterns!==undefined&&indexPatterns.length>0&&datafeedConfig!==undefined&&datafeedConfig.indices!==undefined&&datafeedConfig.indices.length>0){var datafeedIndex=datafeedConfig.indices[0];var defaultIndexPattern=indexPatterns.find(function(indexPattern){return indexPattern.title===datafeedIndex});if(defaultIndexPattern===undefined){defaultIndexPattern=indexPatterns[0]}kibanaSettings.discoverIndexPatternId=defaultIndexPattern.id}return{label:"",type:urlType,timeRange:{type:_constants.TIME_RANGE_TYPE.AUTO,interval:""},kibanaSettings:kibanaSettings,otherUrlSettings:{urlValue:""}}}function getQueryEntityFieldNames(job){var influencers=job.analysis_config.influencers;var detectors=job.analysis_config.detectors;var entityFieldNames=[];if(influencers!==undefined){entityFieldNames.push.apply(entityFieldNames,_toConsumableArray(influencers))}detectors.forEach(function(detector,detectorIndex){var partitioningFields=(0,_job_utils.getPartitioningFieldNames)(job,detectorIndex);partitioningFields.forEach(function(fieldName){if(entityFieldNames.indexOf(fieldName)===-1){entityFieldNames.push(fieldName)}})});return entityFieldNames}function isValidCustomUrlSettingsTimeRange(timeRangeSettings){if(timeRangeSettings.type===_constants.TIME_RANGE_TYPE.INTERVAL){var interval=(0,_parse_interval.parseInterval)(timeRangeSettings.interval);return interval!==null}return true}function isValidCustomUrlSettings(settings,savedCustomUrls){var isValid=(0,_custom_url_utils.isValidLabel)(settings.label,savedCustomUrls);if(isValid===true){isValid=isValidCustomUrlSettingsTimeRange(settings.timeRange)}return isValid}function buildCustomUrlFromSettings(settings){if(settings.type===_constants.URL_TYPE.KIBANA_DASHBOARD){return buildDashboardUrlFromSettings(settings)}else if(settings.type===_constants.URL_TYPE.KIBANA_DISCOVER){return Promise.resolve(buildDiscoverUrlFromSettings(settings))}else{var urlToAdd={url_name:settings.label,url_value:settings.otherUrlSettings.urlValue};return Promise.resolve(urlToAdd)}}function buildDashboardUrlFromSettings(settings){return new Promise(function(resolve,reject){var _settings$kibanaSetti=settings.kibanaSettings,dashboardId=_settings$kibanaSetti.dashboardId,queryFieldNames=_settings$kibanaSetti.queryFieldNames;var savedObjectsClient=_chrome2.default.getSavedObjectsClient();savedObjectsClient.get("dashboard",dashboardId).then(function(response){var filters=[];var query=undefined;var searchSourceJSON=response.get("kibanaSavedObjectMeta.searchSourceJSON");if(searchSourceJSON!==undefined){var searchSourceData=JSON.parse(searchSourceJSON);if(searchSourceData.filter!==undefined){filters=searchSourceData.filter}query=searchSourceData.query}var _g=_risonNode2.default.encode({time:{from:"$earliest$",to:"$latest$",mode:"absolute"}});var appState={filters:filters};if(queryFieldNames!==undefined&&queryFieldNames.length>0){var queryString="";queryFieldNames.forEach(function(fieldName,index){if(index>0){queryString+=" AND "}queryString+=(0,_string_utils.escapeForElasticsearchQuery)(fieldName)+':"$'+fieldName+'$"'});query={language:"lucene",query:queryString}}if(query!==undefined){appState.query=query}var _a=_risonNode2.default.encode(appState);var urlValue="kibana#/dashboard/"+dashboardId+"?_g="+_g+"&_a="+_a;var urlToAdd={url_name:settings.label,url_value:urlValue,time_range:_constants.TIME_RANGE_TYPE.AUTO};if(settings.timeRange.type===_constants.TIME_RANGE_TYPE.INTERVAL){urlToAdd.time_range=settings.timeRange.interval}resolve(urlToAdd)}).catch(function(resp){reject(resp)})})}function buildDiscoverUrlFromSettings(settings){var _settings$kibanaSetti2=settings.kibanaSettings,discoverIndexPatternId=_settings$kibanaSetti2.discoverIndexPatternId,queryFieldNames=_settings$kibanaSetti2.queryFieldNames;var _g=_risonNode2.default.encode({time:{from:"$earliest$",to:"$latest$",mode:"absolute"}});var appState={index:discoverIndexPatternId};if(queryFieldNames!==undefined&&queryFieldNames.length>0){var queryString="";queryFieldNames.forEach(function(fieldName,i){if(i>0){queryString+=" AND "}queryString+=(0,_string_utils.escapeForElasticsearchQuery)(fieldName)+':"$'+fieldName+'$"'});appState.query={language:"lucene",query:queryString}}var _a=_risonNode2.default.encode(appState);var urlValue="kibana#/discover?_g="+_g+"&_a="+_a;var urlToAdd={url_name:settings.label,url_value:urlValue,time_range:_constants.TIME_RANGE_TYPE.AUTO};if(settings.timeRange.type===_constants.TIME_RANGE_TYPE.INTERVAL){urlToAdd.time_range=settings.timeRange.interval}return urlToAdd}function getTestUrl(job,customUrl){var urlValue=customUrl.url_value;var bucketSpanSecs=(0,_parse_interval.parseInterval)(job.analysis_config.bucket_span).asSeconds();var testUrl=customUrl.url_value;var body={query:{bool:{must:[{term:{job_id:job.job_id}},{term:{result_type:"record"}}]}},size:1,_source:{excludes:[]},sort:[{record_score:{order:"desc"}}]};return new Promise(function(resolve,reject){_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,rest_total_hits_as_int:true,body:body}).then(function(resp){if(resp.hits.total>0){var record=resp.hits.hits[0]._source;testUrl=(0,_custom_url_utils.replaceTokensInUrlValue)(customUrl,bucketSpanSecs,record,"timestamp");resolve(testUrl)}else{_job_service.mlJobService.searchPreview(job).then(function(response){var testDoc=void 0;var docTimeFieldName=job.data_description.time_field;if(response.aggregations){var firstBucket=response.aggregations.buckets.buckets[0];testDoc=_defineProperty({},docTimeFieldName,firstBucket.key);urlValue.replace(/\$([^?&$\'"]{1,40})\$/g,function(match,name){if(name!=="earliest"&&name!=="latest"&&firstBucket[name]!==undefined){var tokenBuckets=firstBucket[name];if(tokenBuckets.buckets){testDoc[name]=tokenBuckets.buckets[0].key}}})}else{if(response.hits.total>0){testDoc=response.hits.hits[0]._source}}if(testDoc!==undefined){testUrl=(0,_custom_url_utils.replaceTokensInUrlValue)(customUrl,bucketSpanSecs,testDoc,docTimeFieldName)}resolve(testUrl)})}}).catch(function(resp){reject(resp)})})}},632:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var URL_TYPE=exports.URL_TYPE={KIBANA_DASHBOARD:"KIBANA_DASHBOARD",KIBANA_DISCOVER:"KIBANA_DISCOVER",OTHER:"OTHER"};var TIME_RANGE_TYPE=exports.TIME_RANGE_TYPE={AUTO:"auto",INTERVAL:"interval"}},633:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SelectSeverity=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _anomaly_utils=__webpack_require__(256);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var optionsMap={warning:0,minor:25,major:50,critical:75};var SEVERITY_OPTIONS=[{val:0,display:"warning",color:(0,_anomaly_utils.getSeverityColor)(0)},{val:25,display:"minor",color:(0,_anomaly_utils.getSeverityColor)(25)},{val:50,display:"major",color:(0,_anomaly_utils.getSeverityColor)(50)},{val:75,display:"critical",color:(0,_anomaly_utils.getSeverityColor)(75)}];function optionValueToThreshold(value){var threshold=SEVERITY_OPTIONS.find(function(opt){return opt.val===value});if(threshold===undefined){threshold=SEVERITY_OPTIONS[0]}return threshold}var SelectSeverity=function(_Component){_inherits(SelectSeverity,_Component);function SelectSeverity(props){_classCallCheck(this,SelectSeverity);var _this=_possibleConstructorReturn(this,(SelectSeverity.__proto__||Object.getPrototypeOf(SelectSeverity)).call(this,props));_this.onChange=function(valueDisplay){_this.setState({valueDisplay:valueDisplay});var threshold=optionValueToThreshold(optionsMap[valueDisplay]);if(_this.mlSelectSeverityService!==undefined){_this.mlSelectSeverityService.state.set("threshold",threshold).changed()}else{_this.props.onChangeHandler(threshold)}};_this.getOptions=function(){return SEVERITY_OPTIONS.map(function(_ref){var color=_ref.color,display=_ref.display,val=_ref.val;return{value:display,inputDisplay:_react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_eui.EuiHealth,{color:color,style:{lineHeight:"inherit"}},display)),dropdownDisplay:_react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_eui.EuiHealth,{color:color,style:{lineHeight:"inherit"}},display),_react2.default.createElement(_eui.EuiSpacer,{size:"xs"}),_react2.default.createElement(_eui.EuiText,{size:"xs",color:"subdued"},_react2.default.createElement("p",{className:"euiTextColor--subdued"},"score "+val+" and above")))}})};if(_this.props.mlSelectSeverityService){_this.mlSelectSeverityService=_this.props.mlSelectSeverityService}_this.state={valueDisplay:SEVERITY_OPTIONS[0].display};return _this}_createClass(SelectSeverity,[{key:"componentDidMount",value:function componentDidMount(){if(this.mlSelectSeverityService!==undefined){var thresholdState=this.mlSelectSeverityService.state.get("threshold");var thresholdValue=_lodash2.default.get(thresholdState,"val",0);var threshold=optionValueToThreshold(thresholdValue);var selectedOption=SEVERITY_OPTIONS.find(function(opt){return opt.val===threshold.val});this.mlSelectSeverityService.state.set("threshold",threshold);this.setState({valueDisplay:selectedOption.display})}}},{key:"render",value:function render(){var valueDisplay=this.state.valueDisplay;var options=this.getOptions();return _react2.default.createElement(_eui.EuiSuperSelect,{className:this.props.classNames,hasDividers:true,options:options,valueOfSelected:valueDisplay,onChange:this.onChange})}}]);return SelectSeverity}(_react.Component);SelectSeverity.propTypes={mlSelectSeverityService:_propTypes2.default.object,onChangeHandler:_propTypes2.default.func,classNames:_propTypes2.default.string};SelectSeverity.defaultProps={mlSelectSeverityService:undefined,onChangeHandler:function onChangeHandler(){},classNames:""};exports.SelectSeverity=SelectSeverity},634:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var MULTI_BUCKET_IMPACT=exports.MULTI_BUCKET_IMPACT={HIGH:3,MEDIUM:2,LOW:1,NONE:-5}},635:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.filterAggTypes=filterAggTypes;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _angular=__webpack_require__(21);var _angular2=_interopRequireDefault(_angular);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function filterAggTypes(aggTypes){var filteredAggTypes=[];var typeCopy=void 0;_lodash2.default.each(aggTypes,function(type){type.mlName=type.name;type.mlModelPlotAgg={max:type.name,min:type.name};type.isCountType=false;type.isAggregatableStringType=false;_lodash2.default.each(type.params,function(p){if(p.filterFieldTypes&&typeof p.filterFieldTypes==="string"){p.filterFieldTypes=p.filterFieldTypes.replace(",date","")}});if(type.name==="count"){type.mlModelPlotAgg={max:"max",min:"min"};type.isCountType=true;filteredAggTypes.push(type);typeCopy=_angular2.default.copy(type);typeCopy.title="High count";typeCopy.mlName="high_count";filteredAggTypes.push(typeCopy);typeCopy=_angular2.default.copy(type);typeCopy.title="Low count";typeCopy.mlName="low_count";filteredAggTypes.push(typeCopy)}else if(type.name==="sum"){filteredAggTypes.push(type);typeCopy=_angular2.default.copy(type);typeCopy.title="High sum";typeCopy.mlName="high_sum";filteredAggTypes.push(typeCopy);typeCopy=_angular2.default.copy(type);typeCopy.title="Low sum";typeCopy.mlName="low_sum";filteredAggTypes.push(typeCopy)}else if(type.name==="avg"){type.title="Mean";type.mlName="mean";filteredAggTypes.push(type);typeCopy=_angular2.default.copy(type);typeCopy.title="High mean";typeCopy.mlName="high_mean";filteredAggTypes.push(typeCopy);typeCopy=_angular2.default.copy(type);typeCopy.title="Low mean";typeCopy.mlName="low_mean";filteredAggTypes.push(typeCopy)}else if(type.name==="median"){type.mlModelPlotAgg={max:"max",min:"min"};filteredAggTypes.push(type);typeCopy=_angular2.default.copy(type);typeCopy.title="High median";typeCopy.mlName="high_median";filteredAggTypes.push(typeCopy);typeCopy=_angular2.default.copy(type);typeCopy.title="Low median";typeCopy.mlName="low_median";filteredAggTypes.push(typeCopy)}else if(type.name==="min"){filteredAggTypes.push(type)}else if(type.name==="max"){filteredAggTypes.push(type)}else if(type.name==="cardinality"){type.title="Distinct count";type.mlName="distinct_count";type.mlModelPlotAgg={max:"max",min:"min"};type.isAggregatableStringType=true;_lodash2.default.each(type.params,function(p){if(p.filterFieldTypes){p.filterFieldTypes="number,boolean,ip,string"}});filteredAggTypes.push(type)}});return filteredAggTypes}},636:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.adjustIntervalDisplayed=adjustIntervalDisplayed;var _parse_interval=__webpack_require__(219);function adjustIntervalDisplayed(formConfig){var makeTheSame=false;var intervalSeconds=formConfig.chartInterval.getInterval().asSeconds();var bucketSpan=(0,_parse_interval.parseInterval)(formConfig.bucketSpan);if(bucketSpan!==null){if(bucketSpan.asSeconds()>intervalSeconds){makeTheSame=true}if(formConfig.agg.type!==undefined){var mlName=formConfig.agg.type.mlName;if(mlName==="count"||mlName==="low_count"||mlName==="high_count"||mlName==="distinct_count"){makeTheSame=true}}if(makeTheSame){formConfig.chartInterval.setInterval(formConfig.bucketSpan)}}}},637:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.createFields=createFields;exports.getIndexedFields=getIndexedFields;var _general=__webpack_require__(259);var _field_types=__webpack_require__(257);var _job_utils=__webpack_require__(34);var _field_types_utils=__webpack_require__(993);function createFields(scope,indexPattern){var isPopulation=scope.formConfig.hasOwnProperty("overField");var agg=scope.formConfig.agg;var fields=[];var categoryFields=[];scope.ui.fields=[];agg.type.params.forEach(function(param){if(param.name==="field"){fields=getIndexedFields(indexPattern,[_field_types.KBN_FIELD_TYPES.NUMBER,_field_types.KBN_FIELD_TYPES.STRING,_field_types.KBN_FIELD_TYPES.IP])}if(param.name==="customLabel"){categoryFields=getIndexedFields(indexPattern,[_field_types.KBN_FIELD_TYPES.STRING,_field_types.KBN_FIELD_TYPES.IP])}});var countAgg={type:scope.ui.aggTypeOptions.find(function(o){return o.name==="count"})};var eventRateField={id:_general.EVENT_RATE_COUNT_FIELD,name:"event rate",tooltip:"System defined field",isCountField:true,agg:countAgg,mlType:_field_types.ML_JOB_FIELD_TYPES.NUMBER,splitField:undefined,firstSplitFieldName:undefined,cardLabels:undefined};if(isPopulation){eventRateField.splitField=undefined;eventRateField.firstSplitFieldName=undefined;eventRateField.cardLabels=undefined}scope.ui.fields.push(eventRateField);var cardinalityAgg={type:scope.ui.aggTypeOptions.find(function(o){return o.name==="cardinality"})};fields.forEach(function(field,i){var id=(0,_job_utils.getSafeAggregationName)(field.displayName,i);var f={id:id,name:field.displayName,tooltip:field.displayName,agg:field.mlType===_field_types.ML_JOB_FIELD_TYPES.KEYWORD||field.mlType===_field_types.ML_JOB_FIELD_TYPES.IP?_extends({},cardinalityAgg):_extends({},agg),mlType:field.mlType};if(isPopulation){f.splitField=undefined;f.firstSplitFieldName=undefined;f.cardLabels=undefined}scope.ui.fields.push(f)});categoryFields.forEach(function(field){scope.ui.splitFields.push(field);if(isPopulation){scope.ui.overFields.push(field)}})}function getIndexedFields(indexPattern,fieldTypes){var fields=indexPattern.fields.raw.filter(function(f){return f.aggregatable===true});if(fieldTypes){fields=fields.filter(function(f){return f.displayName!=="_type"&&f.displayName!=="_id"&&f.displayName!=="_index"&&f.scripted!==true});fields=fields.filter(function(f){return fieldTypes.find(function(t){return t===f.type})});fields.forEach(function(f){return f.mlType=(0,_field_types_utils.kbnTypeToMLJobType)(f)});fields=fields.sort(orderBy(["name","type"]))}return fields}function orderBy(items){return function(a,b){var result=0;items.forEach(function(i){var aa=a[i].toLowerCase();var bb=b[i].toLowerCase();if(aa<bb){result=-1}else if(aa>bb){result=1}});return result||0}}},638:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.preLoadJob=preLoadJob;exports.jobSettingsFromJob=jobSettingsFromJob;var _job_service=__webpack_require__(23);var _app_state_settings=__webpack_require__(2307);var _general=__webpack_require__(259);function preLoadJob($scope,appState){var job=_job_service.mlJobService.currentJob;_job_service.mlJobService.currentJob=undefined;if(job!==undefined){var mlJobSettings=jobSettingsFromJob(job,$scope.ui.aggTypeOptions);(0,_app_state_settings.populateAppStateSettings)({mlJobSettings:mlJobSettings},$scope);$scope.setFullTimeRange().then(function(){return $scope.loadVis()}).catch(function(){return $scope.loadVis()})}else{(0,_app_state_settings.populateAppStateSettings)(appState,$scope)}}function jobSettingsFromJob(job,aggTypeOptions){if(job.custom_settings===undefined){return{}}function getKibanaAggName(mlAggName){var agg=aggTypeOptions.find(function(a){return a.mlName===mlAggName});return agg?agg.mlName:undefined}var jobSettings={};var dtrs=job.analysis_config.detectors;if(job.custom_settings.created_by===_general.WIZARD_TYPE.SINGLE_METRIC){var d=dtrs[0];var func=d.function;if(func==="non_zero_count"&&job.analysis_config.summary_count_field_name!==undefined&&job.analysis_config.summary_count_field_name.match(/^dc_.+/)){func="distinct_count"}var field={agg:getKibanaAggName(func)};if(d.field_name){field.fieldName=d.field_name}else if(func==="distinct_count"&&job.analysis_config.summary_count_field_name!==undefined){var fieldMatch=job.analysis_config.summary_count_field_name.match(/^dc_(.+)/);if(fieldMatch[1]!==undefined){field.fieldName=fieldMatch[1]}}jobSettings.fields=[field]}else if(job.custom_settings.created_by===_general.WIZARD_TYPE.MULTI_METRIC){var splitField="";jobSettings.fields=dtrs.map(function(d){if(d.partition_field_name){splitField=d.partition_field_name}var field={agg:getKibanaAggName(d.function)};if(d.field_name){field.fieldName=d.field_name}return field});if(splitField!==""){jobSettings.split=splitField}}else if(job.custom_settings.created_by===_general.WIZARD_TYPE.POPULATION){var overField="";var splitFields={};jobSettings.fields=dtrs.map(function(d){if(d.over_field_name){overField=d.over_field_name}var field={agg:getKibanaAggName(d.function)};if(d.field_name){field.fieldName=d.field_name}if(d.by_field_name){field.split=d.by_field_name}return field});if(overField!==""){jobSettings.population=overField}var numberOfSplits=Object.keys(splitFields).length;if(numberOfSplits>0){if(numberOfSplits>1){for(var f in splitFields){if(splitFields.hasOwnProperty(f)){var i=splitFields[f];jobSettings.fields[i]=f}}}else{jobSettings.split=Object.keys(splitFields)[0]}}}jobSettings.bucketSpan=job.analysis_config.bucket_span;if(job.analysis_limits&&job.analysis_limits.model_memory_limit){jobSettings.modelMemoryLimit=job.analysis_limits.model_memory_limit}if(job.description!==""){jobSettings.description=job.description}if(job.groups!==undefined&&job.groups.length){jobSettings.groups=job.groups}if(job.analysis_config&&job.analysis_config.influencers){jobSettings.influencers=job.analysis_config.influencers}jobSettings.resultsIndexName=job.results_index_name;return jobSettings}},639:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2310);__webpack_require__(992)},640:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JsonTooltip=undefined;var _tooltips=__webpack_require__(3110);var _tooltips2=_interopRequireDefault(_tooltips);var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var JsonTooltip=exports.JsonTooltip=function JsonTooltip(_ref){var id=_ref.id,position=_ref.position;var text=_tooltips2.default[id]?_tooltips2.default[id].text:"";return _react2.default.createElement("span",{"aria-hidden":"true",className:"ml-info-icon"},_react2.default.createElement(_eui.EuiIconTip,{content:text,position:position}),_react2.default.createElement("span",{id:"ml_aria_description_"+id,className:"ml-info-tooltip-text"},text))};JsonTooltip.propTypes={id:_propTypes2.default.string,position:_propTypes2.default.string}},641:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2427);__webpack_require__(2429);__webpack_require__(408)},642:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var PROGRESS_STATES=exports.PROGRESS_STATES={UNSET:-1,WAITING:0,DONE:1,ERROR:-10}},644:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getCalendarSettingsData=getCalendarSettingsData;exports.validateCalendarId=validateCalendarId;exports.generateTempId=generateTempId;var _ml_api_service=__webpack_require__(22);var _job_utils=__webpack_require__(34);function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function getJobIds(){return new Promise(function(resolve,reject){_ml_api_service.ml.jobs.jobsSummary().then(function(resp){resolve(resp.map(function(job){return job.id}))}).catch(function(err){var errorMessage="Error fetching job summaries: "+err;console.log(errorMessage);reject(errorMessage)})})}function getGroupIds(){return new Promise(function(resolve,reject){_ml_api_service.ml.jobs.groups().then(function(resp){resolve(resp.map(function(group){return group.id}))}).catch(function(err){var errorMessage="Error loading groups: "+err;console.log(errorMessage);reject(errorMessage)})})}function getCalendars(){return new Promise(function(resolve,reject){_ml_api_service.ml.calendars().then(function(resp){resolve(resp)}).catch(function(err){var errorMessage="Error loading calendars: "+err;console.log(errorMessage);reject(errorMessage)})})}function getCalendarSettingsData(){var _this=this;return new Promise(function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(resolve,reject){var data,formattedData;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return Promise.all([getJobIds(),getGroupIds(),getCalendars()]);case 3:data=_context.sent;formattedData={jobIds:data[0],groupIds:data[1],calendars:data[2]};resolve(formattedData);_context.next=12;break;case 8:_context.prev=8;_context.t0=_context["catch"](0);console.log(_context.t0);reject(_context.t0);case 12:case"end":return _context.stop()}}},_callee,_this,[[0,8]])}));return function(_x,_x2){return _ref.apply(this,arguments)}}())}function validateCalendarId(calendarId){var valid=true;if(calendarId===""||calendarId===undefined){valid=false}else if((0,_job_utils.isJobIdValid)(calendarId)===false){valid=false}return valid}function generateTempId(){return Math.random().toString(36).substr(2,9)}},645:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _events_table=__webpack_require__(2504);Object.defineProperty(exports,"EventsTable",{enumerable:true,get:function get(){return _events_table.EventsTable}});Object.defineProperty(exports,"TIME_FORMAT",{enumerable:true,get:function get(){return _events_table.TIME_FORMAT}})},646:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Importer=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _ml_api_service=__webpack_require__(22);var _lodash=__webpack_require__(1);var _moment=__webpack_require__(13);var _moment2=_interopRequireDefault(_moment);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var CHUNK_SIZE=1e4;var IMPORT_RETRIES=5;var Importer=exports.Importer=function(){function Importer(_ref){var settings=_ref.settings,mappings=_ref.mappings,pipeline=_ref.pipeline;_classCallCheck(this,Importer);this.settings=settings;this.mappings=mappings;this.pipeline=pipeline;this.data=[];this.docArray=[]}_createClass(Importer,[{key:"initializeImport",value:function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee(index){var settings,mappings,pipeline,ingestPipeline,createIndexResp;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:settings=this.settings;mappings=this.mappings;pipeline=this.pipeline;updatePipelineTimezone(pipeline);ingestPipeline=pipeline!==undefined?{id:index+"-pipeline",pipeline:pipeline}:{};_context.next=7;return _ml_api_service.ml.fileDatavisualizer.import({id:undefined,index:index,data:[],settings:settings,mappings:mappings,ingestPipeline:ingestPipeline});case 7:createIndexResp=_context.sent;return _context.abrupt("return",createIndexResp);case 9:case"end":return _context.stop()}}},_callee,this)}));function initializeImport(_x){return _ref2.apply(this,arguments)}return initializeImport}()},{key:"import",value:function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(id,index,pipelineId,setImportProgress){var chunks,ingestPipeline,success,failures,error,i,aggs,retries,resp,result;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(!id||!index)){_context2.next=2;break}return _context2.abrupt("return",{success:false,error:"no ID or index supplied"});case 2:chunks=(0,_lodash.chunk)(this.docArray,CHUNK_SIZE);ingestPipeline={id:pipelineId};success=true;failures=[];error=void 0;i=0;case 8:if(!(i<chunks.length)){_context2.next=33;break}aggs={id:id,index:index,data:chunks[i],settings:{},mappings:{},ingestPipeline:ingestPipeline};retries=IMPORT_RETRIES;resp={success:false,failures:[],docCount:0};case 12:if(!(resp.success===false&&retries>0)){_context2.next=20;break}_context2.next=15;return _ml_api_service.ml.fileDatavisualizer.import(aggs);case 15:resp=_context2.sent;if(retries<IMPORT_RETRIES){console.log("Retrying import "+(IMPORT_RETRIES-retries))}retries--;_context2.next=12;break;case 20:if(!resp.success){_context2.next=24;break}setImportProgress((i+1)/chunks.length*100);_context2.next=29;break;case 24:console.error(resp);success=false;error=resp.error;populateFailures(resp,failures,i);return _context2.abrupt("break",33);case 29:populateFailures(resp,failures,i);case 30:i++;_context2.next=8;break;case 33:result={success:success,failures:failures,docCount:this.docArray.length};if(success){setImportProgress(100)}else{result.error=error}return _context2.abrupt("return",result);case 36:case"end":return _context2.stop()}}},_callee2,this)}));function _import(_x2,_x3,_x4,_x5){return _ref3.apply(this,arguments)}return _import}()}]);return Importer}();function populateFailures(error,failures,chunkCount){if(error.failures&&error.failures.length){for(var f=0;f<error.failures.length;f++){var failure=error.failures[f];failure.item=failure.item+CHUNK_SIZE*chunkCount}failures.push.apply(failures,_toConsumableArray(error.failures))}}function updatePipelineTimezone(ingestPipeline){if(ingestPipeline!==undefined&&ingestPipeline.processors&&ingestPipeline.processors){var dateProcessor=ingestPipeline.processors.find(function(p){return p.date!==undefined&&p.date.timezone==="{{ beat.timezone }}"});if(dateProcessor){dateProcessor.date.timezone=_moment2.default.tz.guess()}}}},7:function(module,exports){module.exports=vendors},986:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _management=__webpack_require__(2210);Object.defineProperty(exports,"actionsMenuContent",{enumerable:true,get:function get(){return _management.actionsMenuContent}});var _results=__webpack_require__(2211);Object.defineProperty(exports,"ResultLinks",{enumerable:true,get:function get(){return _results.ResultLinks}})},987:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _job_message_icon=__webpack_require__(2214);Object.defineProperty(exports,"JobIcon",{enumerable:true,get:function get(){return _job_message_icon.JobIcon}})},988:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AnnotationsTable=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _risonNode=__webpack_require__(206);var _risonNode2=_interopRequireDefault(_risonNode);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _services=__webpack_require__(654);var _format=__webpack_require__(418);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _recently_accessed=__webpack_require__(468);var _ml_api_service=__webpack_require__(22);var _job_service=__webpack_require__(23);var _table_service=__webpack_require__(628);var _search=__webpack_require__(629);var _job_utils=__webpack_require__(34);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TIME_FORMAT="YYYY-MM-DD HH:mm:ss";var AnnotationsTable=function(_Component){_inherits(AnnotationsTable,_Component);function AnnotationsTable(props){_classCallCheck(this,AnnotationsTable);var _this=_possibleConstructorReturn(this,(AnnotationsTable.__proto__||Object.getPrototypeOf(AnnotationsTable)).call(this,props));_this.openSingleMetricView=function(){var annotation=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var job=_this.getJob(annotation.job_id);var dataCounts=job.data_counts;var from=new Date(dataCounts.earliest_record_timestamp).toISOString();var to=new Date(dataCounts.latest_record_timestamp).toISOString();var globalSettings={ml:{jobIds:[job.job_id]},refreshInterval:{display:"Off",pause:false,value:0},time:{from:from,to:to,mode:"absolute"}};var appState={filters:[],query:{query_string:{analyze_wildcard:true,query:"*"}}};if(annotation.timestamp!==undefined&&annotation.end_timestamp!==undefined){appState.mlTimeSeriesExplorer={zoom:{from:new Date(annotation.timestamp).toISOString(),to:new Date(annotation.end_timestamp).toISOString()}};if(annotation.timestamp<dataCounts.earliest_record_timestamp){globalSettings.time.from=new Date(annotation.timestamp).toISOString()}if(annotation.end_timestamp>dataCounts.latest_record_timestamp){globalSettings.time.to=new Date(annotation.end_timestamp).toISOString()}}var _g=_risonNode2.default.encode(globalSettings);var _a=_risonNode2.default.encode(appState);var url="?_g="+_g+"&_a="+_a;(0,_recently_accessed.addItemToRecentlyAccessed)("timeseriesexplorer",job.job_id,url);window.open(_chrome2.default.getBasePath()+"/app/ml#/timeseriesexplorer"+url,"_self")};_this.onMouseOverRow=function(record){if(_this.mouseOverRecord!==undefined){if(_this.mouseOverRecord.rowId!==record.rowId){_table_service.mlTableService.rowMouseleave.changed(_this.mouseOverRecord,"annotation");_table_service.mlTableService.rowMouseenter.changed(record,"annotation")}}else{_table_service.mlTableService.rowMouseenter.changed(record,"annotation")}_this.mouseOverRecord=record};_this.onMouseLeaveRow=function(){if(_this.mouseOverRecord!==undefined){_table_service.mlTableService.rowMouseleave.changed(_this.mouseOverRecord,"annotation");_this.mouseOverRecord=undefined}};_this.state={annotations:[],isLoading:false,jobId:Array.isArray(_this.props.jobs)&&_this.props.jobs.length>0&&_this.props.jobs[0]!==undefined?_this.props.jobs[0].job_id:undefined};return _this}_createClass(AnnotationsTable,[{key:"getAnnotations",value:function getAnnotations(){var _this2=this;var job=this.props.jobs[0];var dataCounts=job.data_counts;this.setState({isLoading:true});if(dataCounts.processed_record_count>0){_ml_api_service.ml.annotations.getAnnotations({jobIds:[job.job_id],earliestMs:null,latestMs:null,maxAnnotations:_search.ANNOTATIONS_TABLE_DEFAULT_QUERY_SIZE}).then(function(resp){_this2.setState(function(prevState,props){return{annotations:resp.annotations[props.jobs[0].job_id]||[],errorMessage:undefined,isLoading:false,jobId:props.jobs[0].job_id}})}).catch(function(resp){console.log("Error loading list of annotations for jobs list:",resp);_this2.setState({annotations:[],errorMessage:"Error loading the list of annotations for this job",isLoading:false,jobId:undefined})})}}},{key:"getJob",value:function getJob(jobId){if(Array.isArray(this.props.jobs)&&this.props.jobs.length>0){var job=this.props.jobs[0];if(jobId===undefined||job.job_id===jobId){return job}}return _job_service.mlJobService.getJob(jobId)}},{key:"componentDidMount",value:function componentDidMount(){if(this.props.annotations===undefined){this.getAnnotations()}}},{key:"componentWillUpdate",value:function componentWillUpdate(){if(this.props.annotations===undefined&&this.state.isLoading===false&&this.state.jobId!==this.props.jobs[0].job_id){this.getAnnotations()}}},{key:"render",value:function render(){var _this3=this;var _props=this.props,_props$isSingleMetric=_props.isSingleMetricViewerLinkVisible,isSingleMetricViewerLinkVisible=_props$isSingleMetric===undefined?true:_props$isSingleMetric,_props$isNumberBadgeV=_props.isNumberBadgeVisible,isNumberBadgeVisible=_props$isNumberBadgeV===undefined?false:_props$isNumberBadgeV;if(this.props.annotations===undefined){if(this.state.isLoading===true){return _react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceAround"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiLoadingSpinner,{size:"l"})))}if(this.state.errorMessage!==undefined){return _react2.default.createElement(_eui.EuiCallOut,{title:this.state.errorMessage,color:"danger",iconType:"cross"})}}var annotations=this.props.annotations||this.state.annotations;if(annotations.length===0){return _react2.default.createElement(_eui.EuiCallOut,{title:"No annotations created for this job",iconType:"iInCircle"},this.state.jobId&&(0,_job_utils.isTimeSeriesViewJob)(this.getJob(this.state.jobId))&&_react2.default.createElement("p",null,"To create an annotation, open the ",_react2.default.createElement(_eui.EuiLink,{onClick:function onClick(){return _this3.openSingleMetricView()}},"Single Metric Viewer")))}function renderDate(date){return(0,_format.formatDate)(date,TIME_FORMAT)}var columns=[{field:"annotation",name:"Annotation",sortable:true},{field:"timestamp",name:"From",dataType:"date",render:renderDate,sortable:true},{field:"end_timestamp",name:"To",dataType:"date",render:renderDate,sortable:true},{field:"create_time",name:"Creation date",dataType:"date",render:renderDate,sortable:true},{field:"create_username",name:"Created by",sortable:true},{field:"modified_time",name:"Last modified date",dataType:"date",render:renderDate,sortable:true},{field:"modified_username",name:"Last modified by",sortable:true}];var jobIds=_lodash2.default.uniq(annotations.map(function(a){return a.job_id}));if(jobIds.length>1){columns.unshift({field:"job_id",name:"job ID",sortable:true})}if(isNumberBadgeVisible){columns.unshift({field:"key",name:"Label",sortable:true,width:"60px",render:function render(key){return _react2.default.createElement(_eui.EuiBadge,{color:"default"},key)}})}if(isSingleMetricViewerLinkVisible){columns.push({align:_services.RIGHT_ALIGNMENT,width:"60px",name:"View",render:function render(annotation){var isDrillDownAvailable=(0,_job_utils.isTimeSeriesViewJob)(_this3.getJob(annotation.job_id));var openInSingleMetricViewerText=isDrillDownAvailable?"Open in Single Metric Viewer":"Job configuration not supported in Single Metric Viewer";return _react2.default.createElement(_eui.EuiToolTip,{position:"bottom",content:openInSingleMetricViewerText},_react2.default.createElement(_eui.EuiButtonIcon,{onClick:function onClick(){return _this3.openSingleMetricView(annotation)},disabled:!isDrillDownAvailable,iconType:"stats","aria-label":openInSingleMetricViewerText}))}})}var getRowProps=function getRowProps(item){return{onMouseOver:function onMouseOver(){return _this3.onMouseOverRow(item)},onMouseLeave:function onMouseLeave(){return _this3.onMouseLeaveRow()}}};return _react2.default.createElement(_eui.EuiInMemoryTable,{className:"eui-textOverflowWrap",compressed:true,items:annotations,columns:columns,pagination:{pageSizeOptions:[5,10,25]},sorting:{sort:{field:"timestamp",direction:"asc"}},rowProps:getRowProps})}}]);return AnnotationsTable}(_react.Component);AnnotationsTable.propTypes={annotations:_propTypes2.default.array,jobs:_propTypes2.default.array,isSingleMetricViewerLinkVisible:_propTypes2.default.bool,isNumberBadgeVisible:_propTypes2.default.bool};exports.AnnotationsTable=AnnotationsTable},989:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.saveJob=saveJob;exports.loadSavedDashboards=loadSavedDashboards;exports.loadIndexPatterns=loadIndexPatterns;var _lodash=__webpack_require__(1);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _new_job_defaults=__webpack_require__(241);var _job_service=__webpack_require__(23);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function saveJob(job,newJobData,finish){return new Promise(function(resolve,reject){var jobData=_extends({},extractDescription(job,newJobData),extractGroups(job,newJobData),extractMML(job,newJobData),extractDetectorDescriptions(job,newJobData),extractCustomSettings(job,newJobData));var datafeedData=_extends({},extractDatafeed(job,newJobData));if(jobData.custom_settings!==undefined){jobData.custom_settings=processCustomSettings(jobData,datafeedData)}var saveDatafeedWrapper=function saveDatafeedWrapper(){saveDatafeed(datafeedData,job,finish).then(function(){resolve()}).catch(function(error){reject(error)})};if(Object.keys(jobData).length){_job_service.mlJobService.updateJob(job.job_id,jobData).then(function(resp){if(resp.success){saveDatafeedWrapper()}else{reject(resp)}}).catch(function(error){reject(error)})}else{saveDatafeedWrapper()}})}function saveDatafeed(datafeedData,job){return new Promise(function(resolve,reject){if(Object.keys(datafeedData).length){var datafeedId=job.datafeed_config.datafeed_id;_job_service.mlJobService.updateDatafeed(datafeedId,datafeedData).then(function(resp){if(resp.success){resolve()}else{reject(resp)}})}else{resolve()}})}function loadSavedDashboards(maxNumber){return new Promise(function(resolve,reject){var savedObjectsClient=_chrome2.default.getSavedObjectsClient();savedObjectsClient.find({type:"dashboard",fields:["title"],perPage:maxNumber}).then(function(resp){var savedObjects=resp.savedObjects;if(savedObjects!==undefined){var dashboards=savedObjects.map(function(savedObj){return{id:savedObj.id,title:savedObj.attributes.title}});dashboards.sort(function(dash1,dash2){return dash1.title.localeCompare(dash2.title)});resolve(dashboards)}}).catch(function(resp){reject(resp)})})}function loadIndexPatterns(maxNumber){return new Promise(function(resolve,reject){var savedObjectsClient=_chrome2.default.getSavedObjectsClient();savedObjectsClient.find({type:"index-pattern",fields:["title"],perPage:maxNumber}).then(function(resp){var savedObjects=resp.savedObjects;if(savedObjects!==undefined){var indexPatterns=savedObjects.map(function(savedObj){return{id:savedObj.id,title:savedObj.attributes.title}});indexPatterns.sort(function(dash1,dash2){return dash1.title.localeCompare(dash2.title)});resolve(indexPatterns)}}).catch(function(resp){reject(resp)})})}function extractDescription(job,newJobData){var description=newJobData.description;if(newJobData.description!==job.description){return{description:description}}return{}}function extractGroups(job,newJobData){var groups=newJobData.groups;if(newJobData.groups!==undefined){var diffCount=(0,_lodash.difference)(job.groups,groups).length+(0,_lodash.difference)(groups,job.groups).length;return diffCount===0?{}:{groups:groups}}return{}}function extractMML(job,newJobData){var jobLimits=(0,_new_job_defaults.newJobLimits)();var mmlData={};if(job.analysis_limits.model_memory_limit!==undefined){var mml=newJobData.mml;if(mml===""){mml=jobLimits.max_model_memory_limit}if(mml!==job.analysis_limits.model_memory_limit){mmlData.analysis_limits={model_memory_limit:mml}}}return mmlData}function extractDetectorDescriptions(job,newJobData){var detectors=[];var descriptions=newJobData.detectorDescriptions.map(function(d,i){return{detector_index:i,description:d}});var originalDetectors=job.analysis_config.detectors;originalDetectors.forEach(function(d){if(descriptions[d.detector_index].description!==d.detector_description){detectors.push(descriptions[d.detector_index])}});return detectors.length?{detectors:detectors}:{}}function extractCustomSettings(job,newJobData){var settingsData={};if(newJobData&&newJobData.customUrls){settingsData.custom_settings=job.custom_settings||{};settingsData.custom_settings.custom_urls=newJobData.customUrls}return settingsData}function extractDatafeed(job,newDatafeedData){var datafeedData={};if(job.datafeed_config!==undefined){var origQueryString=JSON.stringify(job.datafeed_config.query);var newQuery=JSON.parse(newDatafeedData.datafeedQuery);var newQueryString=JSON.stringify(newQuery);if(origQueryString!==newQueryString){datafeedData.query=newQuery}if(job.datafeed_config.query_delay!==newDatafeedData.datafeedQueryDelay){datafeedData.query_delay=newDatafeedData.datafeedQueryDelay}if(job.datafeed_config.frequency!==newDatafeedData.datafeedFrequency&&newDatafeedData.datafeedFrequency!==""){datafeedData.frequency=newDatafeedData.datafeedFrequency}if(job.datafeed_config.scroll_size!==newDatafeedData.datafeedScrollSize){datafeedData.scroll_size=newDatafeedData.datafeedScrollSize}}return datafeedData}function processCustomSettings(jobData,datafeedData){var customSettings={};if(jobData.custom_settings!==undefined){customSettings=_extends({},jobData.custom_settings);if(jobData.custom_settings.created_by!==undefined){if(jobData.detectors!==undefined||Object.keys(datafeedData).length||jobData.custom_settings.custom_urls!==undefined&&jobData.custom_settings.custom_urls.length){delete customSettings.created_by}}}return customSettings}},990:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.validateModelMemoryLimit=validateModelMemoryLimit;exports.validateGroupNames=validateGroupNames;exports.isValidCustomUrls=isValidCustomUrls;var _new_job_defaults=__webpack_require__(241);var _validate_job=__webpack_require__(469);var _job_utils=__webpack_require__(34);var _custom_url_utils=__webpack_require__(405);function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function validateModelMemoryLimit(mml){var limits=(0,_new_job_defaults.newJobLimits)();var tempJob={analysis_limits:{model_memory_limit:mml}};var validationResults=(0,_job_utils.validateModelMemoryLimitUnits)(tempJob);var _validationResults=validationResults,valid=_validationResults.valid;if(valid){validationResults=(0,_job_utils.validateModelMemoryLimit)(tempJob,limits);valid=validationResults.valid}var modelMemoryLimit={valid:valid,message:""};(0,_validate_job.populateValidationMessages)(validationResults,{modelMemoryLimit:modelMemoryLimit});return modelMemoryLimit}function validateGroupNames(groups){var tempJob={groups:groups};var validationResults=(0,_job_utils.validateGroupNames)(tempJob);var valid=validationResults.valid;var groupIds={valid:valid,message:""};(0,_validate_job.populateValidationMessages)(validationResults,{groupIds:groupIds});return groupIds}function isValidCustomUrls(customUrls){if(customUrls===undefined||customUrls.length===0){return true}var isInvalidItem=customUrls.some(function(customUrl,index){var label=customUrl.url_name;var otherUrls=[].concat(_toConsumableArray(customUrls));otherUrls.splice(index,1);var itemValid=(0,_custom_url_utils.isValidLabel)(label,otherUrls);if(itemValid===true){var timeRange=customUrl.time_range;itemValid=(0,_custom_url_utils.isValidTimeRange)(timeRange)}return!itemValid});return!isInvalidItem}},991:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mlCalendarService=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _ml_api_service=__webpack_require__(22);var _job_service=__webpack_require__(23);var _messagebar_service=__webpack_require__(178);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var msgs=_messagebar_service.mlMessageBarService;var CalendarService=function(){function CalendarService(){_classCallCheck(this,CalendarService);this.calendars=[];this.jobCalendars={};this.groupCalendars={}}_createClass(CalendarService,[{key:"loadCalendars",value:function loadCalendars(jobs){var _this=this;return new Promise(function(resolve,reject){var calendars=[];jobs.forEach(function(j){_this.jobCalendars[j.job_id]=[]});var groups={};_job_service.mlJobService.getJobGroups().forEach(function(g){groups[g.id]=g});_ml_api_service.ml.calendars().then(function(resp){calendars=resp;calendars.forEach(function(cal){cal.job_ids.forEach(function(id){var isGroup=false;if(_this.jobCalendars[id]!==undefined){_this.jobCalendars[id].push(cal.calendar_id)}else if(groups[id]!==undefined){isGroup=true;groups[id].jobs.forEach(function(j){_this.jobCalendars[j.job_id].push(cal.calendar_id)})}else{isGroup=true}if(isGroup){if(_this.groupCalendars[id]===undefined){_this.groupCalendars[id]=[cal.calendar_id]}else{_this.groupCalendars[id].push(cal.calendar_id)}}})});_lodash2.default.each(_this.jobCalendars,function(cal,id){_this.jobCalendars[id]=_lodash2.default.uniq(cal)});_this.calendars=calendars;resolve({calendars:calendars})}).catch(function(err){msgs.error("Calendars list could not be retrieved");msgs.error("",err);reject({calendars:calendars,err:err})})})}},{key:"getCalendarGroups",value:function getCalendarGroups(){return Object.keys(this.groupCalendars).map(function(id){return{id:id}})}}]);return CalendarService}();var mlCalendarService=exports.mlCalendarService=new CalendarService},992:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2295);__webpack_require__(337);__webpack_require__(2297)},993:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.kbnTypeToMLJobType=kbnTypeToMLJobType;var _field_types=__webpack_require__(257);function kbnTypeToMLJobType(field){var type=undefined;switch(field.type){case _field_types.KBN_FIELD_TYPES.STRING:type=field.aggregatable?_field_types.ML_JOB_FIELD_TYPES.KEYWORD:_field_types.ML_JOB_FIELD_TYPES.TEXT;break;case _field_types.KBN_FIELD_TYPES.NUMBER:type=_field_types.ML_JOB_FIELD_TYPES.NUMBER;break;case _field_types.KBN_FIELD_TYPES.DATE:type=_field_types.ML_JOB_FIELD_TYPES.DATE;break;case _field_types.KBN_FIELD_TYPES.IP:type=_field_types.ML_JOB_FIELD_TYPES.IP;break;case _field_types.KBN_FIELD_TYPES.BOOLEAN:type=_field_types.ML_JOB_FIELD_TYPES.BOOLEAN;break;case _field_types.KBN_FIELD_TYPES.GEO_POINT:type=_field_types.ML_JOB_FIELD_TYPES.GEO_POINT;break;default:break}return type}},994:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.changeJobIDCase=changeJobIDCase;function changeJobIDCase(config){if(config.jobId){config.jobId=config.jobId.toLowerCase()}}},995:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.SingleMetricJobServiceProvider=SingleMetricJobServiceProvider;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _parse_interval=__webpack_require__(196);var _job_utils=__webpack_require__(34);var _general=__webpack_require__(259);var _string_utils=__webpack_require__(38);var _field_format_service=__webpack_require__(209);var _job_service=__webpack_require__(23);var _results_service=__webpack_require__(338);var _new_job_utils=__webpack_require__(220);var _ml_api_service=__webpack_require__(22);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function SingleMetricJobServiceProvider(){var SingleMetricJobService=function(){function SingleMetricJobService(){_classCallCheck(this,SingleMetricJobService);this.chartData={line:[],model:[],swimlane:[],hasBounds:false,percentComplete:0,highestValue:0,chartTicksMargin:{width:30},totalResults:0};this.job={}}_createClass(SingleMetricJobService,[{key:"getLineChartResults",value:function getLineChartResults(formConfig){var _this=this;return new Promise(function(resolve,reject){_this.chartData.line=[];_this.chartData.model=[];_this.chartData.swimlane=[];_this.chartData.hasBounds=false;_this.chartData.percentComplete=0;_this.chartData.loadingDifference=0;_this.chartData.eventRateHighestValue=0;_this.chartData.totalResults=0;var aggType=formConfig.agg.type.dslName;if(formConfig.field&&formConfig.field.id){_this.chartData.fieldFormat=_field_format_service.mlFieldFormatService.getFieldFormatFromIndexPattern(formConfig.indexPattern,formConfig.field.id,aggType)}else{delete _this.chartData.fieldFormat}var obj={success:true,results:{}};var searchJson=getSearchJsonFromConfig(formConfig);_ml_api_service.ml.esSearch(searchJson).then(function(resp){var aggregationsByTime=_lodash2.default.get(resp,["aggregations","times","buckets"],[]);var highestValue=void 0;var lowestValue=void 0;_lodash2.default.each(aggregationsByTime,function(dataForTime){var time=dataForTime.key;var value=_lodash2.default.get(dataForTime,["field_value","value"]);if(value===undefined&&formConfig.field!==null){value=_lodash2.default.get(dataForTime,["field_value","values",_job_utils.ML_MEDIAN_PERCENTS])}if(value===undefined&&formConfig.field===null){value=dataForTime.doc_count}if(!isFinite(value)||dataForTime.doc_count===0){value=null}if(value!==null){highestValue=highestValue===undefined?value:Math.max(value,highestValue);lowestValue=lowestValue===undefined?value:Math.min(value,lowestValue)}obj.results[time]={actual:value}});_this.chartData.totalResults=resp.hits.total;_this.chartData.line=processLineChartResults(obj.results);lowestValue=lowestValue===undefined?0:lowestValue;highestValue=highestValue===undefined?1:highestValue;var valueRange=highestValue-lowestValue;if(valueRange>1){lowestValue=Math.floor(lowestValue);_this.chartData.highestValue=Math.ceil(highestValue)}else{_this.chartData.highestValue=highestValue}var lowValueWidth=0;var highValueWidth=0;if(_this.chartData.fieldFormat!==undefined){var lowValueFormatted=_this.chartData.fieldFormat.convert(lowestValue,"text");var highValueFormatted=_this.chartData.fieldFormat.convert(_this.chartData.highestValue,"text");lowValueWidth=(0,_string_utils.calculateTextWidth)(lowValueFormatted,false);highValueWidth=(0,_string_utils.calculateTextWidth)(highValueFormatted,false)}else{lowValueWidth=(0,_string_utils.calculateTextWidth)(lowestValue,true);highValueWidth=(0,_string_utils.calculateTextWidth)(_this.chartData.highestValue,true)}_this.chartData.chartTicksMargin.width=Math.max(lowValueWidth,highValueWidth)+10;resolve(_this.chartData)}).catch(function(resp){reject(resp)})})}},{key:"getJobFromConfig",value:function getJobFromConfig(formConfig){var _aggregations2,_aggregations3;var job=_job_service.mlJobService.getBlankJob();job.data_description.time_field=formConfig.timeField;var func=formConfig.agg.type.mlName;if(formConfig.isSparseData){if(formConfig.agg.type.dslName==="count"){func=func.replace(/count/,"non_zero_count")}else if(formConfig.agg.type.dslName==="sum"){func=func.replace(/sum/,"non_null_sum")}}var dtr={function:func};var query=formConfig.combinedQuery;if(formConfig.field&&formConfig.field.id){dtr.field_name=formConfig.field.id}job.analysis_config.detectors.push(dtr);job.analysis_config.bucket_span=formConfig.bucketSpan;job.analysis_limits={model_memory_limit:formConfig.modelMemoryLimit};delete job.data_description.field_delimiter;delete job.data_description.quote_character;delete job.data_description.time_format;delete job.data_description.format;var bucketSpanSeconds=(0,_parse_interval.parseInterval)(formConfig.bucketSpan).asSeconds();var indices=formConfig.indexPattern.title.split(",").map(function(i){return i.trim()});job.datafeed_config={query:query,indices:indices};job.job_id=formConfig.jobId;job.description=formConfig.description;job.groups=formConfig.jobGroups;job.model_plot_config={enabled:true};if(formConfig.useDedicatedIndex){job.results_index_name=job.job_id}if(formConfig.usesSavedSearch===false){job.custom_settings={created_by:_general.WIZARD_TYPE.SINGLE_METRIC}}var aggType=formConfig.agg.type.dslName;var interval=bucketSpanSeconds*1e3;switch(aggType){case"count":job.analysis_config.summary_count_field_name="doc_count";job.datafeed_config.aggregations={buckets:{date_histogram:{field:formConfig.timeField,interval:interval},aggregations:_defineProperty({},formConfig.timeField,{max:{field:formConfig.timeField}})}};break;case"avg":case"median":case"sum":case"min":case"max":job.analysis_config.summary_count_field_name="doc_count";job.datafeed_config.aggregations={buckets:{date_histogram:{field:formConfig.timeField,interval:interval/100*10},aggregations:(_aggregations2={},_defineProperty(_aggregations2,dtr.field_name,_defineProperty({},aggType,{field:formConfig.field.name})),_defineProperty(_aggregations2,formConfig.timeField,{max:{field:formConfig.timeField}}),_aggregations2)}};break;case"cardinality":job.analysis_config.summary_count_field_name="dc_"+dtr.field_name;job.datafeed_config.aggregations={buckets:{date_histogram:{field:formConfig.timeField,interval:interval},aggregations:(_aggregations3={},_defineProperty(_aggregations3,formConfig.timeField,{max:{field:formConfig.timeField}}),_defineProperty(_aggregations3,job.analysis_config.summary_count_field_name,_defineProperty({},aggType,{field:formConfig.field.name})),_aggregations3)}};dtr.function="non_zero_count";dtr.detector_description=func+" ("+dtr.field_name+")";delete dtr.field_name;break;default:break}return job}},{key:"createJob",value:function createJob(formConfig){var _this2=this;return new Promise(function(resolve,reject){_this2.job=_this2.getJobFromConfig(formConfig);var job=(0,_new_job_utils.createJobForSaving)(_this2.job);_job_service.mlJobService.saveNewJob(job).then(function(resp){if(resp.success){resolve(_this2.job)}else{reject(resp)}})})}},{key:"startDatafeed",value:function startDatafeed(formConfig){var datafeedId=_job_service.mlJobService.getDatafeedId(formConfig.jobId);return _job_service.mlJobService.startDatafeed(datafeedId,formConfig.jobId,formConfig.start,formConfig.end)}},{key:"stopDatafeed",value:function stopDatafeed(formConfig){var datafeedId=_job_service.mlJobService.getDatafeedId(formConfig.jobId);return _job_service.mlJobService.stopDatafeed(datafeedId,formConfig.jobId)}},{key:"checkDatafeedState",value:function checkDatafeedState(formConfig){return _job_service.mlJobService.updateSingleJobDatafeedState(formConfig.jobId)}},{key:"loadModelData",value:function loadModelData(formConfig){var _this3=this;return new Promise(function(resolve,reject){var start=formConfig.start;if(_this3.chartData.model.length>5){start=_this3.chartData.model[_this3.chartData.model.length-5].time;for(var i=0;i<5;i++){_this3.chartData.model.pop()}}_results_service.mlResultsService.getModelPlotOutput(formConfig.jobId,0,[],start,formConfig.end,formConfig.resultsIntervalSeconds+"s",formConfig.agg.type.mlModelPlotAgg).then(function(data){var scale=1;if(formConfig&&(formConfig.agg.type.mlName==="count"||formConfig.agg.type.mlName==="high_count"||formConfig.agg.type.mlName==="low_count"||formConfig.agg.type.mlName==="distinct_count")){var chartIntervalSeconds=formConfig.chartInterval.getInterval().asSeconds();var bucketSpan=(0,_parse_interval.parseInterval)(formConfig.bucketSpan);if(bucketSpan!==null){scale=chartIntervalSeconds/bucketSpan.asSeconds()}}_this3.chartData.model=_this3.chartData.model.concat(processLineChartResults(data.results,scale));var lastBucket=_this3.chartData.model[_this3.chartData.model.length-1];var time=lastBucket!==undefined?lastBucket.time:formConfig.start;var pcnt=(time-formConfig.start+formConfig.resultsIntervalSeconds)/(formConfig.end-formConfig.start)*100;_this3.chartData.percentComplete=Math.round(pcnt);resolve(_this3.chartData)}).catch(function(){reject(_this3.chartData)})})}},{key:"loadSwimlaneData",value:function loadSwimlaneData(formConfig){var _this4=this;return new Promise(function(resolve){_results_service.mlResultsService.getScoresByBucket([formConfig.jobId],formConfig.start,formConfig.end,formConfig.resultsIntervalSeconds+"s",1).then(function(data){var jobResults=data.results[formConfig.jobId];_this4.chartData.swimlane=processSwimlaneResults(jobResults);_this4.chartData.swimlaneInterval=formConfig.resultsIntervalSeconds*1e3;resolve(_this4.chartData)}).catch(function(){resolve(_this4.chartData)})})}}]);return SingleMetricJobService}();return new SingleMetricJobService}function processLineChartResults(data){var scale=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var lineData=[];_lodash2.default.each(data,function(dataForTime,t){var time=+t;var date=new Date(time);lineData.push({date:date,time:time,lower:dataForTime.modelLower*scale,value:dataForTime.actual,upper:dataForTime.modelUpper*scale})});return _lodash2.default.sortBy(lineData,"time")}function processSwimlaneResults(bucketScoreData,init){var swimlaneData=[];_lodash2.default.each(bucketScoreData,function(value,t){var time=+t;var date=new Date(time);value=init?0:value;swimlaneData.push({date:date,time:time,value:value,color:""})});return swimlaneData}function getSearchJsonFromConfig(formConfig){var interval=formConfig.chartInterval.getInterval().asMilliseconds()+"ms";var query=_lodash2.default.cloneDeep(formConfig.combinedQuery);var json={index:formConfig.indexPattern.title,size:0,rest_total_hits_as_int:true,body:{query:{},aggs:{times:{date_histogram:{field:formConfig.timeField,interval:interval,min_doc_count:0,extended_bounds:{min:formConfig.start,max:formConfig.end}}}}}};query.bool.must.push({range:_defineProperty({},formConfig.timeField,{gte:formConfig.start,lte:formConfig.end,format:formConfig.format})});json.body.query=query;if(formConfig.field!==null){json.body.aggs.times.aggs={field_value:_defineProperty({},formConfig.agg.type.dslName,{field:formConfig.field.name})}}return json}},996:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.FieldTypeIcon=FieldTypeIcon;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(2);var _field_types=__webpack_require__(257);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function FieldTypeIcon(_ref){var _ref$tooltipEnabled=_ref.tooltipEnabled,tooltipEnabled=_ref$tooltipEnabled===undefined?false:_ref$tooltipEnabled,type=_ref.type;var ariaLabel="";var iconClass="";var iconChar="";switch(type){case _field_types.ML_JOB_FIELD_TYPES.BOOLEAN:ariaLabel="boolean type";iconClass="fa-adjust";break;case _field_types.ML_JOB_FIELD_TYPES.DATE:ariaLabel="date type";iconClass="fa-clock-o";break;case _field_types.ML_JOB_FIELD_TYPES.NUMBER:ariaLabel="number type";iconChar="#";break;case _field_types.ML_JOB_FIELD_TYPES.GEO_POINT:ariaLabel="geo_point type";iconClass="fa-globe";break;case _field_types.ML_JOB_FIELD_TYPES.KEYWORD:ariaLabel="keyword type";iconChar="t";break;case _field_types.ML_JOB_FIELD_TYPES.TEXT:ariaLabel="text type";iconClass="fa-file-text-o";break;case _field_types.ML_JOB_FIELD_TYPES.IP:ariaLabel="IP type";iconClass="fa-laptop";break;case _field_types.ML_JOB_FIELD_TYPES.UNKNOWN:ariaLabel="Unknown type";iconChar="?";break;default:return null}var className="field-type-icon";if(iconClass!==""){className+=" kuiIcon "+iconClass}var containerProps={ariaLabel:ariaLabel,className:className,iconChar:iconChar};if(tooltipEnabled===true){return _react2.default.createElement(_eui.EuiToolTip,{position:"left",content:type+" type"},_react2.default.createElement(FieldTypeIconContainer,containerProps))}return _react2.default.createElement(FieldTypeIconContainer,containerProps)}FieldTypeIcon.propTypes={tooltipEnabled:_propTypes2.default.bool,type:_propTypes2.default.string};function FieldTypeIconContainer(_ref2){var ariaLabel=_ref2.ariaLabel,className=_ref2.className,iconChar=_ref2.iconChar,rest=_objectWithoutProperties(_ref2,["ariaLabel","className","iconChar"]);return _react2.default.createElement("span",_extends({className:"field-type-icon-container"},rest,{tabIndex:"0"}),iconChar===""?_react2.default.createElement("span",{"aria-label":ariaLabel,className:className}):_react2.default.createElement("span",{"aria-label":ariaLabel,className:className},_react2.default.createElement("strong",{"aria-hidden":"true"},iconChar)))}},997:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ChartDataUtilsProvider=ChartDataUtilsProvider;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _ml_time_buckets=__webpack_require__(258);var _string_utils=__webpack_require__(38);var _results_service=__webpack_require__(338);var _search_service=__webpack_require__(472);var _timefilter=__webpack_require__(16);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ChartDataUtilsProvider(Private){var TimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider);function loadDocCountData(formConfig,chartData){return new Promise(function(resolve,reject){var BAR_TARGET=Math.ceil(formConfig.chartInterval.barTarget/10);var MAX_BARS=BAR_TARGET+BAR_TARGET/100*100;var query=formConfig.combinedQuery;var bounds=_timefilter.timefilter.getActiveBounds();var buckets=new TimeBuckets;buckets.setBarTarget(BAR_TARGET);buckets.setMaxBars(MAX_BARS);buckets.setInterval("auto");buckets.setBounds(bounds);var interval=buckets.getInterval().asMilliseconds();var end=formConfig.end;var start=formConfig.start;_results_service.mlResultsService.getEventRateData(formConfig.indexPattern.title,query,formConfig.timeField,start,end,interval+"ms").then(function(resp){var highestValue=0;chartData.job.bars=[];_lodash2.default.each(resp.results,function(value,t){if(!isFinite(value)){value=0}if(value>highestValue){highestValue=value}var time=+t;var date=new Date(time);chartData.job.barsInterval=interval;chartData.job.bars.push({date:date,time:time,value:value})});chartData.totalResults=resp.total;chartData.eventRateHighestValue=Math.ceil(highestValue);resolve(chartData)}).catch(function(resp){console.log("getEventRate visualization - error getting event rate data from elasticsearch:",resp);reject(resp)})})}function loadJobSwimlaneData(formConfig,chartData){return new Promise(function(resolve){_results_service.mlResultsService.getScoresByBucket([formConfig.jobId],formConfig.start,formConfig.end,formConfig.resultsIntervalSeconds+"s",1).then(function(data){var time=formConfig.start;var jobResults=data.results[formConfig.jobId];chartData.job.swimlane=[];_lodash2.default.each(jobResults,function(value,t){time=+t;var date=new Date(time);chartData.job.swimlane.push({date:date,time:time,value:value,color:""})});var pcnt=(time-formConfig.start+formConfig.resultsIntervalSeconds)/(formConfig.end-formConfig.start)*100;chartData.percentComplete=Math.round(pcnt);chartData.job.percentComplete=chartData.percentComplete;chartData.job.swimlaneInterval=formConfig.resultsIntervalSeconds*1e3;resolve(chartData)}).catch(function(){resolve(chartData)})})}function loadDetectorSwimlaneData(formConfig,chartData){return new Promise(function(resolve){_search_service.mlSimpleJobSearchService.getScoresByRecord(formConfig.jobId,formConfig.start,formConfig.end,formConfig.resultsIntervalSeconds+"s",{name:formConfig.splitField!==undefined?formConfig.splitField.name:undefined,value:formConfig.firstSplitFieldName}).then(function(data){var dtrIndex=0;_lodash2.default.each(formConfig.fields,function(field,key){var dtr=chartData.detectors[key];var times=data.results[dtrIndex];dtr.swimlane=[];_lodash2.default.each(times,function(timeObj,t){var time=+t;var date=new Date(time);dtr.swimlane.push({date:date,time:time,value:timeObj.recordScore,color:""})});dtr.percentComplete=chartData.percentComplete;dtr.swimlaneInterval=formConfig.resultsIntervalSeconds*1e3;dtrIndex++});resolve(chartData)}).catch(function(){resolve(chartData)})})}function getSplitFields(formConfig,splitFieldName,size){var query=formConfig.combinedQuery;return _search_service.mlSimpleJobSearchService.getCategoryFields(formConfig.indexPattern.title,splitFieldName,size,query)}function updateChartMargin(chartData){var longestTextWidth=(0,_string_utils.calculateTextWidth)(chartData.eventRateHighestValue,true);var textCheckMultiplier=1+Math.sqrt(2)/100;_lodash2.default.each(chartData.detectors,function(detector){var longestWidthForDetector=0;if(detector.fieldFormat!==undefined){var longestTextForDetector=detector.fieldFormat.convert(detector.highestValue,"text");longestWidthForDetector=(0,_string_utils.calculateTextWidth)(longestTextForDetector,false);var longestTextCheck=detector.fieldFormat.convert(detector.highestValue*textCheckMultiplier,"text");var longestWidthCheck=(0,_string_utils.calculateTextWidth)(longestTextCheck,false);longestWidthForDetector=Math.max(longestWidthForDetector,longestWidthCheck)}else{longestWidthForDetector=(0,_string_utils.calculateTextWidth)(detector.highestValue,true)}longestTextWidth=Math.max(longestTextWidth,longestWidthForDetector)});chartData.chartTicksMargin.width=longestTextWidth+10}return{loadDocCountData:loadDocCountData,loadJobSwimlaneData:loadJobSwimlaneData,loadDetectorSwimlaneData:loadDetectorSwimlaneData,getSplitFields:getSplitFields,updateChartMargin:updateChartMargin}}},998:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.MultiMetricJobServiceProvider=MultiMetricJobServiceProvider;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _general=__webpack_require__(259);var _job_utils=__webpack_require__(34);var _field_format_service=__webpack_require__(209);var _job_service=__webpack_require__(23);var _new_job_utils=__webpack_require__(220);var _ml_api_service=__webpack_require__(22);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function MultiMetricJobServiceProvider(){var MultiMetricJobService=function(){function MultiMetricJobService(){_classCallCheck(this,MultiMetricJobService);this.chartData={job:{swimlane:[],line:[],bars:[],earliestTime:Number.MAX_SAFE_INTEGER},detectors:{},percentComplete:0,loadingDifference:0,lastLoadTimestamp:null,eventRateHighestValue:0,chartTicksMargin:{width:30},totalResults:0};this.job={}}_createClass(MultiMetricJobService,[{key:"clearChartData",value:function clearChartData(){this.chartData.job.swimlane=[];this.chartData.job.line=[];this.chartData.job.bars=[];this.chartData.detectors={};this.chartData.percentComplete=0;this.chartData.loadingDifference=0;this.chartData.eventRateHighestValue=0;this.chartData.totalResults=0;this.job={}}},{key:"getLineChartResults",value:function getLineChartResults(formConfig,thisLoadTimestamp){var _this=this;return new Promise(function(resolve,reject){var fieldIds=Object.keys(formConfig.fields).sort();_this.chartData.job.earliestTime=formConfig.start;var idx=_lodash2.default.findIndex(fieldIds,function(id){return id===_general.EVENT_RATE_COUNT_FIELD});if(idx!==-1){fieldIds.splice(idx,1);fieldIds.splice(0,0,_general.EVENT_RATE_COUNT_FIELD)}_lodash2.default.each(fieldIds,function(fieldId){_this.chartData.detectors[fieldId]={line:[],swimlane:[],highestValue:0}});var searchJson=getSearchJsonFromConfig(formConfig);_ml_api_service.ml.esSearch(searchJson).then(function(resp){if(thisLoadTimestamp===_this.chartData.lastLoadTimestamp){_lodash2.default.each(fieldIds,function(fieldId){_this.chartData.detectors[fieldId]={line:[],swimlane:[],highestValue:0};if(fieldId!==_general.EVENT_RATE_COUNT_FIELD){var field=formConfig.fields[fieldId];var aggType=field.agg.type.dslName;_this.chartData.detectors[fieldId].fieldFormat=_field_format_service.mlFieldFormatService.getFieldFormatFromIndexPattern(formConfig.indexPattern,fieldId,aggType)}})}else{resolve(_this.chartData)}var aggregationsByTime=_lodash2.default.get(resp,["aggregations","times","buckets"],[]);_lodash2.default.each(aggregationsByTime,function(dataForTime){var time=+dataForTime.key;var date=new Date(time);var docCount=+dataForTime.doc_count;_this.chartData.job.swimlane.push({date:date,time:time,value:0,color:"",percentComplete:0});_this.chartData.job.earliestTime=time<_this.chartData.job.earliestTime?time:_this.chartData.job.earliestTime;_this.chartData.job.line.push({date:date,time:time,value:null});_lodash2.default.each(fieldIds,function(fieldId){var value=void 0;if(fieldId===_general.EVENT_RATE_COUNT_FIELD){value=docCount}else if(typeof dataForTime[fieldId].value!=="undefined"){value=dataForTime[fieldId].value}else if(typeof dataForTime[fieldId].values!=="undefined"){value=dataForTime[fieldId].values[_job_utils.ML_MEDIAN_PERCENTS]}if(!isFinite(value)||docCount===0){value=null}if(_this.chartData.detectors[fieldId]){_this.chartData.detectors[fieldId].line.push({date:date,time:time,value:value});_this.chartData.detectors[fieldId].swimlane.push({date:date,time:time,value:0,color:"",percentComplete:0});if(value!==null){_this.chartData.detectors[fieldId].highestValue=Math.ceil(Math.max(_this.chartData.detectors[fieldId].highestValue,Math.abs(value)))}}})});resolve(_this.chartData)}).catch(function(resp){reject(resp)})})}},{key:"getJobFromConfig",value:function getJobFromConfig(formConfig){var job=_job_service.mlJobService.getBlankJob();job.data_description.time_field=formConfig.timeField;if(formConfig.enableModelPlot===true){job.model_plot_config={enabled:true}}else if(formConfig.enableModelPlot===false){delete job.model_plot_config}_lodash2.default.each(formConfig.fields,function(field,key){var func=field.agg.type.mlName;if(formConfig.isSparseData){if(field.agg.type.dslName==="count"){func=func.replace(/count/,"non_zero_count")}else if(field.agg.type.dslName==="sum"){func=func.replace(/sum/,"non_null_sum")}}var dtr={function:func};dtr.detector_description=func;if(key!==_general.EVENT_RATE_COUNT_FIELD){dtr.field_name=field.name;dtr.detector_description+="("+field.name+")"}if(formConfig.splitField!==undefined){dtr.partition_field_name=formConfig.splitField.name}job.analysis_config.detectors.push(dtr)});var influencerFields=formConfig.influencerFields.map(function(f){return f.name});if(influencerFields&&influencerFields.length){job.analysis_config.influencers=influencerFields}var query=formConfig.combinedQuery;job.analysis_config.bucket_span=formConfig.bucketSpan;job.analysis_limits={model_memory_limit:formConfig.modelMemoryLimit};delete job.data_description.field_delimiter;delete job.data_description.quote_character;delete job.data_description.time_format;delete job.data_description.format;var indices=formConfig.indexPattern.title.split(",").map(function(i){return i.trim()});job.datafeed_config={query:query,indices:indices};job.job_id=formConfig.jobId;job.description=formConfig.description;job.groups=formConfig.jobGroups;if(formConfig.useDedicatedIndex){job.results_index_name=job.job_id}if(formConfig.usesSavedSearch===false){job.custom_settings={created_by:_general.WIZARD_TYPE.MULTI_METRIC}}return job}},{key:"createJob",value:function createJob(formConfig){var _this2=this;return new Promise(function(resolve,reject){_this2.job=_this2.getJobFromConfig(formConfig);var job=(0,_new_job_utils.createJobForSaving)(_this2.job);_job_service.mlJobService.saveNewJob(job).then(function(resp){if(resp.success){resolve(_this2.job)}else{reject(resp)}})})}},{key:"startDatafeed",value:function startDatafeed(formConfig){var datafeedId=_job_service.mlJobService.getDatafeedId(formConfig.jobId);return _job_service.mlJobService.startDatafeed(datafeedId,formConfig.jobId,formConfig.start,formConfig.end)}},{key:"stopDatafeed",value:function stopDatafeed(formConfig){var datafeedId=_job_service.mlJobService.getDatafeedId(formConfig.jobId);return _job_service.mlJobService.stopDatafeed(datafeedId,formConfig.jobId)}}]);return MultiMetricJobService}();return new MultiMetricJobService}function getSearchJsonFromConfig(formConfig){var interval=formConfig.chartInterval.getInterval().asMilliseconds()+"ms";var query=_lodash2.default.cloneDeep(formConfig.combinedQuery);var json={index:formConfig.indexPattern.title,size:0,body:{query:{},aggs:{times:{date_histogram:{field:formConfig.timeField,interval:interval,min_doc_count:0,extended_bounds:{min:formConfig.start,max:formConfig.end}}}}}};query.bool.must.push({range:_defineProperty({},formConfig.timeField,{gte:formConfig.start,lte:formConfig.end,format:formConfig.format})});if(formConfig.firstSplitFieldName!==undefined){query.bool.must.push({term:_defineProperty({},formConfig.splitField.name,formConfig.firstSplitFieldName)})}json.body.query=query;if(Object.keys(formConfig.fields).length){json.body.aggs.times.aggs={};_lodash2.default.each(formConfig.fields,function(field){if(field.id!==_general.EVENT_RATE_COUNT_FIELD){json.body.aggs.times.aggs[field.id]=_defineProperty({},field.agg.type.dslName,{field:field.name});if(field.agg.type.dslName==="percentiles"){json.body.aggs.times.aggs[field.id][field.agg.type.dslName].percents=[_job_utils.ML_MEDIAN_PERCENTS]}}})}return json}},999:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2324)}});